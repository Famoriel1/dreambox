var engagement_shared_math,__extends=this&&this.__extends||(()=>{var i=function(e,t){return(i=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function s(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}})(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,s=1,i=arguments.length;s<i;s++)for(var n in t=arguments[s])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};(e=>{var t,i=replayMode?"":DBLRuntime.requireBundle("assets.bundles.engagement.shared.Messaging"),s=DBLRuntime.requireAudio("assets.audio.components.shared.Click"),n=DBLRuntime.requireAudio("assets.audio.engagement.misc.FeedbackSent"),a=DBLRuntime.requireFont("assets.fonts.Quicksand",DBLFont.LIGHT),o=DBLRuntime.requireFont("assets.fonts.Quicksand",DBLFont.BOLD),h=(DBLRuntime.requireLibrary("library.manipulativecore"),t=createjs.Container,__extends(r,t),r.prototype.render=function(e){this._art=DBLAsset.createArtFromBundle("DBLAFeedbackTab",i),this._art.name="art",this.addChild(this._art);var t=this._art.InstTextSubject,s=(t.text=translate(t.text),this._art.InstInputSubject),t=(s.x=t.x+t.getMeasuredWidth()+10,this._edit1=new DBLTextArea(s.nominalBounds.width-50,s.nominalBounds.height-2,o,20,DBLFont.BOLD,"#6D8697",!1),this._edit1.x=s.x+15,this._edit1.y=s.y-1,this._edit1.addEventListener("change",this.onEditChange.bind(this)),this.addChild(this._edit1),this._art.InstTextFeedback),s=(t.text=translate(t.text),this._art.InstInputFeedback),t=(this._edit2=new DBLTextArea(s.nominalBounds.width-60,s.nominalBounds.height-40,o,20,DBLFont.BOLD,"#6D8697"),this._edit2.x=s.x+25,this._edit2.y=s.y-5,this._edit2.addEventListener("change",this.onEditChange.bind(this)),this.addChild(this._edit2),this._art.InstScreenShotContainer),s=(t.visible=!1,this._screenshotCanvas=e,this._screenshot=new createjs.Bitmap(e),this._screenshot.x=t.x,this._screenshot.y=t.y,this._screenshot.scaleX=this._screenshot.scaleY=292/360,this.addChild(this._screenshot),this._art.InstTextSendFeedback),e=(DBLFont.fixFont(s,a,"",DBLFont.LIGHT),s.text=translate(s.text),this._art.InstButtonAccept),t=(e.visible=!1,DBLAsset.create("DBLAButtonSend",i));DBLFont.fixFont(t.InstSendText,a,"",DBLFont.LIGHT),t.InstSendText.text=translate("Send"),t.InstSendText.y+=15,this._sendButton=new DBLTimelineButton(t),this._sendButton.x=e.x-e.regX,this._sendButton.y=e.y-e.regY,this._sendButton.addEventListener("click",this.onSend.bind(this)),this._sendButton.enabled=!1,this._sendButton.name="sendButton",this.addChild(this._sendButton),this._sendingSign=DBLAsset.create("DBLAFeedbackIndicatorSending",i),this._sendingSign.name="sendingSign",this._sendingSign.x=this.getBounds().width/2-this._sendingSign.getBounds().width/2,this._sendingSign.y=this.getBounds().height/2-this._sendingSign.getBounds().height/2,DBLFont.fixFont(this._sendingSign.text,a,"",DBLFont.LIGHT),this._sendingSign.text.text=translate("Sending feedback")},r.prototype.show=function(){var e=this;this._edit1.show(),this._timeout=setTimeout(function(){e._edit1.focus(!0),e._timeout=null},100),this._edit2.show()},r.prototype.hide=function(){this._edit1.hide(),this._edit2.hide()},r.prototype.cleanup=function(){this.removeAllChildren(),this._sendButton&&this._sendButton.removeAllEventListeners(),this._edit1&&(this._edit1.removeAllEventListeners(),this._edit1.cleanup(),this._edit1=null),this._edit2&&(this._edit2.removeAllEventListeners(),this._edit2.cleanup(),this._edit2=null),-1!=this._timeout&&clearTimeout(this._timeout)},r.prototype.tick=function(){this._edit1&&this._edit1.tick(),this._edit2&&this._edit2.tick()},r.prototype.onEditChange=function(){this._sendButton.enabled=""!=this._edit1.text&&""!=this._edit2.text},r.prototype.onSend=function(e){DBLAsset.playSound(s),DBLAutomation.recordClick(shell,"feedbackSend"),this._edit1.focus(!1),this._edit2.focus(!1),this._edit1.enabled=!1,this._edit1.visible=!1,this._edit2.visible=!1,this._edit2.enabled=!1,this._sendButton.enabled=!1,this.addChild(this._sendingSign),this.dispatchEvent("sendingFeedback"),this._timeout=setTimeout(this.afterShortDelay.bind(this),750)},r.prototype.afterShortDelay=function(){this._timeout=-1;var e=this._edit1.text,t=this._edit2.text;DBLError.sendFeedback(e,t,this._screenshotCanvas,this.onFeedbackSent.bind(this))},r.prototype.onFeedbackSent=function(e){this._sendingSign.text.text=translate("Feedback sent.\nThank you!"),DBLAsset.playSound(n),this._timeout=setTimeout(this.sentSignHoldComplete.bind(this),2e3)},r.prototype.sentSignHoldComplete=function(){this._timeout=-1,this.dispatchEvent("feedbackSent")},r);function r(){var e=t.call(this)||this;return e._timeout=-1,e.name="feedbackTab",e}e.FeedbackTab=h})(engagement_shared_math=engagement_shared_math||{}),(n=>{var a,o=replayMode?"":DBLRuntime.requireBundle("assets.bundles.engagement.shared.Messaging"),h=replayMode?"":DBLRuntime.requireFont("assets.fonts.Quicksand",DBLFont.NORMAL),t=DBLRuntime.requireAudio("assets.audio.components.shared.Click"),e=(a=createjs.Container,__extends(s,a),s.prototype.createAudioButtons=function(){this._audioButton=new DBLTimelineButton(DBLAsset.create("DBLAButtonPlayAudio",o)),this._student?this._audioButton.x=709:this._audioButton.x=45,this._audioButton.y=26,this._audioButton.name="audioButton",this._audioButton.addEventListener("click",this.onAudioClick.bind(this)),this.addChild(this._audioButton),this._stopButton=new DBLTimelineButton(DBLAsset.create("DBLAButtonPlayAudioStop",o)),this._stopButton.x=this._audioButton.x,this._stopButton.y=this._audioButton.y,this._stopButton.name="stopButton",this._stopButton.visible=!1,this._stopButton.addEventListener("click",this.onStopClick.bind(this)),this.addChild(this._stopButton)},s.prototype.createImage=function(){this._image=DBLAsset.createArtFromBundle(this._imageLinkage,o),this.addChild(this._image),this._image.name="image",this._student?this._image.x=690:this._image.x=45-this._image.getBounds().width/2,this._image.y=this._text.y+(this._text.getBounds().height-this._image.getBounds().height)/2,this._image.mouseEnabled=!1},s.prototype.createAddReactionButton=function(){this._student||(this._addReactionButton=new DBLTimelineButton(DBLAsset.create("DBLAButtonEmoticonReact",o),null,null,null,null,0,!0),this._addReactionButton.x=this._width-60,this._addReactionButton.y=this._messageHeight-30,this._addReactionButton.name="addReactionButton",this._addReactionButton.addEventListener("click",this.onAddReactionClick.bind(this)),this._addReactionButton.visible=!this._reactionName,this.addChild(this._addReactionButton))},s.prototype.createPanel=function(){this._panel=new n.MessageReactionPanel,this._panel.x=this._width-310,this._panel.y=this._messageHeight-20,this._panel.addEventListener("click",this.onReact.bind(this)),this.addChild(this._panel)},s.prototype.updateReaction=function(){if(!this._student){for(var e,t=0,s=n.REACTION_BUTTONS;t<s.length;t++){var i=s[t];if(i.id==this._reactionName){e=i.linkage;break}}e?(this._reactionButton&&(this._reactionButton.removeAllEventListeners(),this.removeChild(this._reactionButton)),this._reactionButton=new DBLTimelineButton(DBLAsset.create(e,o),null,null,null,null,0,!0),this._reactionButton.name="reactionButton",this.addChild(this._reactionButton),this._reactionButton.x=this._messageBacker.x+this._messageBacker.getBounds().width-60,this._reactionButton.y=this._messageHeight-30,this._reactionButton.addEventListener("click",this.onChangeReactionClick.bind(this))):DBLLog.log("Unknown reaction "+this._reactionName,DBLLog.ERROR)}},s.prototype.comingIntoView=function(){this._imageLinkage&&!this._image&&this.createImage(),this._reactionName&&!this._reactionButton&&this.updateReaction(),this._reactionName||this._addReactionButton||this.createAddReactionButton(),this._audioButton||this.createAudioButtons()},s.prototype.onAddReactionClick=function(){DBLAsset.playSound(t),this.selected=!0},s.prototype.onChangeReactionClick=function(){DBLAsset.playSound(t),this.selected=!0},Object.defineProperty(s.prototype,"selected",{get:function(){return this._selected},set:function(e){var t=this._selected;this._selected=e,this._panel||1!=e||this.createPanel(),1==e&&(this._panel||this.createPanel(),this._panel.visible=!0),0==e&&this._panel&&(this._panel.visible=!1),this._addReactionButton&&(this._addReactionButton.visible=!this._reactionName&&!e),this._reactionButton&&(this._reactionButton.visible=!e),this._selectedFrame.visible=e,!t&&this._selected&&this.dispatchEvent(new createjs.Event("scrollIntoView",!0,!0))},enumerable:!1,configurable:!0}),s.prototype.onAudioClick=function(e){var t,s,i,n,a=this;this._playing||(this.dispatchEvent(new createjs.Event("stopAudio",!0,!0)),t=void 0,this._dreambox?(n=(t="{cache}"+translate("From DreamBox Learning."))+" "+this._text.text,DBLPlay._playTTSDirect_(n,this.onAudioComplete.bind(this))):(s="spanish"===language?this._originatorLabel.text.replace("/a",""):this._originatorLabel.text,t="{nocache}"+translate("From")+" "+s+".",this._stock?(s=t,i="{cache}"+this._text.text,DBLPlay._playTTSDirect_(s,function(){a._stopping?a.onAudioComplete():DBLPlay._playTTSDirect_(i,function(){a.onAudioComplete()})})):(n=t+" "+this._text.text,DBLPlay._playTTSDirect_(n,this.onAudioComplete.bind(this)))),this._playing=!0,this._audioButton.visible=!1,this._stopButton.visible=!0,DBLAutomation.recordClick(shell,"messageTTS"))},s.prototype.onAudioComplete=function(){this._playing=!1,this._stopping=!1,this._audioButton.visible=!0,this._stopButton.visible=!1},s.prototype.onStopClick=function(e){this.stopAudio()},s.prototype.stopAudio=function(){this._playing&&(this._stopping=!0,DBLPlay.fastForwardSohlisg(),this._audioButton.visible=!0,this._stopButton.visible=!1)},s.prototype.onReact=function(e){e.stopPropagation();e=this._panel.clicked;e&&(this._reactionName=e,DBLAsset.playSound(t),DBLAutomation.recordClick(shell,{type:"messageReaction",reaction:e,id:this._id}),this.selected=!1,this.updateReaction(),this.dispatchEvent(new n.MessageUpdateEvent([{messageId:this._id,seen:!0,reactionName:e}])))},s.prototype.getUnloadedScreenshot=function(){if(this._screenshotPath&&!this._screenshotCanvas)return this._screenshotPath},s.prototype.setScreenshot=function(e){this._screenshotCanvas=e,this.removeChild(this._screenshot),this._screenshot=new createjs.Bitmap(e),this._screenshot.x=18,this._screenshot.y=15,this._screenshot.name="screenshot",this.addChild(this._screenshot)},s);function s(e,t,s){var i,n=a.call(this)||this;return n._id=e.id,n._width=s,n._reactionName=e.reactionName,n._screenshotPath=e.thumbnailPath,n._dreambox="DREAMBOX"==e.originator,e.stockName?(n._stock=!0,t&&((t=t[e.stockName])?(i=t[language],n._imageLinkage=t.image):DBLLog.log("Unknown Stock message "+e.stockName,DBLLog.ERROR))):(n._stock=!1,i=e.messageText,n._imageLinkage=n._dreambox?"DBLADreamboxLogoIcon":"DBLABookIcon"),n._student="STUDENT"==e.originator,t=n._student?__user._name_||"Student":n._dreambox?"DreamBox Learning":translate("Teacher")+" "+(e.customerDisplayLastName||""),n._originatorLabel=new createjs.Text(t,DBLFont.getFontString(h,20),"#626262"),n._originatorLabel.mouseEnabled=!1,n._originatorLabel.name="teacherLabel",n._student?(n._originatorLabel.textAlign="right",n._originatorLabel.x=661):n._originatorLabel.x=84,n._originatorLabel.y=17,n._text=new createjs.Text(i||translate("(Message text unavailable)"),DBLFont.getFontString(h,20),"#000000"),n._text.name="text",n._text.lineHeight=1.2*n._text.getMeasuredHeight(),n._student?(n._text.textAlign="right",n._text.x=661,n._text.lineWidth=500):n._dreambox?(n._text.x=84,n._text.lineWidth=630):(n._text.x=84,n._text.lineWidth=483),n._text.y=n._originatorLabel.y+n._originatorLabel.getBounds().height+20,n._text.mouseEnabled=!1,n._messageBacker=new createjs.Shape,n._messageBacker.name="messageBacker",n._student?n._messageHeight=128:n._messageHeight=n._text.y+n._text.getBounds().height+(n._dreambox?40:25),n._messageBacker.graphics.beginFill("DREAMBOX"==e.originator?"#DBECFF":"#F5F5F5"),n._messageBacker.graphics.drawRoundRect(0,0,s,n._messageHeight,11),n._messageBacker.setBounds(0,0,s,n._messageHeight),n._messageBacker.mouseEnabled=!0,n._selectedFrame=new createjs.Shape,n._selectedFrame.name="selectedIndicator",n._selectedFrame.graphics.setStrokeStyle(4).beginStroke("#4B83AF"),n._selectedFrame.graphics.drawRoundRect(2,0,s-4,n._messageHeight,11),n._selectedFrame.setBounds(0,0,s,n._messageHeight),n._selectedFrame.mouseEnabled=!1,n._selectedFrame.visible=!1,n.addChild(n._messageBacker),n.addChild(n._selectedFrame),n.addChild(n._text),n.addChild(n._originatorLabel),n._student&&((t=new createjs.Shape).name="placeholder",t.x=18,t.y=14,t.graphics.beginFill("#888888"),t.graphics.drawRect(0,0,132,100),t.setBounds(0,0,132,100),t.mouseEnabled=!1,n._screenshot=t,n.addChild(n._screenshot)),n.coreHeight=n.getBounds().height,n}n.Message=e})(engagement_shared_math=engagement_shared_math||{}),(a=>{var t,n=replayMode?"":DBLRuntime.requireBundle("assets.bundles.engagement.shared.Messaging"),s=DBLRuntime.requireAudio("assets.audio.components.shared.Click"),e=(DBLRuntime.requireFont("assets.fonts.Quicksand",DBLFont.NORMAL),DBLRuntime.requireFont("assets.fonts.Quicksand",DBLFont.BOLD),t=createjs.Container,__extends(i,t),i.prototype.load=function(e){var t=this;DBLRuntime.loadLinkedAssets(n,"*",function(){t._messageTab.load(e)})},i.prototype.render=function(e,t){this._screenshot360=new createjs.Container,this._screenshot360.cache(0,0,360,270,1);var s=this._screenshot360.cacheCanvas,s=(this.drawScreen(s,360/(1024*lessonContent.scaleX)),this._screenshot128=new createjs.Container,this._screenshot128.cache(0,0,128,96,1),this._screenshot128.cacheCanvas),s=(this.drawScreen(s,128/(1024*lessonContent.scaleX)),this._screenshot768=new createjs.Container,this._screenshot768.cache(0,0,768,576,1),this._screenshot768.cacheCanvas),s=(this.drawScreen(s,768/(1024*lessonContent.scaleX)),DBLAsset.createArtFromBundle("DBLATabbedDialogTemplate",n)),i=(this._backer=DBLAsset.createArtFromBundle("DBLAToolHelpPopupBase",n),this._backer.name="backer",this._backer.addEventListener("click",this.onClickAnywhere.bind(this)),this.addChild(this._backer),this._messageTab.render(e,this._screenshot128.cacheCanvas,this._screenshot768.cacheCanvas),this.addChild(this._messageTab),this._messageTab.y=74,this._feedbackTab.render(this._screenshot360.cacheCanvas),this._feedbackTab.visible=!1,this.addChild(this._feedbackTab),DBLAsset.createArtFromBundle("DBLATabTeachers",n)),i=(i.text.text=translate(i.text.text),i.text.mouseEnabled=!1,this._messageTabButton=new DBLToggleTimelineButton(i),this._messageTabButton.name="messageTabButton",this._messageTabButton.x=s.InstTabTeachers.x-s.InstTabTeachers.regX,this._messageTabButton.y=s.InstTabTeachers.y-s.InstTabTeachers.regY,this._messageTabButton.addEventListener("click",this.onTabClick.bind(this,1)),this.addChild(this._messageTabButton),DBLAsset.createArtFromBundle("DBLATabDreambox",n)),i=(i.text.text=translate(i.text.text),i.text.mouseEnabled=!1,this._feedbackTabButton=new DBLToggleTimelineButton(i),this._feedbackTabButton.name="feedbackTabButton",this._feedbackTabButton.x=s.InstTabDreambox.x-s.InstTabDreambox.regX,this._feedbackTabButton.y=s.InstTabDreambox.y-s.InstTabDreambox.regY,this._feedbackTabButton.addEventListener("click",this.onTabClick.bind(this,2)),this.addChild(this._feedbackTabButton),DBLAsset.createArtFromBundle("DBLAFeedbackHeader",n)),i=(i.name="messageImage",i.x=s.InstFeedbackHeader.x-s.InstFeedbackHeader.regX,i.y=s.InstFeedbackHeader.y-s.InstFeedbackHeader.regX,this.addChild(i),__sendMessages&&((i=DBLAsset.createArtFromBundle("DBLAToolHelpButton",n)).text.text=translate(i.text.text),i.text.mouseEnabled=!1,this._helpButton=new DBLTimelineButton(i),this._helpButton.name="helpButton",this._helpButton.x=s.InstToolHelp.x-s.InstToolHelp.regX,this._helpButton.y=s.InstToolHelp.y-s.InstToolHelp.regY,this.addChild(this._helpButton),this._helpButton.addEventListener("click",this.onHelp.bind(this))),this._closeButton=new DBLTimelineButton(DBLAsset.create("DBLAButtonCloseHelpTool",n)),this._closeButton.name="closeButton",this._closeButton.x=s.InstClosPopup.x-s.InstClosPopup.regX,this._closeButton.y=s.InstClosPopup.y-s.InstClosPopup.regY,this.addChild(this._closeButton),this._closeButton.addEventListener("click",this.onClose.bind(this)),this.setTab(1),__sendFeedback||(assert(__messaging),this._feedbackTabButton.visible=!1),s.InstTeacherTab),i=(this._messageTab.x=i.x-i.regX,this._messageTab.y=i.y-i.regY,s.InstFeedbackTab);this._feedbackTab.x=i.x-i.regX,this._feedbackTab.y=i.y-i.regY,this._messageTab.addEventListener("sendingFeedback",this.onSendingFeedback.bind(this)),this._messageTab.addEventListener("feedbackSent",this.onFeedbackSent.bind(this)),this._messageTab.addEventListener("feedbackNotSent",this.onFeedbackNotSent.bind(this)),this._feedbackTab.addEventListener("sendingFeedback",this.onSendingFeedback.bind(this)),this._feedbackTab.addEventListener("feedbackSent",this.onFeedbackSent.bind(this)),this._xOriginal=this.x,this._yOriginal=this.y,this.resize(),this.registerSeen(e),a11y.updateAccessibility()},i.prototype.cleanup=function(){this.removeAllChildren(),this._messageTab.removeAllEventListeners(),this._messageTab.cleanup(),this._messageTab=null,this._feedbackTab.removeAllEventListeners(),this._feedbackTab.cleanup(),this._feedbackTab=null},i.prototype.tick=function(){this._messageTab.tick(),this._feedbackTab.tick()},i.prototype.resize=function(){this.scaleX=this.scaleY=lessonContent.scaleX,this.x=this._xOriginal*lessonContent.scaleX,this.y=this._yOriginal*lessonContent.scaleX},i.prototype.setTab=function(e){this._messageTabButton.selected=1===e,this._feedbackTabButton.selected=2===e,this._messageTab.visible=1===e,this._feedbackTab.visible=2===e,1===this._tab&&this._messageTab.hide(),2===this._tab&&this._feedbackTab.hide(),this._tab=e,1===this._tab&&this._messageTab.show(),2===this._tab&&this._feedbackTab.show()},i.prototype.onTabClick=function(e){DBLAsset.playSound(s),this.onClickAnywhere(),DBLAutomation.recordClick(shell,"messagingTab"+e),this.setTab(e)},i.prototype.registerSeen=function(e){for(var t=[],s=0,i=e.messages;s<i.length;s++){var n=i[s];"STUDENT"==n.originator||n.seen||t.push({messageId:n.id,seen:!0})}0<t.length&&this.dispatchEvent(new a.MessageUpdateEvent(t))},i.prototype.onSendingFeedback=function(){this.mouseEnabled=this.mouseChildren=!1},i.prototype.onFeedbackSent=function(){this.dispatchEvent(new createjs.Event("close",!0,!0))},i.prototype.onFeedbackNotSent=function(){this.mouseEnabled=this.mouseChildren=!0},i.prototype.onClickAnywhere=function(){1===this._tab&&this._messageTab.onClickAnywhere()},i.prototype.onClose=function(){this._messageTab.stopAudio(),DBLAsset.playSound(s),this.dispatchEvent(new createjs.Event("close",!0,!0))},i.prototype.onHelp=function(){this._messageTab.stopAudio(),this._messageTab.onClickAnywhere(),DBLAsset.playSound(s),this.dispatchEvent(new createjs.Event("help",!0,!0))},i.prototype.drawScreen=function(e,t){e.getContext("2d").scale(t/dblDevicePixelRatio,t/dblDevicePixelRatio),backgroundStage!=lessonStage&&e.getContext("2d").drawImage(backgroundStage.canvas,0,0),spriteStage&&e.getContext("2d").drawImage(spriteStage.canvas,0,0),e.getContext("2d").drawImage(lessonStage.canvas,0,0),e.getContext("2d").drawImage(engagementStage.canvas,0,0),e.getContext("2d").scale(1/dblDevicePixelRatio,1/dblDevicePixelRatio)},i.prototype.playbackClick=function(e){return!!this._backer&&("messagingTab1"==e?(this.onTabClick(1),!0):"messagingTab2"==e&&(this.onTabClick(2),!0))},i.prototype.getAccessibilityData=function(){return{tabIndex:0,type:"modaldialog",display:{object:this},labelObject:{id:"shellMessageModal"},children:[this._closeButton&&__assign(__assign({},this._closeButton.getAccessibilityData()),{labelObject:{id:"shellMessageClose"}})].filter(function(e){return!!e}),onEsc:null}},i);function i(){var e=t.call(this)||this;return e.name="messageDialog",e._messageTab=new a.MessageTab,e._feedbackTab=new a.FeedbackTab,e}a.MessageDialog=e})(engagement_shared_math=engagement_shared_math||{}),(e=>{var t,o="assets.bundles.engagement.shared.HelpDisplay",h="assets.bundles.engagement.shared.HelpThumbNailFrame",r="assets.bundles.engagement.shared.HelpDemos.HelpDemo_TSCHelp",s=(t=createjs.Container,__extends(i,t),i.prototype.load=function(e){this._loadCallback=e,this._loader=new createjs.LoadQueue,this._loader.on("error",this.onDataLoadFailed.bind(this)),this._loader.on("complete",this.onDataLoaded.bind(this,!0)),this._loader.on("fileload",onPotentialAnimateFileLoad);for(var t=0,s=0,i=["components.shared.helppopup.HelpPopUp",o,h,r];s<i.length;s++){var n,a=i[s];objectFromFQN(a)||(n=fileFromFQN(a),DBLLog.log("Loading "+n,DBLLog.INFO),this._loader.loadFile({src:n,id:a,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1),t++)}0<t?this._loader.load():this.onDataLoaded(!0)},i.prototype.onDataLoadFailed=function(){DBLLog.log("Error loading help resources",DBLLog.ERROR),this.onDataLoaded(!1)},i.prototype.onDataLoaded=function(e){this._loader.removeAllEventListeners(),this._loader.destroy(),this._loader=void 0;var t=this._loadCallback;this._loadCallback=null,t(e)},i.prototype.tick24=function(e){this._popup&&this._popup.tick24(e)},i.prototype.ready=function(){this._popup=new components_shared_helppopup.HelpPopUp,this._popup.scrimless=!0,this._popup.name="popup",this._popup.automationComponent=shell;var e=objectFromFQN(o),e=(this._popup.bundle=e,this._popup.thumbnailBundle=objectFromFQN(h),this._popup.titleScript=translate("Messaging Help"),this._popup.textWidth=600,this._popup.setBack("DBLAToolHelpMainModule",e),this._popup.setSpeakerButton("DBLAButtonToolHelpAudio",e),this._popup.setCloseButton("DBLAButtonCloseHelpTool",e),this._popup.setNavButtonAssets("DBLAButtonPageDot","DBLAButtonPageDot_Up","DBLAButtonPageDot_Down","DBLAButtonPageDot_Over","DBLAButtonPageDot_Highlighted","DBLAButtonPageDot_Selected","DBLAButtonPageDot_SelectedHighlight"),this.addChild(this._popup),this._popup.addEventListener(DBLComponentEvent.COMPONENT_EVENT,this.onComponentEvent.bind(this)),this._popup.resetDisplayScripts(),objectFromFQN(r));this._popup.addPanel("Click the Message button to see your messages. You can send an emoji response or choose an icon to create a new message.","HelpDemo_TSCMessaging",e),this._popup.showPanel(),this.resize()},i.prototype.resize=function(){this.scaleX=this.scaleY=lessonContent.scaleX,this.x=lessonContent.scaleX,this.y=lessonContent.scaleX},i.prototype.onComponentEvent=function(e){"panelSelected"!=e.getSubtype()&&("scrimClicked"==e.getSubtype()||"closeButtonClicked"==e.getSubtype()?(this._popup.hidePanel(),this.dispatchEvent("close",!0,!0)):"speakerButtonClicked"==e.getSubtype()&&(this._popup.speakerButtonEnabled=!1,e=translate(this._popup.getDisplayScript()),DBLPlay._playTTSDirect_("{cache}"+e,this.onAudioComplete.bind(this)),this._playing=!0))},i.prototype.onAudioComplete=function(){this._playing=!1,this._popup.speakerButtonEnabled=!0},i.prototype.stopAudio=function(){this._playing&&DBLPlay.fastForwardSohlisg()},i.prototype.cleanup=function(){this.stopAudio()},i);function i(){return t.call(this)||this}e.MessageHelp=s})(engagement_shared_math=engagement_shared_math||{}),(u=>{var g,m=DBLRuntime.requireFont("assets.fonts.Quicksand",DBLFont.NORMAL),e=(g=createjs.Container,__extends(p,g),p.prototype.addTemplate=function(){var e,t;this._messageTemplateVisible?this.scrollToBottom():(t=this._ySavedInCaseWeSend,this._messageTemplate.visible=!0,this._messageTemplateVisible=!0,t+=this._messageTemplate.getBounds().height+47,this._ySavedInCaseWeSend=t,t+=20,e=this._backerHeight,this._backerHeight=Math.max(t,this._height),this._scrollbar.updateTotalHeight(this._backerHeight),t=-(this._backerHeight-this._height),this._innerContainer.y=-(e-this._height),this._scrollbar.position=-t,this.showMessagesInView(),this._innerContainer.y!=t&&gsap.TweenLite.to(this._innerContainer,.3,{y:t}))},p.prototype.removeTemplate=function(){var e,t,s=this;this._messageTemplateVisible&&(this._messageTemplateVisible=!1,e=this._ySavedInCaseWeSend,e-=this._messageTemplate.getBounds().height+47,this._ySavedInCaseWeSend=e,e+=30,this._innerContainer.y<=-this._backerHeight+1.5*this._height?(this._backerHeight=Math.max(e,this._height),this._scrollbar.updateTotalHeight(this._backerHeight),t=-(this._backerHeight-this._height),this._scrollbar.position=-t,this._innerContainer.y!=t?gsap.TweenLite.to(this._innerContainer,.3,{y:t,onComplete:function(){s._messageTemplate.visible=!1,s.showMessagesInView()}}):this._messageTemplate.visible=!1):(this._backerHeight=Math.max(e,this._height),this._scrollbar.updateTotalHeight(this._backerHeight),this._scrollbar.position=-this._innerContainer.y,this._messageTemplate.visible=!1))},p.prototype.tick=function(){!this._screenshotLoading&&0<this._screenshotsToLoad.length&&(this._screenshotLoading=this._screenshotsToLoad.shift(),DBLMessageManager.getImage(this._screenshotLoading.id,this.onScreenshotLoaded.bind(this)))},p.prototype.onScreenshotLoaded=function(e){e&&this._screenshotLoading.message.setScreenshot(e),this._screenshotLoading=null},p.prototype.cleanup=function(){this._screenshotLoading&&(DBLMessageManager.cancelGetImage(),this._screenshotLoading=null);for(var e=0,t=this._messages;e<t.length;e++)t[e].removeAllEventListeners();this._messages=[],this._scrollbar.removeAllEventListeners()},p.prototype.onScroll=function(){this._innerContainer.y=-this._scrollbar.position,this.showMessagesInView()},p.prototype.onClick=function(e){for(var t=e.target,s=!1;t&&!(t instanceof u.Message)&&!(t instanceof u.MessageTemplate);)"reactionButton"!=t.name&&"addReactionButton"!=t.name&&"messageReactionPanel"!=t.name||(s=!0),t=t.parent;for(var i=0,n=this._messages;i<n.length;i++){var a=n[i];a==t&&s?a.selected=!0:a==t&&!s||(a.selected=!1)}this._messageTemplate&&t!=this._messageTemplate&&(this._messageTemplate.cancelSetMessage(),this.dispatchEvent(new createjs.Event("cancelSetMessage",!0,!0))),this._innerContainer.addChild(t)},p.prototype.onClickAnywhere=function(){for(var e=0,t=this._messages;e<t.length;e++)t[e].selected=!1;this.cancelSetMessage(),this.dispatchEvent(new createjs.Event("cancelSetMessage",!0,!0))},p.prototype.stopAudio=function(){for(var e=0,t=this._messages;e<t.length;e++)t[e].stopAudio();this._messageTemplate&&this._messageTemplate.stopAudio()},p.prototype.showMessagesInView=function(){this._screenshotsToLoad=[];for(var e=0,t=this._messages;e<t.length;e++){var s=t[e],i=this._innerContainer.y+s.y,n=!0;i>this._height&&(n=!1),i+s.getBounds().height<0&&(n=!1),!s.visible&&n&&s.comingIntoView(),s.visible=n,s.visible&&(i=void 0,i=s.getUnloadedScreenshot())&&this._screenshotsToLoad.push({id:i,message:s})}},p.isSameDay=function(e,t){return new Date(e).toDateString()==new Date(t).toDateString()},p.prototype.setMessage=function(e){this._messageTemplate.setMessage(e);for(var t=0,s=this._messages;t<s.length;t++)s[t].selected=!1},p.prototype.cancelSetMessage=function(){this._messageTemplate&&this._messageTemplateVisible&&(this._messageTemplate.cancelSetMessage(),this.removeTemplate())},p.prototype.scrollToBottom=function(){this._innerContainer.y=-(this._backerHeight-this._height),this._scrollbar.position=-this._innerContainer.y,this.showMessagesInView()},p.prototype.scrollIntoView=function(e){var t=e.target.y,e=e.target.coreHeight+45,s=this._innerContainer.y,t=t+s,i=this._height,n=s;i<=t+e?n-=t+e-i+25:t<0&&(n+=15-t),n!=s&&(this._innerContainer.y=n,this._scrollbar.position=-n,this.showMessagesInView())},p);function p(e,t,s,i,n){var a=g.call(this)||this,o=(a._messages=[],a._screenshotLoading=null,a._innerContainer=new createjs.Container,a._innerContainer.name="innerContainer",30);e.messages||(e.messages=[]);for(var h,r=e.messages.length-1;0<=r;r--){var d,l=e.messages[r],c=(_&&p.isSameDay(l.createdAt,_)||(_&&(o+=10,(d=new createjs.Shape).name="line",d.graphics.setStrokeStyle(4).beginStroke("#F5F5F5"),d.graphics.moveTo(0,0).lineTo(s,0),d.setBounds(0,-2,s,4),d.y=o,o+=30,a._innerContainer.addChild(d)),d=new Date(l.createdAt).toLocaleDateString(Loc.getLanguageTag(),{weekday:"long",year:"numeric",month:"long",day:"numeric"}),(c=new createjs.Text(d,DBLFont.getFontString(m,20),"#666666")).x=(s-c.getBounds().width)/2,c.y=o,c.mouseEnabled=!1,c.name="dateLabel",a._innerContainer.addChild(c),o+=c.getMeasuredHeight()+30,_=l.createdAt),new u.Message(l,t,737)),_=l.createdAt;c.name="message "+l.id,c.y=o,o+=c.getBounds().height+47,c.addEventListener("click",a.onClick.bind(a)),c.addEventListener("stopAudio",a.stopAudio.bind(a)),c.addEventListener("scrollIntoView",a.scrollIntoView.bind(a)),a._innerContainer.addChild(c),c.visible=!1,a._messages.push(c)}return a._ySavedInCaseWeSend=o,o+=30,0!=e.messages.length||__sendMessages||((h=new createjs.Text(translate("(There are no messages.)"),DBLFont.getFontString(m,20),"#666666")).x=(s-h.getBounds().width)/2,h.y=(i-h.getBounds().height)/2,h.mouseEnabled=!1,h.name="noMessages",a._innerContainer.addChild(h)),a._backerHeight=Math.max(o,i),a._innerContainer.y=-(a._backerHeight-i),a.addChild(a._innerContainer),__sendMessages&&(a._messageTemplate=new u.MessageTemplate(t,737,n),a._messageTemplate.name="protoMessage",a._messageTemplate.y=o,o+=a._messageTemplate.getBounds().height,a._messageTemplate.addEventListener("click",a.onClick.bind(a)),a._messageTemplate.addEventListener("stopAudio",a.stopAudio.bind(a)),a._messageTemplate.addEventListener("scrollIntoView",a.scrollIntoView.bind(a)),a._messageTemplate.visible=!1,a._messageTemplateVisible=!1,a._innerContainer.addChild(a._messageTemplate)),(h=new createjs.Shape).graphics.beginFill("#000000"),h.graphics.drawRect(-2,0,s+4,i),h.setBounds(-2,0,s+4,i),a._innerContainer.mask=h,a._scrollbar=new u.MessageScrollBar(i,a._backerHeight,a._backerHeight-i),a.addChild(a._scrollbar),a._scrollbar.x=s+26,a._scrollbar.y=-2,a._scrollbar.addEventListener("scroll",a.onScroll.bind(a)),a._height=i,a.showMessagesInView(),a}u.MessageList=e})(engagement_shared_math=engagement_shared_math||{}),(h=>{var r,d=replayMode?"":DBLRuntime.requireBundle("assets.bundles.engagement.shared.Messaging"),e=(h.REACTION_BUTTONS=[{instance:"like",linkage:"DBLAButtonHeart",id:"HEART"},{instance:"thumbsup",linkage:"DBLAButtonLike",id:"THUMBS_UP"},{instance:"smile",linkage:"DBLAButtonSmile",id:"SMILE"},{instance:"neutral",linkage:"DBLAButtonNeutral",id:"NEUTRAL"},{instance:"thumbsdown",linkage:"DBLAButtonThumbsDown",id:"THUMBS_DOWN"}],r=createjs.Container,__extends(t,r),t.prototype.onClick=function(e,t){this.clicked=e},t);function t(){for(var e=r.call(this)||this,t=(e.name="messageReactionPanel",DBLAsset.create("DBLAEmoticonBG",d)),s=(t.scaleX=t.scaleY=.5,e.addChild(t),DBLAsset.create("DBLAReactionPanel",d)),i=0,n=h.REACTION_BUTTONS;i<n.length;i++){var a=n[i],o=DBLAsset.create(a.linkage,d),o=new DBLTimelineButton(o,null,null,null,null,0,!0);o.name="reactionButton",o.x=s[a.instance].x-s[a.instance].regX,o.y=s[a.instance].y-s[a.instance].regY,e.addChild(o),o.addEventListener("click",e.onClick.bind(e,a.id))}return e}h.MessageReactionPanel=e})(engagement_shared_math=engagement_shared_math||{}),(e=>{var n,a=replayMode?"":DBLRuntime.requireBundle("assets.bundles.engagement.shared.Messaging"),t=(n=createjs.Container,__extends(s,n),s.prototype.updateTotalHeight=function(e){this._totalHeight=e,this.updateThumb(this.position)},s.prototype.updateThumb=function(e){var t=this,s=(this._thumb&&this.removeChild(this._thumb),this._thumb=new createjs.Shape,this._thumb.name="thumb",this._effectiveBackerHeight=this._backer.getBounds().height-4,this._effectiveBackerX=__sendMessages?1.5:2,this._effectiveBackerY=this._backer.y+(__sendMessages?4.5:2),this._thumbHeight=Math.max(this._effectiveBackerHeight*this._windowHeight/this._totalHeight,20),this._thumb.graphics.beginLinearGradientFill(["#A4C6DF","#3079AF"],[.114,.894],0,-113,0,113),this._thumb.graphics.drawRoundRect(0,0,this._backer.getBounds().width-3,this._thumbHeight,8),this._thumb.setBounds(0,0,this._backer.getBounds().width-3,this._thumbHeight),this._thumb.x=this._effectiveBackerX,this._effectiveBackerHeight-this._thumbHeight),i=this._totalHeight-this._windowHeight,e=(this._thumb.y=this._effectiveBackerY+(0==i?0:e*s/i),this.addChild(this._thumb),this._thumb.addEventListener("mouseover",function(){t._thumb.visible=!1,t._thumbOver.visible=!0}),this._thumb.addEventListener("mouseout",function(){t._thumb.visible=!0,t._thumbOver.visible=!1}),this._thumb.addEventListener("mousedown",this.onMouseDown.bind(this)),new createjs.Shape);e.graphics.beginFill("white"),e.graphics.drawRect(-10,0,this._backer.getBounds().width+20,this._thumbHeight),this._thumb.hitArea=e,this._thumbOver&&this.removeChild(this._thumbOver),this._thumbOver=new createjs.Shape,this._thumbOver.name="thumbOver",this._thumbOver.graphics.beginLinearGradientFill(["#B1D6F0","#3789C4"],[.114,.894],0,-113,0,113),this._thumbOver.graphics.drawRoundRect(0,0,this._backer.getBounds().width-3,this._thumbHeight,8),this._thumbOver.setBounds(0,0,this._backer.getBounds().width-3,this._thumbHeight),this._thumbOver.x=this._thumb.x,this._thumbOver.y=this._thumb.y,this._thumbOver.visible=!1,this.addChild(this._thumbOver),this._thumbOver.cursor="pointer",this._thumbOver.addEventListener("mouseover",function(){t._thumb.visible=!1,t._thumbOver.visible=!0}),this._thumbOver.addEventListener("mouseout",function(){t._thumb.visible=!0,t._thumbOver.visible=!1}),this._thumbOver.addEventListener("mousedown",this.onMouseDown.bind(this)),this._thumbOver.hitArea=e},s.prototype.onMouseDown=function(e){this._stageYDown=e.stageY,this._yDown=this._thumb.y,this.stage.addEventListener("stagemousemove",this._mouseMoveHandler=this.onMouseMove.bind(this)),this.stage.addEventListener("stagemouseup",this._mouseUpHandler=this.onMouseUp.bind(this))},s.prototype.onMouseMove=function(e){e=(e.stageY-this._stageYDown)/(engagementContent.scaleX*this.stage.scaleX),this._thumb.y=this._yDown+e,this._thumb.y=Math.max(this._effectiveBackerY,this._thumb.y),e=this._effectiveBackerHeight-this._thumbHeight;this._thumb.y=Math.min(this._effectiveBackerY+e,this._thumb.y),this._thumbOver.x=this._thumb.x,this._thumbOver.y=this._thumb.y,this.dispatchEvent(new createjs.Event("scroll",!0,!0))},s.prototype.onMouseUp=function(e){this.stage.removeEventListener("stagemousemove",this._mouseMoveHandler),this.stage.removeEventListener("stagemouseup",this._mouseUpHandler),this._mouseMoveHandler=null,this._mouseUpHandler=null},Object.defineProperty(s.prototype,"position",{get:function(){var e,t=this._effectiveBackerHeight-this._thumbHeight;return 0==t?0:(e=this._totalHeight-this._windowHeight,(this._thumb.y-this._effectiveBackerY)*e/t)},set:function(e){var t,s=this._effectiveBackerHeight-this._thumbHeight;0!=s&&(t=this._totalHeight-this._windowHeight,this._thumb.y=this._thumbOver.y=this._effectiveBackerY+s*e/t)},enumerable:!1,configurable:!0}),s.prototype.onUpClick=function(){this._thumb.y=Math.max(this._effectiveBackerY,this._thumb.y-.9*this._thumbHeight),this._thumbOver.x=this._thumb.x,this._thumbOver.y=this._thumb.y,this.dispatchEvent(new createjs.Event("scroll",!0,!0))},s.prototype.onDownClick=function(){var e=this._effectiveBackerHeight-this._thumbHeight;this._thumb.y=Math.min(this._effectiveBackerY+e,this._thumb.y+.9*this._thumbHeight),this._thumbOver.x=this._thumb.x,this._thumbOver.y=this._thumb.y,this.dispatchEvent(new createjs.Event("scroll",!0,!0))},s);function s(e,t,s){var i=n.call(this)||this,e=(i.name="messageScrollBar",i._windowHeight=e,i._totalHeight=t,DBLAsset.create("DBLAScrollbar_arrow_up",a)),t=new createjs.Shape;return t.graphics.beginFill("white"),t.graphics.drawRect(-10,-5,e.getBounds().width+20,e.getBounds().height+10),i._upButton=new DBLTimelineButton(e,null,null,null,t),i._upButton.name="upButton",i._upButton.x=0,i._upButton.y=6,i._upButton.addEventListener("click",i.onUpClick.bind(i)),i.addChild(i._upButton),i._backer=DBLAsset.create(__sendMessages?"DBLAScrollBarShortBG":"DBLAScrollBarBG",a),i._backer.name="backer",i._backer.x=1,i._backer.y=29,i._backer.mouseEnabled=!1,i.addChild(i._backer),i._downButton=new DBLTimelineButton(DBLAsset.create("DBLAScrollbar_arrow_down",a),null,null,null,t),i._downButton.name="downButton",i._downButton.x=0,i._downButton.y=__sendMessages?351:389,i._downButton.addEventListener("click",i.onDownClick.bind(i)),i.addChild(i._downButton),i.updateThumb(s),i}e.MessageScrollBar=t})(engagement_shared_math=engagement_shared_math||{}),(r=>{var t,d="assets.data.engagement.shared.StockMessageData",l=replayMode?"":DBLRuntime.requireBundle("assets.bundles.engagement.shared.Messaging"),s=[{instance:"InstButtonGotIt",linkage:"DBLAButtonGotIt",id:"MESSAGE_GOT_IT"},{instance:"InstButtonPractice",linkage:"DBLAButtonPractice",id:"MESSAGE_PRACTICE"},{instance:"InstButtonTime",linkage:"DBLAButtonTime",id:"MESSAGE_TIME"},{instance:"InstButtonBreak",linkage:"DBLAButtonBreak",id:"MESSAGE_BREAK"},{instance:"InstButtonPeer",linkage:"DBLAButtonPeer",id:"MESSAGE_PEER"},{instance:"InstButtonHelp",linkage:"DBLAButtonHelp",id:"MESSAGE_HELP"}],c=DBLRuntime.requireFont("assets.fonts.Quicksand",DBLFont.LIGHT),n=DBLRuntime.requireAudio("assets.audio.components.shared.Click"),i=DBLRuntime.requireAudio("assets.audio.engagement.misc.FeedbackSent"),e=(t=createjs.Container,__extends(a,t),a.prototype.load=function(e){this._loadCallback=e,this._loader=new createjs.LoadQueue,this._loader.on("error",this.onDataLoadFailed.bind(this)),this._loader.on("complete",this.onDataLoaded.bind(this));var t,e=0;objectFromFQN(d)||(t=fileFromFQN(d,".csv"),DBLLog.log("Loading "+t,DBLLog.INFO),this._loader.loadFile({src:t,id:d,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1),e++),0<e?this._loader.load():this.onDataLoaded()},a.prototype.tick=function(){this._messageList&&this._messageList.tick()},a.prototype.onDataLoadFailed=function(){DBLLog.log("Error loading stock message data - stock message text will show placeholder",DBLLog.WARN),this.onDataLoaded()},a.prototype.onDataLoaded=function(){objectFromFQN(d)||(window[d.split(".").join("_")]=DBLCSVUtils.createIndexedCSVStructure(this._loader.getResult(d),d)),this._loader.removeAllEventListeners(),this._loader.destroy(),this._loader=void 0;var e=this._loadCallback;this._loadCallback=null,e()},a.prototype.render=function(e,t,s){this._screenshot128=t,this._screenshot768=s;var i=DBLAsset.createArtFromBundle(__sendMessages?"DBLATeacherTabWithSend":"DBLATeacherTab",l),s=i[__sendMessages?"InstMessageDisplayShortBG":"InstMessageDisplayBG"];if(this._messageList=new r.MessageList(e,objectFromFQN(d),737,s.nominalBounds.height-2,t),this._messageList.name="messageList",this._messageList.y=s.y,this._messageList.x=s.x+25,this._messageList.addEventListener("cancelSetMessage",this.cancelSetMessage.bind(this)),this.addChild(this._messageList),s.setBounds(s.nominalBounds.x,s.nominalBounds.y,s.nominalBounds.width,s.nominalBounds.height),this.addChild(s),__sendMessages){e=DBLAsset.createArtFromBundle("DBLAButtonSend",l);DBLFont.fixFont(e.InstSendText,c,"",DBLFont.LIGHT),e.InstSendText.text=translate(e.InstSendText.text),e.InstSendText.mouseEnabled=!1,this._sendButton=new DBLTimelineButton(e,null,null,null,null,0,!0),this._sendButton.name="sendButton",this._sendButton.x=i.InstButtonAccept.x-i.InstButtonAccept.regX,this._sendButton.y=i.InstButtonAccept.y-i.InstButtonAccept.regY,this._sendButton.enabled=!1,this.addChild(this._sendButton),this._sendButton.addEventListener("click",this.onSendClick.bind(this)),this._sendingSign=DBLAsset.create("DBLAFeedbackIndicatorSending",l),this._sendingSign.name="sendingSign",this._messageButtons=[];for(var n=0,a=this.getButtonsData();n<a.length;n++){var o=a[n],h=DBLAsset.create(o.linkage,l),h=new DBLSelectTimelineButton(h,null,null,null);h.name="messageButton",h.x=i[o.instance].x-i[o.instance].regX,h.y=i[o.instance].y-i[o.instance].regY,this.addChild(h),h.addEventListener("click",this.onMessageClick.bind(this,o.id,!0)),this._messageButtons.push(h),o.selected&&this.onMessageClick(o.id,!1)}}},a.prototype.onClickAnywhere=function(){this._messageList.onClickAnywhere(),this.cancelSetMessage()},a.prototype.stopAudio=function(){this._messageList.stopAudio()},a.prototype.onMessageClick=function(e,t){t&&DBLAsset.playSound(n),this._sendButton.enabled=!0;for(var s=this.getButtonsData(),i=0;i<s.length;i++)this._messageButtons[i].selected=e==s[i].id;this._selectedMessage=e,this._messageList.setMessage(e),this._messageList.addTemplate()},a.prototype.cancelSetMessage=function(){if(__sendMessages){this._sendButton.enabled=!1;for(var e=0,t=this._messageButtons;e<t.length;e++)t[e].selected=!1;this._messageList.cancelSetMessage()}},a.prototype.onSendClick=function(){DBLAsset.playSound(n);for(var e=0,t=this._messageButtons;e<t.length;e++)t[e].enabled=!1;this._sendButton.enabled=!1,this._sendingSign.x=this.parent.getBounds().x+this.parent.getBounds().width/2-this._sendingSign.getBounds().width/2,this._sendingSign.y=this.parent.y+300-this._sendingSign.getBounds().height/2-80,DBLFont.fixFont(this._sendingSign.text,c,"",DBLFont.LIGHT),this._sendingSign.text.text=translate("Sending message"),this.parent.addChild(this._sendingSign),this.dispatchEvent("sendingFeedback"),this._timeout=setTimeout(this.afterShortDelay.bind(this),750);var s="sendMessage"+(lesson?"InLesson":"");DBLAutomation.recordClick(shell,s)},a.prototype.afterShortDelay=function(){this._timeout=-1,DBLMessageManager.sendMessage(this._selectedMessage,this._screenshot128,this._screenshot768,this.onFeedbackSent.bind(this))},a.prototype.onFeedbackSent=function(e,t){!e||rootParams.simulatesendfailed||rootParams.simulatelimitexceeded?(this._sendingSign.text.text=translate(t||rootParams.simulatelimitexceeded?"Daily message limit reached.":"Something went wrong.\nPlease try again later."),this._timeout=setTimeout(this.notSentSignHoldComplete.bind(this),5e3)):(this._sendingSign.text.text=translate("Message sent.\nThank you!"),DBLAsset.playSound(i),this._timeout=setTimeout(this.sentSignHoldComplete.bind(this),2e3))},a.prototype.sentSignHoldComplete=function(){this._timeout=-1,this.dispatchEvent("feedbackSent")},a.prototype.notSentSignHoldComplete=function(){this._timeout=-1,this.parent.removeChild(this._sendingSign);for(var e=0,t=this._messageButtons;e<t.length;e++)t[e].enabled=!0;this._sendButton.enabled=!0,this.dispatchEvent("feedbackNotSent")},a.prototype.cleanup=function(){this.removeAllChildren(),this._messageList&&(this._messageList.cleanup(),this._messageList=null)},a.prototype.getButtonsData=function(){var e=s;if("primary"!=engagement&&"squiggly"!=engagement)switch(screenfqn){case DBLDataConstants.ACHIEVEMENTS_SCREEN_FQN:e=[{instance:"InstButtonAchievements",linkage:"DBLAButtonAchievements",id:"MESSAGE_ACHIEVEMENTS_PAGE",selected:!0}];break;case DBLDataConstants.STATS_SCREEN_FQN:e=[{instance:"InstButtonStats",linkage:"DBLAButtonStats",id:"MESSAGE_STATS_PAGE",selected:!0}];break;default:e=s}return e},a.prototype.show=function(){},a.prototype.hide=function(){},a);function a(){var e=t.call(this)||this;return e._timeout=-1,e.name="messageTab",e}r.MessageTab=e})(engagement_shared_math=engagement_shared_math||{}),(e=>{var n,a=replayMode?"":DBLRuntime.requireBundle("assets.bundles.engagement.shared.Messaging"),o=replayMode?"":DBLRuntime.requireFont("assets.fonts.Quicksand",DBLFont.NORMAL),h="Choose an icon below to add a message!",r="#9e9e9e",t=(n=createjs.Container,__extends(s,n),Object.defineProperty(s.prototype,"selected",{get:function(){return this._selected},set:function(e){var t=this._selected;this._selected=e,this._selectedFrame.visible=e,!t&&this._selected&&this.dispatchEvent(new createjs.Event("scrollIntoView",!0,!0))},enumerable:!1,configurable:!0}),s.prototype.setMessage=function(e){e=this._stockData[e],this._text.text=e[language],this._text.color="#000000",this._image&&this.removeChild(this._image),e=e.image;this._image=DBLAsset.createArtFromBundle(e,a),this.addChild(this._image),this._image.name="image",this._image.x=690,this._image.y=this._text.y+(this._text.getBounds().height-this._image.getBounds().height)/2,this._image.mouseEnabled=!1},s.prototype.cancelSetMessage=function(){this._text.text=translate(h),this._text.color=r,this._image&&this.removeChild(this._image),this._image=null},s.prototype.onAudioClick=function(e){var t,s=this;this._playing||(this.dispatchEvent(new createjs.Event("stopAudio",!0,!0)),t="{cache}"+this._text.text,DBLPlay._playTTSDirect_(t,function(){s.onAudioComplete()}),this._playing=!0,this._audioButton.visible=!1,this._stopButton.visible=!0,DBLAutomation.recordClick(shell,"messageTTS"))},s.prototype.onAudioComplete=function(){this._playing=!1,this._stopping=!1,this._audioButton.visible=!0,this._stopButton.visible=!1},s.prototype.onStopClick=function(e){this.stopAudio()},s.prototype.stopAudio=function(){this._playing&&(this._stopping=!0,DBLPlay.fastForwardSohlisg(),this._audioButton.visible=!0,this._stopButton.visible=!1)},s);function s(e,t,s){var i=n.call(this)||this,e=(i._stockData=e,i._width=t,i._selectedFrame=DBLAsset.create("DBLARectangleQuickFeedBackSolid",a),i._selectedFrame.name="solidFrame",i._selectedFrame.mouseEnabled=!0,i.addChild(i._selectedFrame),i._screenshot=new createjs.Bitmap(s),i._screenshot.x=18,i._screenshot.y=15,i.addChild(i._screenshot),__user._name_||"Student");return i._studentLabel=new createjs.Text(e,DBLFont.getFontString(o,20),"#626262"),i._studentLabel.mouseEnabled=!1,i._studentLabel.name="teacherLabel",i._studentLabel.textAlign="right",i._studentLabel.x=661,i._studentLabel.y=17,i.addChild(i._studentLabel),i._text=new createjs.Text(translate(h),DBLFont.getFontString(o,20),r),i._text.name="text",i._text.lineHeight=1.2*i._text.getMeasuredHeight(),i._text.lineWidth=500,i._text.textAlign="right",i._text.x=661,i._text.y=58,i._text.mouseEnabled=!1,i.addChild(i._text),i._audioButton=new DBLTimelineButton(DBLAsset.create("DBLAButtonPlayAudio",a)),i._audioButton.x=709,i._audioButton.y=26,i._audioButton.name="audioButton",i._audioButton.addEventListener("click",i.onAudioClick.bind(i)),i.addChild(i._audioButton),i._stopButton=new DBLTimelineButton(DBLAsset.create("DBLAButtonPlayAudioStop",a)),i._stopButton.x=i._audioButton.x,i._stopButton.y=i._audioButton.y,i._stopButton.name="stopButton",i._stopButton.visible=!1,i._stopButton.addEventListener("click",i.onStopClick.bind(i)),i.addChild(i._stopButton),i}e.MessageTemplate=t})(engagement_shared_math=engagement_shared_math||{}),(e=>{var s;function t(e){var t=s.call(this,"messageUpdate",!0,!0)||this;return t.updates=e,t}s=createjs.Event,__extends(t,s),e.MessageUpdateEvent=t})(engagement_shared_math=engagement_shared_math||{});