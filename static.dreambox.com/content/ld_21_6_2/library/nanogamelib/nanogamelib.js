var __extends=this&&this.__extends||(()=>{var n=function(t,e){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}))(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}})(),library_nanogamelib=library_nanogamelib||{},Background=(e=>{function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._art2=null,t._isScrollable=!1,t.displacement=0,t}return __extends(t,e),t.prototype.init=function(t){this._art=t,this.addChild(this._art)},t.prototype.addScrollBackground=function(t){this._art2=t},Object.defineProperty(t.prototype,"isScrollable",{get:function(){return this._isScrollable},set:function(t){this._isScrollable=t,this._isScrollable&&(this.addChild(this._art2),this._art2.x=this._art.x+this._art.getBounds().width-1)},enumerable:!1,configurable:!0}),t.prototype.move=function(t){this._art.x+=-1*t,this._art2.x+=-1*t,this.displacement+=-1*t,this._art.x<this._art2.x?this._art.x+this._art.getBounds().width<=0&&(this._art.x=this._art2.x+this._art2.getBounds().width-1):this._art2.x+this._art2.getBounds().width<=0&&(this._art2.x=this._art.x+this._art.getBounds().width-1)},t})(createjs.Container),Clock=(i=>{function t(t){var e=i.call(this)||this;return e._art=t.clone(),e.addChild(e._art),e}return __extends(t,i),t.prototype.updateTime=function(t){this._art.time_txt.text=t},t})(createjs.MovieClip),Constants=(()=>{function t(){}return t.STATE_INITIALIZING="state_initializing",t.STATE_INSTRUCTING="state_instructing",t.STATE_INTRODUCING="state_introducing",t.STATE_PLAYING="state_playing",t.STATE_ENDING="state_ending",t.STATE_CLOSING="state_closing",t.STATE_PAUSING="state_pausing",t.STATE_RESUMING="state_resuming",t.STATE_MUTING="state_muting",t.STATE_UNMUTING="state_unmuting",t.RESULT_INCOMPLETE="result_incomplete",t.RESULT_WON="result_won",t.RESULT_LOST="result_lost",t})(),NANOGAME_MONTREAL_SERIAL=DBLRuntime.requireFont("assets.fonts.MontrealSerial",DBLFont.SEMI_BOLD),NANOGAME_BUNDLE_PATH=DBLRuntime.requireBundle("assets.bundles.engagement.intermediate.nanogames.NanogameArt"),NANOGAME_SOUND_GENERALBUTTONROLLOVER_PATH=DBLRuntime.requireAudio("assets.audio.engagement.intermediate."+BWtoPF(engagement)+".GeneralButtonRollover"),NANOGAME_SOUND_GENERALBUTTONCLICK_PATH=DBLRuntime.requireAudio("assets.audio.engagement.intermediate."+BWtoPF(engagement)+".GeneralButtonClick"),Nanogame=(DBLRuntime.requireLibrary("library.manipulativecore"),DBLRuntime.requireLibrary("library.intermediateshared"),(i=>{function t(t){var e=i.call(this)||this;return e._gameDuration=15,e._gameLevel=1,e._gravity=15,e._smoothness=5,e._targets=[],e._obstacles=[],e._particles=[],e._lives=[],e._gameStarted=!1,e._gameIsOver=!1,e._isPaused=!1,e._isClosed=!1,e._showingInstructions=!1,e._showingIntroduction=!1,e._showingGameOverScreen=!1,e._showingVictoryScreen=!1,e._fastGameLoop=!1,e._gameSpeed=0,e._gameLevelTimer=1e3,e._timePrevious=-1,e._timeWhilePaused=0,e._useObstacles=!1,e._result=Constants.RESULT_INCOMPLETE,e._variationsFQN=t,setSessionProperty(DBLDataConstants.CUR_SCREEN_TYPE,DBLScreenConstants.NANOGAME_SCREEN),e}return __extends(t,i),t.prototype.getMappings=function(){return[this._variationsFQN]},t.prototype.load=function(t){t()},t.prototype.getBackScreen=function(){return null},t.prototype.ready=function(){var t=new createjs.Rectangle(0,0,1024,768),e=this.globalToLocal(0,0),t=(this._scrim=new createjs.Shape,this._scrim.graphics.beginFill(createjs.Graphics.getRGB(0,0,0)),this._scrim.graphics.drawRect(t.x,t.y,t.width,t.width),this._scrim.graphics.endFill(),this._scrim.setBounds(t.x,t.y,t.width,t.height),this._scrim.x=e.x,this._scrim.y=e.y,this._scrim.name="scrim",this.addChild(this._scrim),this._container=new createjs.Container,this._container.scaleX=this._container.scaleY=.75,this._container.x=128,this._container.y=75,this._container.name="container",new createjs.Shape),e=(t.graphics.beginFill(createjs.Graphics.getRGB(0,0,0)),t.graphics.drawRect(128,75,768,576),t.graphics.endFill(),this._container.mask=t,this.addChild(this._container),this._timerTextField=new createjs.Text,DBLFont.fixFont(this._timerTextField,NANOGAME_MONTREAL_SERIAL,"32px",DBLFont.BOLD),this._timerTextField.color="white",this._timerTextField.text="00",this._timerTextField.name="timertextfield",this._timerTextField.x=490,this._timerTextField.y=20,this._timerTextField.visible=!1,this.addChild(this._timerTextField),DBLAsset.create("DBLANanoShellCloseButton_"+BWtoPF(engagement),NANOGAME_BUNDLE_PATH)),t=(e.name="closebutton",this._closeButton=new DBLTimelineButton(e,null,NANOGAME_SOUND_GENERALBUTTONCLICK_PATH,NANOGAME_SOUND_GENERALBUTTONROLLOVER_PATH),this._closeButton.x=950,this._closeButton.y=45,this._closeButton.addEventListener("click",this.onCloseButtonClick.bind(this)),this.addChild(this._closeButton),a11y.focusElement(this._closeButton),objectFromFQN(this._variationsFQN)),e=rootParams.nanovariation||getSessionProperty(DBLDataConstants.NANO_VARIATION);this._variation=t[e],a11y.playAlert("nanoGamesNotAvailableAlert")},t.prototype.cleanup=function(){this._isClosed||(this._gameStarted=!1,this._isClosed=!0,this._activeScreen=null,this._bkg=null,this._art=null,this._particles=[],this._obstacles=[],this._targets=[],this._lives=[],this._gameOverSoundTimer&&(this._gameOverSoundTimer.stop(),this._gameOverSoundTimer.removeEventListener(DBLTimer.TIMER_COMPLETE,this.playGameOverSound.bind(this)),this._gameOverSoundTimer=null),this._closeButton.removeAllEventListeners(),this._closeButton.cleanup(),this._closeButton=null,this._soundManager.cleanup(),this._soundManager=null,this._container.removeAllChildren(),this._container=null,this.removeAllEventListeners())},t.prototype.pause=function(){this._isPaused=!0,this._gameOverSoundTimer&&this._gameOverSoundTimer.stop(),this._activeScreen&&this._activeScreen.stop(),this._timeWhilePaused=getTime(),this._soundManager.pause()},t.prototype.resume=function(){a11y.focusElement(this._closeButton),this._gameOverSoundTimer&&this._gameOverSoundTimer.start(),this._activeScreen&&this._activeScreen.play(),this._soundManager.resume(),this._isPaused=!1,this._gameStartTime=this._gameStartTime-this._timeWhilePaused+getTime(),this._timeCurrent=getTime(),this._realTimeElapsed+=this._timeCurrent-this._timeWhilePaused},t.prototype.mute=function(){this._soundManager.mute()},t.prototype.unmute=function(){this._soundManager.unmute()},t.prototype.hide=function(t){t()},t.prototype.setFastGameLoop=function(t){this._fastGameLoop=t},t.prototype.initArt=function(t,e,i,n,s){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=null),this._art={},this._soundManager=new NanoGameSoundManager,null!=t||null!=e||null!=i||null!=n||null!=s?(this._art.background=t,this._art.instructions=e,this._art.introduction=i,this._art.victory=n,this._art.gameOver=s):DBLLog.log("Unable to initialize nanogame due to invalid assets.",DBLLog.FATAL)},t.prototype.initGame=function(t,e,i){void 0===t&&(t=!1),void 0===e&&(e=!1),this._isPaused=i=void 0===i?!1:i,this._soundManager.isMuted=e,this._gameDuration=+this._variation.duration,this._gameLevel=+this._variation.level,this._smoothness=this._variation.playerSmoothness?+this._variation.playerSmoothness:this._smoothness,this._useObstacles=this._variation.useObstacles?JSON.parse(this._variation.useObstacles):this._useObstacles,this._testMode=t,this._testMode?this.startGame():this._isPaused||this.showInstructions()},t.prototype.skipState=function(){this._showingInstructions?this.endInstructions():this._showingIntroduction&&this.endIntroduction()},Object.defineProperty(t.prototype,"result",{get:function(){return this._result},enumerable:!1,configurable:!0}),t.prototype.showInstructions=function(){this._activeScreen=this._art.instructions,this._timerTextField.text=this._gameDuration.toString(),this._timerTextField.visible=!0,this._container.addChild(this._activeScreen),this._showingInstructions=!0,this._soundManager.play(NanoGameSoundManager.SOUND_GENERAL_INSTRUCTIONS)},t.prototype.endInstructions=function(){this._showingInstructions=!1,this.showIntroduction()},t.prototype.showIntroduction=function(){this._activeScreen=this._art.introduction,this._container.addChild(this._activeScreen),this._showingIntroduction=!0,this._soundManager.play(NanoGameSoundManager.SOUND_GENERAL_INTRODUCTION)},t.prototype.endIntroduction=function(){this._showingIntroduction=!1,this.startGame()},t.prototype.updateActiveScreen=function(){this._activeScreen.currentFrame==this._activeScreen.timeline.duration-1&&(this._activeScreen.stop(),this._container.removeChild(this._activeScreen),this._activeScreen=null,this._showingInstructions?this.endInstructions():this._showingIntroduction?this.endIntroduction():(this._showingGameOverScreen||this._showingVictoryScreen)&&this.close())},t.prototype.advanceAnimations=function(){this._activeScreen&&!this._isPaused&&(DBLAsset.advanceMovieClip(this._activeScreen),this.updateActiveScreen())},t.prototype.startGame=function(){this._gameStarted=!0,this._bkg=new Background,this._container.addChildAt(this._bkg,0),this._bkg.init(this._art.background),this._timeCurrent=getTime(),this._realTimeElapsed=getTime(),this._secondsTick=0},t.prototype.gameCompleted=function(t,e){void 0===e&&(e=0),this.stage&&(this._gameIsOver=!0,this._result=t?Constants.RESULT_WON:Constants.RESULT_LOST,this._gameStarted=!1,this._timerTextField.visible=!1,this._container.removeAllChildren(),t?this.showVictoryScreen():this.showGameOverScreen(e))},t.prototype.showGameOverScreen=function(t){this._activeScreen=this._art.gameOver,this._container.addChild(this._activeScreen),this._showingGameOverScreen=!0,0<t?(this._gameOverSoundTimer=new DBLTimer(t/24e3,1),this._gameOverSoundTimer.addEventListener(DBLTimer.TIMER_COMPLETE,this.playGameOverSound.bind(this)),this._gameOverSoundTimer.start()):this.playGameOverSound()},t.prototype.playGameOverSound=function(){this._gameOverSoundTimer&&(this._gameOverSoundTimer.removeEventListener(DBLTimer.TIMER_COMPLETE,this.playGameOverSound.bind(this)),this._gameOverSoundTimer=null),this._soundManager.play(NanoGameSoundManager.SOUND_GENERAL_GAME_OVER)},t.prototype.showVictoryScreen=function(){this._activeScreen=this._art.victory,this._container.addChild(this._activeScreen),this._showingVictoryScreen=!0,this._soundManager.play(NanoGameSoundManager.SOUND_GENERAL_VICTORY)},t.prototype.close=function(){shell.loadScreen(DBLScreenConstants.CHOOSER_SCREEN)},t.prototype.gameLoop=function(){if(this._isPaused||this._gameIsOver)return!1;this._timeCurrent=getTime(),this._timeElapsed=0<this._timePrevious?this._timeCurrent-this._timePrevious:50,this._remainingTime=Math.ceil(1e3*this._gameDuration-(this._timeCurrent-this._realTimeElapsed)),this._timePrevious=this._timeCurrent;var t=Math.floor(this._gameDuration-this._remainingTime/1e3),t=(this._secondsTick<t&&(this._secondsTick=t,0<=(t=this._gameDuration-this._secondsTick))&&(t<=5&&(this._soundManager.play(NanoGameSoundManager.SOUND_GENERAL_TIMER_BEEP),this._timerTextField.color="#f14e4e"),this.dispatchEvent(new NanogameEvent(NanogameEvent.NANOGAME_TICK,t))),this._remainingTime<0&&(this._remainingTime=0),Math.ceil(this._remainingTime/1e3).toString());return this._timerTextField.text=1<t.length?t:"0".concat(t),this.calculateGameSpeed(),!0},t.prototype.calculateGameSpeed=function(){isNaN(this._gameStartTime)&&(this._gameStartTime=getTime()),this._gameLevelTimer<getTime()-this._gameStartTime?(this._gameLevelTimer-=.5*this._gameLevel,this._gameLevelTimer=this._gameLevelTimer<150?150:this._gameLevelTimer,this._gameStartTime=getTime(),this._gameSpeed=this._gameSpeed+.3*this._gameLevel,this._canSpawnTarget=!0):this._canSpawnTarget=!1},t.prototype.updateTweensOf=function(t,e){for(var i=gsap.TweenLite.getTweensOf(t,!0),n=i.length;-1<--n;)e?i[n].pause():i[n].resume()},t.prototype.onCloseButtonClick=function(){this.dispatchEvent("close")},Object.defineProperty(t.prototype,"stage",{get:function(){return lessonStage},enumerable:!1,configurable:!0}),t.prototype.tick24=function(){this.advanceAnimations(),this._gameStarted&&!this._fastGameLoop&&this.gameLoop()},t.prototype.tick=function(){this._gameStarted&&this._fastGameLoop&&this.gameLoop()},t.prototype.getAccessibilityData=function(){var t,e=[];return this._closeButton&&((t=this._closeButton.getAccessibilityData()).labelObject={id:"close"},e=[t]),{role:"presentation",display:{object:this},labelObject:{id:this.name||"dblTimelineButton"},children:e}},t})(createjs.Container)),NanogameEvent=(s=>{function t(t,e,i,n){void 0===e&&(e=null);t=s.call(this,t,i=void 0===i?!1:i,n=void 0===n?!1:n)||this;return t._data=e,t}return __extends(t,s),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),t.NANOGAME_TICK="nanogameTick",t})(createjs.Event),ArrayShuffler=(()=>{function t(){}return t.Shuffle=function(t){for(var e=0;e<t.length;e++){var i=Math.floor(Math.random()*t.length),n=t[e];t[e]=t[i],t[i]=n}return t},t})(),MathUtils=(()=>{function e(){}return e.randomRange=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},e.getRandomElementOf=function(t,e){void 0===e&&(e=!1);var i=Math.floor(Math.random()*t.length);return e?t.splice(i,1)[0]:t[i]},e.randomize=function(t,e){return Math.random()<.5?-1:1},e.randomizeArray=function(t){t.sort(e.randomize)},e})(),INSTRUCTIONSSOUND=DBLRuntime.requireAudio("assets.bundles.engagement.intermediate.nanogames.sounds.DBLAInstructionsSound"),GAMEOVERSOUND=DBLRuntime.requireAudio("assets.bundles.engagement.intermediate.nanogames.sounds.DBLAGameOverSound"),TIMERBEEPSOUND=DBLRuntime.requireAudio("assets.bundles.engagement.intermediate.nanogames.sounds.DBLATimerBeepSound"),VICTORYSOUND=DBLRuntime.requireAudio("assets.bundles.engagement.intermediate.nanogames.sounds.DBLAVictorySound"),NanoGameSoundManager=(()=>{function n(){this._isMuted=!1,this._playedCustomSounds=[]}return n.prototype.cleanup=function(){this.stop(),this._backgroundMusicSoundChannel=null,this._playedCustomSounds.length=0},Object.defineProperty(n.prototype,"isMuted",{get:function(){return this._isMuted},set:function(t){this._isMuted=t},enumerable:!1,configurable:!0}),n.prototype.mute=function(){null!=this._backgroundMusicSoundChannel&&(this._backgroundMusicSoundChannel.stop(),this._backgroundMusicSoundChannel=null),this._playedCustomSounds.forEach(function(t){return t.stop()}),this._isMuted=!0},n.prototype.unmute=function(){this._isMuted&&null!=this._backgroundMusic&&(this._isMuted=!1,this.playBackgroundMusic()),this._isMuted=!1},n.prototype.stop=function(){null!=this._backgroundMusicSoundChannel&&(this._backgroundMusicSoundChannel.stop(),this._backgroundMusicSoundChannel=null),null!=this._backgroundMusic&&(this._backgroundMusic=null),this._playedCustomSounds.forEach(function(t){return t.stop()})},n.prototype.pause=function(){this._isMuted||(null!=this._backgroundMusicSoundChannel&&(this._backgroundMusicSoundChannel.stop(),this._backgroundMusicSoundChannel=null),this._playedCustomSounds.forEach(function(t){return t.paused=!0}))},n.prototype.resume=function(){this._isMuted||(null!=this._backgroundMusic&&this.playBackgroundMusic(),this._playedCustomSounds.forEach(function(t){return t.paused=!1}))},n.prototype.playBackgroundMusic=function(){null==this._backgroundMusicSoundChannel&&(this._backgroundMusicSoundChannel=createjs.Sound.play(this._backgroundMusic,{loop:10}),this._isMuted)&&this.mute()},n.prototype.play=function(t,e){switch(void 0===e&&(e=null),t){case n.SOUND_GENERAL_GAME_OVER:DBLAsset.playSound(GAMEOVERSOUND);break;case n.SOUND_GENERAL_INSTRUCTIONS:DBLAsset.playSound(INSTRUCTIONSSOUND);break;case n.SOUND_GENERAL_INTRODUCTION:break;case n.SOUND_GENERAL_TIMER_BEEP:DBLAsset.playSound(TIMERBEEPSOUND);break;case n.SOUND_GENERAL_VICTORY:DBLAsset.playSound(VICTORYSOUND);break;case n.SOUND_CUSTOM:var i;null!=e&&(i=DBLAsset.playSound(e))&&-1==this._playedCustomSounds.indexOf(i)&&this._playedCustomSounds.push(i);break;case n.SOUND_BACKGROUND:null!=e&&(this._backgroundMusic=e,this.playBackgroundMusic())}},n.SOUND_GENERAL_GAME_OVER="sound_game_over",n.SOUND_GENERAL_INSTRUCTIONS="sound_instructions",n.SOUND_GENERAL_INTRODUCTION="sound_introduction",n.SOUND_GENERAL_TIMER_BEEP="sound_timer_beep",n.SOUND_GENERAL_VICTORY="sound_victory",n.SOUND_CUSTOM="sound_custom",n.SOUND_BACKGROUND="sound_background",n})();