var engagement_intermediate_shell,__extends=this&&this.__extends||(()=>{var n=function(t,e){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}))(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}})(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,s=1,n=arguments.length;s<n;s++)for(var o in e=arguments[s])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};(s=>{var e;function i(){var t=e.call(this)||this;return t.init(),t}e=createjs.Container,__extends(i,e),i.prototype.show=function(t,e,s,n,o){void 0===e&&(e=0),void 0===s&&(s=i.BUTTON_PLAY),void 0===n&&(n=null),void 0===o&&(o=null),DBLLog.log("showing dialog box",DBLLog.INFO),this._messageText=t,e==this._buttonLeftType&&s==this._buttonRightType||(this._buttonLeftType=e,this._buttonRightType=s,this.updateButtons()),this.mouseChildren=this.mouseEnabled=!0,this.messageText=this._messageText,this.queryMessage=n,o&&(this._subText.text=o,this._subText.visible=!0,this._subText.x=this._background.x+(this._background.getTransformedBounds().width/2-this._subText.getMeasuredWidth()/2)),this.adjustLayout(),this._showing||(null!=this._hideTimeline&&this._hideTimeline.kill(),null!=this._showTimeline&&this._showTimeline.clear(),t=this.scaleY,this.scaleX=this.scaleY=0,this._showTimeline=new gsap.TimelineLite,this._showTimeline.add(gsap.TweenLite.to(this,.125,{scaleX:1.1*t,scaleY:1.1*t})),this._showTimeline.add(gsap.TweenLite.to(this,.125,{scaleX:t,scaleY:t,onComplete:function(){a11y.updateFocusGraphics()}})),this._soundShow&&DBLAsset.playSound(this._soundShow),this._showing=!0,this.visible=!0,DBLAsset.calculateBoundsFromChildren(this))},i.prototype.hide=function(t){this._showing&&(this.mouseChildren=this.mouseEnabled=!1,null!=this._showTimeline&&this._showTimeline.kill(),null!=this._hideTimeline&&this._hideTimeline.clear(),this._hideTimeline=new gsap.TimelineLite({onComplete:t}),this._hideTimeline.add(gsap.TweenLite.to(this,.25,{scaleX:0,scaleY:0})),this._showing=!1)},i.prototype.cleanup=function(){this._queryDisplay&&this._queryDisplay.removeAllEventListeners(),this._hideTimeline&&this._hideTimeline.kill(),this.cleanupButtons()},i.prototype.clicked=function(t){void 0===t&&(t=null),this._queryDisplay.visible&&DBLLog.log("checkboxClicked "+this._queryCheck.visible.toString(),DBLLog.INFO),DBLLog.log((t.target==this._buttonLeft?i.BUTTON1:i.BUTTON2).toString(),DBLLog.INFO),this.dispatchEvent(new s.DialogCloseEvent(s.DialogCloseEvent.CLOSE,!1,!1,t.target==this._buttonLeft?i.BUTTON1:i.BUTTON2))},Object.defineProperty(i.prototype,"messageText",{set:function(t){this._message.text.textAlign="center",this._message.text.text=t,this.adjustLayout()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"queryMessage",{set:function(t){null==t?this._queryDisplay.visible=!1:(this._queryText.text=t,this._queryCheck.visible=!1,this._queryDisplay.visible=!0),this.adjustLayout()},enumerable:!1,configurable:!0}),i.prototype.init=function(){this.resize(),this.name="shelldialog",this._background=DBLAsset.create(s.ShellSkinConstants.SHELL_POPUPBACKGROUND,s.ShellSkinConstants.SHELL_BUNDLE),this._background.x=-this._background.getTransformedBounds().width/2,this._background.y=-this._background.getTransformedBounds().height/2,this.addChild(this._background),this._message=DBLAsset.create(s.ShellSkinConstants.SHELL_POPUPMESSAGE,s.ShellSkinConstants.SHELL_BUNDLE),this._message.x=0,this._message.y=-55,this.addChild(this._message),this._queryDisplay=new createjs.Container,this._queryDisplay.visible=!1,this._queryDisplay.x=this._background.x+i.LEFT_MARGIN,this.addChild(this._queryDisplay),this._queryCheckbox=DBLAsset.create(s.ShellSkinConstants.SHELL_POPUPCHECKBOX,s.ShellSkinConstants.SHELL_BUNDLE),this._queryCheckbox.y=20,this._queryCheckbox.gotoAndStop(0),this._queryDisplay.addChild(this._queryCheckbox),this._queryCheck=this._queryCheckbox.check,DBLAsset.setNameAndBounds(this._queryCheck,"querycheck",this._queryCheck);var t=new createjs.Shape,e=this._queryCheckbox.getBounds();t.graphics.beginFill("#000000"),t.graphics.drawRect(e.x-.5*(40-e.width),e.y-.5*(40-e.height),40,40),t.graphics.endFill(),this._queryCheckbox.hitArea=t,DBLFont.fixFont(this._message.text,FONT_TYPE_HEADER_ONE,"",FONT_TYPE_HEADER_ONE_WEIGHT),this._queryText=new createjs.Text,DBLFont.fixFont(this._queryText,FONT_TYPE_BODY_COPY,"16px",FONT_TYPE_BODY_COPY_WEIGHT),this._queryText.color=FONT_COLOR,this._queryText.textBaseline="alphabet",this._queryText.x=18,this._queryText.y=22+this._queryText.getMeasuredLineHeight(),this._queryDisplay.addChild(this._queryText),this._subText=new createjs.Text,DBLFont.fixFont(this._subText,FONT_TYPE_BODY_COPY,"16px",DBLFont.SEMI_BOLD),this._subText.color=FONT_COLOR,this._subText.visible=!1,this.addChild(this._subText),this._queryDisplay.addEventListener("click",this.queryClicked.bind(this)),this._queryDisplay.addEventListener("mouseover",this.onQueryMouseOver.bind(this)),this._queryDisplay.addEventListener("mouseout",this.onQueryMouseOut.bind(this)),this._soundShow=s.ShellSkinConstants.SOUND_DIALOGSHOW,this.visible=!1},i.prototype.resize=function(){var t=(engagementStage?engagementStage.getBounds():new createjs.Rectangle).width/1024;this.scaleX=this.scaleY=t,this.x=i.DIALOG_CENTER_X*t,this.y=i.DIALOG_CENTER_Y*t},i.prototype.queryClicked=function(){this._queryCheck.visible=!this._queryCheck.visible},i.prototype.onQueryMouseOver=function(){DBLCursor.setCursor(DBLCursor.POINTER)},i.prototype.onQueryMouseOut=function(){DBLCursor.setCursor(DBLCursor.AUTO)},i.prototype.cleanupButtons=function(){this._buttonLeft&&(this.removeChild(this._buttonLeft),this._buttonLeft.removeAllEventListeners(),this._buttonLeft.cleanup(),this._buttonLeft=null),this._buttonRight&&(this.removeChild(this._buttonRight),this._buttonRight.removeAllEventListeners(),this._buttonRight.cleanup(),this._buttonRight=null)},i.prototype.createButton=function(t){switch(t){case i.BUTTON_ACCEPT:case i.BUTTON_EXIT:return DBLAsset.create(s.ShellSkinConstants.SHELL_POPUPBUTTONACCEPT,s.ShellSkinConstants.SHELL_BUNDLE);case i.BUTTON_CANCEL:return DBLAsset.create(s.ShellSkinConstants.SHELL_POPUPBUTTONCANCEL,s.ShellSkinConstants.SHELL_BUNDLE);case i.BUTTON_PLAY:return DBLAsset.create(s.ShellSkinConstants.SHELL_POPUPBUTTONPLAY,s.ShellSkinConstants.SHELL_BUNDLE)}return null},i.prototype.updateButtons=function(){this.cleanupButtons();var t=this.createButton(this._buttonLeftType);null!=t&&(this._buttonLeft=new DBLTimelineButton(t,null,s.ShellSkinConstants.SOUND_GENERALBUTTONCLICK,s.ShellSkinConstants.SOUND_GENERALBUTTONROLLOVER),this._buttonLeft.addEventListener("click",this.clicked.bind(this)),this._buttonLeft.x=-95,this._buttonLeft.y=10,DBLAsset.setNameAndBounds(t,"dialog_leftbutton",t),this.addChild(this._buttonLeft)),null!=(t=this.createButton(this._buttonRightType))&&(this._buttonRight=new DBLTimelineButton(t,null,s.ShellSkinConstants.SOUND_GENERALBUTTONCLICK,s.ShellSkinConstants.SOUND_GENERALBUTTONROLLOVER),this._buttonRight.addEventListener("click",this.clicked.bind(this)),this._buttonRight.x=95,this._buttonRight.y=10,DBLAsset.setNameAndBounds(t,"dialog_rightbutton",t),this.addChild(this._buttonRight))},i.prototype.adjustLayout=function(){var t=this._message.text.getMeasuredHeight(),e=this._buttonLeft.getTransformedBounds(),s=this._queryText.getTransformedBounds(),n=this._subText.getTransformedBounds(),o=t+i.BUTTON_GAP+e.height;this._queryDisplay.visible&&(o+=i.CHECKBOX_GAP+s.height),this._subText.visible&&(o+=i.SUBTEXT_GAP1+n.height+i.SUBTEXT_GAP2),this._background.scaleY=(o+=i.TOP_MARGIN+i.BOTTOM_MARGIN)/this._background.getBounds().height,this._background.y=-o/2,this._message.y=this._background.y+i.TOP_MARGIN,this._buttonLeft.y=this._message.y+t+i.BUTTON_GAP-e.y,this._buttonRight&&(this._buttonRight.y=this._buttonLeft.y),e=this._buttonLeft.getBounds(),this._queryDisplay.visible&&(this._queryDisplay.y=e.y+e.height+i.CHECKBOX_GAP),this._subText.visible&&(this._subText.y=e.y+e.height+i.SUBTEXT_GAP1),this._buttonLeft.visible&&this._buttonRight?(this._buttonLeft.x=-95,this._buttonRight&&(this._buttonRight.x=95)):(this._buttonLeft.x=0,this._buttonRight&&(this._buttonRight.x=0))},Object.defineProperty(i.prototype,"queryResponse",{get:function(){return this._queryCheck.visible},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"buttonLeft",{get:function(){return this._buttonLeft},enumerable:!1,configurable:!0}),i.prototype.getAccessibilityChildren=function(){var t=[];return this._buttonLeft&&t.push(this._buttonLeft.getAccessibilityData()),this._buttonRight&&t.push(this._buttonRight.getAccessibilityData()),t},i.prototype.getAccessibilityData=function(){return{tabIndex:0,type:"modaldialog",display:{object:this},labelObject:{id:"shellDialog",params:{message:this._messageText}},children:[this.getA11yButton(this._buttonLeftType,this._buttonLeft),this.getA11yButton(this._buttonRightType,this._buttonRight),this.getA11yCheckbox()].filter(function(t){return!!t}),onEsc:null}},i.prototype.getA11yButton=function(t,e){if(!t)return null;var s;switch(t){case i.BUTTON_ACCEPT:s=e.name||"shellDialogAcceptButton";break;case i.BUTTON_CANCEL:s="shellDialogCancelButton";break;case i.BUTTON_PLAY:s="shellDialogPlayButton";break;case i.BUTTON_EXIT:s="shellDialogExitButton";break;case i.BUTTON_EXIT_GREEN:s="shellDialogExitGreenButton";break;case i.BUTTON_BACK:s="shellDialogBackButton"}t=e.getAccessibilityData();return t.label=null,t.labelObject={id:s},t.visible=t.visible&&e.stage&&!!e.getBounds(),t},i.prototype.getA11yCheckbox=function(){var t=this._queryDisplay,e=this.queryResponse?translate("press to uncheck"):translate("press to check");return{role:"checkbox",display:{object:t},label:"".concat(translate("Do not show me this warning again.")," ").concat(e),checked:this.queryResponse,focus:{bounds:t.getBounds().clone().pad(5,5,-10,5)},onSubmit:function(){t.dispatchEvent("click")}}},i.BUTTON1=1,i.BUTTON2=2,i.BUTTON_ACCEPT=1,i.BUTTON_CANCEL=2,i.BUTTON_PLAY=3,i.BUTTON_EXIT=4,i.BUTTON_EXIT_GREEN=5,i.BUTTON_BACK=6,i.LEFT_MARGIN=30,i.TOP_MARGIN=30,i.BOTTOM_MARGIN=57,i.BUTTON_GAP=40,i.CHECKBOX_GAP=15,i.SUBTEXT_GAP1=15,i.SUBTEXT_GAP2=25,i.DIALOG_CENTER_X=512,i.DIALOG_CENTER_Y=390,s.Dialog=i})(engagement_intermediate_shell=engagement_intermediate_shell||{}),(t=>{var o;function e(t,e,s,n){void 0===n&&(n=-1);t=o.call(this,t,e=void 0===e?!1:e,s=void 0===s?!1:s)||this;return t.detail=n,t}o=createjs.Event,__extends(e,o),e.prototype.clone=function(){return new e(this.type,this.bubbles,this.cancelable,this.detail)},e.CLOSE="close",e.HIDDEN="hidden",t.DialogCloseEvent=e})(engagement_intermediate_shell=engagement_intermediate_shell||{}),(a=>{var e;function s(){var t=e.call(this)||this;return t._enabled=!1,t._buttonControllers=[],t._pulseOnce=!1,t._myLessonsButton="myLessonsButton"+("spanish"==language?"_es":""),t._myLessonsActive="myLessonsActive"+("spanish"==language?"_es":""),t._myStuffButton="myStuffButton"+("spanish"==language?"_es":""),t._myStuffActive="myStuffActive"+("spanish"==language?"_es":""),t._showHeaderButtons=!0,t}e=createjs.Container,__extends(s,e),s.prototype.init=function(){this._art=DBLAsset.create(a.ShellSkinConstants.SHELL_SHELLHEADER,a.ShellSkinConstants.SHELL_BUNDLE),this._art.gotoAndStop(0),DBLAsset.setNameAndBounds(this,"header",this._art),this.addChild(this._art),this.setArtBackgroundLogo(),this._art.flipSkipHelp.visible=!1,this._art.myLessonsButton.visible=!1,this._art.myLessonsButton_es.visible=!1,this._art.myStuffButton.visible=!1,this._art.myStuffButton_es.visible=!1,this._art.myLessonsActive.visible=!1,this._art.myLessonsActive_es.visible=!1,this._art.myStuffActive.visible=!1,this._art.myStuffActive_es.visible=!1,this.helpVisible=!0,this._myStuffNotification=this._art.myStuffNotification,this._art.removeChild(this._myStuffNotification),this._myStuffLocked=this._art.myStuffLocked,this._art.removeChild(this._myStuffLocked),this._art.ornamentationBronze.visible=!1,this._art.ornamentationSilver.visible=!1,this._art.ornamentationGold.visible=!1,this._studentName=this._art.studentName,this._coinCount=this._art.tokenCount,DBLFont.fixFont(this._studentName,FONT_TYPE_NAVIGATION_BAR_TEXT,"",FONT_TYPE_NAVIGATION_BAR_TEXT_WEIGHT),DBLFont.fixFont(this._coinCount,FONT_TYPE_NAVIGATION_BAR_TEXT,"",FONT_TYPE_NAVIGATION_BAR_TEXT_WEIGHT),this._studentName.textBaseline="alphabet",this._studentName.y+=.85*this._studentName.getMeasuredHeight(),DBLAsset.setNameAndBounds(this._studentName,"studentname",this._studentName.getBounds()),this._coinCount.textBaseline="alphabet",this._coinCount.y+=.85*this._coinCount.getMeasuredHeight(),DBLAsset.setNameAndBounds(this._coinCount,"coincount",this._coinCount.getBounds(),2),this._art.timeline=null,this._art.removeChild(this._art["myLessonsButton"+("spanish"!=language?"_es":"")]),this._art["myLessonsButton"+("spanish"!=language?"_es":"")]=null,this._art.removeChild(this._art["myLessonsActive"+("spanish"!=language?"_es":"")]),this._art["myLessonsActive"+("spanish"!=language?"_es":"")]=null,this._art.removeChild(this._art["myStuffButton"+("spanish"!=language?"_es":"")]),this._art["myStuffButton"+("spanish"!=language?"_es":"")]=null,this._art.removeChild(this._art["myStuffActive"+("spanish"!=language?"_es":"")]),this._art["myStuffActive"+("spanish"!=language?"_es":"")]=null},s.prototype.cleanup=function(){this.highlightHelp=!1,this.clearButtons(),this.clearHighlight()},s.prototype.reload=function(){this.cleanup(),this.removeAllChildren(),this.init()},Object.defineProperty(s.prototype,"studentName",{set:function(t){var e=18;for(DBLFont.fixFont(this._studentName,FONT_TYPE_NAVIGATION_BAR_TEXT,e+"px",FONT_TYPE_NAVIGATION_BAR_TEXT_WEIGHT),this._studentName.text=t.toLowerCase();165<this._studentName.getMeasuredWidth();)DBLFont.fixFont(this._studentName,FONT_TYPE_NAVIGATION_BAR_TEXT,--e+"px",FONT_TYPE_NAVIGATION_BAR_TEXT_WEIGHT)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"helpVisible",{get:function(){return this._art.helpButton.visible},set:function(t){this._art.helpButton.visible=t,this._art.skipButton.visible=!t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"skipVisible",{get:function(){return this._art.skipButton.visible},set:function(t){this._art.skipButton.visible=t,this._art.helpButton.visible=!t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"pauseVisible",{set:function(t){this._art.pauseButton.visible=t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"helpEnabled",{get:function(){return this.buttonController(s.HELP_BUTTON).enabled},set:function(t){this.buttonController(s.HELP_BUTTON).mouseEnabled=t,this.buttonController(s.HELP_BUTTON).enabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"skipEnabled",{get:function(){return this.buttonController(s.SKIP_BUTTON).enabled},set:function(t){this.buttonController(s.SKIP_BUTTON).enabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"pauseEnabled",{get:function(){return this.buttonController(s.PAUSE_BUTTON).enabled},set:function(t){t&&(this._art.pauseButton.visible=!0),this.buttonController(s.PAUSE_BUTTON).enabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"closeEnabled",{get:function(){return this.buttonController(s.CLOSE_BUTTON).enabled},set:function(t){this.buttonController(s.CLOSE_BUTTON).enabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"myLessonsEnabled",{get:function(){return this.buttonController(s.MY_LESSONS_BUTTON).enabled},set:function(t){this.buttonController(s.MY_LESSONS_BUTTON).enabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"myStuffEnabled",{get:function(){return this.buttonController(s.MY_STUFF_BUTTON).enabled},set:function(t){this.buttonController(s.MY_STUFF_BUTTON).enabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"myStuffNotificationVisible",{get:function(){return null!=this._myStuffNotification.parent},set:function(t){t?this.addChild(this._myStuffNotification):this._myStuffNotification.parent&&this.removeChild(this._myStuffNotification)},enumerable:!1,configurable:!0}),s.prototype.highlightHelpPulse=function(){this._pulseOnce=!0,this.highlightHelp=!0},Object.defineProperty(s.prototype,"highlightHelp",{set:function(t){this.clearHighlight(),t&&(this.createHighlight(),this._highlightHelp.x=878)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"highlightAudioButton",{set:function(t){this.clearHighlight(),t&&(this.createHighlight(),this._highlightHelp.x=928)},enumerable:!1,configurable:!0}),s.prototype.createHighlight=function(){this._highlightHelp=DBLAsset.create("DBLAHelpButtonCallout",a.ShellSkinConstants.SHELL_BUNDLE),this.addChild(this._highlightHelp),this._highlightHelp.visible=!0,this._highlightHelp.y=3},s.prototype.clearHighlight=function(){this._highlightHelp&&this._highlightHelp.parent&&(this._highlightHelp.parent.removeChild(this._highlightHelp),this._highlightHelp=null)},s.prototype.initButton=function(t,e,s,n){var o,i;return void 0===n&&(n=null),o=this.buttonInstance(t),n?(i=new DBLTextTimelineButton(o,null,a.ShellSkinConstants.SOUND_GENERALBUTTONCLICK,a.ShellSkinConstants.SOUND_GENERALBUTTONROLLOVER)).buttonText=n:i=new DBLTimelineButton(o,null,a.ShellSkinConstants.SOUND_GENERALBUTTONCLICK,a.ShellSkinConstants.SOUND_GENERALBUTTONROLLOVER),i.toolTipText=s,i.addEventListener("click",e),DBLAsset.setNameAndBounds(o,"button"+t,o),this.addChild(i),this._buttonControllers[t]=i},s.prototype.clearButtons=function(){for(var t=0,e=this._buttonControllers;t<e.length;t++){var s=e[t];s.removeAllEventListeners(),s.cleanup(),this.removeChild(s)}},s.prototype.buttonInstance=function(t){var e;switch(t){case s.HELP_BUTTON:e=this._art.helpButton;break;case s.SKIP_BUTTON:e=this._art.skipButton;break;case s.PAUSE_BUTTON:e=this._art.pauseButton;break;case s.CLOSE_BUTTON:e=this._art.closeButton;break;case s.MY_LESSONS_BUTTON:(e=this._art[this._myLessonsButton]).visible=!0;break;case s.MY_STUFF_BUTTON:(e=this._art[this._myStuffButton]).visible=!0;break;case s.MY_LESSONS_BUTTON_ACTIVE:(e=this._art[this._myLessonsActive]).visible=!0;break;case s.MY_STUFF_BUTTON_ACTIVE:(e=this._art[this._myStuffActive]).visible=!0}return e},s.prototype.buttonController=function(t){return this._buttonControllers[t]},Object.defineProperty(s.prototype,"coinCount",{get:function(){return Number(this._coinCount.text)},set:function(t){this._coinCount.text=DBLNumberUtils.format(t),this.updateCoinsVisibility()},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"headerButtonsVisible",{get:function(){return this._showHeaderButtons&&!DBLAudienceTypeConstants.isDemoOrTeacherTools(audienceType)},enumerable:!1,configurable:!0}),s.prototype.updateCoinsVisibility=function(){var t=this.headerButtonsVisible;this._coinCount.visible=t,this._art.background&&(this._art.background.tokensButton.visible=t)},s.prototype.clearCoinCount=function(){this._coinCount.text=""},s.prototype.preloadAvatarArt=function(t){this._preloadAvatarCallback=t;t=DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_CURRENT_AVATAR),t=objectFromFQN(DBLDataConstants.AVATAR_DATA_FQN)[t];(new DBLImageLoader).loadImage(t.icon_url,"icon",this.onAvatarReady.bind(this),"_small")},s.prototype.onAvatarReady=function(t){this._art.studentAvatar.removeAllChildren();var t=t instanceof createjs.DisplayObject?t:new createjs.Bitmap(t),e=(t&&(e=this._art.studentAvatar.nominalBounds,t.scaleX=e.width/t.getBounds().width,t.scaleY=e.height/t.getBounds().height,this._art.studentAvatar.addChild(t)),this._avatarIcon=t,this._preloadAvatarCallback);(this._preloadAvatarCallback=null)!=e&&e()},s.prototype.updateAvatarArt=function(){DBLAudienceTypeConstants.isDemoOrTeacherTools(audienceType)||this.updateAvatarFrame()},s.prototype.updateAvatarFrame=function(t){t=null==(t=void 0===t?null:t)?getSessionProperty(DBLDataConstants.CUR_PROGRESS_AVATAR):t;t&&(this._art.ornamentationBronze.visible=!1,this._art.ornamentationSilver.visible=!1,this._art.ornamentationGold.visible=!1,1<=t.levels?this._art.ornamentationGold.visible=!0:t.type==DBLProgressAvatar.GOLD?this._art.ornamentationSilver.visible=!0:t.type==DBLProgressAvatar.SILVER&&(this._art.ornamentationBronze.visible=!0))},Object.defineProperty(s.prototype,"studentAvatarContainer",{get:function(){return this._art.studentAvatar},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"avatarIcon",{get:function(){return this._avatarIcon},enumerable:!1,configurable:!0}),s.prototype.setScreenButtons=function(t){this._showHeaderButtons=!t;t=getSessionProperty(DBLDataConstants.CUR_SCREEN_TYPE);if(this._art[this._myLessonsButton].visible=!1,this._art[this._myStuffButton].visible=!1,this._art[this._myLessonsActive].visible=!1,this._art[this._myStuffActive].visible=!1,this.updateCoinsVisibility(),this.headerButtonsVisible)switch(t){case DBLScreenConstants.LESSON_SCREEN:case DBLScreenConstants.CHOOSER_SCREEN:case DBLScreenConstants.MOVIEPLAYER_SCREEN:case DBLScreenConstants.NANOGAME_SCREEN:this._art[this._myLessonsActive].visible=!0,this._art[this._myStuffButton].visible=!0;break;case DBLScreenConstants.BADGES_SCREEN:case DBLScreenConstants.ACHIEVEMENTS_SCREEN:case DBLScreenConstants.STATS_SCREEN:case DBLScreenConstants.COLLECTIONS_SCREEN:case DBLScreenConstants.PERSONALIZATION_SCREEN:case DBLScreenConstants.MINIGAME_SCREEN:this._art[this._myLessonsButton].visible=!0,this._art[this._myStuffActive].visible=!0;break;default:this._art[this._myLessonsActive].visible=!0,this._art[this._myStuffButton].visible=!0}else this._art.skipButton.visible=!1},Object.defineProperty(s.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t;for(var e=0,s=this._buttonControllers;e<s.length;e++){var n=s[e];n.mouseEnabled=t&&n.enabled}},enumerable:!1,configurable:!0}),s.prototype.tick24=function(){null!=this._highlightHelp&&(DBLAsset.advanceMovieClip(this._highlightHelp),this._pulseOnce)&&this._highlightHelp.currentFrame==this._highlightHelp.totalFrames-1&&(this._pulseOnce=!1,this.clearHighlight())},s.prototype.setArtBackgroundLogo=function(){var t;"neon"!==engagement&&(t=this._art.background,"bookworm"==engagement?(t.logo.visible=!1,t.logo_be.visible=!1):(t.logo_reading&&(t.logo_reading.visible=!1),"GB"===dialect?t.logo.visible=!1:t.logo_be.visible=!1))},s.prototype.setHelpDownState=function(t){this.buttonController(s.HELP_BUTTON).state=t?DBLBaseButton.STATE_DOWN:DBLBaseButton.STATE_UP,(this.highlightHelp=t)&&this._highlightHelp.gotoAndStop(s.HELP_HIGHLIGHT_FRAME_FOR_REPLAY)},s.prototype.getAccessibilityChildren=function(){return[this.getA11yCoinCountButton(),this.getA11yButton(s.MY_LESSONS_BUTTON,"shellMyLessons"),this.getA11yButton(s.MY_LESSONS_BUTTON_ACTIVE,"shellMyLessons"),this.getA11yButton(s.MY_STUFF_BUTTON,"shellMyStuff"),this.getA11yButton(s.MY_STUFF_BUTTON_ACTIVE,"shellMyStuff"),this.getA11yButton(s.SKIP_BUTTON,"shellSkipButton"),this.getA11yButton(s.HELP_BUTTON,"shellHelpButton"),this.getA11yButton(s.PAUSE_BUTTON,"shellPauseButton"),this.getA11yButton(s.CLOSE_BUTTON,"shellExitButton")].filter(function(t){return!!t})},s.prototype.getA11yButton=function(t,e){var s,t=this._buttonControllers[t];return t?((s=t.getAccessibilityData()).label=null,s.labelObject={id:e},s.visible=s.visible&&t.stage&&!!t.getBounds(),s):null},s.prototype.getA11yCoinCountButton=function(){var e=this;return{type:"img",display:{object:this._coinCount},tabIndex:-1,focus:{boundsDisplayObject:this,bounds:function(){var t=null!=(t=e._buttonControllers[s.MY_LESSONS_BUTTON].getBounds())?t:e._buttonControllers[s.MY_LESSONS_BUTTON_ACTIVE].getBounds();return new createjs.Rectangle(e._coinCount.x-35,0,t.width,t.height)}},labelObject:{id:"shellCoins",params:{coins:this._coinCount.text}}}},s.HELP_BUTTON=0,s.SKIP_BUTTON=1,s.PAUSE_BUTTON=2,s.CLOSE_BUTTON=3,s.MY_LESSONS_BUTTON=4,s.MY_STUFF_BUTTON=5,s.MY_LESSONS_BUTTON_ACTIVE=6,s.MY_STUFF_BUTTON_ACTIVE=7,s.HELP_HIGHLIGHT_FRAME_FOR_REPLAY=35,a.Header=s})(engagement_intermediate_shell=engagement_intermediate_shell||{}),(s=>{var t;function e(){return t.call(this)||this}t=createjs.Container,__extends(e,t),e.prototype.init=function(t){var e=s.ShellSkinConstants.SHELL_INFOSCREEN;this._art=DBLAsset.create(e,s.ShellSkinConstants.SHELL_BUNDLE),this._art.gotoAndStop(0),DBLAsset.setNameAndBounds(this,"infopanel",this._art),appVersion?this._art.versionText.text="Version: "+appVersion:this._art.versionText.visible=!1,this.addChild(this._art),this._art.copyrightLine.text="Copyright © "+(new Date).getFullYear()+" Discovery Education, Inc. All Rights Reserved.",appVersion||(this._art.copyrightLine.y-=20),__suppressIESFX&&(this._art.copyrightLine.y-=10,(e=new createjs.Text("Limited sound on this "+(webview?"device":"browser")+".",this._art.copyrightLine.font,this._art.copyrightLine.color)).y=this._art.copyrightLine.y+25,e.x=this._art.backButton.x,e.textAlign="center",this.addChild(e)),this._button=new DBLTimelineButton(this._art.backButton,null,s.ShellSkinConstants.SOUND_GENERALBUTTONCLICK,s.ShellSkinConstants.SOUND_GENERALBUTTONROLLOVER),this._button.addEventListener("click",this.backClicked.bind(this)),DBLAsset.setNameAndBounds(this._art.backButton,"infopanel",this._art.backButton),this.addChild(this._button),this.resize()},e.prototype.resize=function(){var t=(engagementStage?engagementStage.getBounds():new createjs.Rectangle).width/1024;this.scaleX=this.scaleY=t,this.x=s.Dialog.DIALOG_CENTER_X*t-this.getTransformedBounds().width/2,this.y=s.Dialog.DIALOG_CENTER_Y*t-this.getTransformedBounds().height/2},e.prototype.cleanup=function(){this._button.removeAllEventListeners(),this.removeAllChildren(),this._art=null,this._button=null},e.prototype.backClicked=function(){this.dispatchEvent(e.CLOSE_PANEL,!0)},e.prototype.getAccessibilityData=function(){return{tabIndex:0,type:"modaldialog",display:{object:this},labelObject:{id:"shellInfoModal"},children:[__assign(__assign({},this._button.getAccessibilityData()),{labelObject:{id:"shellInfoClose"}})],onEsc:null}},e.CLOSE_PANEL="closePanel",s.InfoPanel=e})(engagement_intermediate_shell=engagement_intermediate_shell||{}),(a=>{var s;function o(){var t,e=s.call(this)||this;return e.BUTTONS_ORDER=[o.BADGES_BUTTON,o.ACHIEVEMENTS_BUTTON,o.STATS_BUTTON,o.COLLECTIONS_BUTTON,o.PERSONALIZATION_BUTTON],e.NUMBER_MAP={1:"one",2:"two",3:"three",4:"four",5:"five"},e.ANIMATION_TIME=.5,e.A11Y_BUTTONS_LABEL_ID=((t={})[o.BADGES_BUTTON]="myStuffBadgesButton",t[o.ACHIEVEMENTS_BUTTON]="achievementsLabel",t[o.STATS_BUTTON]="myStuffStatsButton",t[o.COLLECTIONS_BUTTON]="myStuffCollectionsButton",t[o.PERSONALIZATION_BUTTON]="myStuffPersonalizationButton",t),e._badgesButton="badgesButton"+("spanish"==language?"_es":""),e._achieveButton="achieveButton"+("spanish"==language?"_es":""),e._statsButton="statsButton"+("spanish"==language?"_es":""),e._collectionsButton="collectionsButton"+("spanish"==language?"_es":""),e._personalizeButton="personalizeButton"+("spanish"==language?"_es":""),e.showPersonalizationTab()?setSessionProperty(DBLDataConstants.MYSTUFF_SCREEN,DBLScreenConstants.PERSONALIZATION_SCREEN):setSessionProperty(DBLDataConstants.MYSTUFF_SCREEN,DBLScreenConstants.BADGES_SCREEN),e.tab=getSessionProperty(DBLDataConstants.MYSTUFF_SCREEN),e._enabled=!0,e}s=createjs.Container,__extends(o,s),o.prototype.showPersonalizationTab=function(){return!(void 0!==personalization&&!DBLDataUtils.isBookworm&&"boolean"==typeof personalization)||personalization},o.prototype.showCollectionsTab=function(){return!(void 0!==collections&&!DBLDataUtils.isBookworm&&"boolean"==typeof collections)||collections},o.prototype.init=function(){var s,t,e,n=this;this._buttons||(this._buttons=[],(s=DBLAsset.create(a.ShellSkinConstants.MYSTUFF_NAV_MYSTUFFNAV_MENU,a.ShellSkinConstants.MYSTUFF_NAV_BUNDLE)).gotoAndStop(0),DBLAsset.setNameAndBounds(this,"mystuffnavigation",s),["badgesButton","badgesButton_es","achieveButton","achieveButton_es","statsButton","statsButton_es","collectionsButton","collectionsButton_es","personalizeButton","personalizeButton_es"].forEach(function(t){s[t].visible=!1,s[t].stop()}),e=s[this._badgesButton],t=(t=s[this._achieveButton]).x-t.regX-(e.x-e.regX)-e.nominalBounds.width,this._halfButtonSpace=Math.floor(.5*t),t=(e=[{show:!0,buttonId:o.BADGES_BUTTON,buttonName:"mystuffnavigation_badgesbutton",assetId:this._badgesButton,screen:DBLScreenConstants.BADGES_SCREEN},{show:achievements&&!screenerMode&&"bookworm"!=engagement,buttonId:o.ACHIEVEMENTS_BUTTON,buttonName:"mystuffnavigation_achievementsbutton",assetId:this._achieveButton,screen:DBLScreenConstants.ACHIEVEMENTS_SCREEN},{show:stats&&!screenerMode&&"bookworm"!=engagement,buttonId:o.STATS_BUTTON,buttonName:"mystuffnavigation_statsbutton",assetId:this._statsButton,screen:DBLScreenConstants.STATS_SCREEN},{show:this.showCollectionsTab(),buttonId:o.COLLECTIONS_BUTTON,buttonName:"mystuffnavigation_collectionsbutton",assetId:this._collectionsButton,screen:DBLScreenConstants.COLLECTIONS_SCREEN},{show:this.showPersonalizationTab(),buttonId:o.PERSONALIZATION_BUTTON,buttonName:"mystuffnavigation_personalizationbutton",assetId:this._personalizeButton,screen:DBLScreenConstants.PERSONALIZATION_SCREEN}]).reduce(function(t,e){return e.show?n.addButton(e.buttonId,e.buttonName,s[e.assetId],e.screen):t.push(e.buttonId),t},[]),this.updateButtonPositions(t,e,s),t=Object.keys(this._buttons).length,s.background.gotoAndStop(this.NUMBER_MAP[t]),this.addChildAt(s.background,0),(e=DBLIntermediateEngagementRestrictionUtility.getEngagementRestrictions()).personalizationRestricted?e.personalizationRestrictedTimeRemainingSeconds?DBLClientEventManager.recordClientEvent("DblShellScreen","EngagementRestrictedPersonalize",e.personalizationRestrictedTimeRemainingSeconds):DBLClientEventManager.recordClientEvent("DblShellScreen","EngagementRestrictedPersonalize",!0):DBLClientEventManager.recordClientEvent("DblShellScreen","EngagementRestrictedPersonalize",!1),e.collectionsRestricted?e.collectionsRestrictedTimeRemainingInSeconds?DBLClientEventManager.recordClientEvent("DblShellScreen","EngagementRestrictedCollections",e.collectionsRestrictedTimeRemainingInSeconds):DBLClientEventManager.recordClientEvent("DblShellScreen","EngagementRestrictedCollections",!0):DBLClientEventManager.recordClientEvent("DblShellScreen","EngagementRestrictedCollections",!1))},o.prototype.addButton=function(t,e,s,n){if(this._buttons[t])throw new Error("Button with such id already exists");var o=s.x,i=s.y,s=(s.x=0,s.y=0,DBLGraphicUtils.createCachedMovieClip(s,!0));return this._buttons[t]=new DBLTimelineButton(s,null,a.ShellSkinConstants.SOUND_GENERALBUTTONCLICK,a.ShellSkinConstants.SOUND_GENERALBUTTONROLLOVER),this._buttons[t].addEventListener("click",this.showScreen.bind(this,n,this._buttons[t])),this._buttons[t].name=e,this._buttons[t].x=o,this._buttons[t].y=i,this.addChild(this._buttons[t]),this._buttons[t]},o.prototype.updateButtonPositions=function(t,o,i){var a=this,r=this.BUTTONS_ORDER.concat(),l=r.reduce(function(t,e){return t[e]=0,t},{});t.forEach(function(e){var s=1,t=o.filter(function(t){return t.buttonId===e})[0].assetId,n=.5*i[t].nominalBounds.width;r.forEach(function(t){t===e?s=-1:l[t]+=s*(n+a._halfButtonSpace)}),r=r.filter(function(t){return t!=e}),delete l[e]}),r.forEach(function(t){a._buttons[t].x+=l[t]})},o.prototype.showScreen=function(t,e){e.enabled&&(this.tab=t,setSessionProperty(DBLDataConstants.MYSTUFF_SCREEN,t),screencur.hide(function(){shell.loadScreen(t)}))},o.prototype.cleanup=function(){this.clear(),this._showTimeline&&(this._showTimeline.clear(),this._showTimeline=null),this._hideCallback&&(this._hideTimeline.clear(),this._hideTimeline=null),this._hideCallback=null},o.prototype.show=function(t){void 0===t&&(t=!1),this.init(),null!=this._hideTimeline&&(this._hideTimeline.clear(),this._hideTimeline=null),null!=this._showTimeline&&(this._showTimeline.clear(),this._showTimeline=null),this.alpha=0,this._showTimeline=new gsap.TimelineLite({onComplete:this.finishShow.bind(this)}),this._showTimeline.add(gsap.TweenLite.to(this,t?0:this.ANIMATION_TIME,{alpha:1})),this.mouseEnabled=this.mouseChildren=!1,this._animating=!0},o.prototype.hide=function(t){null!=this._showTimeline&&(this._showTimeline.clear(),this._showTimeline=null),null!=this._hideTimeline&&(this._hideTimeline.clear(),this._hideTimeline=null),this.alpha=1,this._hideTimeline=new gsap.TimelineLite({onComplete:this.finishHide.bind(this)}),this._hideTimeline.add(gsap.TweenLite.to(this,this.ANIMATION_TIME,{alpha:0})),this.mouseEnabled=this.mouseChildren=!1,this._animating=!0,screencur.hide(t)},Object.defineProperty(o.prototype,"tab",{set:function(t){switch(this.deselectButtons(),t){case DBLScreenConstants.BADGES_SCREEN:this.selectButton(o.BADGES_BUTTON);break;case DBLScreenConstants.ACHIEVEMENTS_SCREEN:this.selectButton(o.ACHIEVEMENTS_BUTTON);break;case DBLScreenConstants.STATS_SCREEN:this.selectButton(o.STATS_BUTTON);break;case DBLScreenConstants.COLLECTIONS_SCREEN:this.selectButton(o.COLLECTIONS_BUTTON);break;case DBLScreenConstants.PERSONALIZATION_SCREEN:this.selectButton(o.PERSONALIZATION_BUTTON)}},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"enabled",{set:function(t){this._enabled=t,!this._animating&&this&&(this.mouseEnabled=this.mouseChildren=t)},enumerable:!1,configurable:!0}),o.prototype.selectButton=function(t){this._buttons&&(this._buttons[t].enabled=!1)},o.prototype.deselectButtons=function(){if(this._buttons)for(var t=0;t<this._buttons.length;t++){var e=this._buttons[t];e&&0==e.enabled&&(e.enabled=!0)}},o.prototype.finishShow=function(){this._animating=!1,this.mouseEnabled=this.mouseChildren=this._enabled},o.prototype.finishHide=function(){this._animating=!1,this.mouseEnabled=this.mouseChildren=this._enabled},o.prototype.clear=function(){if(this.removeAllChildren(),this._buttons){for(;0<this._buttons.length;){var t=this._buttons.pop();t&&(t.removeAllEventListeners(),t.cleanup())}this._buttons=null}},o.prototype.getAccessibilityData=function(){var n=this,o=[];return this._buttons&&this.BUTTONS_ORDER.forEach(function(t){var e,s=n._buttons[t];s&&((e=s&&s.getAccessibilityData()).pressed=!e.enabled,e.enabled=e.visible,e.labelObject={id:n.A11Y_BUTTONS_LABEL_ID[t]},s)&&o.push(e)}),{role:"group",tabIndex:-1,display:{object:this},labelObject:{id:"myStuffNavigation"},children:o}},o.BADGES_BUTTON=0,o.COLLECTIONS_BUTTON=1,o.PERSONALIZATION_BUTTON=2,o.ACHIEVEMENTS_BUTTON=3,o.STATS_BUTTON=4,a.MyStuffNavigation=o})(engagement_intermediate_shell=engagement_intermediate_shell||{}),(t=>{function e(){}e.prototype.start=function(){this._startTime=getTime(),this._stopTime=0,this._pauseTime=0,this._pauseStart=0},e.prototype.stop=function(){this._stopTime=getTime()},Object.defineProperty(e.prototype,"pause",{set:function(t){t?this._pauseStart=getTime():0!=this._pauseStart&&(this._pauseTime+=getTime()-this._pauseStart,this._pauseStart=0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return 0==this._startTime?0:0!=this._stopTime?this._stopTime-this._startTime-this._pauseTime:getTime()-this._startTime-this._pauseTime},enumerable:!1,configurable:!0}),t.ProgressTimer=e})(engagement_intermediate_shell=engagement_intermediate_shell||{}),(r=>{var t=engagement_shared.RatingLocations,s=(DBLRuntime.requireLibrary("library.manipulativecore"),DBLRuntime.requireLibrary("library.intermediateshared"),DBLRuntime.requireLibrary("library.engagementshared"),replayMode||(DBLRuntime.requireLibrary("library.nanogamelib"),DBLRuntime.requireLibrary("library.minigamelib")),webview&&DBLRuntime.requireComponent("engagement.login.Login"),DBLRuntime.requireComponent("components.shared.buttondynamic.ButtonDynamic"),r.LESSON_CONTENT_TOP_HEIGHT=51,Loc.localizeBundle("assets.bundles.engagement.intermediate.screener.".concat(engagement,".Assessment_ScreenerTransitions"))),e=webview?DBLRuntime.requireBundle("assets.bundles.engagement.shared.ModeIndicator"):"",n=DBLRuntime.requireBundle("assets.bundles.lessons.shared.ButtonsShared");function o(){this.NAV_BUTTONS_Y=95,this._keyboardInfoPopup=null,this._messageHelp=null,this._settingsPopup=null,this._pauseCount=0,this._nextScreen=null,this._enableHelp=!1,this._ffStuckDetector=0}Object.defineProperty(o.prototype,"sessionStartTime",{get:function(){return this._sessionStartTime||0},enumerable:!1,configurable:!0}),o.prototype.load=function(t){var e;screenerMode?(e=t,t=function(){DBLAsset.loadBundle(s,function(){DBLRuntime.loadLinkedAssets(s,"*",e)})}):DBLStateManager.setProperty(DBLDataConstants.SEEN_SCREENER_INTRO,!1),setSessionProperty(DBLDataConstants.PREV_COINS_EARNED,getSessionProperty(DBLDataConstants.PREV_COINS_EARNED)||0),setSessionProperty(DBLDataConstants.PREV_LESSON_TIME,getSessionProperty(DBLDataConstants.PREV_LESSON_TIME)||0),setSessionProperty(DBLDataConstants.CUR_COINS_EARNED,getSessionProperty(DBLDataConstants.CUR_COINS_EARNED)||0),setSessionProperty(DBLDataConstants.CUR_LESSON_TIME,getSessionProperty(DBLDataConstants.CUR_LESSON_TIME)||0),setSessionProperty(DBLDataConstants.CUR_LESSONS_COMPLETED,getSessionProperty(DBLDataConstants.CUR_LESSONS_COMPLETED)||0),setSessionProperty(DBLDataConstants.NANO_AWARDED,getSessionProperty(DBLDataConstants.NANO_AWARDED)||!1),setSessionProperty(DBLDataConstants.NANO_LESSONS_SINCE_LAST,getSessionProperty(DBLDataConstants.NANO_LESSONS_SINCE_LAST)||0),setSessionProperty(DBLDataConstants.NANO_TIME_SINCE_LAST,getSessionProperty(DBLDataConstants.NANO_TIME_SINCE_LAST)||0),setSessionProperty(DBLDataConstants.PREV_SCREEN_TYPE,getSessionProperty(DBLDataConstants.PREV_SCREEN_TYPE)||""),setSessionProperty(DBLDataConstants.CUR_SCREEN_TYPE,getSessionProperty(DBLDataConstants.CUR_SCREEN_TYPE)||""),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_AVATAR_PROGRESS),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_BADGES_SEEN),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_MINIGAMES_SEEN),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_MINIGAME_PIECES_SEEN),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_CURRENT_AVATAR),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_CURRENT_MUSIC),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_CURRENT_WALLPAPER),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_LEVELS_PASSED_DURING_SESSION),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_MINIGAME_DATA),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_NANOGAME_PLAYS),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_NANOGAMES_RECENTLY_PLAYED),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_SHOW_PROGRESS_WARNING),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_STREAK_HISTORY),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_TOTAL_CORRECT_ANSWERS),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_INTRO_VIDEO_SEEN_ENGAGEMENT+engagement),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_AVATAR_POINTS_SEEN),DBLStateManager.requestProperty(DBLDataConstants.USER_DATA_BLOB),DBLStateManager.requestProperty(DBLDataConstants.SEEN_PRIMARY_FTUE),DBLStateManager.requestProperty(DBLDataConstants.NEON_FIRST_LOGIN),DBLStateManager.requestProperty(DBLDataConstants.COLOR_CHOICE_PRIMARY),DBLStateManager.requestProperty(DBLDataConstants.COLOR_CHOICE_ACCENT),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_USE_CUSTOM_AVATAR),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_CUSTOM_AVATAR_CONFIG),DBLStateManager.requestProperty(DBLDataConstants.PROPERTY2_CUSTOM_AVATAR_ASSET_NAME),DBLStateManager.requestProperty("introVideoSeen"),DBLStateManager.requestProperty("map"),DBLStateManager.requestProperty("GeometryGlossary"),DBLStateManager.requestProperty("CoordinateGridsZoomingAnswer"),DBLStateManager.requestProperty("Coordinates"),DBLStateManager.requestProperty("SimpleLights"),DBLStateManager.requestProperty("FunctionGraph"),DBLStateManager.requestProperty("Transform"),DBLStateManager.requestProperty(engagement_shared.PROPERTY_SOUND_OPTIONS),DBLStateManager.requestProperty(engagement_shared.PROPERTY_MESSAGES_EVER),DBLStateManager.requestProperty(engagement_shared.PROPERTY_DREAMBOX_REACTIONS),DBLStateManager.requestProperty(DBLVoiceChoice.PROPERTY_VOICE_BASE+lcid),__gatesSurvey&&DBLStateManager.requestProperty(engagement_shared.SURVEY_POPUP_TIMESTAMP_PREFIX),this._initialLoadCallback=t,DBLStateManager.syncProperties(this.onStateLoaded.bind(this))},o.prototype.onStateLoaded=function(){void 0===getSessionProperty(DBLDataConstants.INITIAL_LESSONS_COMPLETED)&&setSessionProperty(DBLDataConstants.INITIAL_LESSONS_COMPLETED,__lessonsCompletedThisWeek||0),DBLVoiceChoice.afterInitialPropSync(),DBLEngagementManager.getInventory(["coins","badges","minigames","minigamePieces","avatarPoints","avatars","wallpapers","music"],this.onInventoryLoaded.bind(this))},o.prototype.onInventoryLoaded=function(t){setSessionProperty(DBLDataConstants.INVENTORY_CACHE,t);var t=DBLStateManager.getProperty(DBLDataConstants.USER_DATA_BLOB),e=!1;t&&(DBLLog.log("Splitting udb property into sub-properties (new for 2.0)",DBLLog.INFO),this.migrate(t,DBLDataConstants.PROPERTY2_AVATAR_PROGRESS,DBLDataConstants.UDB_AVATAR_PROGRESS),this.migrate(t,DBLDataConstants.PROPERTY2_BADGES_SEEN,DBLDataConstants.UDB_BADGE),this.migrate(t,DBLDataConstants.PROPERTY2_MINIGAMES_SEEN,DBLDataConstants.UDB_COLLECTION_DATA),this.migrate(t,DBLDataConstants.PROPERTY2_MINIGAME_PIECES_SEEN,DBLDataConstants.UDB_COLLECTION_PIECE_DATA),this.migrate(t,DBLDataConstants.PROPERTY2_CURRENT_AVATAR,DBLDataConstants.UDB_CURRENT_AVATAR),this.migrate(t,DBLDataConstants.PROPERTY2_CURRENT_MUSIC,DBLDataConstants.UDB_CURRENT_MUSIC_THEME),this.migrate(t,DBLDataConstants.PROPERTY2_CURRENT_WALLPAPER,DBLDataConstants.UDB_CURRENT_WALLPAPER),this.migrate(t,DBLDataConstants.PROPERTY2_LEVELS_PASSED_DURING_SESSION,DBLDataConstants.UDB_LEVELS_PASSED_DURING_SESSION),this.migrate(t,DBLDataConstants.PROPERTY2_MINIGAME_DATA,DBLDataConstants.UDB_MINIGAME_DATA),this.migrate(t,DBLDataConstants.PROPERTY2_NANOGAME_PLAYS,DBLDataConstants.UDB_NANOGAME_PLAYS),this.migrate(t,DBLDataConstants.PROPERTY2_SHOW_PROGRESS_WARNING,DBLDataConstants.UDB_SHOW_PROGRESS_WARNING),this.migrate(t,DBLDataConstants.PROPERTY2_STREAK_HISTORY,DBLDataConstants.UDB_STREAK_HISTORY),this.migrate(t,DBLDataConstants.PROPERTY2_TOTAL_CORRECT_ANSWERS,DBLDataConstants.UDB_TOTAL_CORRECT_ANSWERS),DBLStateManager.setProperty(DBLDataConstants.USER_DATA_BLOB,null),0<Object.keys(t).length&&DBLStateManager.setProperty(DBLDataConstants.PROPERTY2_INTRO_VIDEO_SEEN_ENGAGEMENT+engagement,!0),e=!0),e=this.migrateHelper("introVideoSeen",["paperfrenzy","coolfrost","neon"])||e,e=this.migrateHelper("map",["has_finished_ftue","has_seen_reward_intro"])||e,e=this.migrateHelper("GeometryGlossary",["cardData"])||e,e=this.migrateHelper("CoordinateGridsZoomingAnswer",["ShortAnimation"])||e,e=this.migrateHelper("Coordinates",["DragGrid"])||e,e=this.migrateHelper("SimpleLights",["seen_long_intro_1"])||e,e=this.migrateHelper("FunctionGraph",["robotConfiguration","robotPartStatus"])||e,(e=this.migrateHelper("Transform",["LongAnimation"])||e)?DBLStateManager.syncProperties(this.initializeProperties.bind(this)):this.initializeProperties()},o.prototype.migrate=function(t,e,s){t[s]&&DBLStateManager.setProperty(e,JSON.parse(JSON.stringify(t[s])))},o.prototype.migrateHelper=function(t,e){var s,n=!1;if(s=DBLStateManager.getProperty(t)){for(var o=0,i=e;o<i.length;o++){var a=i[o];DBLStateManager.setProperty("Property."+t+"."+a,s[a])}DBLStateManager.setProperty(t,null),n=!0}return n},o.prototype.initializeProperties=function(){var t;!DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_CURRENT_WALLPAPER)&&DBLStateManager.getProperty(DBLDataConstants.SEEN_PRIMARY_FTUE)&&DBLStateManager.setProperty(DBLDataConstants.PROPERTY2_CURRENT_WALLPAPER,2020),"neon"!=engagement||DBLStateManager.getProperty(DBLDataConstants.NEON_FIRST_LOGIN)||(t=DBLDataUtils.getEngagementData(DBLDataConstants.ED_DEFAULT_WALLPAPER_ID),DBLStateManager.setProperty(DBLDataConstants.PROPERTY2_CURRENT_WALLPAPER,t),DBLStateManager.setProperty(DBLDataConstants.NEON_FIRST_LOGIN,!0)),this.initKeyProperties(),this.createProgressAvatar2(),this.createWallpaper2(),this.createMusic2(),DBLStateManager.syncProperties(this.anyAdditionalLoading.bind(this))},o.prototype.anyAdditionalLoading=function(){this.startCreatingHeader(this.initialLoadComplete.bind(this))},o.prototype.initialLoadComplete=function(){var t=this._initialLoadCallback;this._initialLoadCallback=null,t()},o.prototype.getMappings=function(){var t=[DBLDataConstants.AVATAR_DATA_FQN,DBLDataConstants.ENGAGEMENT_DATA_FQN,DBLDataConstants.TRANSLATE_FQN];return replayMode||(t.push(DBLDataConstants.HELP_PLAY_FQN,DBLDataConstants.BADGES_DATA_FQN,DBLDataConstants.MINIGAMEPIECE_DATA_FQN,DBLDataConstants.MUSIC_DATA_FQN,DBLDataConstants.TRANSLATE_SR_FQN,DBLDataConstants.PLAY_SR_FQN,DBLDataConstants.WALLPAPER_DATA_FQN,engagement_shared.SEASONAL_DATA_FQN,DBLDataConstants.LESSONDOMAINS_FQN,DBLDataConstants.LESSONGROUPS_FQN,DBLDataConstants.DREAMBOX_MESSAGES_FQN,DBLDataConstants.INTERMEDIATE_SHELL_PLAYSR,DBLDataConstants.SHARED_FQN,DBLDataConstants.EXPRESSION_SIMPLIFIER_FQN),webview&&t.push("assets.translations.engagement.login.Translate")),__gatesPreviewEnabled&&t.push(DBLDataConstants.LESSON_DESCRIPTIONS_FQN),"bookworm"==engagement?t.push(DBLDataConstants.FRIENDLYNAMES_BOOKWORM_FQN):t.push(DBLDataConstants.FRIENDLYNAMES_FQN),t},o.prototype.getHeaderHeight=function(){return this._header&&this._headerInitialized?this._header.getBounds().height-4:46.5},o.prototype.getFooterHeight=function(){return 100},o.prototype.getInitialScreen=function(){return this.chooserScreenFqn},o.prototype.getLessonExitScreen=function(){return this._lessonExitScreenFQN},o.prototype.showLoadingScreen=function(){this.enableShellComponents(!1,!1,!1,!1)},o.prototype.hideLoadingScreen=function(){this.enableShellComponents(!0,!0,!0,!0)},o.prototype.showSpinner=function(t){t&&(this.transitioningToLesson=!1),this._spinner||((!this.screenerStartedAndRunning||this.pressedBack&&!t?(this._spinner=new DBLLoadingSpinner,engagementStage):(this._spinner=new engagement_shared_screener.ScreenerSpinner(s),engagementContent)).addChild(this._spinner),this._spinner.show())},o.prototype.hideSpinner=function(){screenerMode&&this.transitioningToLesson||this._spinner&&(this._spinner.cleanup(),engagementStage.removeChild(this._spinner),this._spinner=null)},Object.defineProperty(o.prototype,"waitForSpinnerToFinish",{get:function(){return lesson&&this._spinner&&this._spinner.isRunning},enumerable:!1,configurable:!0}),o.prototype.finishedLoading=function(){this._spinner&&(this._spinner.hide=!0)},o.prototype.showContentScrim=function(t){this._scrim.visible=t=void 0===t?!1:t,freezeContent()},o.prototype.hideContentScrim=function(){this._scrim.visible=!1,thawContent()},o.prototype.getSoundOptions=function(){var t=DBLStateManager.getProperty(engagement_shared.PROPERTY_SOUND_OPTIONS);return t?!0===rootParams.cc&&(t.cc=!0,DBLStateManager.setProperty(engagement_shared.PROPERTY_SOUND_OPTIONS,t)):(t={cc:!0,sfx:!0,sound:!0},DBLStateManager.setProperty(engagement_shared.PROPERTY_SOUND_OPTIONS,t)),t},o.prototype.ready=function(){var t=this,e=(this._progressTimer=new r.ProgressTimer,this.createToolTipManager(),this.finishCreatingHeader(),this.createScrim(),this.createInfoButton(),this.createKeyboardButton(),this.createFeedbackButton(),this.createMyStuffNavigation(),engagementStage.addChild(this._header),engagementStage.addChild(this._scrim),engagementStage.addChild(this._infoButtonContainer),this._keyboardButtonContainer&&engagementStage.addChild(this._keyboardButtonContainer),engagementStage.addChild(this._feedbackButtonContainer),engagementStage.addChild(this._toolTipRollover),this.resize(),webview&&(this._tabletMuteMessage=new createjs.Container,this.initTabletMuteMessage()),this.getSoundOptions()),e=(e&&(this.closedCaptionBarEnabled=e.cc),rootParams.fakemessages&&(this._messagesAvailable=!0,this.updateFeedbackButton()),this.enableShellComponents(!1,!1,!1,!1),this._sessionStartTime=(new Date).getTime(),DBLAsset.create("DBLAButtonDynamic",n)),s=translate("Keyboard Info"),s=(components_shared_buttondynamic.translateButtonAssetText(s,e),this._keyboardInfoButton=new DBLTimelineButton(e),a11y.initKeyboardInfoButton(this._keyboardInfoButton,e,this._header,function(){return t.keyboardInfoButtonClicked()}),DBLAsset.create("DBLAButtonSkiplink",n)),e=translate("Skip to Content");components_shared_buttondynamic.translateButtonAssetText(e,s),this._skipToContentButton=new DBLTimelineButton(s),a11y.initSkipToContentButton(this._skipToContentButton,s,this._header),this._stickyDragFx=new engagement_shared.StickyDragFx},o.prototype.getLessonSupportModule=function(){return"engagement.intermediate.lessonsupport.LessonSupport"},o.prototype.lessonIntro=function(t){try{var e=engagementStage.getChildIndex(this._scrim),s=e?e+1:0;this._lessonSupport=new engagement_intermediate_lessonsupport.LessonSupport,engagementStage.addChildAt(this._lessonSupport,s),this._lessonSupport.addEventListener(engagement_intermediate_lessonsupport.LessonSupport.STOP_LESSON,this.onLessonStop.bind(this)),this._lessonSupport.addEventListener(DBLScreenConstants.HIDE_COMPLETE,this.onLessonComplete.bind(this)),this._lessonSupport.ready(),this._lessonSupport.setShowMeters(!0,t),this.startProgressTimer()}catch(t){DBLLog.log("Failed to initialize lesson support module. Reason: "+t,DBLLog.FATAL)}},o.prototype.lessonOutro=function(t,e,s){this.showSkipButton=!1,setSessionProperty(DBLDataConstants.ASSIGNMENT_COMPLETIONS,e),this._lessonSupport?(this._outroCallback=s,this.endLessonUpdateInventory(t)):s()},o.prototype.endLessonUpdateInventory=function(t){var e=this;this.updateInventory(function(){e.runningScreener?e._lessonSupport.screenerFinalizeProgress(t):e._lessonSupport.finalizeProgress(t)})},o.prototype.updateInventory=function(t){DBLEngagementManager.getInventory(["coins","badges","minigames","minigamePieces","avatarPoints","avatars","wallpapers","music"],this.getInventoryComplete.bind(this,t))},o.prototype.getInventoryComplete=function(t,e){setSessionProperty(DBLDataConstants.INVENTORY_CACHE,e),t&&t()},o.prototype.setLastLessonCompleted=function(t){var e=getSessionProperty(DBLDataConstants.INVENTORY_CACHE)||{};setSessionProperty(DBLDataConstants.COINS_PRIOR_TO_END_LESSON,e.coins||0)},o.prototype.setLastLessonSuccessful=function(t){this._lastLessonSuccessful=t},o.prototype.lessonReady=function(){var t;this.updateHeader(),this._lessonSupport&&(t=(t=DfhgSgh.mfeh())?Math.min(Math.max(Math.round(t),0),100):0,this.updateProgress(t,"",null)),this._lessonExitScreenFQN=this.chooserScreenFqn,this._ffStuckDetector=0},o.prototype.updateHeader=function(){this._header.setScreenButtons(this.screenerStarted)},o.prototype.screenReady=function(){a11y.screenReady(),DBLActivityMonitor.controlReturnsToUser(),lessonContent.alpha=1,this.updateHeader();var t,e=!1;switch(getSessionProperty(DBLDataConstants.CUR_SCREEN_TYPE)){case DBLScreenConstants.BADGES_SCREEN:case DBLScreenConstants.ACHIEVEMENTS_SCREEN:case DBLScreenConstants.STATS_SCREEN:e=!0;break;case DBLScreenConstants.COLLECTIONS_SCREEN:e=!0,screencur.addEventListener("play",this.onMinigamePlay.bind(this));break;case DBLScreenConstants.PERSONALIZATION_SCREEN:e=!0;break;case DBLScreenConstants.NANOGAME_SCREEN:screencur.addEventListener("close",this.onNanogameCloseButtonClicked.bind(this))}e&&!this._myStuffNav.parent&&(t=getSessionProperty(DBLDataConstants.CUR_SCREEN_TYPE),this.showMyStuffNavigation(t)),this._tabletMuteMessage&&(this._tabletMuteMessage.alpha=0)},o.prototype.resize=function(){var t,e=engagementContent?engagementContent.getTransformedBounds():new createjs.Rectangle(0,0,1024,768),s=e.width/1024;this._header.scaleX=this._header.scaleY=s,this._header.x=(e.width-this._header.getTransformedBounds().width)/2,this._myStuffNav.scaleX=this._myStuffNav.scaleY=s,this._myStuffNav.x=e.width/2,this._myStuffNav.y=s*this.NAV_BUTTONS_Y,this._feedbackButtonContainer.x=e.width,this._feedbackButtonContainer.y=e.height,this._feedbackButtonContainer.scaleX=this._feedbackButtonContainer.scaleY=s,this._infoButtonContainer.x=e.x,this._infoButtonContainer.y=e.height,this._infoButtonContainer.scaleX=this._infoButtonContainer.scaleY=s,this._keyboardButtonContainer&&(this._keyboardButtonContainer.x=e.x,t="paperfrenzy"==BWtoPF(engagement)?r.ShellSkinConstants.SHELL_KEYBOARD_DY_PAPERFRENZY:"neon"==engagement?r.ShellSkinConstants.SHELL_KEYBOARD_DY_NEON:r.ShellSkinConstants.SHELL_KEYBOARD_DY_COOLFROST,this._keyboardButtonContainer.y=e.height-t*s,this._keyboardButtonContainer.scaleX=this._keyboardButtonContainer.scaleY=s),this._scrim.scaleX=this._scrim.scaleY=s,this._wallpaper&&(this._wallpaper instanceof createjs.Bitmap?(this._wallpaper.scaleX=this._wallpaper.scaleY=e.height/768/2,this._wallpaper.x=(e.width-this._wallpaper.getTransformedBounds().width)/2):this._wallpaper.scaleX=this._wallpaper.scaleY=e.height/768),this._infoPanel&&this._infoPanel.resize(),this._keyboardInfoPopup&&this._keyboardInfoPopup.resize(),this._dialog&&this._dialog.resize(),this._spinner&&this._spinner.resize(),this._settingsPopup&&this.resizeSettingsPopup(),this._lessonSupport&&this._lessonSupport.resize(),this._feedbackDialog&&this._feedbackDialog.resize(),this._messageHelp&&this._messageHelp.resize(),this._messageDialog&&this._messageDialog.resize(),this._tabletMuteMessage&&this.resizeMuteMessage(),this._closedCaptionBar&&this.resizeClosedCaptionBar(s),this._helpPopup&&this.resizeHelpPopup(),this._toolTipManager.offset=new createjs.Point(0,24*s)},o.prototype.persistSessionState=function(){this._spinner instanceof engagement_shared_screener.ScreenerSpinner&&this._spinner.saveState()},o.prototype.cleanup=function(){this._loadCallback=null,this._outroCallback=null,DBLDataUtils.cleanup(),engagementStage&&engagementStage.removeAllChildren(),this._toolTipManager&&(this._toolTipManager.cleanup(),this._toolTipRollover=null),this._header&&this._header.cleanup(),this._infoButtonContainer&&(this._infoButtonContainer.removeAllChildren(),this._infoButton.cleanup()),this._feedbackButtonContainer&&(this._feedbackButtonContainer.removeAllChildren(),this._feedbackButton.cleanup()),this._resumeDialog&&(this._resumeDialog.removeAllEventListeners(),this._resumeDialog.cleanup()),this._dialog&&this._dialog.cleanup(),this._myStuffNav&&this._myStuffNav.cleanup(),this._soundChannel&&(this._soundChannel.stop(),this._soundChannel.destroy(),this._soundChannel=null),this._feedbackDialog&&this.onFeedbackCancel(),this._messageHelp&&this.closeMessageHelp(),this._messageDialog&&this.closeMessageDialog(),this._settingsPopup&&this.closeAnySettingsPopup(),this._helpPopup&&this.closeHelpPopup(),this.cleanupLessonSupport(),DBLProgressStar.destroy(),a11y.cleanup()},o.prototype.showPausePopupDueToStall=function(){this.doPauseClicked()},o.prototype.closeAnyPausePopup=function(){this.closeResponse()},o.prototype.tick=function(){this._feedbackDialog&&this._feedbackDialog.tick(),this._messageDialog&&this._messageDialog.tick(),this._resumeDialog&&this._resumeDialog.tick(),this._closedCaptionBar&&this._closedCaptionBar.tick()},o.prototype.tick24=function(t){var e;this._spinner&&this._spinner.tick24(t),this._lessonSupport&&this._lessonSupport.tick24(t),this._header&&this._headerInitialized&&this._header.tick24(),this._keyboardButton&&this._keyboardButtonContainer.visible&&this._keyboardButton.tick24(t),this._feedbackButtonNewMessages&&this._feedbackButtonNewMessages.visible&&this._feedbackButtonNewMessages.tick24(t),this._messageHelp&&this._messageHelp.visible&&this._messageHelp.tick24(t),this._settingsPopup&&this._settingsPopup.tick24(t),this._helpPopup&&this._helpPopup.tick24(t),null!=(e=this._stickyDragFx)&&e.tick24(t)},Object.defineProperty(o.prototype,"showHelpButton",{get:function(){return this._header.helpVisible},set:function(t){this._header.helpVisible=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"enableHelp",{get:function(){return this._header.helpEnabled},set:function(t){this._enableHelp=t,this._header.helpEnabled=t},enumerable:!1,configurable:!0}),o.prototype.highlightHelpPulse=function(){this._header.highlightHelpPulse()},o.prototype.highlightHelp=function(t){this._header.highlightHelp=t},o.prototype.highlightAudioButton=function(t){this._header.highlightAudioButton=t},Object.defineProperty(o.prototype,"showSkipButton",{get:function(){return this._header.skipVisible},set:function(t){this._header.skipVisible=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"enableSkip",{get:function(){return this._header.skipEnabled},set:function(t){this._header.skipEnabled=t},enumerable:!1,configurable:!0}),o.prototype.showErrorPopup=function(t,e,s,n){this.showDialog(t,e==DBLLog.FATAL?r.Dialog.BUTTON_EXIT:r.Dialog.BUTTON_ACCEPT,0,null,e==DBLLog.FATAL?"Error: "+s:null,n)},Object.defineProperty(o.prototype,"toolTipManager",{get:function(){return this._toolTipManager},enumerable:!1,configurable:!0}),o.prototype.updateAvatarFrame=function(t){this._header.updateAvatarFrame(t=void 0===t?null:t)},o.prototype.loadLesson=function(t){function e(){t.videoURL?s.loadScreen(DBLScreenConstants.MOVIEPLAYER_SCREEN):userRunLesson(t)}var s=this;this.enableHeader(!1),setSessionProperty(DBLDataConstants.CUR_LESSON_INFO,t);getSessionProperty(DBLDataConstants.CUR_SCREEN_TYPE)==DBLScreenConstants.CHOOSER_SCREEN?(this.enableHeader(!1),screencur.hide(function(){e()})):e(),setSessionProperty(DBLDataConstants.PREV_SCREEN_TYPE,getSessionProperty(DBLDataConstants.CUR_SCREEN_TYPE))},Object.defineProperty(o.prototype,"screenerStarted",{get:function(){return getSessionProperty(DBLDataConstants.ED_SCREENER_STARTED)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"screenerStartedAndRunning",{get:function(){return screenerMode&&this.screenerStarted},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"runningScreener",{get:function(){return screenerMode||this.screenerStarted},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"chooserScreen",{get:function(){return this.runningScreener?DBLScreenConstants.SCREENER_SCREEN:DBLScreenConstants.CHOOSER_SCREEN},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"chooserScreenFqn",{get:function(){var t=DBLDataUtils.useFlex?DBLDataConstants.LESSONCHOOSERFLEX_SCREEN_FQN:DBLDataConstants.LESSONCHOOSER_SCREEN_FQN;return this.runningScreener?DBLDataConstants.LESSONSCREENER_SCREEN_FQN:t},enumerable:!1,configurable:!0}),o.prototype.loadScreen=function(t){this.enableHeader(!1);getSessionProperty(DBLDataConstants.CUR_SCREEN_TYPE)==DBLScreenConstants.MOVIEPLAYER_SCREEN&&getSessionProperty(DBLDataConstants.CUR_LESSON_INFO).status!=DBLLessonConstants.OPENING_VIDEO_PLAYED&&setSessionProperty(DBLDataConstants.PREV_LAUNCH,null);var e=(new Date).getTime();switch(this._timeMinigameStarted&&(DBLClientEventManager.recordClientEvent("DblShellScreen","GamePlayTime",Math.round((e-this._timeMinigameStarted)/1e3)),this._timeMinigameStarted=void 0),this._timeStatsStarted&&(DBLClientEventManager.recordClientEvent("DblShellScreen","StatsViewTime",Math.round((e-this._timeStatsStarted)/1e3)),this._timeStatsStarted=void 0),this._timeAchievementsStarted&&(DBLClientEventManager.recordClientEvent("DblShellScreen","AchievementsViewTime",Math.round((e-this._timeAchievementsStarted)/1e3)),this._timeAchievementsStarted=void 0),this._timeBadgesStarted&&(DBLClientEventManager.recordClientEvent("DblShellScreen","BadgesViewTime",Math.round((e-this._timeBadgesStarted)/1e3)),this._timeBadgesStarted=void 0),this._timeNanogameStarted&&(DBLClientEventManager.recordClientEvent("DblShellScreen","NanogamePlayTime",Math.round((e-this._timeNanogameStarted)/1e3)),this._timeNanogameStarted=void 0),t){case DBLScreenConstants.BADGES_SCREEN:n=DBLDataConstants.BADGES_SCREEN_FQN,this.playMusic(),this._timeBadgesStarted=(new Date).getTime();break;case DBLScreenConstants.ACHIEVEMENTS_SCREEN:n=DBLDataConstants.ACHIEVEMENTS_SCREEN_FQN,this.playMusic(),this._timeAchievementsStarted=(new Date).getTime();break;case DBLScreenConstants.STATS_SCREEN:n=DBLDataConstants.STATS_SCREEN_FQN,this.playMusic(),this._timeStatsStarted=(new Date).getTime(),this._timeMyStuffStarted||(this._timeMyStuffStarted=this._timeStatsStarted);break;case DBLScreenConstants.COLLECTIONS_SCREEN:n=DBLDataConstants.COLLECTIONS_SCREEN_FQN,this.playMusic(),this._timeMyStuffStarted||(this._timeMyStuffStarted=(new Date).getTime());break;case DBLScreenConstants.PERSONALIZATION_SCREEN:n=DBLDataConstants.PERSONALIZE_SCREEN_FQN,this.playMusic(),this._timeMyStuffStarted||(this._timeMyStuffStarted=(new Date).getTime());break;case DBLScreenConstants.MOVIEPLAYER_SCREEN:n=DBLDataConstants.MOVEIPLAYER_SCREEN_FQN;break;case DBLScreenConstants.CHOOSER_SCREEN:n=DBLDataUtils.useFlex?DBLDataConstants.LESSONCHOOSERFLEX_SCREEN_FQN:DBLDataConstants.LESSONCHOOSER_SCREEN_FQN,this._timeMyStuffStarted&&(DBLClientEventManager.recordClientEvent("DblShellScreen","MyStuffViewTime",Math.round((e-this._timeMyStuffStarted)/1e3)),this._timeMyStuffStarted=void 0);break;case DBLScreenConstants.SCREENER_SCREEN:n=DBLDataConstants.LESSONSCREENER_SCREEN_FQN;break;case DBLScreenConstants.NANOGAME_SCREEN:var s=DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_NANOGAMES_RECENTLY_PLAYED),s=s[s.length-1],n=DBLDataConstants.NANOGAME_SCREEN_BASE_FQN+s.toLocaleLowerCase()+"."+s;this._timeNanogameStarted=(new Date).getTime();break;case DBLScreenConstants.MINIGAME_SCREEN:s=getSessionProperty(DBLDataConstants.MINI_SELECTED);n=DBLDataConstants.MINIGAME_SCREEN_BASE_FQN+s.toLocaleLowerCase()+"."+s,this._timeMinigameStarted=(new Date).getTime()}setSessionProperty(DBLDataConstants.PREV_SCREEN_TYPE,getSessionProperty(DBLDataConstants.CUR_SCREEN_TYPE)),userRunScreen(n)},o.prototype.updateCoinCount=function(t){void 0===t&&(t=null);var e=getSessionProperty(DBLDataConstants.INVENTORY_CACHE).coins||0;this._header.coinCount=t||e},Object.defineProperty(o.prototype,"coinCount",{get:function(){return this._header.coinCount},enumerable:!1,configurable:!0}),o.prototype.startProgressTimer=function(){this._progressTimer.start()},o.prototype.stopProgressTimer=function(){this._progressTimer.stop();var t=getSessionProperty(DBLDataConstants.CUR_LESSON_TIME)+this._progressTimer.duration,t=(setSessionProperty(DBLDataConstants.CUR_LESSON_TIME,t),getSessionProperty(DBLDataConstants.NANO_TIME_SINCE_LAST)+this._progressTimer.duration);setSessionProperty(DBLDataConstants.NANO_TIME_SINCE_LAST,t)},o.prototype.updateProgress=function(t,e,s){this._lessonSupport.updateProgress(t,e,s)},o.prototype.updatePersonalizationItem=function(t){switch(this.updateCoinCount(),t){case DBLDataConstants.UED_AVATAR:this.updateAvatar();break;case DBLDataConstants.UED_WALLPAPER:this.updateWallpaper();break;case DBLDataConstants.UED_MUSIC_THEME:this.updateMusic()}},o.prototype.playMusic=function(){this.playMusicActual()},o.prototype.playMusicActual=function(){var t;muted||(t=getSessionProperty(DBLDataConstants.MUSIC_THEME_IDS),this._musicCount>=t.length&&(this._musicCount=0,setSessionProperty(DBLDataConstants.MUSIC_COUNT,this._musicCount)),this._soundChannel&&(this._soundChannel.stop(),this._soundChannel.destroy(),this._soundChannel=null),this._soundChannel=createjs.Sound.play(t[this._musicCount++]),setSessionProperty(DBLDataConstants.MUSIC_COUNT,this._musicCount))},o.prototype.updateNewMyStuffItems=function(t){if(null===(t=void 0===t?null:t)||!1===t){var e,s=getSessionProperty(DBLDataConstants.INVENTORY_CACHE),n=!1,o=DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_BADGES_SEEN)||{},i=objectFromFQN(DBLDataConstants.BADGES_DATA_FQN);for(e in s.badges||{})if((!o[e]||o[e].ownedCount<s.badges[e])&&i[e]){n=!0;break}var a,r=!1,l=DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_MINIGAME_PIECES_SEEN)||{};for(a in s.minigamePieces||{})if(!l[a]||l[a].state==DBLCollectionConstants.COLLECTIBLE_PIECE_AWARDED||l[a].state==DBLCollectionConstants.COLLECTIBLE_PIECE_PRESENTED){r=!0;break}t=n||r}this._header.myStuffNotificationVisible=t},o.prototype.enableHeader=function(t){this._header.enabled=t,this._myStuffNav.enabled=t},Object.defineProperty(o.prototype,"pressedBack",{get:function(){return getSessionProperty("Session.pressed_back")},set:function(t){setSessionProperty("Session.pressed_back",t)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"wallpaperVisible",{set:function(t){this._wallpaper&&((this._wallpaper.visible=t)?backgroundStage.addChildAt(this._wallpaper,0):-1!=backgroundStage.getChildIndex(this._wallpaper)&&backgroundStage.removeChild(this._wallpaper))},enumerable:!1,configurable:!0}),o.prototype.createAvatarIcon=function(t){var e,s=null;return this._header&&this._header.avatarIcon&&(s=new createjs.Container,e=t/(t=this._header.avatarIcon.clone()).getBounds().height,t.scaleX=t.scaleY=e,s.addChild(t)),s},o.prototype.showHelpPopup=function(t,e){getActualFromSignature(t)?fastForwarding||(this._helpPopupCallback=e,fastForward("popup"),this.showHelpPopupWhenDoneFastForwarding(t)):DBLLog.log("No mapping for toolHelp id "+t,DBLLog.ERROR)},o.prototype.showHelpPopupWhenDoneFastForwarding=function(t){fastForwarding?setTimeout(this.showHelpPopupWhenDoneFastForwarding.bind(this),1):this.doShowHelpPopup(t)},o.prototype.doShowHelpPopup=function(t){var e=this;this._helpPopup=new engagement_shared_toolhelp.HelpPopup(!0),engagementStage.addChild(this._helpPopup),this._helpPopup.addEventListener(engagement_shared_toolhelp.HELPPOPUP_EVENT_EXIT,this.closeHelpPopup.bind(this)),this._resumeFunctionSaved=__resumeFunction,this.resizeHelpPopup(),this.incPauseCount(),this.showContentScrim(!0),this.enableShellComponents(!1,!1,!1,!1),this._helpPopup.load(t,function(t){t?e._helpPopup.show():e.closeHelpPopup()})},o.prototype.resizeHelpPopup=function(){this._helpPopup.resize()},o.prototype.closeHelpPopup=function(){var t;this.decPauseCount(),engagementStage.removeChild(this._helpPopup),this._helpPopup.removeAllEventListeners(),(this._keyboardInfoPopup=null)==this._dialog&&null==this._resumeDialog&&(this.hideContentScrim(),this.enableShellComponents(!0,!0,!0,!0)),a11y.closeDialog(),this._helpPopupCallback&&(t=this._helpPopupCallback,this._helpPopupCallback=null,t())},o.prototype.initKeyProperties=function(){var t=DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_STREAK_HISTORY),t=(1<(t=t||[{start:(new Date).getTime(),length:0}]).length&&(t=[t.pop()]),DBLStateManager.setProperty(DBLDataConstants.PROPERTY2_STREAK_HISTORY,t),DBLStateManager.setProperty(DBLDataConstants.PROPERTY2_LEVELS_PASSED_DURING_SESSION,0),null!=(t=DBLStateManager.getProperty(DBLDataConstants.COLOR_CHOICE_PRIMARY))?t:DBLColorManager.DEFAULT_PRIMARY_HUE),e=null!=(e=DBLStateManager.getProperty(DBLDataConstants.COLOR_CHOICE_ACCENT))?e:DBLColorManager.DEFAULT_ACCENT_HUE;DBLStateManager.setProperty(DBLDataConstants.COLOR_CHOICE_PRIMARY,t),DBLStateManager.setProperty(DBLDataConstants.COLOR_CHOICE_ACCENT,e),DBLColorManager.assignColors(t,e)},o.prototype.createProgressAvatar2=function(){var t,e=DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_CURRENT_AVATAR)||0,s=((e=(getSessionProperty(DBLDataConstants.INVENTORY_CACHE).avatars||{})[e]?e:null)||(e=(e=__user._avatar_?parseInt(__user._avatar_):e)||DBLDataUtils.getEngagementData(DBLDataConstants.ED_DEFAULT_AVATAR_ID),DBLStateManager.setProperty(DBLDataConstants.PROPERTY2_CURRENT_AVATAR,e)),DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_AVATAR_PROGRESS)||{});s[e]?t=new DBLProgressAvatar(JSON.parse(JSON.stringify(s[e]))):(t=DBLProgressAvatar.create(e),rootParams.avatartype&&(t.type=rootParams.avatartype),rootParams.avatarcount&&(t.count=rootParams.avatarcount),rootParams.avatarprogress&&(t.progress=rootParams.avatarprogress),rootParams.avatarlevels&&(t.levels=rootParams.avatarlevels),s[e]=t.data,DBLStateManager.setProperty(DBLDataConstants.PROPERTY2_AVATAR_PROGRESS,s)),setSessionProperty(DBLDataConstants.CUR_PROGRESS_AVATAR,t),setSessionProperty(DBLDataConstants.PREV_PROGRESS_AVATAR,DBLProgressAvatar.create())},o.prototype.createWallpaper2=function(){var t=DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_CURRENT_WALLPAPER)||0;(t=(getSessionProperty(DBLDataConstants.INVENTORY_CACHE).wallpapers||{})[t]?t:null)||(t=DBLDataUtils.getEngagementData(DBLDataConstants.ED_DEFAULT_WALLPAPER_ID),DBLStateManager.setProperty(DBLDataConstants.PROPERTY2_CURRENT_WALLPAPER,t)),this.updateWallpaper()},o.prototype.createMusic2=function(){var t=DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_CURRENT_MUSIC)||0;(t=(getSessionProperty(DBLDataConstants.INVENTORY_CACHE).music||{})[t]?t:null)||(t=DBLDataUtils.getEngagementData(DBLDataConstants.ED_DEFAULT_MUSIC_ID),DBLStateManager.setProperty(DBLDataConstants.PROPERTY2_CURRENT_MUSIC,t)),this.updateMusic()},o.prototype.createToolTipManager=function(){this._toolTipManager=new DBLToolTipManager,this._toolTipManager.scaleBackground=!0,this._toolTipManager.hoverOnly=!0,this._toolTipManager.offset=new createjs.Point(0,24),this._toolTipRollover=DBLAsset.create(r.ShellSkinConstants.SHELL_GENERICTOOLTIPNOSHADOW,r.ShellSkinConstants.SHELL_BUNDLE),this._toolTipRollover.background.shadow=new createjs.Shadow("rgba(0,0,0,0.3)",2,2,2),DBLAsset.setNameAndBounds(this._toolTipRollover,"tooltiprollover",this._toolTipRollover),DBLAsset.setNameAndBounds(this._toolTipRollover.background,"tooltiprollover_background",this._toolTipRollover.background),DBLFont.fixFont(this._toolTipRollover.content,FONT_TYPE_BODY_COPY,"",FONT_TYPE_BODY_COPY_WEIGHT),this._toolTipManager.tipArt=this._toolTipRollover},o.prototype.startCreatingHeader=function(t){this._header=new r.Header,this._header.init(),this.createAvatar(t)},o.prototype.finishCreatingHeader=function(){this._toolTipManager.addHost(this._header.initButton(r.Header.HELP_BUTTON,this.helpClicked.bind(this),translate("Help"))),this._toolTipManager.addHost(this._header.initButton(r.Header.SKIP_BUTTON,this.skipClicked.bind(this),translate("Skip"))),this._toolTipManager.addHost(this._header.initButton(r.Header.PAUSE_BUTTON,this.settingsClicked.bind(this),translate("Settings"))),this._toolTipManager.addHost(this._header.initButton(r.Header.CLOSE_BUTTON,this.closeClicked.bind(this),translate("Quit"))),this._header.initButton(r.Header.MY_LESSONS_BUTTON,this.myLessonsClicked.bind(this),null),this._header.initButton(r.Header.MY_LESSONS_BUTTON_ACTIVE,this.myLessonsClicked.bind(this),null),this._header.initButton(r.Header.MY_STUFF_BUTTON,this.myStuffClicked.bind(this),null),this._header.initButton(r.Header.MY_STUFF_BUTTON_ACTIVE,this.myStuffClicked.bind(this),null),this._header.studentName=__user._name_||"DreamBox",this.updateHeader(),this._header.updateAvatarArt(),DBLAudienceTypeConstants.isDemoOrTeacherTools(audienceType)||(this.updateCoinCount(),this.updateNewMyStuffItems());var t=this.getSoundOptions();t&&(t.sound||(muted=!0),t.sfx||(sfxMuted=!0),this.closedCaptionBarEnabled=t.cc),this._headerInitialized=!0},o.prototype.createScrim=function(){var t=new createjs.Rectangle(0,0,1024,768),e=t.width,s=t.height;this._scrim=new createjs.Shape,this._scrim.graphics.beginFill(createjs.Graphics.getRGB(0,0,0,.6)),this._scrim.graphics.drawRect(0,0,e,s),this._scrim.graphics.endFill(),this._scrim.name="scrim",this._scrim.setBounds(0,0,e,s),this._scrim.visible=!1,DBLAsset.setNameAndBounds(this._scrim,"shellscrim",t)},o.prototype.createInfoButton=function(){this._infoButtonArt=DBLAsset.create(r.ShellSkinConstants.SHELL_INFOTAB,r.ShellSkinConstants.SHELL_BUNDLE),this._infoButtonArt.gotoAndStop(0),this._infoButtonArt.infoButton.mouseChildren=!1,this._infoButtonContainer?(this._infoButtonContainer.removeAllChildren(),this._toolTipManager.removeHost(this._infoButton),this._infoButton.cleanup()):(this._infoButtonContainer=new createjs.Container,this._infoButtonContainer.x=0,this._infoButtonContainer.y=768),this._infoButton=new DBLTimelineButton(this._infoButtonArt.infoButton,null,r.ShellSkinConstants.SOUND_GENERALBUTTONCLICK,r.ShellSkinConstants.SOUND_GENERALBUTTONROLLOVER),this._infoButton.toolTipText=translate("About DreamBox\nLearning"),this._infoButton.addEventListener("click",this.infoButtonClicked.bind(this)),this._toolTipManager.addHost(this._infoButton),this._infoButtonContainer.addChild(this._infoButtonArt),this._infoButtonContainer.addChild(this._infoButton),DBLAsset.setNameAndBounds(this._infoButtonContainer,"infobutton",this._infoButtonArt)},o.prototype.createKeyboardButton=function(){this._keyboardButtonArt=DBLAsset.create(r.ShellSkinConstants.SHELL_KEYBOARDTAB,r.ShellSkinConstants.SHELL_BUNDLE),this._keyboardButtonArt.gotoAndStop(0),this._keyboardButtonArt.infoButton.mouseChildren=!1,this._keyboardButton=new DBLIdleTimelineButton(this._keyboardButtonArt.infoButton,null,r.ShellSkinConstants.SOUND_GENERALBUTTONCLICK,r.ShellSkinConstants.SOUND_GENERALBUTTONROLLOVER),this._keyboardButton.idle=!0,this._keyboardButton.toolTipText=translate("Show Keypad"),this._keyboardButton.addEventListener("click",this.keyboardButtonClicked.bind(this)),this._toolTipManager.addHost(this._keyboardButton),this._keyboardButtonContainer=new createjs.Container,this._keyboardButtonContainer.x=0,this._keyboardButtonContainer.y=768,this._keyboardButtonContainer.addChild(this._keyboardButtonArt),this._keyboardButtonContainer.addChild(this._keyboardButton),DBLAsset.setNameAndBounds(this._keyboardButtonContainer,"keyboardButton",this._keyboardButtonArt),this._keyboardButtonContainer.visible=!1},o.prototype.hitTestRestoreKeyboardButton=function(t,e){return!!this._keyboardButtonContainer&&(t=this._keyboardButtonContainer.globalToLocal(t,e),(e=this._keyboardButtonContainer.getBounds()).pad(10,10,10,10),e.contains(t.x,t.y))},o.prototype.createFeedbackButton=function(){this._feedbackButtonArt=DBLAsset.create(r.ShellSkinConstants.SHELL_FEEDBACKTAB,r.ShellSkinConstants.SHELL_BUNDLE),this._feedbackButtonArt.gotoAndStop(0),this._feedbackButtonArt.feedbackButton.mouseChildren=!1,this._feedbackButtonContainer?(this._feedbackButtonContainer.removeAllChildren(),this._toolTipManager.removeHost(this._feedbackButton),this._toolTipManager.removeHost(this._feedbackButtonNewMessages),this._feedbackButton.cleanup(),this._feedbackButtonNewMessages.cleanup()):(this._feedbackButtonContainer=new createjs.Container,this._feedbackButtonContainer.x=1024,this._feedbackButtonContainer.y=768),this._feedbackButton=new DBLTimelineButton(this._feedbackButtonArt.feedbackButton,null,r.ShellSkinConstants.SOUND_GENERALBUTTONCLICK,r.ShellSkinConstants.SOUND_GENERALBUTTONROLLOVER),__sendFeedback||__messaging?this._feedbackButton.addEventListener("click",this.feedbackButtonClicked.bind(this)):this._feedbackButton.enabled=!1,this._feedbackButton.toolTipText=translate(__messaging?"Messages":"Send feedback"),this._toolTipManager.addHost(this._feedbackButton),this._feedbackButtonArtNewMessages=DBLAsset.create(r.ShellSkinConstants.SHELL_FEEDBACKNEWTAB,r.ShellSkinConstants.SHELL_BUNDLE),this._feedbackButtonArtNewMessages.visible=!1,this._feedbackButtonArtNewMessages.gotoAndStop(0),this._feedbackButtonArtNewMessages.feedbackButton.mouseChildren=!1,this._feedbackButtonNewMessages=new DBLTimelineButton(this._feedbackButtonArtNewMessages.feedbackButton,null,r.ShellSkinConstants.SOUND_GENERALBUTTONCLICK,r.ShellSkinConstants.SOUND_GENERALBUTTONROLLOVER),this._feedbackButtonNewMessages.visible=!1,__sendFeedback||__messaging?this._feedbackButtonNewMessages.addEventListener("click",this.feedbackButtonClicked.bind(this)):this._feedbackButtonNewMessages.enabled=!1,this._feedbackButtonNewMessages.toolTipText=translate("You have a message!"),this._toolTipManager.addHost(this._feedbackButtonNewMessages),this._feedbackButtonContainer.addChild(this._feedbackButtonArt),this._feedbackButtonContainer.addChild(this._feedbackButton),this._feedbackButtonContainer.addChild(this._feedbackButtonArtNewMessages),this._feedbackButtonContainer.addChild(this._feedbackButtonNewMessages),DBLAsset.setNameAndBounds(this._feedbackButtonContainer,"feedbackbutton",this._feedbackButtonArt),this.updateFeedbackButton()},o.prototype.updateFeedbackButton=function(){this._feedbackButtonArtNewMessages.visible=this._messagesAvailable,this._feedbackButtonNewMessages.visible=this._messagesAvailable,this._feedbackButtonArt.visible=!this._messagesAvailable,this._feedbackButton.visible=!this._messagesAvailable},o.prototype.createMyStuffNavigation=function(){this._myStuffNav=new r.MyStuffNavigation,this._myStuffNav.x=512,this._myStuffNav.y=this.NAV_BUTTONS_Y},o.prototype.showMyStuffNavigation=function(t,e){void 0===e&&(e=!1);var s=engagementStage.getChildIndex(this._scrim)-1;engagementStage.addChildAt(this._myStuffNav,s),this._myStuffNav.show(e),this._myStuffNav.tab=t},o.prototype.reloadMyStuffNavigation=function(){this._myStuffNav&&(engagementStage.removeChild(this._myStuffNav),this._myStuffNav.clear(),this.createMyStuffNavigation(),this.showMyStuffNavigation(DBLScreenConstants.PERSONALIZATION_SCREEN,!0),this.resize())},o.prototype.helpClicked=function(){var t=lesson?lesson.toolHelp:null;t?this.showHelpPopup(t,function(){}):userHelp()},o.prototype.skipClicked=function(){userSkip()},o.prototype.onCCOnPressed=function(){this.closedCaptionBarEnabled=!1},o.prototype.onCCOffPressed=function(){this.closedCaptionBarEnabled=!0},o.prototype.showPausePopupDueToLossOfFocus=function(){this.doPauseClicked()},o.prototype.showPausePopupOnStart=function(t){var e=this;this.showDialog(translate("Press to start."),r.Dialog.BUTTON_PLAY,0,null,null,function(){e.pauseDialogResponse(),null!=t&&t()})},o.prototype.showPausePopupDueToClosedCaptionHistory=function(){this.doPauseClicked()},o.prototype.pauseAllowed=function(){return this._header.pauseEnabled&&this._header.enabled},o.prototype.pauseClicked=function(){this.doPauseClicked()},o.prototype.doPauseClicked=function(){this._resumeDialog||fastForwarding||(fastForward("popup"),this.showPausePopupWhenDoneFastForwarding())},o.prototype.showPausePopupWhenDoneFastForwarding=function(){fastForwarding?setTimeout(this.showPausePopupWhenDoneFastForwarding.bind(this),1):this.doShowPausePopup()},o.prototype.doShowPausePopup=function(){this._messageHelp&&this.closeMessageHelp(),this._messageDialog&&this.closeMessageDialog(),this.showDialog(translate("DreamBox is paused."),r.Dialog.BUTTON_PLAY,0,null,null,this.pauseDialogResponse.bind(this)),this._closedCaptionBar&&this._closedCaptionBar.pause()},o.prototype.pauseDialogResponse=function(){this.hideDialog(),this._closedCaptionBar&&this._closedCaptionBar.unpause()},o.prototype.settingsClicked=function(){this.showSettingsPopup()},o.prototype.showSettingsPopup=function(){fastForwarding||(fastForward("popup"),this.showSettingsPopupWhenDoneFastForwarding())},o.prototype.showSettingsPopupWhenDoneFastForwarding=function(){fastForwarding?setTimeout(this.showSettingsPopupWhenDoneFastForwarding.bind(this),1):this.doShowSettingsPopup()},o.prototype.doShowSettingsPopup=function(){this._settingsPopup=new engagement_shared.SettingsPopup,this._resumeFunctionSaved=__resumeFunction,this.resizeSettingsPopup(),this.incPauseCount(),this.enableShellComponents(!1,!1,!1,!1),this._settingsPopup.addEventListener(engagement_shared.PAUSEPOPUP_EVENT_PLAY,this.onSettingsPlayPressed.bind(this)),this._settingsPopup.addEventListener(engagement_shared.TopBar.TOPBAR_EVENT_CCOFF,this.onCCOffPressed.bind(this)),this._settingsPopup.addEventListener(engagement_shared.TopBar.TOPBAR_EVENT_CCON,this.onCCOnPressed.bind(this)),this._settingsPopup.name="settings",engagementStage.addChild(this._settingsPopup),this.showContentScrim(!0),userPause()},o.prototype.resizeSettingsPopup=function(){this._settingsPopup.scaleX=this._settingsPopup.scaleY=lessonContent.scaleX,this._settingsPopup.x=(engagementStage.getBounds().width-this._settingsPopup.getTransformedBounds().width)/2,this._settingsPopup.y=r.LESSON_CONTENT_TOP_HEIGHT*lessonContent.scaleX+52*lessonContent.scaleX},o.prototype.closeAnySettingsPopup=function(){this._settingsPopup&&(this.closeSettingsPopup(),userResume())},o.prototype.closeAnyOpenPopup=function(){this._settingsPopup?this.closeAnySettingsPopup():this._messageDialog?this.closeMessageDialog():this._infoPanel?this.closeInfoPanel():this._helpPopup?this.closeHelpPopup():this._keyboardInfoPopup?this.closeKeyboardInfoPopup():this._dialog&&this.hideDialog()},o.prototype.closeSettingsPopup=function(){this._settingsPopup&&(engagementStage.removeChild(this._settingsPopup),this._settingsPopup.removeAllEventListeners(),this._settingsPopup.cleanup(),this._settingsPopup=null,this.hideContentScrim(),__resumeFunction=this._resumeFunctionSaved,this.decPauseCount(),this.enableShellComponents(!0,!0,!0,!0),a11y.doOnDialogHide())},o.prototype.onSettingsPlayPressed=function(t){this.closeSettingsPopup(),userResume()},o.prototype.closeClicked=function(){this._header.closeEnabled&&(fastForwarding?(DBLLog.log("Exit request ignored - already fastForwarding "+this._ffStuckDetector,DBLLog.INFO),this._ffStuckDetector++,3<=this._ffStuckDetector&&(DBLLog.log("Possible fastForwarding not being reset - resetting it",DBLLog.ERROR),fastForwarding=!1)):(fastForward("popup"),this.showClosePopupWhenDoneFastForwarding()))},o.prototype.showClosePopupWhenDoneFastForwarding=function(){fastForwarding?setTimeout(this.showClosePopupWhenDoneFastForwarding.bind(this),1):this.doShowClosePopup()},o.prototype.doShowClosePopup=function(){DBLLog.log("Close",DBLLog.INFO),this.showDialog(translate("Do you want to quit DreamBox?"),r.Dialog.BUTTON_ACCEPT,r.Dialog.BUTTON_CANCEL,null,null,this.closeResponse.bind(this))},o.prototype.closeResponse=function(t){void 0===t&&(t=null),this.hideDialog(),t&&t.detail==r.Dialog.BUTTON1?(DBLLog.log("Close Chosen",DBLLog.INFO),userExit()):DBLLog.log("Play Chosen",DBLLog.INFO)},o.prototype.myLessonsClicked=function(){switch(getSessionProperty(DBLDataConstants.CUR_SCREEN_TYPE)){case DBLScreenConstants.LESSON_SCREEN:return void this.onLessonStop();case DBLScreenConstants.MOVIEPLAYER_SCREEN:break;case DBLScreenConstants.BADGES_SCREEN:case DBLScreenConstants.ACHIEVEMENTS_SCREEN:case DBLScreenConstants.STATS_SCREEN:case DBLScreenConstants.COLLECTIONS_SCREEN:case DBLScreenConstants.PERSONALIZATION_SCREEN:return this.enableHeader(!1),this._myStuffNav.hide(this.onMyStuffHide.bind(this)),void this.playMusic();case DBLScreenConstants.NANOGAME_SCREEN:return void this.closeNanogame();case DBLScreenConstants.MINIGAME_SCREEN:break;default:return}this.enableHeader(!1),this.transitionToScreen(this.chooserScreen)},o.prototype.onMyStuffHide=function(){engagementStage.removeChild(this._myStuffNav),this._myStuffNav.clear(),this.loadScreen(this.chooserScreen)},o.prototype.myStuffClicked=function(){switch(DBLClientEventManager.recordClientEvent("DblShell","MyStuffClick",this._header.myStuffNotificationVisible),getSessionProperty(DBLDataConstants.CUR_SCREEN_TYPE)){case DBLScreenConstants.LESSON_SCREEN:switch(getSessionProperty(DBLDataConstants.MYSTUFF_SCREEN)){case DBLScreenConstants.BADGES_SCREEN:this._lessonExitScreenFQN=DBLDataConstants.BADGES_SCREEN_FQN;break;case DBLScreenConstants.ACHIEVEMENTS_SCREEN:this._lessonExitScreenFQN=DBLDataConstants.ACHIEVEMENTS_SCREEN_FQN;break;case DBLScreenConstants.STATS_SCREEN:this._lessonExitScreenFQN=DBLDataConstants.STATS_SCREEN_FQN;break;case DBLScreenConstants.COLLECTIONS_SCREEN:this._lessonExitScreenFQN=DBLDataConstants.COLLECTIONS_SCREEN_FQN;break;case DBLScreenConstants.PERSONALIZATION_SCREEN:this._lessonExitScreenFQN=DBLDataConstants.PERSONALIZE_SCREEN_FQN}return void(this._lessonSupport&&(this._lessonSupport.isLessonActive?this.onLessonStop():(this.onLessonComplete(),this.playMusic())));case DBLScreenConstants.MOVIEPLAYER_SCREEN:case DBLScreenConstants.CHOOSER_SCREEN:case DBLScreenConstants.SCREENER_SCREEN:break;case DBLScreenConstants.NANOGAME_SCREEN:return void this.closeNanogame(!0);default:return}this.enableHeader(!1),this.transitionToScreen(getSessionProperty(DBLDataConstants.MYSTUFF_SCREEN))},o.prototype.infoButtonClicked=function(){this._infoPanel?this.closeInfoPanel():this.showInfoPanel()},o.prototype.showInfoPanel=function(){__messaging&&!this._header.enabled||screenerMode||(this.incPauseCount(),this._infoPanel=new r.InfoPanel,this._infoPanel.init(""),this._infoPanel.addEventListener(r.InfoPanel.CLOSE_PANEL,this.closeInfoPanel.bind(this)),engagementStage.addChild(this._infoPanel),this.showContentScrim(!0),this.enableShellComponents(!1,!0,!0,!0))},o.prototype.closeInfoPanel=function(){this.decPauseCount(),engagementStage.removeChild(this._infoPanel),this._infoPanel.removeAllEventListeners(),this._infoPanel.cleanup(),(this._infoPanel=null)==this._dialog&&null==this._resumeDialog&&(this.hideContentScrim(),this.enableShellComponents(!0,!0,!0,!0)),a11y.closeDialog()},o.prototype.keyboardInfoButtonClicked=function(){this._keyboardInfoPopup?this.closeKeyboardInfoPopup():this.showKeyboardInfoPopup()},o.prototype.showKeyboardInfoPopup=function(){__messaging&&!this._header.enabled||screenerMode||(this.incPauseCount(),this._keyboardInfoPopup=new engagement_shared.KeyboardInfoPopup,this._keyboardInfoPopup.addEventListener(engagement_shared.KEYBOARD_INFOPOPUP_EVENT_BACK,this.closeKeyboardInfoPopup.bind(this)),this._keyboardInfoPopup.name="keyboardinfo",engagementStage.addChild(this._keyboardInfoPopup),this.showContentScrim(!0),this.enableShellComponents(!1,!0,!0,!0))},o.prototype.closeKeyboardInfoPopup=function(){this.decPauseCount(),engagementStage.removeChild(this._keyboardInfoPopup),this._keyboardInfoPopup.removeAllEventListeners(),this._keyboardInfoPopup.cleanup(),(this._keyboardInfoPopup=null)==this._dialog&&null==this._resumeDialog&&(this.hideContentScrim(),this.enableShellComponents(!0,!0,!0,!0)),a11y.closeDialog()},o.prototype.feedbackButtonClicked=function(){this._loadingMessaging||(this._messageDialog?(this._messageHelp&&this.closeMessageHelp(),this.closeMessageDialog()):this.showFeedbackDialog())},o.prototype.showFeedbackDialog=function(){__messaging&&!this._header.enabled||this._loadingMessaging||this._messageDialog||(__messaging&&(this._loadingMessaging=!0),fastForwarding?(DBLLog.log("Feedback request ignored - already fastForwarding "+this._ffStuckDetector,DBLLog.INFO),this._ffStuckDetector++,3<=this._ffStuckDetector&&(DBLLog.log("Possible fastForwarding not being reset - resetting it",DBLLog.ERROR),fastForwarding=!1)):(fastForward("popup"),this.showFeedbackDialogWhenDoneFastForwarding()))},o.prototype.showFeedbackDialogWhenDoneFastForwarding=function(){fastForwarding?setTimeout(this.showFeedbackDialogWhenDoneFastForwarding.bind(this),1):this.doShowFeedbackDialog()},o.prototype.doShowFeedbackDialog=function(){var t;__messaging?(this.enableShellComponents(!1,!1,!1,!1),t="messaging"+(lesson?"InLesson":"")+(this._messagesAvailable?"*":""),DBLAutomation.recordClick(this,t),DBLQOSEventManager.markLoadStart(DBLQOSEventManager.Key.MessagesDialogLoadDuration),DBLMessageManager.getMessages(this.onGetMessagesReturn.bind(this))):(this._feedbackDialog=new engagement_shared.FeedbackDialog,this._feedbackDialog.addEventListener(engagement_shared.FEEDBACK_DIALOG_EVENT_SENT,this.onFeedbackSent.bind(this)),this._feedbackDialog.addEventListener(engagement_shared.FEEDBACK_DIALOG_EVENT_CANCEL,this.onFeedbackCancel.bind(this)),this._feedbackDialog.name="feedback",engagementStage.addChild(this._feedbackDialog)),this.incPauseCount()},o.prototype.onGetMessagesReturn=function(t){t=t||{messages:[]},this._messageDialog=new engagement_shared_math.MessageDialog,this._messageDialog.load(this.onMessageDialogLoaded.bind(this,t))},o.prototype.onMessageDialogLoaded=function(t){this._infoPanel&&this.closeInfoPanel(),this._keyboardInfoPopup&&this.closeKeyboardInfoPopup(),this._messageDialog.addEventListener("messageUpdate",this.onMessageUpdate.bind(this)),this._messageDialog.addEventListener("close",this.onMessageClose.bind(this,!1)),this._messageDialog.addEventListener("help",this.onMessageClose.bind(this,!0)),this._messageDialog.x=65,this._messageDialog.y=84;var e=DBLStateManager.getProperty(engagement_shared.PROPERTY_MESSAGES_EVER);this._messageDialog.render(t,e),engagementStage.addChild(this._messageDialog),this.showContentScrim(!0),this._loadingMessaging=!1,this.enableShellComponents(!1,!0,!0,!0),this._resumeFunctionSaved=__resumeFunction,0<t.totalCount&&!e&&(DBLLog.log("Recording that this user saw messages for the first time",DBLLog.INFO),DBLStateManager.setProperty(engagement_shared.PROPERTY_MESSAGES_EVER,!0)),DBLQOSEventManager.recordLoadEnd(DBLQOSEventManager.Key.MessagesDialogLoadDuration)},o.prototype.onMessageUpdate=function(t){DBLMessageManager.sendUpdates(t.updates),this._messagesAvailable=!1,this.updateFeedbackButton()},o.prototype.onMessageClose=function(t){t?(this._messageDialog.visible=!1,this.showMessagingHelp()):this.closeMessageDialog()},o.prototype.closeMessageDialog=function(){DBLAutomation.recordClick(this,"messagingClose"),__resumeFunction=this._resumeFunctionSaved,this.decPauseCount(),engagementStage.removeChild(this._messageDialog),this._messageDialog.removeAllEventListeners(),this._messageDialog.cleanup(),(this._messageDialog=null)==this._dialog&&null==this._resumeDialog&&(this.hideContentScrim(),this.enableShellComponents(!0,!0,!0,!0)),a11y.closeDialog()},o.prototype.closeFeedbackDialog=function(){engagementStage.removeChild(this._feedbackDialog),this._feedbackDialog.removeAllEventListeners(),this._feedbackDialog.cleanup(),this._feedbackDialog=null,this.decPauseCount()},o.prototype.onFeedbackSent=function(){this.onFeedbackCancel()},o.prototype.onFeedbackCancel=function(){this.closeFeedbackDialog()},o.prototype.keyboardButtonClicked=function(){__keyPadController&&__keyPadController.popUpKeyPad()},o.prototype.showMessagingHelp=function(){this._messageHelp=new engagement_shared_math.MessageHelp,this._messageHelp.name="messageHelp",this._messageHelp.load(this.onMessageHelpLoaded.bind(this))},o.prototype.onMessageHelpLoaded=function(){this._messageHelp.addEventListener("close",this.onMessageHelpClose.bind(this)),this._messageHelp.ready(),engagementStage.addChild(this._messageHelp),this._messageHelp.y=72},o.prototype.onMessageHelpClose=function(){this.closeMessageHelp(),this._messageDialog.visible=!0},o.prototype.closeMessageHelp=function(){engagementStage.removeChild(this._messageHelp),this._messageHelp.removeAllEventListeners(),this._messageHelp.cleanup(),this._messageHelp=null},o.prototype.showResumePasswordDialog=function(t){this._feedbackDialog&&this.closeFeedbackDialog(),this._messageHelp&&this.closeMessageHelp(),this._messageDialog&&this.closeMessageDialog(),fastForwarding||(fastForward("popup"),this.showResumePasswordDialogWhenDoneFastForwarding(t))},o.prototype.showResumePasswordDialogWhenDoneFastForwarding=function(t){fastForwarding?setTimeout(this.showResumePasswordDialogWhenDoneFastForwarding.bind(this,t),1):this.doShowResumePasswordDialog(t)},o.prototype.doShowResumePasswordDialog=function(t){if(this._resumeDialog)DBLLog.log("Already showing resume dialog.",DBLLog.INFO);else{this.incPauseCount();var e,s=null,n=!1;switch(DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_USE_CUSTOM_AVATAR)?(e=DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_CUSTOM_AVATAR_ASSET_NAME))&&(s=e,n=!0,DBLLog.log("[Shell] Using custom avatar asset: "+e,DBLLog.INFO)):(e=DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_CURRENT_AVATAR))&&(e=objectFromFQN(DBLDataConstants.AVATAR_DATA_FQN)[e])&&(s=e.icon_url.split(".")[0].split("/").join("."),DBLLog.log("[Shell] Using traditional avatar FQN: "+s,DBLLog.INFO)),t){case"pictureid":this._resumeDialog=new engagement_login.ResumeDialogPicturePassword(s,n);break;case"password":this._resumeDialog=new engagement_login.ResumeDialogTextPassword(s,n);break;case"sso":this._resumeDialog=new engagement_login.ResumeDialogDirectLogin(s,n)}this._resumeDialog.addEventListener("play",this.onPasswordResumePlay.bind(this)),this._resumeDialog.addEventListener("logout",this.onPasswordResumeLogOut.bind(this)),engagementStage.addChild(this._resumeDialog),this.enableShellComponents(!1,!1,!1,!1),this.showContentScrim(!0)}},o.prototype.cleanupPasswordResumeDialog=function(){this.decPauseCount(),this._resumeDialog&&(engagementStage.removeChild(this._resumeDialog),this._resumeDialog.cleanup(),this._resumeDialog=null),null==this._dialog&&null==this._infoPanel&&this._keyboardInfoPopup&&(this.enableShellComponents(!0,!0,!0,!0),this.hideContentScrim())},o.prototype.onPasswordResumePlay=function(){this.cleanupPasswordResumeDialog()},o.prototype.onPasswordResumeLogOut=function(){this.cleanupPasswordResumeDialog(),userExit()},o.prototype.showDialog=function(t,e,s,n,o,i,a){void 0===e&&(e=0),void 0===s&&(s=0),void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=null),void 0===a&&(a=null),this._infoPanel&&this.closeInfoPanel(),this._keyboardInfoPopup&&this.closeKeyboardInfoPopup(),this._dialog&&(engagementStage&&engagementStage.removeChild(this._dialog),this._dialog.removeAllEventListeners(),this._dialog.cleanup(),this._dialog=null),this.incPauseCount(),this.enableShellComponents(!1,!0,!0,!0),this.showContentScrim(!0),this._dialog=new r.Dialog,engagementStage.addChild(this._dialog),this._dialog.show(t,e,s,n,o),this._dialog.addEventListener(r.DialogCloseEvent.CLOSE,i.bind(this)),this._dialog.buttonLeft.name=a},o.prototype.hideDialog=function(t){void 0===t&&(t=null),this._dialog&&this._dialog.hide(function(){this.decPauseCount(),engagementStage&&engagementStage.removeChild(this._dialog),this._dialog.removeAllEventListeners(),this._dialog.cleanup(),this._dialog=null,a11y.closeDialog(),this.enableShellComponents(!0,!0,!0,!0),this.hideContentScrim(),t&&t()}.bind(this))},o.prototype.enableShellComponents=function(t,e,s,n){this._header.helpEnabled=t,this.enableHeader(t),this._infoButton.mouseEnabled=this._infoButton.mouseChildren=e,this._feedbackButton.mouseEnabled=this._feedbackButton.mouseChildren=s},o.prototype.cleanupLessonSupport=function(){this._lessonSupport&&(this._lessonSupport.parent&&engagementStage.removeChild(this._lessonSupport),this._lessonSupport.removeAllEventListeners(),this._lessonSupport.cleanup(),this._lessonSupport=null)},o.prototype.onLessonStop=function(){this.stopProgressTimer(),this._lessonSupport&&(this._lessonSupport.isLessonActive?fastForwarding?this._lessonSupport.stopButtonEnabled=!0:(fastForward("popup"),this.showStopPopupWhenDoneFastForwarding()):this._lessonSupport.forceHideDialog())},o.prototype.showStopPopupWhenDoneFastForwarding=function(){fastForwarding?setTimeout(this.showStopPopupWhenDoneFastForwarding.bind(this),1):this.doShowStopPopup()},o.prototype.doShowStopPopup=function(){__delayedUserRunScreen?(userRunScreen(__delayedUserRunScreen,__runScreenParams),DBLLog.log(" cancel delay until thaw - already done",DBLLog.INFO),__delayedUserRunScreen=void 0):!1!==DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_SHOW_PROGRESS_WARNING)?this.showDialog(translate("Do you want to leave this lesson?"),r.Dialog.BUTTON_ACCEPT,r.Dialog.BUTTON_CANCEL,translate("Do not show me this warning again."),null,function(t){t.detail==r.Dialog.BUTTON1&&(this._holdResume=!0),this.hideDialog(),this._dialog.queryResponse&&DBLStateManager.setProperty(DBLDataConstants.PROPERTY2_SHOW_PROGRESS_WARNING,!1),t.detail==r.Dialog.BUTTON1?this.waitForDialog():(this.startProgressTimer(),this._lessonExitScreenFQN=this.chooserScreenFqn,this._lessonSupport.stopButtonEnabled=!0)}.bind(this)):this.showFeedbackDialogOnEarlyExit()},o.prototype.waitForDialog=function(){this._dialog?setTimeout(this.waitForDialog.bind(this),10):(abandonAnyInterruptPoint(),this._holdResume=!1,userResume(),this.showFeedbackDialogOnEarlyExit())},o.prototype.showFeedbackDialogOnEarlyExit=function(){__lessonFeedbackRandom&&0<__requestLessonRating&&100*DBLRandom.seededRandomGeneralPurpose()<__requestLessonRating?(__requestLessonRating=0,__requestEnjoymentRating=0,this._lessonSupport.createLessonFeedbackDialog(!0,t.PERCENT_ON_EARLY_EXIT,this.feedbackComplete.bind(this))):this.feedbackComplete(!1)},o.prototype.feedbackComplete=function(t){userStop(),setSessionProperty(DBLDataConstants.PREV_LAUNCH,null),this.cleanupLessonSupport(),this._lessonExitScreenFQN!=this.chooserScreenFqn&&this.playMusic()},o.prototype.onLessonComplete=function(){this.cleanupLessonSupport(),this._outroCallback?this._outroCallback():userStop()},o.prototype.loadCustomAvatar=function(s){var n=this,o=(void 0===s&&(s=null),new library_intermediateshared_avatareditor.AvatarEditor),i=DBLAsset.create("PersonalAvatarIcon",r.ShellSkinConstants.SHELL_BUNDLE);o.on(library_intermediateshared_avatareditor.AvatarEditorConstants.AVATAR_IMAGE_LOADED,function(){var t,e=o.createAvatarBitmap();DBLAsset.recalculateBounds(i.image),e.scaleX=e.scaleY=i.image.getBounds().width/e.getTransformedBounds().width,t=[i.image.getBounds().x,-40],e.x=t[0],e.y=t[1],i.image.addChild(e),s?s(i):n._header.onAvatarReady(i),o.cleanup()})},o.prototype.createAvatar=function(t){DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_USE_CUSTOM_AVATAR)?(this.loadCustomAvatar(),null!=t&&t()):this._header.preloadAvatarArt(t)},o.prototype.updateAvatar=function(){var t=this;DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_USE_CUSTOM_AVATAR)?this.loadCustomAvatar():(this.createProgressAvatar2(),this._header.preloadAvatarArt(function(){t._header.updateAvatarArt()}))},o.prototype.updateWallpaper=function(){var e=objectFromFQN(DBLDataConstants.WALLPAPER_DATA_FQN);if(e){e=e[DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_CURRENT_WALLPAPER)];if(e){var s=new DBLImageLoader;if(library_intermediateshared_colorchoice.isNeonDefaultWallpaper(e.wallpaper_url))try{this.onWallPaperReady(library_intermediateshared_colorchoice.createNeonDefaultWallpaper())}catch(t){s.loadImage(e.wallpaper_url,"wallpaper",this.onWallPaperReady.bind(this))}else s.loadImage(e.wallpaper_url,"wallpaper",this.onWallPaperReady.bind(this))}}},o.prototype.onWallPaperReady=function(t){var e,s;t instanceof HTMLImageElement?((e=new createjs.Bitmap(t)).setBounds(0,0,t.naturalWidth,t.naturalHeight),s=engagementStage?engagementStage.getBounds():new createjs.Rectangle(0,0,1024,768),e.scaleX=e.scaleY=s.height/768/2,e.x=(s.width-e.getTransformedBounds().width)/2):(e=t,DBLAsset.recalculateBounds(e),s=engagementStage?engagementStage.getBounds():new createjs.Rectangle(0,0,1024,768),e.scaleX=e.scaleY=s.height/e.getTransformedBounds().height),backgroundStage.removeChild(this._wallpaper),this._wallpaper=e,DBLAsset.setNameAndBounds(this._wallpaper,"wallpaper",this._wallpaper.getBounds()),backgroundStage.addChildAt(this._wallpaper,0),backgroundStage.update()},o.prototype.updateMusic=function(){if(!replayMode){for(var t=objectFromFQN(DBLDataConstants.MUSIC_DATA_FQN)[DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_CURRENT_MUSIC)],e=t.count,s=t.music_url,n=[],o=1;o<=e;o++){var i=(i=s+o.toString()).replace(/\//g,"."),a=(n.push(i),DBLDataUtils.createFilePath(s+o.toString()+".mp3"));DBLLog.log("Loading "+a,DBLLog.INFO),createjs.Sound.registerSound({src:DBLDataUtils.createFilePath(s+o.toString()+".mp3"),id:i})}this._musicCount=0,setSessionProperty(DBLDataConstants.MUSIC_COUNT,this._musicCount),setSessionProperty(DBLDataConstants.MUSIC_THEME_IDS,n)}},o.prototype.onNanogameCloseButtonClicked=function(){this.closeNanogame()},o.prototype.closeNanogame=function(t){var e=this,s=(t=void 0===t?!1:t)?getSessionProperty(DBLDataConstants.MYSTUFF_SCREEN):this.chooserScreen;this.showDialog(translate("Do you want to quit?"),r.Dialog.BUTTON_ACCEPT,r.Dialog.BUTTON_CANCEL,null,null,function(t){e.hideDialog(function(){t&&t.detail==r.Dialog.BUTTON1?(DBLLog.log("Close Nanogame Chosen",DBLLog.INFO),e.enableHeader(!1),e.transitionToScreen(s)):DBLLog.log("Play Nanogame Chosen",DBLLog.INFO)})},"quitButtonLabel")},o.prototype.onMinigamePlay=function(){engagementStage.removeChild(this._myStuffNav),this._myStuffNav.clear(),this.enableHeader(!1),this.transitionToScreen(DBLScreenConstants.MINIGAME_SCREEN)},o.prototype.transitionToScreen=function(t){this._nextScreen=t,screencur&&screencur.hide?screencur.hide(this.onTransitionComplete.bind(this)):this.onTransitionComplete()},o.prototype.onTransitionComplete=function(){this.loadScreen(this._nextScreen),this._nextScreen=null},o.prototype.incPauseCount=function(){this._pauseCount++,1==this._pauseCount&&(userPause(),this._lessonSupport)&&this._lessonSupport.disableButtons(!0)},o.prototype.decPauseCount=function(){this._pauseCount--,0==this._pauseCount&&(this._holdResume||userResume(),this._lessonSupport)&&this._lessonSupport.disableButtons(!1)},o.prototype.onInteractiveChanged=function(){this._header&&this._headerInitialized&&(this._header.helpEnabled=interactive&&this._enableHelp&&!this._dialog)},Object.defineProperty(o.prototype,"screenShowingModal",{get:function(){return!1},set:function(t){},enumerable:!1,configurable:!0}),o.prototype.popDownInfoPanel=function(t){this._lessonSupport&&this._lessonSupport.hideInfoPanel(t)},o.prototype.initTabletMuteMessage=function(){var t=DBLAsset.createArtFromBundle("DBLAModeIndicatorMute",e),t=(this._tabletMuteMessage.addChild(t),this._tabletMuteMessage.name="muteMessage",DBLAsset.create("DBLAModeMessage",e));t.text.text=translate("Your iPad is muted."),this._tabletMuteMessage.addChild(t),t.y=95,this.resizeMuteMessage(),this._tabletMuteMessage.alpha=0},o.prototype.resizeMuteMessage=function(){this._tabletMuteMessage.scaleX=this._tabletMuteMessage.scaleY=lessonContent.scaleX,this._tabletMuteMessage.x=engagementStage.getBounds().width/2,this._tabletMuteMessage.y=engagementStage.getBounds().height/2},o.prototype.cleanupTabletMuteMessage=function(){this._tabletMuteMessage&&(this._tabletMuteMessage.removeAllChildren(),this._tabletMuteMessage=null)},o.prototype.setMuteDisplay=function(){engagementStage.removeChild(this._tabletMuteMessage),engagementStage.addChild(this._tabletMuteMessage),gsap.TweenLite.to(this._tabletMuteMessage,1,{alpha:1}),gsap.TweenLite.to(this._tabletMuteMessage,1,{delay:3,alpha:0})},o.prototype.createClosedCaptionBar=function(){__ccEnabled&&null==this._closedCaptionBar&&(this._closedCaptionBar=new engagement_shared.ClosedCaptionBar,this._closedCaptionBar.ready(),this._closedCaptionBar.visible=!1,this._closedCaptionBar.name="closedCaptionBar",engagementStage.addChild(this._closedCaptionBar),this.resizeClosedCaptionBar())},o.prototype.resizeClosedCaptionBar=function(t){this._closedCaptionBar.scaleX=this._closedCaptionBar.scaleY=t=void 0===t?1:t;var e=this._closedCaptionBar.getBounds()||{width:engagement_shared.ClosedCaptionBar.BAR_WIDTH,height:engagement_shared.ClosedCaptionBar.BAR_HEIGHT};this._closedCaptionBar.x=lessonStage.getBounds().width/2-e.width*t/2,this._closedCaptionBar.y=lessonStage.getBounds().height-e.height*t/2-40*t,this._closedCaptionBar.resize()},o.prototype.showClosedCaptionString=function(t){this._closedCaptionBar&&this._closedCaptionBar.addText(t)},o.prototype.notifyClosedCaptionPlayComplete=function(){this._closedCaptionBar&&this._closedCaptionBar.playComplete()},Object.defineProperty(o.prototype,"closedCaptionBarEnabled",{set:function(t){this.createClosedCaptionBar(),this._closedCaptionBar&&(this._closedCaptionBar.enabled=t)},enumerable:!1,configurable:!0}),o.prototype.hideCC=function(){this._closedCaptionBar&&this._closedCaptionBar.hide()},o.prototype.showCC=function(){this._closedCaptionBar&&this._closedCaptionBar.show()},o.prototype.resetClosedCaptioning=function(){this._closedCaptionBar&&this._closedCaptionBar.reset()},o.prototype.fastForwardPopDownInfoPanel=function(){},o.prototype.popUpInfoPanel=function(t){this._lessonSupport&&this._lessonSupport.showInfoPanel(t)},o.prototype.fastForwardPopUpInfoPanel=function(){},o.prototype.userAvatar=function(){var t=DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_CURRENT_AVATAR),t=t?objectFromFQN(DBLDataConstants.AVATAR_DATA_FQN)[t]:void 0;return t?t.icon_url.split(".")[0].split("/").join("."):null},o.prototype.runVideoLesson=function(t){var e,s=getSessionProperty(DBLDataConstants.CUR_LESSON_INFO);s.videoURL=t.split(".").join("/")+".mp4",s.conceptVideo=!0;try{e=lesson.__data.moes[lesson.__data.active_knob_sequence][0]}catch(t){}setSessionProperty(DBLDataConstants.CONCEPT_VIDEO_COMPLETION_INFO,{fqn:t,assesses:e,lessonStartTime:lessonStartTime,lessonid:__lessonid,lessonpid:__lessonpid,lessonuuid:__lessonuuid,lessonaid:__lessonaid,lessonrid:__lessonrid,resumeData:__startingAS}),shell.startProgressTimer(),this.loadScreen(DBLScreenConstants.MOVIEPLAYER_SCREEN)},o.prototype.declareIntentToNavigate=function(){},o.prototype.updateKeyboardButton=function(){var t=!!DBLTextInputFocusManager.getTextInputWithFocus()&&__keyPadController.getKeyPadMinimized();this._keyboardButton&&(this._keyboardButtonContainer.visible=t)},o.prototype.checkMessages=function(t){this._messageCallback=t,DBLMessageManager.checkMessages(this.onCheckMessagesReturn.bind(this))},o.prototype.fastForwardCheckMessages=function(){this._messageCallback=null},o.prototype.onCheckMessagesReturn=function(t){var e=this._messagesAvailable,t=(this._messagesAvailable=t&&0<t.newCount,!e&&this._messagesAvailable&&logAutomation("new message"),this.updateFeedbackButton(),this._messageCallback);this._messageCallback=null,t&&t()},o.prototype.getLessonName=function(){var t=getSessionProperty(DBLDataConstants.CUR_LESSON_INFO);return t?t.name:null},o.prototype.setLessonName=function(t){var e=getSessionProperty(DBLDataConstants.CUR_LESSON_INFO);e&&(e.name=t)},o.prototype.getLessonType=function(){return __lessontype==DBLLessonConstants.TYPE_TUTORIAL?"tutorial":"normal"},o.prototype.setLessonType=function(t){__lessontype="tutorial"==t?DBLLessonConstants.TYPE_TUTORIAL:DBLLessonConstants.TYPE_NORMAL},o.prototype.getAvatar=function(){return DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_CURRENT_AVATAR)},o.prototype.getData=function(){return getSessionProperty(DBLDataConstants.CUR_COINS_EARNED)},o.prototype.reloadShell=function(){this.reloadHeader(),this.reloadFooter(),this.reloadMyStuffNavigation(),this.updateWallpaper()},o.prototype.reloadHeader=function(){this._header&&(this._toolTipManager.removeHost(this._header.buttonController(r.Header.HELP_BUTTON)),this._toolTipManager.removeHost(this._header.buttonController(r.Header.SKIP_BUTTON)),this._toolTipManager.removeHost(this._header.buttonController(r.Header.PAUSE_BUTTON)),this._toolTipManager.removeHost(this._header.buttonController(r.Header.CLOSE_BUTTON)),this._header.reload(),this.updateAvatar(),this.finishCreatingHeader())},o.prototype.reloadFooter=function(){this.createInfoButton(),this.createFeedbackButton()},o.prototype.recordConfiguration=function(){return this._messageDialog?{popup:"messaging"}:{}},o.prototype.playbackClick=function(t){return"messaging*"==t||"messaging"==t||"messagingInLesson"==t||"messagingInLesson*"==t?(this.doShowFeedbackDialog(),!0):"messagingClose"==t?(this.closeMessageDialog(),!0):!(!this._messageDialog||!this._messageDialog.playbackClick(t))},o.prototype.playbackEdit=function(t,e){return!1},o.prototype.playbackDrag=function(t,e,s,n){return!1},o.prototype.playbackMouse=function(t,e,s){return!1},o.prototype.takeHelpSnapshot=function(){this._header.setHelpDownState(!0),takePendingSnapshot(),this._header.setHelpDownState(!1)},Object.defineProperty(o.prototype,"skipToContentButton",{get:function(){return this._skipToContentButton},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"keyboardInfoButton",{get:function(){return this._keyboardInfoButton},enumerable:!1,configurable:!0}),o.prototype.getAccessibilityHeaderButtons=function(){return this._header.getAccessibilityChildren().filter(function(t){return a11y.isButton(t)})},o.prototype.getAccessibilityDataHeaderChildren=function(){var t=this,e=[],s=this._settingsPopup?this._settingsPopup.getAccessibilityData():this._dialog&&this._dialog.visible&&this._dialog.mouseEnabled?this._dialog.getAccessibilityData():null,s=(s&&(s.onEsc=function(){t.closeAnyOpenPopup(),t._lessonSupport.stopButtonEnabled=!0},e.push(s)),this._keyboardInfoButton&&e.push(this._keyboardInfoButton.getAccessibilityData()),this._skipToContentButton&&e.push(this._skipToContentButton.getAccessibilityData()),e=e.concat(this._header.getAccessibilityChildren()),this._myStuffNav&&e.push(this._myStuffNav.getAccessibilityData()),this._lessonSupport&&e.push(this._lessonSupport.getA11yLessonBanner()),null==(s=this._lessonSupport)?void 0:s.getAccessibilityData());return e=s?[s]:e},o.prototype.getAccessibilityDataHeader=function(){return{role:"header",tabIndex:-1,display:{id:"shellHeader"},labelObject:{id:"shellHeader"},children:this.getAccessibilityDataHeaderChildren()}},o.prototype.getAccessibilityDataFooter=function(){var t=this,e=[],s=this._messageDialog?this._messageDialog.getAccessibilityData():this._infoPanel?this._infoPanel.getAccessibilityData():this._keyboardInfoPopup?this._keyboardInfoPopup.getAccessibilityData():null;return s&&(s.onEsc=function(){return t.closeAnyOpenPopup()},e.push(s)),e.push(__assign(__assign({},null==(s=this._infoButton)?void 0:s.getAccessibilityData()),{focus:{boundsDisplayObject:this._infoButtonContainer},labelObject:{id:"shellInfoButton"}}),__assign(__assign({},null==(s=this._feedbackButton)?void 0:s.getAccessibilityData()),{focus:{boundsDisplayObject:this._feedbackButtonContainer},labelObject:{id:"shellFeedbackButton"}})),{role:"footer",tabIndex:-1,display:{id:"shellFooter"},labelObject:{id:"shellFooter"},children:e}},o.prototype.showStickyDragFx=function(){this._stickyDragFx.init(),engagementStage.addChild(this._stickyDragFx)},o.prototype.removeStickyDragFx=function(){engagementStage.removeChild(this._stickyDragFx),engagementStage.update()},r.Shell=o})(engagement_intermediate_shell=engagement_intermediate_shell||{}),(t=>{var e=replayMode?"":DBLRuntime.requireBundle("assets.bundles.engagement.intermediate."+BWtoPF(engagement)+".DBLAMyStuffNav"),s=DBLRuntime.requireBundle("assets.bundles.engagement.intermediate."+BWtoPF(engagement)+".DBLAShell"),n=DBLRuntime.requireAudio("assets.audio.engagement.intermediate."+BWtoPF(engagement)+".DialogShow"),o=DBLRuntime.requireAudio("assets.audio.engagement.intermediate."+BWtoPF(engagement)+".GeneralButtonRollover"),i=DBLRuntime.requireAudio("assets.audio.engagement.intermediate."+BWtoPF(engagement)+".GeneralButtonClick");function a(){}a.MYSTUFF_NAV_BUNDLE=e,a.MYSTUFF_NAV_MYSTUFFNAV_MENU="DBLAMyStuffNavMenu",a.SHELL_BUNDLE=s,a.SHELL_FEEDBACKTAB="DBLAFeedbackTab",a.SHELL_FEEDBACKNEWTAB="DBLAFeedbackNewTab",a.SHELL_GENERICTOOLTIPNOSHADOW="DBLAGenericToolTipNoShadow",a.SHELL_INFOSCREEN="DBLAInfoScreen",a.SHELL_INFOTAB="DBLAInfoTab",a.SHELL_KEYBOARDTAB="DBLAKeyboardTab",a.SHELL_POPUPBACKGROUND="DBLAPopupBackground",a.SHELL_POPUPBUTTONACCEPT="DBLAPopupButtonAccept",a.SHELL_POPUPBUTTONCANCEL="DBLAPopupButtonCancel",a.SHELL_POPUPBUTTONPLAY="DBLAPopupButtonPlay",a.SHELL_POPUPCHECKBOX="DBLAPopupCheckbox",a.SHELL_POPUPMESSAGE="DBLAPopupMessage",a.SHELL_SHELLHEADER="DBLAShellHeader",a.SHELL_KEYBOARD_DY_PAPERFRENZY=64,a.SHELL_KEYBOARD_DY_COOLFROST=46,a.SHELL_KEYBOARD_DY_NEON=46,a.SOUND_DIALOGSHOW=n,a.SOUND_GENERALBUTTONROLLOVER=o,a.SOUND_GENERALBUTTONCLICK=i,t.ShellSkinConstants=a})(engagement_intermediate_shell=engagement_intermediate_shell||{});