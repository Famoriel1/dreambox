var library_intermediateshared_colorchoice,library_intermediateshared_avatar,library_intermediateshared_avatareditor,__extends=this&&this.__extends||(()=>{var n=function(t,e){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}))(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}})(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var n,a=0,i=e.length;a<i;a++)!n&&a in e||((n=n||Array.prototype.slice.call(e,0,a))[a]=e[a]);return t.concat(n||Array.prototype.slice.call(e))},__rest=this&&this.__rest||function(t,e){var r={};for(a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(r[a]=t[a]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,a=Object.getOwnPropertySymbols(t);n<a.length;n++)e.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(t,a[n])&&(r[a[n]]=t[a[n]]);return r},library_intermediateshared=library_intermediateshared||{},DBLAudienceTypeConstants=(()=>{function e(){}return e.isDemo=function(t){return t==e.DEMO},e.isTeacherTools=function(t){return t==e.TEACHER_TOOLS},e.isDemoOrTeacherTools=function(t){return t==e.DEMO||t==e.TEACHER_TOOLS},e.STUDENT=0,e.DEMO=1,e.TEACHER_TOOLS=2,e})(),DBLCollectionConstants=(()=>{function t(){}return t.BADGE_STATE_HIDDEN=0,t.BADGE_STATE_HINT=1,t.BADGE_STATE_AWARDED=2,t.BADGE_STATE_SHOWN=3,t.BADGE_STATE_OWNED=4,t.BADGE_STATE_INVISIBLE=5,t.COLLECTIBLE_GAME_LOCKED=0,t.COLLECTIBLE_GAME_ACTIVE=1,t.COLLECTIBLE_GAME_UNLOCKED=2,t.COLLECTIBLE_GAME_OWNED=3,t.COLLECTIBLE_PIECE_HIDDEN=0,t.COLLECTIBLE_PIECE_AWARDED=1,t.COLLECTIBLE_PIECE_PRESENTED=2,t.COLLECTIBLE_PIECE_OWNED=4,t})(),DBLDataConstants=(()=>{function t(){}return Object.defineProperty(t,"ED_DEFAULT_AVATAR_ID",{get:function(){return DBLDataUtils.isBookworm?"default_bookworm_avatar_id":DBLDataUtils.isCoolFrost||DBLDataUtils.isNeon?"default_cool_frost_avatar_id":"default_paper_frenzy_avatar_id"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"ED_DEFAULT_MUSIC_ID",{get:function(){return DBLDataUtils.isCoolFrost||DBLDataUtils.isNeon?"default_cool_frost_music_id":"default_paper_frenzy_music_id"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"ED_DEFAULT_WALLPAPER_ID",{get:function(){return DBLDataUtils.isBookworm?"default_bookworm_wallpaper_id":DBLDataUtils.isCoolFrost?"default_cool_frost_wallpaper_id":DBLDataUtils.isNeon?"default_neon_wallpaper_id":"default_paper_frenzy_wallpaper_id"},enumerable:!1,configurable:!0}),t.USER_DATA_BLOB="UserDataCluster.intermediate",t.UDB_AVATAR_PROGRESS="avatar_progress",t.UDB_BADGE="badge",t.UDB_COLLECTION_DATA="collection_data",t.UDB_COLLECTION_PIECE_DATA="collection_piece_data",t.UDB_CURRENT_AVATAR="current_avatar",t.UDB_CURRENT_MUSIC_THEME="current_music_theme",t.UDB_CURRENT_WALLPAPER="current_wallpaper",t.UDB_LEVELS_PASSED_DURING_SESSION="levels_passed_during_session",t.UDB_MINIGAME_DATA="minigame_data",t.UDB_NANOGAME_PLAYS="nanogame_plays",t.UDB_SHOW_PROGRESS_WARNING="show_progress_warning",t.UDB_STREAK_HISTORY="streak_history",t.UDB_TOTAL_CORRECT_ANSWERS="total_correct_answers",t.PROPERTY2_AVATAR_PROGRESS="Property.avatarProgress",t.PROPERTY2_BADGES_SEEN="Property.badgesSeen",t.PROPERTY2_MINIGAMES_SEEN="Property.minigamesSeen",t.PROPERTY2_MINIGAME_PIECES_SEEN="Property.minigamePiecesSeen",t.PROPERTY2_CURRENT_AVATAR="Property.currentAvatar",t.PROPERTY2_USE_CUSTOM_AVATAR="Property.useCustomAvatar",t.PROPERTY2_CUSTOM_AVATAR_CONFIG="Property.customAvatarConfig",t.PROPERTY2_CUSTOM_AVATAR_ASSET_NAME="Property.customAvatarAssetName",t.PROPERTY2_CURRENT_MUSIC="Property.currentMusic",t.PROPERTY2_CURRENT_WALLPAPER="Property.currentWallpaper",t.PROPERTY2_LEVELS_PASSED_DURING_SESSION="Property.levelsPassedDuringSession",t.PROPERTY2_MINIGAME_DATA="Property.minigameData",t.PROPERTY2_NANOGAME_PLAYS="Property.nanogamePlays",t.PROPERTY2_NANOGAMES_RECENTLY_PLAYED="Property.nanogamesRecentlyPlayed",t.PROPERTY2_SHOW_PROGRESS_WARNING="Property.showProgressWarning",t.PROPERTY2_STREAK_HISTORY="Property.streakHistory",t.PROPERTY2_TOTAL_CORRECT_ANSWERS="Property.totalCorrectAnswers",t.PROPERTY2_INTRO_VIDEO_SEEN_ENGAGEMENT="Property.introVideoSeen.",t.PROPERTY2_AVATAR_POINTS_SEEN="Property.avatarPointsSeen",t.SEEN_PRIMARY_FTUE="Property.map.has_finished_ftue",t.SEEN_SCREENER_INTRO="Session.seen_screener_intro",t.UED_AVATAR="avatar",t.UED_MUSIC_THEME="music_theme",t.UED_WALLPAPER="wallpaper",t.INITIAL_LESSONS_COMPLETED="Session.initialLessonsCompleted",t.WEEKLY_GOAL_SEEN="Session.weeklyGoalSeen",t.CUR_ASSIGNMENT_COUNT="Session.currentAssignmentCount",t.CUR_ASSIGNMENT_TYPE="Session.currentAssignmentType",t.CUR_COINS_EARNED="Session.currentCoinsEarned",t.CUR_LESSON_INFO="Session.currentLessonInfo",t.CUR_LESSON_TIME="Session.currentLessonTime",t.CUR_LESSONS_COMPLETED="Session.currentLessonsCompleted",t.CUR_SESSION_START="Session.currentSessionStart",t.CUR_PROGRESS_AVATAR="Session.currentProgressAvatar",t.CUR_SCREEN_TYPE="Session.currentScreenType",t.CURRENT_ASSIGNMENTS="Session.currentAssignments",t.ASSIGNMENT_COMPLETIONS="Session.assignmentCompletions",t.PREV_COINS_EARNED="Session.previousCoinsEarned",t.PREV_LAUNCH="Session.previousLaunch",t.PREV_LESSON_TIME="Session.previousLessonTime",t.PREV_LESSONS="Session.previousLessons",t.PREV_PROGRESS_AVATAR="Session.previousProgressAvatar",t.PREV_SCREEN_TYPE="Session.previousScreenType",t.PREV_MINIGAME_SELECTION="Session.previousSelection",t.PREV_BOXES_POSITIONS="Session.previousBoxesPositions",t.PREV_HAD_ASSIGNMENTS="Session.hadAssigments",t.NANO_AWARDED="Session.nanoAwarded",t.NANO_LESSONS_SINCE_LAST="Session.nanoLessonsSinceLast",t.NANO_TIME_SINCE_LAST="Session.nanoTimeSinceLast",t.NANO_VARIATION="Session.nanoVariation",t.MINI_SELECTED="Session.miniSelected",t.MYSTUFF_SCREEN="Session.mystuffScreen",t.MUSIC_THEME_IDS="Session.musicData",t.INVENTORY_CACHE="Session.awardedItemsCache",t.COINS_PRIOR_TO_END_LESSON="Session.coinsPriorToEndLesson",t.CONCEPT_VIDEO_COMPLETION_INFO="Session.conceptVideoCompletionInfo",t.MUSIC_COUNT="Session.musicCount",t.ENGAGEMENT_DATA_FQN="assets.data.engagement.intermediate.EngagementData",t.ED_COINS_TUTORIAL_PASS="coins_tutorial_pass",t.ED_COINS_PREFERRED_BONUS="coins_preferred_bonus",t.ED_PROGRESS_AVATAR_BORDER_RATE="progress_avatar_border_rate",t.ED_PROGRESS_BRONZE_COINS="progress_bronze_coins",t.ED_PROGRESS_SILVER_COINS="progress_silver_coins",t.ED_PROGRESS_GOLD_COINS="progress_gold_coins",t.ED_LESSON_CHOOSER_RESIDUAL_LOCK_PROBABILITY_PERCENT="lesson_chooser_residual_lock_probability_percent",t.ED_LESSON_CHOOSER_KEY_PROBABILITY_PERCENT="lesson_chooser_key_probability_percent",t.ED_NANOGAME_RULE="nanogame_rule",t.ED_NANOGAME_SELECTOR="nanogame_selector",t.ED_SCREENER_STARTED="screener_started",t.NEON_FIRST_LOGIN="Property.neon_first_login",t.COLOR_CHOICE_PRIMARY="Property.color_choice_primary",t.COLOR_CHOICE_ACCENT="Property.color_choice_accent",t.LESSONCHOOSER_SCREEN_FQN="engagement.intermediate.lessonchooser.LessonChooser",t.LESSONCHOOSERFLEX_SCREEN_FQN="engagement.intermediate.lessonchooserflex.LessonChooserFlex",t.LESSONSCREENER_SCREEN_FQN="engagement.intermediate.screener.Screener",t.BADGES_SCREEN_FQN="engagement.intermediate.badges.Badges",t.COLLECTIONS_SCREEN_FQN="engagement.intermediate.collections.Collections",t.ACHIEVEMENTS_SCREEN_FQN="engagement.intermediate.achievements.Achievements",t.STATS_SCREEN_FQN="engagement.intermediate.stats.StatsScreen",t.MOVEIPLAYER_SCREEN_FQN="engagement.intermediate.movieplayer.MoviePlayer",t.PERSONALIZE_SCREEN_FQN="engagement.intermediate.personalization.Personalization",t.NANOGAME_SCREEN_BASE_FQN="engagement.intermediate.nanogames.",t.MINIGAME_SCREEN_BASE_FQN="engagement.intermediate.minigames.",t.AVATAR_DATA_FQN="assets.data.engagement.intermediate.AvatarData",t.BADGES_DATA_FQN="assets.data.engagement.intermediate.BadgeData",t.MINIGAME_DATA_FQN="assets.data.engagement.intermediate.MinigameData",t.MINIGAMEPIECE_DATA_FQN="assets.data.engagement.intermediate.MinigamePieceData",t.MUSIC_DATA_FQN="assets.data.engagement.intermediate.MusicThemeData",t.NANOGAME_DATA_FQN="assets.data.engagement.intermediate.NanogamesData",t.WALLPAPER_DATA_FQN="assets.data.engagement.intermediate.WallpaperData",t.SYNONYM={name:"SYNONYM",question:"synonym of",fqn:"assets.data.engagement.intermediate.bookworm.Synonym"},t.ANTONYM={name:"ANTONYM",question:"antonym of",fqn:"assets.data.engagement.intermediate.bookworm.Antonym"},t.PREFIX_SUFFIX_ROOT={name:"PREFIX_SUFFIX_ROOT",question:"the word that has the root",fqn:"assets.data.engagement.intermediate.bookworm.PrefixSuffixRoot"},t.PREFIX_SUFFIX_MATCH={name:"PREFIX_SUFFIX_MATCH",question:"the word that has the",fqn:"assets.data.engagement.intermediate.bookworm.PrefixSuffixMatch"},t.SAME_WORD={name:"SAME_WORD",question:"the same word",fqn:"assets.data.engagement.intermediate.bookworm.SameWord"},t.SYLLABLE_SPELLING={name:"SYLLABLE_SPELLING",question:"the correct syllables spelling",fqn:"assets.data.engagement.intermediate.bookworm.SyllablesSpelling"},t.PREFIX_SUFFIX={name:"PREFIX_SUFFIX",question:"the word that has a",fqn:"assets.data.engagement.intermediate.bookworm.PrefixSuffix"},t.IRREGULAR_PHONICS_PATTERNS={name:"IRREGULAR_PHONICS_PATTERNS",question:"the word containing",fqn:"assets.data.engagement.intermediate.bookworm.IrregularPhonicsPatterns"},t.ROOT_WORD_MEANINGS={name:"ROOT_WORD_MEANINGS",question:"the root word meaning",fqn:"assets.data.engagement.intermediate.bookworm.RootWordMeanings"},t.REGULAR_PHONICS_PATTERNS={name:"REGULAR_PHONICS_PATTERNS",question:"the word with a",fqn:"assets.data.engagement.intermediate.bookworm.RegularPhonicsPatterns"},t.HELP_PLAY_FQN="assets.audio.engagement.intermediate.help.Play",t.TRANSLATE_SR_FQN="assets.audio.engagement.intermediate.TranslateSR",t.PLAY_SR_FQN="assets.audio.engagement.intermediate.PlaySR",t.PERSONALIZATION_SR_FQN="assets.audio.engagement.intermediate.PersonalizationSR",t.TRANSLATE_FQN="assets.translations.engagement.intermediate.Translate",t.LESSONDOMAINS_FQN="assets.translations.shared.LessonDomains",t.LESSONGROUPS_FQN="assets.translations.shared.LessonGroups",t.SHARED_FQN="assets.translations.shared.Shared",t.EXPRESSION_SIMPLIFIER_FQN="assets.translations.shared.ExpressionSimplifier",t.TRANSLATE_VIDEO_BASE_FQN="assets.media.engagement.intermediate.videos.conceptvideos.",t.FRIENDLYNAMES_FQN="assets.translations.engagement.intermediate.FriendlyNames",t.LESSON_DESCRIPTIONS_FQN="assets.translations.engagement.intermediate.LessonDescriptions",t.FRIENDLYNAMES_BOOKWORM_FQN="assets.data.engagement.literacy.FriendlyNames",t.DREAMBOX_MESSAGES_FQN="assets.data.engagement.shared.DreamBoxMessages",t.INTERMEDIATE_SHELL_PLAYSR="assets.audio.engagement.intermediate.shell.PlaySR",t})(),MONTREAL_SERIAL=DBLRuntime.requireFont("assets.fonts.MontrealSerial"),COOPER_BLACK=DBLRuntime.requireFont("assets.fonts.CooperBlack"),FONT_TYPE_HEADER_TWO=MONTREAL_SERIAL,FONT_TYPE_HEADER_TWO_WEIGHT=DBLFont.SEMI_BOLD,FONT_TYPE_BODY_COPY=MONTREAL_SERIAL,FONT_TYPE_BODY_COPY_WEIGHT=DBLFont.NORMAL,FONT_TYPE_MUSIC_TRACK_TITLES=MONTREAL_SERIAL,FONT_TYPE_MUSIC_TRACK_TITLES_WEIGHT=DBLFont.BOLD,FONT_TYPE_BADGE_COUNTERS=COOPER_BLACK,FONT_TYPE_BADGE_COUNTERS_WEIGHT=DBLFont.BOLD,FONT_TYPE_TITLE="coolfrost"==engagement||"neon"==engagement?MONTREAL_SERIAL:COOPER_BLACK,FONT_TYPE_TITLE_WEIGHT="coolfrost"==engagement||"neon"==engagement?DBLFont.EXTRA_BOLD:DBLFont.NORMAL,FONT_TYPE_HEADER_ONE="coolfrost"==engagement||"neon"==engagement?MONTREAL_SERIAL:COOPER_BLACK,FONT_TYPE_HEADER_ONE_WEIGHT="coolfrost"==engagement||"neon"==engagement?DBLFont.BOLD:DBLFont.NORMAL,FONT_TYPE_CHOOSER_LESSON_TITLES="coolfrost"==engagement||"neon"==engagement?FONT_TYPE_HEADER_TWO:FONT_TYPE_HEADER_ONE,FONT_TYPE_CHOOSER_LESSON_TITLES_WEIGHT="coolfrost"==engagement||"neon"==engagement?DBLFont.SEMI_BOLD:DBLFont.NORMAL,FONT_TYPE_NAVIGATION_BAR_TEXT="coolfrost"==engagement||"neon"==engagement?FONT_TYPE_HEADER_TWO:FONT_TYPE_HEADER_ONE,FONT_TYPE_NAVIGATION_BAR_TEXT_WEIGHT="coolfrost"==engagement||"neon"==engagement?DBLFont.SEMI_BOLD:DBLFont.NORMAL,FONT_TYPE_PROGRESS=DBLRuntime.requireFont("assets.fonts.MontrealSerial"),FONT_TYPE_PROGRESS_WEIGHT=DBLFont.MEDIUM,FONT_COLOR="neon"==engagement?"#FFFFFF":"#000000",DBLLessonConstants=(()=>{function t(){}return t.TYPE_NORMAL=1,t.TYPE_TUTORIAL=-2,t.STATUS_START=4,t.OPENING_VIDEO_NOT_PLAYED=0,t.OPENING_VIDEO_PLAYED=1,t})(),DBLScreenConstants=(()=>{function t(){}return t.BADGES_SCREEN="badgesScreen",t.ACHIEVEMENTS_SCREEN="achievementsScreen",t.STATS_SCREEN="statsScreen",t.COLLECTIONS_SCREEN="collectionsScreen",t.CHOOSER_SCREEN="chooserScreen",t.SCREENER_SCREEN="screenerScreen",t.LESSON_SCREEN="lessonScreen",t.MINIGAME_SCREEN="minigameScreen",t.MOVIEPLAYER_SCREEN="moviePlayerScreen",t.NANOGAME_SCREEN="nanogameScreen",t.PERSONALIZATION_SCREEN="personalizationScreen",t.HIDE_COMPLETE="hideComplete",t.SHOW_COMPLETE="showComplete",t.UPDATE_COMPLETE="updateComplete",t})(),DBLProgressAvatar=((t=>{var e=DBLRuntime.requireBundle("assets.bundles.engagement.intermediate.neon.DBLAWallpaperNeon");t.createNeonDefaultWallpaper=function(){return DBLAsset.create("DBLAWallpaperNeon",e)},t.isNeonDefaultWallpaper=function(t){return-1!=t.indexOf("NeonDefault")&&DBLDataUtils.isNeon}})(library_intermediateshared_colorchoice=library_intermediateshared_colorchoice||{}),(()=>{function n(t){null!=(this.data=t=void 0===t?null:t)&&0<this.levels&&this.type!=n.GOLD&&(this.type=n.GOLD)}return n.prototype.cleanup=function(){this.data=null},n.prototype.clone=function(){var t=n.create(this.id);return t.type=this.type,t.count=this.count,t.progress=this.progress,t.levels=this.levels,t},n.create=function(t){return new n({id:t=void 0===t?n.DEFAULT_ID:t,type:n.BRONZE,count:0,progress:0,levels:0})},Object.defineProperty(n.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"id",{get:function(){return this._data.id},set:function(t){this._data.id=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"type",{get:function(){return this._data.type},set:function(t){this._data.type=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"count",{get:function(){return this._data.count},set:function(t){this._data.count=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"progress",{get:function(){return this._data.progress},set:function(t){this._data.progress=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"levels",{get:function(){return this._data.levels},set:function(t){this._data.levels=t},enumerable:!1,configurable:!0}),n.prototype.incrementProgress=function(t,e){var r;t=Math.max(0,Math.min(t,300)),this.progress+=Math.ceil(t/e[this.type]*n.N),this.progress>=n.N&&(r=this.progress-n.N,this.progress=0,t=r/n.N*e[this.type],this.count++,this.count>=n.AWARDS_PER_LEVEL&&(this.type++,this.count=0,this.type>n.GOLD)&&(this.levels++,this.type=n.GOLD),this.incrementProgress(t,e))},n.DEFAULT_ID=0,n.BRONZE=0,n.SILVER=1,n.GOLD=2,n.N=1e3,n.AWARDS_PER_LEVEL=3,n})()),DBLProgressStar=(n=>{function a(t,e){void 0===e&&(e=null);var r=n.call(this)||this,t=(r._fillLevel=0,r._useBackFill=!0,r._skin=t,e&&(r.x=e.x-e.regX,r.y=e.y-e.regY),DBLAsset.setNameAndBounds(r,"progressstar",e,3),r._backFill=null,r._fill=r.getAsset(r._skin.PROGRESS_BRONZESTAR),r._fillContainer=new createjs.Container,r._fill.getTransformedBounds());return r._fillMask=new createjs.Shape,r._fillMask.graphics.drawRect(0,0,t.width,t.height),r._fillMask.setBounds(0,0,t.width,t.height),r._fillContainer.mask=r._fillMask,r._border=r.getAsset(r._skin.PROGRESS_BLANKSTAR),r._borderType=-1,r._fillType=-1,r.addChild(r._fillContainer),r._fillContainer.addChild(r._fill),r.addChild(r._border),r.fillLevel=0,r}return __extends(a,n),a.destroy=function(){a.__cache=null},a.prototype.getAsset=function(t){var e,r;return minspec?(DBLLog.log("Star border won't animate due to minspec device.",DBLLog.INFO),a.__cache[t]||(a.__cache[t]={},e=DBLAsset.create(t,this._skin.PROGRESS_BUNDLE),DBLAsset.calculateBoundsFromChildren(e),r=e.getBounds(),e.cache(r.x,r.y,r.width,r.height,standardScale),a.__cache[t].canvas=e.cacheCanvas,a.__cache[t].x=e.getTransformedBounds().x,a.__cache[t].y=e.getTransformedBounds().y,e.uncache()),(r=new createjs.Bitmap(a.__cache[t].canvas)).scaleX=1/standardScale,r.scaleY=1/standardScale,r.x=a.__cache[t].x,r.y=a.__cache[t].y,r):DBLAsset.create(t,this._skin.PROGRESS_BUNDLE)},Object.defineProperty(a.prototype,"borderType",{set:function(t){t!=this._borderType&&(this._borderType=t,this.removeChild(this._border),t!=DBLProgressAvatar.GOLD?this._border=this.getAsset(this._skin.PROGRESS_BLANKSTAR):(this._border=this.getAsset(this._skin.PROGRESS_BLANKSTARGOLDBORDER),this.stop()),this.addChild(this._border))},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"fillType",{set:function(t){if(t!=this._fillType){switch(this._fillType=t,this._backFill&&this.removeChild(this._backFill),this._fillContainer.removeChild(this._fill),t){case DBLProgressAvatar.BRONZE:this._backFill=null,this._fill=this.getAsset(this._skin.PROGRESS_BRONZESTAR);break;case DBLProgressAvatar.SILVER:this._backFill=this._useBackFill?this.getAsset(this._skin.PROGRESS_BRONZESTAR):null,this._fill=this.getAsset(this._skin.PROGRESS_SILVERSTAR);break;case DBLProgressAvatar.GOLD:this._backFill=this._useBackFill?this.getAsset(this._skin.PROGRESS_SILVERSTAR):null,this._fill=this.getAsset(this._skin.PROGRESS_GOLDSTAR)}this._backFill&&this.addChildAt(this._backFill,0),this._fillContainer.addChild(this._fill)}},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"fillLevel",{set:function(t){this._fillLevel=t;var e=this._fillMask.getBounds().width;this._fillMask.x=t*e-e,this._fill.visible=0<t},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"useBackFill",{set:function(t){!(this._useBackFill=t)&&this._backFill&&(this.removeChild(this._backFill),this._backFill=null)},enumerable:!1,configurable:!0}),a.prototype.play=function(){this._border instanceof createjs.MovieClip&&this._border.gotoAndPlay("transition")},a.prototype.stop=function(){this._border instanceof createjs.MovieClip&&this._border.gotoAndStop("idle")},Object.defineProperty(a.prototype,"isPlaying",{get:function(){return this._border instanceof createjs.MovieClip&&!this._border.paused},enumerable:!1,configurable:!0}),a.prototype.cleanup=function(){this.removeAllChildren(),this._backFill=null,this._fill=null,this._border=null,this._skin=null},a.prototype.tick24=function(){this._border instanceof createjs.MovieClip&&!this._border.paused&&DBLAsset.advanceMovieClip(this._border)},a.__cache={},a})(createjs.Container),DBLProgressStarGroup=(n=>{function t(t){var e=n.call(this)||this,r=DBLAsset.create(t.PROGRESS_STARGROUP,t.PROGRESS_BUNDLE);return r.gotoAndPlay(0),e._star1=new DBLProgressStar(t,r.star1),e.addChild(e._star1),e._star2=new DBLProgressStar(t,r.star2),e.addChild(e._star2),e._star3=new DBLProgressStar(t,r.star3),e.addChild(e._star3),DBLAsset.setNameAndBounds(e,"stargroup",r),e}return __extends(t,n),t.prototype.cleanup=function(){this._star1.cleanup(),this._star2.cleanup(),this._star3.cleanup(),this.removeAllChildren()},t.prototype.update=function(t,e,r){var n=1<t.levels||1==t.levels&&0<t.progress,a=1<e.levels||1==e.levels&&0<e.progress,n=(n?(this._star1.borderType=DBLProgressAvatar.GOLD,this._star2.borderType=DBLProgressAvatar.GOLD,this._star3.borderType=DBLProgressAvatar.GOLD,!a&&r&&(this._star1.play(),this._star2.play(),this._star3.play()),this._star1.useBackFill=!1,this._star2.useBackFill=!1,this._star3.useBackFill=!1):(this._star1.borderType=DBLProgressAvatar.BRONZE,this._star2.borderType=DBLProgressAvatar.BRONZE,this._star3.borderType=DBLProgressAvatar.BRONZE),this._star1.fillType=t.type,this._star2.fillType=t.type,this._star3.fillType=t.type,t.count);if(0==n?(this._star1.fillLevel=t.progress/DBLProgressAvatar.N,this._star2.fillLevel=0,this._star3.fillLevel=0):1==n?(this._star1.fillLevel=1,this._star2.fillLevel=t.progress/DBLProgressAvatar.N,this._star3.fillLevel=0):2==n&&(this._star1.fillLevel=1,this._star2.fillLevel=1,this._star3.fillLevel=t.progress/DBLProgressAvatar.N),r){var i=e.count,o=n-i;(0==o&&t.type!=e.type||o<0)&&(o+=3);for(var s=0;s<o;s++)switch((s+i)%3){case 0:this._star1.play();break;case 1:this._star2.play();break;case 2:this._star3.play()}}this._count=t.count},t.prototype.stop=function(){this._star1.stop(),this._star2.stop(),this._star3.stop()},Object.defineProperty(t.prototype,"isPlaying",{get:function(){return this._star1.isPlaying||this._star2.isPlaying||this._star3.isPlaying},enumerable:!1,configurable:!0}),t.prototype.tick24=function(){this._star1.tick24(),this._star2.tick24(),this._star3.tick24()},t})(createjs.Container),DBLScrollDots=(i=>{function t(t,e,r,n){var a=i.call(this)||this;return a.SPACING=4,a._currentDot=-1,a._angle=t*Math.PI/180,a._dotAsset=e,a._curdotAsset=r,a._bundle=n,a.mouseEnabled=a.mouseChildren=!1,a._currentDotArt=DBLAsset.create(r,n),a._currentDotArt.visible=!1,a.addChild(a._currentDotArt),a}return __extends(t,i),t.prototype.cleanup=function(){this.removeAllChildren()},t.prototype.create=function(){var t,e=DBLAsset.create(this._dotAsset,this._bundle).getBounds().width;null!=this._currentDotArt.parent&&this._currentDotArt.parent.removeChild(this._currentDotArt);for(var r=this.numChildren;r<this._dotCount;r++)t=DBLAsset.create(this._dotAsset,this._bundle),this.addChild(t);if(0<this._dotCount)for(var n=-Math.cos(this._angle)*((this._dotCount*e+(this._dotCount-1)*this.SPACING)/2-e/2),a=-Math.sin(this._angle)*((this._dotCount*e+(this._dotCount-1)*this.SPACING)/2-e/2),i=Math.cos(this._angle)*(e+this.SPACING),o=Math.sin(this._angle)*(e+this.SPACING),r=0;r<this._dotCount;r++)(t=this.getChildAt(r)).x=n+r*i,t.y=a+r*o,t.visible=!0;if(this.numChildren>this._dotCount)for(r=this._dotCount;r<this.numChildren;r++)(t=this.getChildAt(r)).visible=!1;this.currentDot=this.currentDot},Object.defineProperty(t.prototype,"dotCount",{get:function(){return this._dotCount},set:function(t){this._dotCount=t,this.create()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentDot",{get:function(){return this._currentDot},set:function(t){var e,r=t!=this._currentDot;-1==t?(e=void 0,this._currentDotArt.visible=!1,0<=this._currentDot&&((e=this.getChildAt(this._currentDot)).visible=!0)):!r&&null!=this._currentDotArt.parent&&0!=this._currentDotArt.visible||(e=void 0,this.addChild(this._currentDotArt),this._currentDotArt.visible=!0,-1!=this._currentDot&&((e=this.getChildAt(this._currentDot)).visible=!0),(e=this.getChildAt(t)).visible=!1,this._currentDotArt.x=e.x,this._currentDotArt.y=e.y),this._currentDot=t},enumerable:!1,configurable:!0}),t.ACROSS=0,t.DOWN=90,t})(createjs.Container),DBLScrollListGrid=(r=>{function p(t){void 0===t&&(t=null);var e=r.call(this)||this;return e.DRAG_LIMIT=20,e._scrollDirection=p.SCROLL_HORIZONTAL,e._horizontalMargin=10,e._verticalMargin=10,e._currentPage=0,e._prevPage=0,e._allowSwipe=!0,e._ignoreInvisible=!1,e._mouseDown=!1,e._soundScroll=t,e._items=[],e.addEventListener("mousedown",e.mouseDown.bind(e)),e.addEventListener("pressmove",e.mouseMove.bind(e)),e.addEventListener("pressup",e.mouseUp.bind(e)),e}return __extends(p,r),p.prototype.cleanup=function(){this.removeAllChildren(),this.removeAllEventListeners(),this._items=[]},Object.defineProperty(p.prototype,"scrollRect",{set:function(t){this._scrollRect=t,this._mask=new createjs.Shape,this._mask.graphics.drawRect(t.x,t.y,t.width,t.height),this.mask=this._mask},enumerable:!1,configurable:!0}),p.prototype.addItem=function(t){this._items.push(t)},Object.defineProperty(p.prototype,"ignoreInvisible",{get:function(){return this._ignoreInvisible},set:function(t){this._ignoreInvisible=t},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"allowSwipe",{get:function(){return this._allowSwipe},set:function(t){this._allowSwipe=t},enumerable:!1,configurable:!0}),p.prototype.scrollPagePrevious=function(){this.scrollToPage(this._currentPage-1)},p.prototype.scrollPageNext=function(){this.scrollToPage(this._currentPage+1)},p.prototype.scrollToPage=function(t){var e,r;void 0===t&&(t=0),this._scrolling||(t=Math.max(0,Math.min(t,this._maxPage)))!=this._currentPage&&(e=t*-this._pageWidth+this._scrollRect.x,r=t*-this._pageHeight+this._scrollRect.y,e=this._scrollDirection==p.SCROLL_HORIZONTAL?e:this.x,r=this._scrollDirection==p.SCROLL_VERTICAL?r:this.y,e==this.x&&r==this.y||(this._scrolling=!0,this.mouseEnabled=this.mouseChildren=!1,gsap.TweenLite.to(this,.2,{x:e,y:r,onComplete:this.scrollComplete.bind(this)}),t!=this._currentPage&&this._soundScroll&&DBLAsset.playSound(this._soundScroll)),this._prevPage=this._currentPage,this._currentPage=t,this.addPageItems(this._currentPage))},p.prototype.scrollComplete=function(){this._scrolling=!1,this.mouseEnabled=this.mouseChildren=!0,this.removePageItems(this._prevPage),this.dispatchEvent(p.SCROLL_COMPLETE)},p.prototype.goToPage=function(t){var e;void 0===t&&(t=0),(t=Math.max(0,Math.min(t,this._maxPage)))!=this._currentPage&&(this._prevPage=this._currentPage,this._currentPage=Math.max(0,Math.min(t,this._maxPage)),this.removePageItems(this._prevPage),this.addPageItems(this._currentPage),t=this._currentPage*this._pageWidth,e=this._currentPage*this._pageHeight,t=this._scrollDirection==p.SCROLL_HORIZONTAL?t:this.x,e=this._scrollDirection==p.SCROLL_VERTICAL?e:this.y,this.x=t,this.y=e)},p.prototype.addPageItems=function(t){for(var e=this._horizontalCount*this._verticalCount,t=e*t,r=Math.min(t+e,this._items.length),n=t;n<r;n++)this.addChild(this._items[n]),this._items[n].added()},p.prototype.removePageItems=function(t){for(var e=this._horizontalCount*this._verticalCount,t=e*t,r=Math.min(t+e,this._items.length),n=t;n<r;n++)this._items[n].parent&&(this.removeChild(this._items[n]),this._items[n].removed())},Object.defineProperty(p.prototype,"canScrollPrevious",{get:function(){return 0<this._currentPage},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"canScrollNext",{get:function(){return this._currentPage<this._maxPage&&0<this._maxPage},enumerable:!1,configurable:!0}),p.prototype.mouseDown=function(t){this._allowSwipe&&(this._startX=t.stageX,this._startY=t.stageY,this._lastDelta=0,this._mouseDown=!0)},p.prototype.mouseMove=function(t){var e;this._mouseDown&&(e=void 0,e=this._scrollDirection==p.SCROLL_HORIZONTAL?this._startX-t.stageX:this._startY-t.stageY,Math.abs(e)>this.DRAG_LIMIT&&(this.mouseChildren=!1,e<0?this.scrollPagePrevious():this.scrollPageNext(),this._mouseDown=!1,this.mouseChildren=!0),this._lastDelta=e)},p.prototype.mouseUp=function(){this.scrollToPage(this._currentPage),this._mouseDown=!1},p.prototype.update=function(){for(var t,e,r,n,a=this.itemsCount,i=this._scrollRect,o=i.width-2*this._horizontalMargin,s=i.height-2*this._verticalMargin,l=this._horizontalCount*this._verticalCount,c=(this._pageWidth=this._scrollDirection==p.SCROLL_HORIZONTAL?i.width-2:0,this._pageHeight=this._scrollDirection==p.SCROLL_VERTICAL?i.height-2:0,r=DBLUtils.toInt(o/this._horizontalCount),n=DBLUtils.toInt(s/this._verticalCount),t=(o-r*(this._horizontalCount-1))/2,e=(s-n*(this._verticalCount-1))/2,0),_=0;_<this._items.length;_++){var u,h,d=this._items[_];this._ignoreInvisible&&0==d.visible?c++:(u=DBLUtils.toInt((_-c)/l),d.x=u*this._pageWidth+this._horizontalMargin+t+(h=(_-c)%l)%this._horizontalCount*r,d.y=u*this._pageHeight+this._verticalMargin+e+DBLUtils.toInt(h/this._horizontalCount)*n)}this.addPageItems(this._currentPage),this._maxPage=DBLUtils.toInt(a/l),a%l==0&&this._maxPage--},Object.defineProperty(p.prototype,"horizontalCount",{get:function(){return this._horizontalCount},set:function(t){this._horizontalCount=Math.max(1,t)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"verticalCount",{get:function(){return this._verticalCount},set:function(t){this._verticalCount=Math.max(1,t)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"scrollDirection",{get:function(){return this._scrollDirection},set:function(t){this._scrollDirection=t},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"horizontalMargin",{get:function(){return this._horizontalMargin},set:function(t){this._horizontalMargin=t},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"verticalMargin",{get:function(){return this._verticalMargin},set:function(t){this._verticalMargin=t},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"enabled",{get:function(){return this.mouseEnabled},set:function(t){this.mouseEnabled=this.mouseChildren=t},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"currentPage",{get:function(){return this._currentPage},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"pageCount",{get:function(){return Math.ceil(this.itemsCount/(this._horizontalCount*this._verticalCount))},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"scrolling",{get:function(){return this._scrolling},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"soundScroll",{get:function(){return this._soundScroll},set:function(t){this._soundScroll=t},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"itemsCount",{get:function(){var t=this._items.length;if(this._ignoreInvisible)for(var e=0;e<this._items.length;e++)this._items[e].visible||t--;return t},enumerable:!1,configurable:!0}),p.prototype.getCurrentPageItems=function(){for(var t=[],e=this._horizontalCount*this._verticalCount,r=e*this._currentPage,n=Math.min(r+e,this._items.length),a=r;a<n;a++)t.push(this._items[a]);return t},p.SCROLL_COMPLETE="scrollComplete",p.SCROLL_HORIZONTAL=1,p.SCROLL_VERTICAL=2,p})(createjs.Container),DBLScrollListItem=(e=>{function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isAdded=!1,t}return __extends(t,e),t.prototype.added=function(){this._isAdded=!0},t.prototype.removed=function(){this._isAdded=!1},t})(createjs.Container),DBLDataUtils=(()=>{function a(){}return a.cleanup=function(){for(var t=0,e=[DBLDataConstants.INITIAL_LESSONS_COMPLETED,DBLDataConstants.WEEKLY_GOAL_SEEN,DBLDataConstants.CUR_ASSIGNMENT_COUNT,DBLDataConstants.CUR_ASSIGNMENT_TYPE,DBLDataConstants.CUR_COINS_EARNED,DBLDataConstants.CUR_LESSON_INFO,DBLDataConstants.CUR_LESSON_TIME,DBLDataConstants.CUR_LESSONS_COMPLETED,DBLDataConstants.CUR_SESSION_START,DBLDataConstants.CUR_PROGRESS_AVATAR,DBLDataConstants.CUR_SCREEN_TYPE,DBLDataConstants.PREV_COINS_EARNED,DBLDataConstants.PREV_LAUNCH,DBLDataConstants.PREV_LESSON_TIME,DBLDataConstants.PREV_LESSONS,DBLDataConstants.PREV_PROGRESS_AVATAR,DBLDataConstants.PREV_SCREEN_TYPE,DBLDataConstants.PREV_MINIGAME_SELECTION,DBLDataConstants.NANO_AWARDED,DBLDataConstants.NANO_LESSONS_SINCE_LAST,DBLDataConstants.NANO_TIME_SINCE_LAST,DBLDataConstants.NANO_VARIATION,DBLDataConstants.MINI_SELECTED,DBLDataConstants.MYSTUFF_SCREEN,DBLDataConstants.MUSIC_THEME_IDS];t<e.length;t++){var r=e[t],n=getSessionProperty(r);n&&n.cleanup&&n.cleanup(),setSessionProperty(r,null)}},a.getEngagementData=function(t){var e=objectFromFQN(DBLDataConstants.ENGAGEMENT_DATA_FQN);return e?(e=e[t].value,t!=DBLDataConstants.ED_NANOGAME_RULE?parseInt(e):e):null},Object.defineProperty(a,"isCoolFrost",{get:function(){return"coolfrost"==engagement},enumerable:!1,configurable:!0}),Object.defineProperty(a,"isNeon",{get:function(){return"neon"==engagement},enumerable:!1,configurable:!0}),Object.defineProperty(a,"isPaperFrenzy",{get:function(){return"paperfrenzy"==engagement},enumerable:!1,configurable:!0}),Object.defineProperty(a,"useFlex",{get:function(){return"neon"==engagement},enumerable:!1,configurable:!0}),Object.defineProperty(a,"isBookworm",{get:function(){return"bookworm"==engagement},enumerable:!1,configurable:!0}),Object.defineProperty(a,"isPaperFrenzyOrBookworm",{get:function(){return"paperfrenzy"==engagement||"bookworm"==engagement},enumerable:!1,configurable:!0}),a.createFilePath=function(t,e){void 0===e&&(e="");t=t.split("."),e=t[0].split("/").join(".")+e,t="."+t[1];return fileFromFQN(e,t)},a.loadFile=function(t,e,r,n){t=a.createFilePath(t,n=void 0===n?"":n);DBLLog.log("Loading "+t,DBLLog.INFO),r.loadFile({id:e,src:t,crossOrigin:!0,loadTimeout:DEFAULT_LOAD_TIMEOUT})},a.getIntroMovieFqn=function(){switch(engagement){case"bookworm":return"DBLAMovieBookworm.mp4";case"paperfrenzy":return"DBLAMoviePaperFrenzy.mp4";case"coolfrost":return"DBLAMovieMSEFeatures.mp4";default:return"DBLAMovieMiddleSchoolFeatures.mp4"}},a})(),DBLImageLoader=(()=>{function t(){this._loader=new createjs.LoadQueue}return t.prototype.loadImage=function(t,e,r,n){void 0===n&&(n=""),this._loader.on("fileload",this.onImageLoaded.bind(this,e,r)),this._loader.on("fileload",onPotentialAnimateFileLoad),this._loader.on("error",function(){DBLLog.log("Unable to load image with id "+e,DBLLog.ERROR)}),DBLDataUtils.loadFile(t,e,this._loader,n)},t.prototype.cleanup=function(){this._loader&&this._loader.destroy(),this._loader=null},t.prototype.onImageLoaded=function(t,e){lessonStage&&this.waitForImage(t,e)},t.prototype.waitForImage=function(t,e){var r=this._loader.getResult(t);0<r.naturalWidth&&r.complete?e(r):setTimeout(this.waitForImage.bind(this,t,e),1)},t})(),DBLHelpAudioHelper=(()=>{function t(t){this._fqn=t}return t.prototype.cleanup=function(){this.fastForwardHelpAudio()},t.prototype.fastForwardHelpAudio=function(){this._playing&&(fastForwarding=!0,DBLPlay.fastForwardPlay())},t.prototype.cleanupHelpAudio=function(){this._playing&&(this._playing=!1,fastForwarding=!1,skippable=!1,__ff=null)},t.prototype.help=function(){this._playing?this.fastForwardHelpAudio():(this.cleanupHelpAudio(),skippable=!0,this._playing=!0,__ff=this.fastForwardHelpAudio.bind(this),DBLPlay.play(this._fqn,this.cleanupHelpAudio.bind(this)))},t})(),MIN_SCROLL_SPEED=.2,MAX_SCROLL_SPEED=.5,SCROLL_EXTRA=70,FlexBox=(n=>{function t(t,e){var r=this;return(r=n.call(this)||this).__properties={direction:"horizontal",rows:1,columns:1,gap:{x:24,y:24},start:{x:36,y:54},end:{x:36,y:26},visibleItems:10,padMask:{left:10,up:30,right:10,down:10},hideBg:!1,hideArrows:!1,assetTitle:"SectionTitle",assetSubtitle:"SectionSubtitle",assetBackground:"FlexScrim",assetArrowStart:"ArrowButton_Left",assetArrowEnd:"ArrowButton_Right",assetArrowStartBg:"CarouselGradient_Left",assetArrowEndBg:"CarouselGradient_Right",showBoxAnim:{duration:.5,offset:{x:100,y:0},alpha:!0},showItemsAnim:{duration:.25,offset:{x:100,y:0},delay:.5,alpha:!0,step:.03},arrowSize:38,useIdleScrim:!0,useScrollStep:!1},r._enabled=!0,r._needScroll=!0,r._maxScroll=1,r._clickPoint=new createjs.Point,r._boxId="",r.__properties=__assign(__assign({},r.__properties),t),r._bundle=e,r._staticObjects=[],r.createBackground(),r.addTitle&&((t=DBLAsset.create(r.assetTitle,r.bundle)).lblTitle&&(t.lblTitle.text=null==(e=translate(r.__properties.title))?void 0:e.toUpperCase(),t.lblTitle.color=r.__properties.titleColor||t.lblTitle.color,r._titleObject=t,DBLFont.fixTextFields(t)),r.addStaticObject(t,r.addTitle.x,r.addTitle.y,!0)),r._box=new createjs.Container,r.addChild(r._box),r.isStatic&&(r.enabled=!1),r.title&&(r._boxId=r.title.replace(/\s/g,"")),r._hidden=[],r.addListeners(),r}return __extends(t,n),Object.defineProperty(t.prototype,"gap",{get:function(){return this.__properties.gap},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"start",{get:function(){return this.__properties.start},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"end",{get:function(){return this.__properties.end},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHorizontal",{get:function(){return"horizontal"==this.__properties.direction},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"columns",{get:function(){return this.__properties.columns||1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rows",{get:function(){return this.__properties.rows||1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visibleItems",{get:function(){return this.__properties.visibleItems||1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"addTitle",{get:function(){return this.__properties.addTitle},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subtitlePos",{get:function(){return this.__properties.subtitlePos},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subtitle",{get:function(){return this.__properties.subtitle},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fixWidth",{get:function(){return this.__properties.fixWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fixHeight",{get:function(){return this.__properties.fixHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maskPad",{get:function(){return this.__properties.padMask},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hideBg",{get:function(){return this.__properties.hideBg},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hideArrows",{get:function(){return this.__properties.hideArrows},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bundle",{get:function(){return this._bundle},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"assetTitle",{get:function(){return this.__properties.assetTitle},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"assetSubtitle",{get:function(){return this.__properties.assetSubtitle},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"assetBackground",{get:function(){return this.__properties.assetBackground},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"assetArrowStart",{get:function(){return this.__properties.assetArrowStart},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showStart",{get:function(){return this.isHorizontal?this._box.x<0:this._box.y<0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showEnd",{get:function(){return this.isHorizontal?this._box.x>-this._maxScroll:this._box.y>-this._maxScroll},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"assetArrowEnd",{get:function(){return this.__properties.assetArrowEnd},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"assetArrowStartBg",{get:function(){return this.__properties.assetArrowStartBg},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"assetArrowEndBg",{get:function(){return this.__properties.assetArrowEndBg},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"arrowSize",{get:function(){return this.__properties.arrowSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useArrowScrim",{get:function(){return this.__properties.useArrowScrim},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useIdleScrim",{get:function(){return this.__properties.useIdleScrim},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useScrollStep",{get:function(){return this.__properties.useScrollStep},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._background.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._background.height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"title",{get:function(){return this.__properties.title},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showBoxAnim",{get:function(){return this.__properties.showBoxAnim},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showItemsAnim",{get:function(){return this.__properties.showItemsAnim},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isStatic",{get:function(){return this.__properties.isStatic},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=!this.isStatic&&t,this.mouseChildren=this.mouseEnabled=!this.isStatic&&t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minSize",{get:function(){return this.__properties.minSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"posY",{get:function(){return this.__properties.y},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hidden",{set:function(t){this._hidden=t},enumerable:!1,configurable:!0}),t.prototype.createScrim=function(t,e){var r,n=new DBLScale9Container(DBLAsset.create(t,this.bundle));for(r in e)n[r]=e[r];return this.addChild(n),n},t.prototype.createArrowButton=function(t,e,r){t=new DBLTimelineButton(DBLAsset.create(t,this.bundle)),e=[e.x,e.y],t.x=e[0],t.y=e[1],this.addChild(t),e=DBLGraphicUtils.drawFilledRectangle(r.width,r.height,"#0"),r=[r.x,r.y];return e.x=r[0],e.y=r[1],t.hitArea=e,t},t.prototype.createArrows=function(t,e){var r=this,n=this.arrowSize,a=this.end.x+this.start.x,i=this.end.y+this.start.y,o=e-i,a=t-a,s=.5*o+this.start.y,l=this.isHorizontal?new createjs.Rectangle(1,this.start.y,n,e-i):new createjs.Rectangle(0,0,t,n),c=(this.useIdleScrim&&(this._startScrim=this.createScrim(this.assetArrowStartBg,l)),this.useArrowScrim&&(this._buttonStartBg=this.createScrim(this.assetArrowStartBg,l)),this.isHorizontal?new createjs.Point(.5*n,s):new createjs.Point(.5*t,0)),_=this.isHorizontal?new createjs.Rectangle(.5*-n,.5*-o,n,o):new createjs.Rectangle(.5*-a,0,a,n);this._arrowStart=this.createArrowButton(this.assetArrowStart,c,_),this._arrowStart.on("click",function(t){r.enabled&&r.setScrollPosition(r.useScrollStep?r.scrollPos-r.scrollStep:0,!0)}),l=this.isHorizontal?new createjs.Rectangle(t-n-1,this.start.y,n,e-i):new createjs.Rectangle(0,e-n,t,n),this.useIdleScrim&&(this._endScrim=this.createScrim(this.assetArrowEndBg,l)),this.useArrowScrim&&(this._buttonEndBg=this.createScrim(this.assetArrowEndBg,l)),c=this.isHorizontal?new createjs.Point(t-.5*n,s):new createjs.Point(.5*t,e),_=this.isHorizontal?new createjs.Rectangle(.5*-n,.5*-o,n,o):new createjs.Rectangle(.5*-a,-n,a,n),this._arrowEnd=this.createArrowButton(this.assetArrowEnd,c,_),this._arrowEnd.on("click",function(t){r.enabled&&r.setScrollPosition(r.useScrollStep?r.scrollPos+r.scrollStep:1,!0)}),this._arrowStart.visible=this._arrowEnd.visible=!1,this.showOnOverArrows(!1)},t.prototype.updateArrows=function(){this.hideArrows||(this._arrowStart&&(this._arrowStart.visible=this.showStart),this._arrowEnd&&(this._arrowEnd.visible=this.showEnd))},t.prototype.showOnOverArrows=function(t){this.hideArrows||(this._buttonStartBg&&(this._buttonStartBg.visible=t&&this.showStart),this._buttonEndBg&&(this._buttonEndBg.visible=t&&this.showEnd),DBLCapabilities.hasMouse()&&(this._arrowStart.alpha=t?1:0,this._arrowEnd.alpha=t?1:0))},t.prototype.createBackground=function(){this._background&&this.removeChild(this._background),this._background=new DBLScale9TimelineButton(DBLAsset.create(this.assetBackground,this.bundle)),this._background.visible=!1,this.addChildAt(this._background,0)},t.prototype.updateBackground=function(t,e){t=[.5*t,.5*e,t,e];this._background.x=t[0],this._background.y=t[1],this._background.width=t[2],this._background.height=t[3],this._background.visible=!0,this._background.alpha=this.hideBg?.001:1},t.prototype.calculateBackground=function(t){var e=this.rows,r=this.columns,n=(this.isHorizontal?r=Math.ceil(this.visibleItems/this.rows):e=Math.ceil(this.visibleItems/this.columns),this.fixWidth||r*(null==(n=t.getBounds())?void 0:n.width)+(r-1)*this.gap.x+this.start.x+this.end.x),t=this.fixHeight||e*(null==(r=t.getBounds())?void 0:r.height)+(e-1)*this.gap.y+this.start.y+this.end.y,r=(this.updateBackground(n,t),this.hideArrows||this.createArrows(n,t),this.maskPad.left+this.maskPad.right),e=this.maskPad.up+this.maskPad.down,n=DBLGraphicUtils.drawFilledRoundRectangle(n-r,t-e,"#0",2),r=[this.maskPad.left,this.maskPad.up];n.x=r[0],n.y=r[1],this._box.mask=n},t.prototype.cleanup=function(){this._box.removeAllChildren(),this.removeAllChildren(),this._titleObject=null,this._subtitleObject=null,this._mouseDownListener&&(this.off("mousedown",this._mouseDownListener),this._mouseDownListener=null),this._pressUpListener&&(this.off("pressup",this._pressUpListener),this._pressUpListener=null),this._pressMoveListener&&(this.off("pressmove",this._pressMoveListener),this._pressMoveListener=null),this._mouseOverListener&&(this.off("moveover",this._mouseOverListener),this._mouseOverListener=null),this._mouseOutListener&&(this.off("mouseout",this._mouseOutListener),this._mouseOutListener=null)},t.prototype.addItem=function(t){0==this._box.children.length&&(this._staticObjects.forEach(function(t){return t.visible=!0}),this.calculateBackground(t));var e=new createjs.Container,r=[.5*-(null==(r=t.getBounds())?void 0:r.width),.5*-(null==(r=t.getBounds())?void 0:r.height)];t.x=r[0],t.y=r[1],e.addChild(t),t&&this._box.addChild(e),this.positionItems()},t.prototype.getItemIndex=function(t){return this._box.children.indexOf(t.parent)},t.prototype.getItems=function(){return this._box.children},t.prototype.getItem=function(t){return this._box.getChildAt(t)},t.prototype.getLayoutItem=function(t){return null==(t=this.getItem(t))?void 0:t.children[0]},t.prototype.positionItems=function(i){var t,o=this,s=(void 0===i&&(i=!1),this.start.x),l=this.start.y,c=[],_=0,u=0,h=0;if(this._box.children.forEach(function(t,e){var r,n,a;h=(null==(r=t.getBounds())?void 0:r.width)||0,u=(null==(r=t.getBounds())?void 0:r.height)||0,-1!=o._hidden.indexOf(e)?c.push({x:0,y:0}):(r=s,n=l,o.isHorizontal?(a=_%o.rows,l=a==o.rows-1||e==o._box.children.length-1?(s=r+h+o.gap.x,o.start.y):(u+o.gap.y)*(1+a)+o.start.y):(a=_%o.columns,s=a==o.columns-1||e==o._box.children.length-1?(l=n+u+o.gap.y,o.start.x):(h+o.gap.x)*(1+a)+o.start.x),r+=.5*h,n+=.5*u,i?c.push({x:r,y:n}):(t.x=(e=[r,n])[0],t.y=e[1]),_++)}),i)return c;s+=this.end.x-this.gap.x,l+=this.end.y-this.gap.y,this._maxScroll=this.isHorizontal?s-(null==(t=this._background)?void 0:t.width):l-(null==(t=this._background)?void 0:t.height),this._needScroll=this.isHorizontal?s-.25*h>(null==(t=this._background)?void 0:t.width):l-.25*u>(null==(t=this._background)?void 0:t.height),this._background&&(this._background.enabled=this._needScroll),this.updateArrows()},t.prototype.addStaticObject=function(t,e,r,n){e=[e,r,!n];t.x=e[0],t.y=e[1],t.visible=e[2],this._staticObjects.push(t),!n&&this.fixWidth&&this.fixHeight&&this.updateBackground(this.fixWidth,this.fixHeight),this.addChild(t)},t.prototype.setEmptyBox=function(){var t=this.isHorizontal?this.fixWidth:this.minSize,e=this.isHorizontal?this.minSize:this.fixHeight;t&&e&&(this._staticObjects.forEach(function(t){return t.visible=!0}),this.updateBackground(t,e))},t.prototype.addSubtitle=function(){var t=DBLAsset.create(this.assetSubtitle,this.bundle),e=0;t.lblSubtitle&&(t.lblSubtitle.text=translate(this.subtitle),e=t.lblSubtitle.lineWidth,this._subtitleObject=t,DBLFont.fixTextFields(t)),this.addStaticObject(t,this.subtitlePos.x-e,this.subtitlePos.y,!0),t.visible=!0},Object.defineProperty(t.prototype,"size",{get:function(){return this.isHorizontal?this._background.height:this._background.width},set:function(t){this.updateBackground(this.isHorizontal?this._background.width:t,this.isHorizontal?t:this._background.height)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fullSize",{get:function(){return this.isHorizontal?this.fixHeight:this.fixWidth},enumerable:!1,configurable:!0}),t.prototype.stopAnimScroll=function(){this._scrollTween&&(this._scrollTween.kill(),this._scrollTween=null)},Object.defineProperty(t.prototype,"scrollStep",{get:function(){return 1/Math.max(1,Math.floor(this._maxScroll/this.size))},enumerable:!1,configurable:!0}),t.prototype.getBoxPos=function(){return this.isHorizontal?this._box.x:this._box.y},t.prototype.setBoxPos=function(t){this.scrollPos=t/-this._maxScroll,this.updateArrows()},Object.defineProperty(t.prototype,"scrollPos",{get:function(){return(this.isHorizontal?this._box.x:this._box.y)/-this._maxScroll},set:function(t){this.setScrollPosition(t,!1)},enumerable:!1,configurable:!0}),t.prototype.setScrollPosition=function(t,e,r){var n=this,a=(void 0===e&&(e=!0),void 0===r&&(r=0),this.stopAnimScroll(),t=Math.max(0,Math.min(1,t)),this.isHorizontal?{x:t*-this._maxScroll,ease:gsap.Power3.easeOut}:{y:t*-this._maxScroll,ease:gsap.Power3.easeInOut});e?(e=r||Math.max(MIN_SCROLL_SPEED,Math.abs(this.scrollPos-t)*MAX_SCROLL_SPEED),a.onComplete=function(){n.updateArrows()},this._scrollTween=gsap.TweenLite.to(this._box,e,a)):(r=[a.x||this._box.x,a.y||this._box.y],this._box.x=r[0],this._box.y=r[1])},t.prototype.addListeners=function(){var e=this;this._mouseDownListener=this.on("mousedown",function(t){e.enabled&&e._needScroll&&(e.stopAnimScroll(),e._clickPoint=new createjs.Point(t.stageX,t.stageY))}),this._pressUpListener=this.on("pressup",function(){e.enabled&&e._needScroll&&((e.scrollPos<0||1<e.scrollPos)&&e.setScrollPosition(Math.max(0,Math.min(e.scrollPos,1))),e._clickPoint=new createjs.Point)}),this._pressMoveListener=this.on("pressmove",function(t){e.enabled&&e._needScroll&&e.onScroll(t)}),this._mouseOverListener=this.on("mouseover",function(t){e.enabled&&e._needScroll&&e.showOnOverArrows(!0)}),this._mouseOutListener=this.on("mouseout",function(){e.enabled&&e._needScroll&&e.showOnOverArrows(!1)})},t.prototype.onScroll=function(t){var e;this.isHorizontal?(e=this._box.x+t.stageX-this._clickPoint.x,this._box.x=Math.min(Math.max(-this._maxScroll-SCROLL_EXTRA,e),SCROLL_EXTRA)):(e=this._box.y+t.stageY-this._clickPoint.y,this._box.y=Math.min(Math.max(-this._maxScroll-SCROLL_EXTRA,e),SCROLL_EXTRA)),this.updateArrows(),this._clickPoint=new createjs.Point(t.stageX,t.stageY)},t.prototype.tick24=function(){for(var t=0;t<this._box.numChildren;t++){var e=this.getLayoutItem(t);null!=e&&e.tick24&&e.tick24()}},t.prototype.getBoxBounds=function(){var t,e=null==(e=null==(e=this._background)?void 0:e.getBounds())?void 0:e.clone();return e&&(e.x=(t=[0,0])[0],e.y=t[1]),e},t.prototype.getAccessibilityHeader=function(){return{role:"heading2",display:{object:this._titleObject},tabIndex:-1,labelObject:{id:"flex".concat(this._boxId,"Title")}}},t.prototype.getAccessibilitySubtitle=function(){return{role:"span",display:{object:this._subtitleObject},tabIndex:-1,labelObject:{id:"flex".concat(this._boxId,"Subtitle")}}},t.prototype.getAccessibilityGrid=function(){function n(t){return 0!=t.scaleX&&0!=t.scaleY&&(null==(t=t.children[0])?void 0:t.visible)}var t,a=this,e=[],i={},o=1,s=this.getItems().filter(n).length-this._hidden.length;for(t in this.getItems().forEach(function(e,t){i[e.y]||(i[e.y]=[]);var r,t=a.getLayoutItem(t);n(e)&&(r=t.getAccessibilityData?t.getAccessibilityData():{label:null,display:{object:t}},i[e.y].push(__assign(__assign({},r),{focus:{alwaysShowFocusRect:!0,onCanvasFocus:function(){var t;a._needScroll&&(a.isHorizontal?a.setBoxPos(-e.x+.5*(null==(t=e.getBounds())?void 0:t.width)+a.start.x-1):a.setBoxPos(-e.y+.5*(null==(t=e.getBounds())?void 0:t.height)+a.start.y-1))}},labelObject:r.label?null:{id:"flex".concat(a._boxId,"Item"),params:{index:o,total:s,title:t.title||"",tagText:t.tagText||"",selected:t.selected?translate("selected"):translate("not selected")}}})),o++)}),i)e.push(i[t]);return{type:"grid",focus:{bounds:this.getBoxBounds()},navigationLooping:"no",visible:this.visible,display:{object:this},gridData:e}},t.prototype.getAccessibilityData=function(){var t=[];return this._titleObject&&t.push(this.getAccessibilityHeader()),t.push(this.getAccessibilityGrid()),this._subtitleObject&&t.push(this.getAccessibilitySubtitle()),{role:"presentation",tabIndex:-1,display:{object:this._background},children:t}},t})(createjs.Container),FlexGroup=(n=>{function t(t,e){var r=n.call(this)||this;return r._layoutData=t,r._bundle=e,r._boxes=[],r}return __extends(t,n),t.prototype.cleanup=function(){this._boxes.forEach(function(t){return t.cleanup()}),this._boxes=[],this.removeAllChildren(),this._layoutData=null},Object.defineProperty(t.prototype,"enabled",{set:function(e){this._boxes.forEach(function(t){return t.enabled=e})},enumerable:!1,configurable:!0}),t.prototype.loadLayout=function(t){var e=this;this._layoutData&&this._layoutData[t]&&this._layoutData[t].forEach(function(t){e.addFlexBox({x:t.x,y:t.y},t)})},t.prototype.addFlexBox=function(t,e){e=new FlexBox(e,this._bundle),t=[t.x,t.y];e.x=t[0],e.y=t[1],this._boxes.push(e),this.addChild(e)},t.prototype.setFlexBoxEmpty=function(t){t=this.getBox(t);t&&t.setEmptyBox()},t.prototype.getBox=function(e){return this._boxes.filter(function(t){return t.title==e})[0]},t.prototype.getBoxes=function(){return this._boxes},t.prototype.addItem=function(t){},t.prototype.addItemWithBox=function(t,e){this.getBox(e)?this.getBox(e).addItem(t):console.error("no box with title ",e)},t.prototype.getItems=function(){for(var t=[],e=0;e<this.numChildren;e++)t.push(this.getItem(e));return t},t.prototype.getItem=function(t){return this.getChildAt(t)},t.prototype.tick24=function(){for(var t=0;t<this.numChildren;t++){var e=this.getItem(t);e instanceof FlexBox&&e.tick24()}},t.prototype.getAccessibilityData=function(){return{role:"heading1",tabIndex:-1,visible:this.visible,display:{object:this},labelObject:{id:"flexGroupTitle"},children:this.getBoxes().map(function(t){return t.getAccessibilityData()})}},t})(createjs.Container);(t=>{function e(){}t.BUTTONS_BUNDLE="",t.VERDANA=DBLRuntime.requireFont("assets.fonts.Verdana"),e.ASSET_EXTENSION="png",e.EMPTY_ASSET_STRING="none",e.POSE_ASSET_SUBSTRING="_pose",e.PARTS_SCALING=1,e.AVATAR_SCALING=.5,e.AVATAR_UPDATE_COMPLETE_EVENT="avatar_update_complete",e.PREV_SKIN_EVENT="prev_skin",e.NEXT_SKIN_EVENT="next_skin",e.PREV_OUTFIT_EVENT="prev_outfit",e.NEXT_OUTFIT_EVENT="next_outfit",e.LOAD_OUTFIT_EVENT="load_outfit",e.CLEAR_OUTFIT_EVENT="clear_outfit",e.CLEAR_OUTFITS_EVENT="clear_outfits",e.AVATAR_CONFIG_KEY="avatar_config",e.SAVE_CONFIGURATION_EVENT="save_configuration",e.LOAD_CONFIGURATION_EVENT="load_configuration",e.REMOVE_CONFIGURATION_EVENT="remove_configuration",e.CREATE_SNAPSHOT_EVENT="create_snapshot",e.REMOVE_SNAPSHOT_EVENT="remove_snapshot",t.AvatarConstants=e})(library_intermediateshared_avatar=library_intermediateshared_avatar||{}),(a=>{var e="[AvatarRig]",r=["%c".concat(e),"".concat("background-color: #8B4000; color: #F2D2BD","; padding: 3px 1px 2px 1px; border-radius: 3px")];a.logInfo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return console.log.apply(console,__spreadArray(__spreadArray([],r,!1),t,!1))},a.logDebug=function(){for(var t=0;t<arguments.length;t++)t,0;return!1},a.logWarning=function(t){return DBLLog.log("".concat(e," ").concat(t),DBLLog.WARN)},a.logError=function(t){return DBLLog.log("".concat(e," ").concat(t),DBLLog.ERROR)},a.collectFoldersWithFiles=function t(e,r){r=(r=void 0===r?[]:r)||[];var n=[];if("folder"===e.type&&Array.isArray(e.children)&&"Skins"!==e.name){e.children.some(function(t){return"file"===t.type})&&n.push({name:e.name,path:r.concat(e.name).join("."),children:e.children});for(var a=0,i=e.children;a<i.length;a++)var o=i[a],n=n.concat(t(o,r.concat(e.name)))}return n},a.findInArray=function(t,e){for(var r=0;r<t.length;r++)if(e(t[r]))return t[r]},a.uniqueArray=function(t){for(var e=[],r=0;r<t.length;r++)-1===e.indexOf(t[r])&&e.push(t[r]);return e},a.saveAvatarConfig=function(t){try{localStorage.setItem(a.AvatarConstants.AVATAR_CONFIG_KEY,JSON.stringify(t))}catch(t){DBLLog.logError("[AvatarRig] Failed to save avatar config:",t)}},a.readAvatarConfig=function(){try{var t=localStorage.getItem(a.AvatarConstants.AVATAR_CONFIG_KEY);return t?JSON.parse(t):null}catch(t){return DBLLog.logError("[AvatarRig] Failed to read avatar config:",t),null}},a.deleteAvatarConfig=function(){try{localStorage.removeItem(a.AvatarConstants.AVATAR_CONFIG_KEY)}catch(t){DBLLog.logError("[AvatarRig] Failed to delete avatar config:",t)}},a.isAvatarConfigPresent=function(){return null!==localStorage.getItem(a.AvatarConstants.AVATAR_CONFIG_KEY)},a.createButton=function(t,e,r,n){return(t=new DBLClipClassButton(DBLAsset.resolve(t,a.BUTTONS_BUNDLE),DBLAsset.resolve(e,a.BUTTONS_BUNDLE),DBLAsset.resolve(r,a.BUTTONS_BUNDLE),null,!1,!0)).addEventListener("click",n),t},a.getPlaceholderForPose=function(t){var e=(t=t.substring(t.indexOf("_")+1).split(".")[0]).lastIndexOf(a.AvatarConstants.POSE_ASSET_SUBSTRING);return-1<e&&(e=t.length-e,t=t.substring(0,t.length-e)),{eyes:"Avatar_Eyes",eyebrows:"Avatar_Eyebrows",hairback:"Avatar_HairBack",hairfront:"Avatar_HairFront",mouth:"Avatar_Mouth",neck:"Avatar_Neck",ear_left:"Avatar_Ear_Left",ear_right:"Avatar_Ear_Right",hat:"Clothes_Hat",head:"Clothes_FaceAccessory",faceaccessory:"Clothes_FaceAccessory",mask:"Clothes_Mask",eyeaccessory:"Clothes_EyeAccessory",noseaccessory:"Clothes_NoseAccessory",chest:"Clothes_Chest",forearm_left:"Clothes_Forearm_Left",forearm_right:"Clothes_Forearm_Right",arm_left:"Clothes_Arm_Left",arm_right:"Clothes_Arm_Right",hand_left:"Avatar_Hand_Left",hand_right:"Avatar_Hand_Right",pelvis:"Clothes_Pelvis",thigh_left:"Clothes_Thigh_Left",thigh_right:"Clothes_Thigh_Right",leg_left:"Clothes_Leg_Left",leg_right:"Clothes_Leg_Right",foot_left:"Clothes_Foot_Left",foot_right:"Clothes_Foot_Right"}[t.toLowerCase()]},a.getPoseForAsset=function(t){var e=(t=t.split(".")[0]).toLowerCase().indexOf(a.AvatarConstants.POSE_ASSET_SUBSTRING);return-1===e||(t=t.substring(e+a.AvatarConstants.POSE_ASSET_SUBSTRING.length),e=parseInt(t,10),isNaN(e))?0:e}})(library_intermediateshared_avatar=library_intermediateshared_avatar||{}),(o=>{var n,e=DBLRuntime.requireBundle("assets.bundles.engagement.shared.Avatar.AvatarRig_FullBody"),t=(n=createjs.Container,__extends(r,n),r.prototype.initPlaceholders=function(){var t=0===this.poseIdx?"Avatar":"AvatarPose".concat(this.poseIdx),t=DBLAsset.create(t,e);o.logDebug("LOADED AVATAR ASSET:",t),this._placeholders=t.children.map(function(t){return t.name}),o.logDebug("LOADED PLACEHOLDERS:",this._placeholders),this._avatarBundleAsset=t},r.prototype.initAvatarLayers=function(){var n=this;this._placeholders.forEach(function(t){var e=new createjs.Container,r=(DBLAsset.calculateBoundsFromChildren(n._avatarBundleAsset[t]),n._avatarBundleAsset[t]);r.getBounds()?(e.rotation=r.rotation||0,e.x=r.x,e.y=r.y,e.regX=r.regX,e.regY=r.regY,-1!==t.toLowerCase().indexOf("right")&&(e.scaleX=-1)):o.logError("Problem with layer: ".concat(t)),n._avatarLayers[t]={ct:e,src:""},n._layerContainer.addChild(n._avatarLayers[t].ct)})},r.prototype.loadPart=function(t,e){var r,n,a,i=this;e=e||o.getPlaceholderForPose(t),t&&-1===t.toLowerCase().indexOf("."+o.AvatarConstants.EMPTY_ASSET_STRING)?this._avatarLayers[e]?(r="."+o.AvatarConstants.ASSET_EXTENSION,n=(t=t.lastIndexOf(r)===t.length-r.length?t.substring(0,t.length-r.length):t).replace(/\./g,"/")+r,this._avatarLayers[e].src!==n&&(this._avatarLayers[e].src=n,this._rig.loadedImages[n]?this.applyPartToAvatar(e,this._rig.loadedImages[n]):((a=new DBLFileLoader).addFile(n,".png"),a.load(function(){var t=a.getImage(n);o.logDebug("LOADED PART:",e,i._avatarLayers[e].src),i._rig.loadedImages[i._avatarLayers[e].src]=t,i.applyPartToAvatar(e,t),i.onAvatarUpdateComplete()})))):o.logError("Placeholder not found: ".concat(e)):this.clearPart(e)},r.prototype.applyPartToAvatar=function(t,e){var r=this._avatarLayers[t];r?((e=new createjs.Bitmap(e)).scaleX=e.scaleY=o.AvatarConstants.PARTS_SCALING,r.ct.removeAllChildren(),r.ct.addChild(e),o.logDebug("APPLIED PART:",t,r.src,r.ct.x,r.ct.y)):o.logError("Failed to apply avatar part, because avatarLayer for placeholder not found: ".concat(t))},r.prototype.clearPart=function(t){this._avatarLayers[t].ct.removeAllChildren(),this._avatarLayers[t].src=null},r.prototype.onAvatarUpdateComplete=function(){o.logDebug("AVATAR UPDATE COMPLETE EVENT"),this.dispatchEvent(new createjs.Event(o.AvatarConstants.AVATAR_UPDATE_COMPLETE_EVENT,!0,!0))},r.prototype.cleanup=function(){this._placeholders=[],this.removeAllChildren()},r);function r(t,e){void 0===e&&(e=0);var r=n.call(this)||this;return r._avatarLayers={},r._placeholders=[],r.poseIdx=e,r._rig=t,r.name=0===e?"Avatar":"AvatarPose_".concat(e),r._layerContainer=new createjs.Container,r._layerContainer.scaleX=r._layerContainer.scaleY=o.AvatarConstants.AVATAR_SCALING,r._layerContainer.x=-70,r._layerContainer.y=-70,r.addChild(r._layerContainer),r.initPlaceholders(),r.initAvatarLayers(),r}o.AvatarBase=t})(library_intermediateshared_avatar=library_intermediateshared_avatar||{}),(o=>{o.BASE_PATH="assets.bundles.engagement.shared.Avatar.",o.SKINS_PATH="".concat(o.BASE_PATH,"Assets.Skins.");var r,i={Clothes_Mask:["Avatar_HairBack","Avatar_HairFront","Clothes_Hat"]},t=(r=o.AvatarBase,__extends(e,r),e.prototype.init=function(){var e=this,t=o.findInArray(this._rig.assetsStructureDef.children,function(t){return"Skins"===t.name}),n=(this._skins=t.children.map(function(t){return t.name}),[]);this._rig.foldersWithAssets.forEach(function(t){var r=[];t.children.filter(function(t){return 0===o.getPoseForAsset(t.name)}).forEach(function(t){var e=o.getPlaceholderForPose(t.name);e?r.push(__assign(__assign({},t),{placeholder:e})):n.push(t.name)}),0<r.length&&(t=__assign(__assign({},t),{children:r}),e._allOutfits.push(t))}),o.logDebug("SKINS:",this._skins),o.logDebug("FOLDERS WITH FILES:",this._rig.foldersWithAssets),o.logDebug("OUTFITS:",this._allOutfits),0<n.length&&o.logWarning("[".concat(this.name,"] Placeholders not found for the following types of files:\n")+o.uniqueArray(n.sort()).join("\n")),this.loadSkin(),this.initEvents()},e.prototype.initEvents=function(){var t=this;this.addEventListener(o.AvatarConstants.PREV_SKIN_EVENT,function(){return t.selectPrevSkin()}),this.addEventListener(o.AvatarConstants.NEXT_SKIN_EVENT,function(){return t.selectNextSkin()}),this.addEventListener(o.AvatarConstants.PREV_OUTFIT_EVENT,function(){return t.prevOutfit()}),this.addEventListener(o.AvatarConstants.NEXT_OUTFIT_EVENT,function(){return t.nextOutfit()}),this.addEventListener(o.AvatarConstants.LOAD_OUTFIT_EVENT,function(){return t.applyOutfit()}),this.addEventListener(o.AvatarConstants.CLEAR_OUTFIT_EVENT,function(){return t.clearCurrentOutfit()}),this.addEventListener(o.AvatarConstants.CLEAR_OUTFITS_EVENT,function(){return t.resetAvatar()}),this.addEventListener(o.AvatarConstants.SAVE_CONFIGURATION_EVENT,function(){return t.saveConfiguration()}),this.addEventListener(o.AvatarConstants.LOAD_CONFIGURATION_EVENT,function(){return t.loadConfiguration()}),this.addEventListener(o.AvatarConstants.REMOVE_CONFIGURATION_EVENT,function(){return t.removeConfiguration()}),this.addEventListener(o.AvatarConstants.CREATE_SNAPSHOT_EVENT,function(){return t.createAvatarSnapshot()}),this.addEventListener(o.AvatarConstants.REMOVE_SNAPSHOT_EVENT,function(){return t.removeLastAvatarSnapshot()})},e.prototype.cleanupEvents=function(){this.removeAllEventListeners(o.AvatarConstants.PREV_SKIN_EVENT),this.removeAllEventListeners(o.AvatarConstants.NEXT_SKIN_EVENT),this.removeAllEventListeners(o.AvatarConstants.PREV_OUTFIT_EVENT),this.removeAllEventListeners(o.AvatarConstants.NEXT_OUTFIT_EVENT),this.removeAllEventListeners(o.AvatarConstants.LOAD_OUTFIT_EVENT),this.removeAllEventListeners(o.AvatarConstants.CLEAR_OUTFIT_EVENT),this.removeAllEventListeners(o.AvatarConstants.CLEAR_OUTFITS_EVENT),this.removeAllEventListeners(o.AvatarConstants.SAVE_CONFIGURATION_EVENT),this.removeAllEventListeners(o.AvatarConstants.LOAD_CONFIGURATION_EVENT),this.removeAllEventListeners(o.AvatarConstants.REMOVE_CONFIGURATION_EVENT),this.removeAllEventListeners(o.AvatarConstants.REMOVE_SNAPSHOT_EVENT)},e.prototype.applyPartToAvatar=function(t,e){r.prototype.applyPartToAvatar.call(this,t,e),this._avatarLayers[t].ct.visible=!0,this.adaptIncompatibleParts(t)},e.prototype.clearPart=function(t){r.prototype.clearPart.call(this,t),this.adaptIncompatibleParts(t)},e.prototype.adaptIncompatibleParts=function(n){function e(t){var e=!!a._avatarLayers[n].src,r=a._avatarLayers[t];null!=r&&r.src&&r.ct.visible===e&&(r.ct.visible=!e,e)&&o.logDebug('Hiding "'.concat(t,'" since it\'s incompatible with "').concat(n,'"'))}var a=this;i[n]?i[n].forEach(function(t){e(t)}):Object.keys(i).forEach(function(t){-1<i[t].indexOf(n)&&e(t)})},e.prototype.cleanup=function(){r.prototype.cleanup.call(this),this.cleanupEvents()},e.prototype.loadSkin=function(){var e=this,t=this.getCurrentSkinPlaceholders();o.logDebug("LOADING SKIN:",this._skins[this.currentSkinIndex],t),t.forEach(function(t){return e.loadPart(e.currentSkinPath+t,t)})},Object.defineProperty(e.prototype,"currentSkinPath",{get:function(){return"".concat(o.SKINS_PATH).concat(this._skins[this._currentSkinIndex],".")},enumerable:!1,configurable:!0}),e.prototype.getCurrentSkinPlaceholders=function(){var e=this,t=o.findInArray(this._rig.assetsStructureDef.children,function(t){return"Skins"===t.name}),t=o.findInArray(t.children,function(t){return t.name===e._skins[e.currentSkinIndex]});return t?t.children.map(function(t){return t.name.replace(/\.png$/i,"")}):[]},Object.defineProperty(e.prototype,"currentSkinIndex",{get:function(){return this._currentSkinIndex},set:function(t){this._currentSkinIndex=t,this.loadSkin()},enumerable:!1,configurable:!0}),e.prototype.selectNextSkin=function(){this.currentSkinIndex=(this.currentSkinIndex+1)%this._skins.length},e.prototype.selectPrevSkin=function(){this.currentSkinIndex=(this.currentSkinIndex-1+this._skins.length)%this._skins.length},e.prototype.pathToOutfitName=function(t){return t.replace("Assets.","").replace(/\./g," / ")},Object.defineProperty(e.prototype,"currentOutfitIndex",{get:function(){return this._currentOutfitIndex},set:function(t){this._currentOutfitIndex=t;this._allOutfits[this.currentOutfitIndex];this.updateMenuButtonsState()},enumerable:!1,configurable:!0}),e.prototype.prevOutfit=function(){this.currentOutfitIndex=(this.currentOutfitIndex-1+this._allOutfits.length)%this._allOutfits.length},e.prototype.nextOutfit=function(){this.currentOutfitIndex=(this.currentOutfitIndex+1)%this._allOutfits.length},e.prototype.applyOutfit=function(){var t,r,n=this,e=this._allOutfits[this.currentOutfitIndex];e&&(-1!==(t=this.getOverlappedAppliedOutfitIndex(e))&&this.clearOutfit(t),o.logDebug("LOADING OUTFIT:",e),r="".concat(o.BASE_PATH).concat(e.path,"."),e.children.forEach(function(t){var e=o.getPlaceholderForPose(t.name);e&&n.loadPart("".concat(r).concat(t.name),e)}),this._appliedOutfits.push(e),this.updateMenuButtonsState())},e.prototype.clearOutfit=function(t){var e=this,r=this._appliedOutfits[t];r&&(o.logDebug("CLEARING OUTFIT:",r),r.children.forEach(function(t){e.clearPart(t.placeholder)}),this._appliedOutfits.splice(t,1))},e.prototype.clearCurrentOutfit=function(){for(var t=this.getOutfitCategory(this._allOutfits[this.currentOutfitIndex]),e=this._appliedOutfits.length-1;0<=e;e--){var r=this._appliedOutfits[e];this.getOutfitCategory(r)===t&&this.clearOutfit(e)}this.updateMenuButtonsState()},e.prototype.resetAvatar=function(t){var e=this;this._placeholders.forEach(function(t){e.clearPart(t)}),this.loadSkin(),this._appliedOutfits=[],t||this.onAvatarUpdateComplete(),this.updateMenuButtonsState()},e.prototype.getOutfitCategory=function(t){return t?t.path.split(".").slice(0,2).join("."):null},e.prototype.getOverlappedAppliedOutfitIndex=function(t){for(var e=0;e<this._appliedOutfits.length;e++){var r=this._appliedOutfits[e];if(0<DBLArrayUtilities.commonItems(this.getOutfitPlaceholders(r),this.getOutfitPlaceholders(t)).length)return e}return-1},e.prototype.getOutfitPlaceholders=function(t){return t.children.map(function(t){return t.placeholder})},e.prototype.getConfiguration=function(e){var r=this,n=[];return Object.keys(this._avatarLayers).forEach(function(t){e&&!r._avatarLayers[t].ct.visible||(t=r._avatarLayers[t].src)&&n.push(t)}),0<n.length?n:(o.logWarning("No configuration to save! ".concat(JSON.stringify(this._avatarLayers))),null)},e.prototype.saveConfiguration=function(){var t=this.getConfiguration();t&&(o.saveAvatarConfig(t),o.logDebug("SAVED CONFIGURATION:",t))},e.prototype.loadConfiguration=function(){var e=this,t=o.readAvatarConfig();if(t){o.logDebug("LOADING CONFIGURATION:",t);for(var r="",n=0,a=t;n<a.length;n++){var i=a[n],i=this.extractSkinNameFromSrc(i);if(i){r=i;break}}r&&(this._currentSkinIndex=this._skins.indexOf(r)),this.resetAvatar(!0),t.forEach(function(t){t&&e.loadPart(t)})}},e.prototype.extractSkinNameFromSrc=function(t){t=t.match(/\/Skin\/([^\/]+)\//);return t?t[1]:void 0},e.prototype.removeConfiguration=function(){o.deleteAvatarConfig(),this.updateMenuButtonsState()},e.prototype.updateMenuButtonsState=function(){},e.prototype.createAvatarSnapshot=function(){var t,e,r,n=this._layerContainer.getBounds();n?(this._layerContainer.cache(n.x,n.y,n.width,n.height,standardScale),(t=this._layerContainer.cacheCanvas)?(e=DBLGraphicUtils.getEffectiveScale(this._layerContainer),(r=document.createElement("img")).className="avatar-snapshot",r.src=t.toDataURL("image/png"),r.style.width="".concat(n.width*e,"px"),r.style.height="".concat(n.height*e,"px"),document.body.appendChild(r)):o.logError("Cannot create PNG: cacheCanvas is not available."),this._layerContainer.uncache()):o.logError("Cannot create PNG: Transformed bounds are not available.")},e.prototype.removeLastAvatarSnapshot=function(){var t=document.querySelector("body > img.avatar-snapshot:last-child");t?t.remove():o.logWarning("No avatar snapshot found to remove.")},e);function e(t){t=r.call(this,t,0)||this;return t._skins=[],t._allOutfits=[],t._appliedOutfits=[],t._currentSkinIndex=0,t._currentOutfitIndex=0,t.init(),t}o.Avatar=t})(library_intermediateshared_avatar=library_intermediateshared_avatar||{}),(r=>{var t;function e(){return null!==t&&t.apply(this,arguments)||this}t=r.AvatarBase,__extends(e,t),e.prototype.loadConfiguration=function(t){var e=this;t&&(r.logDebug("LOADING CONFIGURATION:",t),this.cleanAllParts(),t.forEach(function(t){t&&e.loadPart(t)}),this.loadPoseFiles())},e.prototype.loadPoseFiles=function(){var r=this,n=this._rig.poseAssets[this.poseIdx];Object.keys(n).forEach(function(t){var e=n[t];e&&r.loadPart(e,t)})},e.prototype.cleanAllParts=function(){var e=this;this._placeholders.forEach(function(t){e.clearPart(t)})},r.AvatarPose=e})(library_intermediateshared_avatar=library_intermediateshared_avatar||{}),(i=>{var e,r="library.intermediateshared.avatar.assets_structure",t=(e=createjs.Container,__extends(n,e),n.prototype.cleanup=function(){var e=this;this.assetsStructureDef=null,this._avatarInstances.forEach(function(t){t&&(t.cleanup(),e.removeChild(t))}),this._avatarInstances=[],this.currentAvatarPose=0,this._nextPoseButton&&(this._nextPoseButton.removeAllEventListeners(),this._nextPoseButton=null),this.cleanupEvents(),this.removeAllChildren()},n.prototype.createChildren=function(){var t=this,e=i.createButton("SCAToolTutorPVWorkspaceGoal12Up","SCAToolTutorPVWorkspaceGoal12Down","SCAToolTutorPVWorkspaceGoal12Over",function(){return t.showNextAvatarPose()}),e=(e.x=500,e.y=-100,this.addChild(e),this._nextPoseButton=e,new createjs.Text(this.poseText,DBLFont.getFontString(i.VERDANA,16),"#ddd"));e.textBaseline="alphabetic",e.mouseEnabled=!1,this.addChild(e),e.x=610,e.y=-55,this._currentPoseDisplay=e},n.prototype.loadAssets=function(){var t=this,e=new DBLFileLoader;e.addFile(r,".json","text"),e.load(function(){t.assetsStructureDef=e.getJson(r),t.foldersWithAssets=i.collectFoldersWithFiles(t.assetsStructureDef),i.logDebug("LOADED ASSETS STRUCTURE:",t.assetsStructureDef),t.createAvatarInstance(0)})},n.prototype.createAvatarInstance=function(t){i.logDebug("CREATING AVATAR INSTANCE ".concat(t));var e=0===t?new i.Avatar(this):new i.AvatarPose(this,t);e.visible=t===this.currentAvatarPose,this._avatarInstances.push(e),this.addChild(e)},n.prototype.createPoseInstances=function(){var a=this;this.foldersWithAssets.forEach(function(n){n.children.forEach(function(t){var e,r=i.getPlaceholderForPose(t.name);r?0<(e=i.getPoseForAsset(t.name))&&(a.poseAssets[e]||(a.poseAssets[e]={}),a.poseAssets[e][r]=i.BASE_PATH+n.path+"."+t.name):i.logWarning("Placeholder not found for asset: ".concat(t.name))})}),Object.keys(this.poseAssets).forEach(function(t){t=parseInt(t,10);a.createAvatarInstance(t),a.applyConfigurationToPose(t)}),this._posesInitialized=!0},Object.defineProperty(n.prototype,"currentAvatarPose",{get:function(){return this._currentInstanceIdx},set:function(t){this._currentInstanceIdx!==t&&(this._currentInstanceIdx=t,this._currentPoseDisplay.text=this.poseText)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"poseText",{get:function(){return 0===this.currentAvatarPose?"Base Pose":"Pose "+this.currentAvatarPose},enumerable:!1,configurable:!0}),n.prototype.showAvatarPose=function(r){this.currentAvatarPose!==r&&(this._avatarInstances.forEach(function(t,e){t.visible=e===r}),this.currentAvatarPose=r)},n.prototype.showNextAvatarPose=function(){var t=(this.currentAvatarPose+1)%this._avatarInstances.length;this.showAvatarPose(t)},n.prototype.applyConfigurationsToAllPoses=function(){for(var t=this.getBaseConfiguration(),e=1;e<this._avatarInstances.length;e++)this.applyConfigurationToPose(e,t)},n.prototype.applyConfigurationToPose=function(t,e){void 0===e&&(e=this.getBaseConfiguration()),this._avatarInstances[t].loadConfiguration(e)},n.prototype.getBaseConfiguration=function(){return this._avatarInstances[0].getConfiguration(!0)},n.prototype.isBaseInstance=function(t){return 0===t.poseIdx},n.prototype.initEvents=function(){var e=this;this.addEventListener(i.AvatarConstants.AVATAR_UPDATE_COMPLETE_EVENT,function(t){e.isBaseInstance(t.target)&&(e._posesInitialized?e.applyConfigurationsToAllPoses():e.createPoseInstances())})},n.prototype.cleanupEvents=function(){this.removeAllEventListeners(i.AvatarConstants.AVATAR_UPDATE_COMPLETE_EVENT)},n);function n(){var t=e.call(this)||this;return t.foldersWithAssets=[],t.loadedImages={},t.poseAssets={},t._avatarInstances=[],t._currentInstanceIdx=0,t._posesInitialized=!1,t.name="AvatarRig",t.loadAssets(),t.createChildren(),t.initEvents(),t}i.AvatarRig=t})(library_intermediateshared_avatar=library_intermediateshared_avatar||{}),(t=>{var e="Skin000",r={style:"Eyes101",color:"Black"},n={style:"Hair000",color:"None"},a={style:"Eyebrows101",color:"Black"},i={style:"Mouth101"},o={color:"Shirt105"},s=((s=l).ASSETS_STRUCTURE_DESCRIPTION_FQN="".concat(l.ASSETS_BASE_PATH="assets.bundles.engagement.shared.Avatar.","assets_structure"),l.AVATAR_BUNDLE=DBLRuntime.requireBundle("".concat(l.ASSETS_BASE_PATH,"AvatarRig_Face")),l.ASSETS_FOLDER_PATH="".concat(l.ASSETS_BASE_PATH,"Assets."),l.SKINS_FOLDER_NAME="Skin",l.FACE_EDITOR_CATEGORY_FOLDERS=[s.SKINS_FOLDER_NAME,"Hair","Eyes","Mouth","Eyebrows","Glasses"],l.SKINS_PATH="".concat(l.ASSETS_FOLDER_PATH).concat(l.SKINS_FOLDER_NAME,"."),l.THUMBNAIL_FILE_NAME="thumbnail.png",l.INCOMPATIBLE_PLACEHOLDERS={Clothes_Mask:["Avatar_HairBack","Avatar_HairFront","Clothes_Hat"]},l.AVATAR_SCALING=.7,l.ASSET_EXTENSION="png",l.EMPTY_ASSET_STRING="none",l.PARTS_SCALING=1,l.AVATAR_READY_EVENT="avatarReady",l.AVATAR_IMAGE_LOADED="avatarImageLoaded",l.BACKEND_AVATAR_OFFSET_X=-61,l.BACKEND_AVATAR_OFFSET_Y=-130,l.DEFAULT_SKIN=e,l.DEFAULT_AVATAR_CONFIG=["Skin/".concat(e,"/Avatar_Head.png"),"Skin/".concat(e,"/Avatar_Neck.png"),"Skin/".concat(e,"/Avatar_Chest.png"),"Skin/".concat(e,"/Avatar_Arm_Left.png"),"Skin/".concat(e,"/Avatar_Arm_Left.png"),"Skin/".concat(e,"/Avatar_Arm_Right.png"),"Skin/".concat(e,"/Avatar_Forearm_Left.png"),"Skin/".concat(e,"/Avatar_Forearm_Left.png"),"Skin/".concat(e,"/Avatar_Forearm_Right.png"),"Skin/".concat(e,"/Avatar_Pelvis.png"),"Skin/".concat(e,"/Avatar_Ear_Left.png"),"Skin/".concat(e,"/Avatar_Ear_Right.png"),"Hair/".concat(n.style,"/").concat(n.color,"/Avatar_HairBack.png"),"Eyes/".concat(r.style,"/").concat(r.color,"/Avatar_Eyes.png"),"Eyebrows/".concat(a.style,"/").concat(a.color,"/Avatar_Eyebrows.png"),"Mouth/".concat(i.style,"/Avatar_Mouth.png"),"Hair/".concat(n.style,"/").concat(n.color,"/Avatar_HairFront.png"),"Shirt/".concat(o.color,"/Clothes_Chest.png"),"Shirt/".concat(o.color,"/Clothes_Arm_Left.png"),"Shirt/".concat(o.color,"/Clothes_Arm_Right.png")],l);function l(){}t.AvatarEditorConstants=s})(library_intermediateshared_avatareditor=library_intermediateshared_avatareditor||{}),(s=>{var o="[AvatarEditor]",r=["%c".concat(o),"".concat("background-color: #8B4000; color: #F2D2BD","; padding: 3px 1px 2px 1px; border-radius: 3px")];function n(t,e){try{var r="".concat(serverURL,"public/v1/avatars/").concat(__studentId,"/generate"),n=(s.logDebug("Sending avatar config to URL: ".concat(r)),s.logDebug("Student ID: ".concat(__studentId,", Config layers: ").concat(t.layers.length)),__assign(__assign({},t),{width:2*t.width,height:2*t.height,layers:t.layers.map(function(t){var e=t.regX,r=t.regY,n=__rest(t,["regX","regY"]);return __assign(__assign({},n),{src:t.src.replace(/\.png$/,""),x:(t.x||0)-(e||0)+s.AvatarEditorConstants.BACKEND_AVATAR_OFFSET_X,y:(t.y||0)-(r||0)+s.AvatarEditorConstants.BACKEND_AVATAR_OFFSET_Y})})})),a=JSON.stringify(n).length,i=(s.logDebug("Request payload size: ".concat(a," characters")),new XMLHttpRequest);i.open("POST",r,!0),i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("DBL-AuthSessionUuid",authSession),clientInstance&&i.setRequestHeader("DBL-ClientInstanceUuid",clientInstance),i.setRequestHeader("DBL-ClientRequestUuid",uuidv4()),i.onerror=function(){s.logError("Network error sending avatar config to ".concat(r)),s.logError("Request details - Student: ".concat(__studentId,", Payload size: ").concat(a," chars, Auth: ").concat(authSession?"present":"missing")),null!=e&&e()},i.ontimeout=function(){s.logError("Request timeout sending avatar config to ".concat(r)),s.logError("Student: ".concat(__studentId,", Payload size: ").concat(a," chars")),null!=e&&e()},i.onabort=function(){s.logError("Request aborted sending avatar config to ".concat(r)),null!=e&&e()},i.onreadystatechange=function(){if(4===i.readyState)if(0===i.status)s.logError("Avatar config request failed with status 0 - Network/CORS issue"),s.logError("URL: ".concat(r,", Student: ").concat(__studentId)),s.logError("serverURL: ".concat(serverURL,", authSession: ").concat(authSession?"present":"missing")),s.logError("Request payload size: ".concat(a," characters")),null!=e&&e();else if(200===i.status)try{var t=JSON.parse(i.responseText);t.assetName?(DBLStateManager.setProperty(DBLDataConstants.PROPERTY2_CUSTOM_AVATAR_ASSET_NAME,t.assetName),DBLStateManager.setProperty(DBLDataConstants.PROPERTY2_CURRENT_AVATAR,t.assetName),DBLStateManager.setProperty(DBLDataConstants.PROPERTY2_USE_CUSTOM_AVATAR,!0),DBLStateManager.syncProperties(function(){s.logDebug("Avatar successfully saved to backend: ".concat(t.assetName))}),DBLEngagementManager.engagementEvent("AVATAR_CHANGED",{avatar:t.assetName},function(){s.logDebug("Avatar change event sent successfully for: ".concat(t.assetName)),null!=e&&e()}),s.logDebug("Avatar successfully generated and set: ".concat(t.assetName))):(s.logWarning("Backend response missing assetName field"),s.logWarning("Response received: ".concat(i.responseText)),null!=e&&e())}catch(t){s.logError("Failed to parse backend response: ".concat(t)),s.logError("Raw response: ".concat(i.responseText)),null!=e&&e()}else s.logError("Failed to save avatar config to the backend: ".concat(i.status," ").concat(i.statusText)),s.logError("URL: ".concat(r,", Student: ").concat(__studentId)),s.logError("Response: ".concat(i.responseText)),null!=e&&e()},i.send(JSON.stringify(n)),s.logDebug("Avatar config request sent to ".concat(r))}catch(t){DBLLog.logError("".concat(o," Failed to send avatar config to backend:"),t),s.logError("Exception details - serverURL: ".concat(serverURL,", studentId: ").concat(__studentId)),null!=e&&e()}}function a(){try{var t=DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_CUSTOM_AVATAR_CONFIG);return t||e()}catch(t){return DBLLog.logError("".concat(o," Failed to read avatar config:"),t),e()}}s.logInfo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return console.log.apply(console,__spreadArray(__spreadArray([],r,!1),t,!1))},s.logDebug=function(){for(var t=0;t<arguments.length;t++)t,0;return!1},s.logWarning=function(t){return DBLLog.log("".concat(o," ").concat(t),DBLLog.WARN)},s.logError=function(t){return DBLLog.log("".concat(o," ").concat(t),DBLLog.ERROR)},s.collectFoldersWithFiles=function t(e,r){r=(r=void 0===r?[]:r)||[];var n=[];if("folder"===e.type&&Array.isArray(e.children)&&e.name!==s.AvatarEditorConstants.SKINS_FOLDER_NAME){e.children.some(function(t){return"file"===t.type&&t.name!==s.AvatarEditorConstants.THUMBNAIL_FILE_NAME})&&n.push({name:e.name,path:r.concat(e.name).join("."),children:e.children});for(var a=0,i=e.children;a<i.length;a++)var o=i[a],n=n.concat(t(o,r.concat(e.name)))}return n},s.findInArray=function(t,e){for(var r=0;r<t.length;r++)if(e(t[r]))return t[r]},s.uniqueArray=function(t){for(var e=[],r=0;r<t.length;r++)-1===e.indexOf(t[r])&&e.push(t[r]);return e},s.saveAvatarConfig=function(t,e){DBLStateManager.setProperty(DBLDataConstants.PROPERTY2_CUSTOM_AVATAR_CONFIG,t),DBLStateManager.setProperty(DBLDataConstants.PROPERTY2_CUSTOM_AVATAR_ASSET_NAME,null),serverURL?n(t,e):null!=e&&e()},s.applyCustomAvatar=function(t){var e,r=DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_CUSTOM_AVATAR_ASSET_NAME);r?(DBLStateManager.setProperty(DBLDataConstants.PROPERTY2_CURRENT_AVATAR,r),DBLStateManager.setProperty(DBLDataConstants.PROPERTY2_USE_CUSTOM_AVATAR,!0),DBLStateManager.syncProperties(function(){s.logDebug("Custom avatar restored from saved asset: ".concat(r))}),DBLEngagementManager.engagementEvent("AVATAR_CHANGED",{avatar:r},function(){s.logDebug("Avatar change event sent for restored custom avatar: ".concat(r)),null!=t&&t()})):(e=a())&&serverURL?n(e,t):null!=t&&t()},s.getAvatarConfig=a;var t=null;function e(){return s.logDebug("USING DEFAULT AVATAR CONFIG..."),t=t||{width:s.AvatarEditor.frameSize.width,height:s.AvatarEditor.frameSize.height,format:s.AvatarEditorConstants.ASSET_EXTENSION,layers:s.AvatarEditorConstants.DEFAULT_AVATAR_CONFIG.map(function(t){return{src:t}})}}})(library_intermediateshared_avatareditor=library_intermediateshared_avatareditor||{}),(l=>{var n;function o(t){void 0===t&&(t=null);var e,r=this;return(r=n.call(this)||this)._foldersWithAssets=[],r._loadedImages={},r._skins=[],r._allOutfits=[],r._placeholders=[],r._avatarLayersData={},r._appliedOutfits=[],r._currentSkinIndex=0,r._isReady=!1,r._loadCounter=0,r.name="AvatarEditor",(e=o.frameSize).width||(e.width=null==t?void 0:t.width),(e=o.frameSize).height||(e.height=null==t?void 0:t.height),r.loadAssets(function(){return r.init()}),r}l.EDITOR_BUNDLE=DBLRuntime.requireBundle("assets.bundles.engagement.intermediate."+BWtoPF("none"==engagement||"primary"==engagement?"neon":engagement)+".DBLAAvatarEditor"),n=createjs.Container,__extends(o,n),o.prototype.cleanup=function(){this._assetsStructureDef=null,this._foldersWithAssets=[],this._loadedImages={},this._skins=[],this._allOutfits=[],this._avatarBundleAsset=null,this._placeholders=[],this._avatarLayersContainer&&(this._avatarLayersContainer.removeAllChildren(),this._avatarLayersContainer=null),this._avatarLayersData={},this._appliedOutfits=[],this._currentSkinIndex=0,this.removeAllChildren()},o.prototype.loadAssets=function(e){var r=this,n=new DBLFileLoader;n.addFile(l.AvatarEditorConstants.ASSETS_STRUCTURE_DESCRIPTION_FQN,".json","text"),n.load(function(){var t=n.getJson(l.AvatarEditorConstants.ASSETS_STRUCTURE_DESCRIPTION_FQN);r._assetsStructureDef={name:t.name,type:"folder",children:t.children.filter(function(t){return-1!==l.AvatarEditorConstants.FACE_EDITOR_CATEGORY_FOLDERS.indexOf(t.name)})},l.logDebug("LOADED ASSETS STRUCTURE:",r._assetsStructureDef),r._foldersWithAssets=l.collectFoldersWithFiles(r._assetsStructureDef),l.logDebug("FOLDERS WITH FILES:",r._foldersWithAssets),null!=e&&e()})},o.prototype.init=function(){this.createPreview(),this.initPlaceholders(),this.initAvatarLayers(),this.initSkins(),this.initOutfits(),this.loadConfiguration()},o.prototype.createPreview=function(){var t=new createjs.Container,e=(t.name="avatarPreview",t.mask=DBLGraphicUtils.drawFilledRoundRectangle(o.frameSize.width,o.frameSize.height,"#0",8),e=[t.x,t.y],t.mask.x=e[0],t.mask.y=e[1],DBLAsset.create("AvatarEditorBackground",l.EDITOR_BUNDLE)),e=(t.addChild(e),new createjs.Container);e.scaleX=e.scaleY=l.AvatarEditorConstants.AVATAR_SCALING,e.x=-90,e.y=-130,t.addChild(e),this.addChild(t),this._avatarLayersContainer=e},o.prototype.initPlaceholders=function(){var t=DBLAsset.create("Avatar",l.AvatarEditorConstants.AVATAR_BUNDLE);l.logDebug("LOADED AVATAR ASSET:",t),this._placeholders=t.children.map(function(t){return t.name}),l.logDebug("LOADED PLACEHOLDERS:",this._placeholders),this._avatarBundleAsset=t},o.prototype.initAvatarLayers=function(){var a=this;this._placeholders.forEach(function(t){var e=new createjs.Container,r=a._avatarBundleAsset[t],n=(DBLAsset.calculateBoundsFromChildren(r),r.getBounds());n?(e.rotation=r.rotation||0,e.x=r.x,e.y=r.y,e.regX=r.regX,e.regY=r.regY,-1!==t.toLowerCase().indexOf("right")&&(e.x-=n.width,e.regX=-e.regX)):l.logError("Problem with layer: ".concat(t,", ").concat(r,".")),a._avatarLayersData[t]={ct:e,src:""},a._avatarLayersContainer.addChild(e)})},o.prototype.initSkins=function(){var t=l.findInArray(this._assetsStructureDef.children,function(t){return t.name===l.AvatarEditorConstants.SKINS_FOLDER_NAME});this._skins=t.children.map(function(t){return t.name}),l.logDebug("SKINS:",this._skins)},o.prototype.initOutfits=function(){var n=this,a=[];this._foldersWithAssets.forEach(function(t){var r=[];t.children.forEach(function(t){var e;t.name!==l.AvatarEditorConstants.THUMBNAIL_FILE_NAME&&((e=n.getPlaceholder(t.name))?r.push(__assign(__assign({},t),{placeholder:e})):a.push(t.name))}),0<r.length&&(t=__assign(__assign({},t),{children:r}),n._allOutfits.push(t))}),l.logDebug("OUTFITS:",this._allOutfits),0<a.length&&l.logWarning("Placeholders not found for the following types of files:\n"+l.uniqueArray(a.sort()).join("\n"))},o.prototype.getCategoryItemNodes=function(e){var t=l.findInArray(this._assetsStructureDef.children,function(t){return t.name.toLowerCase()===e.toLowerCase()}),t=(null==t?void 0:t.children)||[];return e===l.AvatarEditorConstants.SKINS_FOLDER_NAME?t.filter(function(t){return t.name!==l.AvatarEditorConstants.DEFAULT_SKIN}):t},o.prototype.getThumbnailSrc=function(e,r){var t,n;return null!=(t=null==(t=null==(t=this._assetsStructureDef.children.filter(function(t){return t.name===e})[0])?void 0:t.children.filter(function(t){return t.name===r})[0])?void 0:t.children)&&t.some(function(t){return t.name===l.AvatarEditorConstants.THUMBNAIL_FILE_NAME})?(t=l.AvatarEditorConstants.ASSETS_FOLDER_PATH,n=l.AvatarEditorConstants.THUMBNAIL_FILE_NAME,"".concat(t).concat(e,".").concat(r).replace(/\./g,"/")+"/".concat(n)):null},o.prototype.loadPart=function(t,e){var r,n,a,i,o=this;(e=e||this.getPlaceholder(t))?t&&-1===t.toLowerCase().indexOf("."+l.AvatarEditorConstants.EMPTY_ASSET_STRING)?this._avatarLayersData[e]?(r="."+l.AvatarEditorConstants.ASSET_EXTENSION,n=(t=t.lastIndexOf(r)===t.length-r.length?t.substring(0,t.length-r.length):t).replace(/\./g,"/")+r,this._avatarLayersData[e].src!==n&&(this._avatarLayersData[e].src=n,this._loadedImages[n]?this.applyPartToAvatar(e,this._loadedImages[n]):(a=function(){0==o._loadCounter&&(o.dispatchEvent(new createjs.Event(l.AvatarEditorConstants.AVATAR_IMAGE_LOADED,!0,!0)),l.logDebug("EVENT:",l.AvatarEditorConstants.AVATAR_IMAGE_LOADED),o.onAvatarInitComplete())},(i=new DBLFileLoader({stopOnError:!0,errorLogLevel:DBLLog.ERROR,onErrorCallback:function(){o._loadCounter--,a()}})).addFile(n,".png"),this._loadCounter++,i.load(function(){var t=i.getImage(n);o._loadedImages[o._avatarLayersData[e].src]=t,o.applyPartToAvatar(e,t),o._loadCounter--,a()}),l.logDebug("LOADING PART:",e,"->",n)))):l.logError("Missing layer data for placeholder: ".concat(e)):this.clearPart(e):l.logError("No placeholder found for part with path: ".concat(t))},o.prototype.applyPartToAvatar=function(t,e){var r=this._avatarLayersData[t];r?((e=new createjs.Bitmap(e)).scaleX=e.scaleY=l.AvatarEditorConstants.PARTS_SCALING,r.ct.removeAllChildren(),r.ct.addChild(e),this._avatarLayersData[t].ct.visible=!0,this.adaptIncompatibleParts(t),l.logDebug("APPLIED PART:",t,"->",r.src,r.ct.x,r.ct.y)):l.logError("Failed to apply avatar part, because avatarLayer for placeholder not found: ".concat(t))},o.prototype.clearPart=function(t){this._avatarLayersData[t].ct.removeAllChildren(),this._avatarLayersData[t].src=null,this.adaptIncompatibleParts(t)},o.prototype.getPlaceholder=function(t){var e=t.substring(t.indexOf("_")+1).split(".")[0],r=-1<t.indexOf(l.AvatarEditorConstants.SKINS_FOLDER_NAME);switch(e.toLowerCase()){case"eyes":return"Avatar_Eyes";case"eyebrows":return"Avatar_Eyebrows";case"hairback":return"Avatar_HairBack";case"hairfront":return"Avatar_HairFront";case"ear_left":return"Avatar_Ear_Left";case"ear_right":return"Avatar_Ear_Right";case"mouth":return"Avatar_Mouth";case"head":return"Avatar_Head";case"neck":return"Avatar_Neck";case"eyeaccessory":return"Clothes_EyeAccessory";case"chest":return r?"Avatar_Chest":"Clothes_Chest";case"forearm_left":return r?"Avatar_Forearm_Left":"Clothes_Forearm_Left";case"forearm_right":return r?"Avatar_Forearm_Right":"Clothes_Forearm_Right";case"arm_left":return r?"Avatar_Arm_Left":"Clothes_Arm_Left";case"arm_right":return r?"Avatar_Arm_Right":"Clothes_Arm_Right";case"pelvis":return r?"Avatar_Pelvis":"Clothes_Pelvis"}},o.prototype.adaptIncompatibleParts=function(n){function e(t){var e=!!a._avatarLayersData[n].src,r=a._avatarLayersData[t];null!=r&&r.src&&r.ct.visible===e&&(r.ct.visible=!e,e)&&l.logDebug('Hiding "'.concat(t,'" since it\'s incompatible with "').concat(n,'"'))}var a=this;l.AvatarEditorConstants.INCOMPATIBLE_PLACEHOLDERS[n]?l.AvatarEditorConstants.INCOMPATIBLE_PLACEHOLDERS[n].forEach(function(t){e(t)}):Object.keys(l.AvatarEditorConstants.INCOMPATIBLE_PLACEHOLDERS).forEach(function(t){-1<l.AvatarEditorConstants.INCOMPATIBLE_PLACEHOLDERS[t].indexOf(n)&&e(t)})},o.prototype.onAvatarInitComplete=function(){var t;this._isReady||(t=l.AvatarEditorConstants.AVATAR_READY_EVENT,this._isReady=!0,this.dispatchEvent(new createjs.Event(t,!0,!0)),l.logDebug("EVENT:",t))},o.prototype.loadSkin=function(){var e=this,t=this.getCurrentSkinPlaceholders();l.logDebug("LOADING SKIN:",this._skins[this._currentSkinIndex],t),t.forEach(function(t){return e.loadPart(e.currentSkinPath+t,t)})},Object.defineProperty(o.prototype,"currentSkinPath",{get:function(){return"".concat(l.AvatarEditorConstants.SKINS_PATH).concat(this._skins[this._currentSkinIndex],".")},enumerable:!1,configurable:!0}),o.prototype.getCurrentSkinPlaceholders=function(){var e=this,t=l.findInArray(this._assetsStructureDef.children,function(t){return t.name===l.AvatarEditorConstants.SKINS_FOLDER_NAME}),t=l.findInArray(t.children,function(t){return t.name===e._skins[e._currentSkinIndex]});return t?t.children.map(function(t){return t.name.replace(/\.png$/i,"")}):[]},Object.defineProperty(o.prototype,"currentSkinIndex",{set:function(t){t!==this._currentSkinIndex&&(this._currentSkinIndex=t,this.loadSkin())},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentSkinName",{get:function(){return this._skins[this._currentSkinIndex]},set:function(t){var e=this._skins.indexOf(t);-1!==e?this.currentSkinIndex=e:l.logError('Skin "'.concat(t,'" not found in the available skins: ').concat(this._skins.toString()))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"isLoadingItems",{get:function(){return 0<this._loadCounter},enumerable:!1,configurable:!0}),o.prototype.applyOutfit=function(t,e,r){var n,a,i,o,s=this;t===l.AvatarEditorConstants.SKINS_FOLDER_NAME?this.currentSkinName=e:(n="".concat(t,".").concat(e),0===(i=this._allOutfits.filter(function(t){return-1<t.path.indexOf(n)})).length?l.logWarning('No outfits found for path "'.concat(n,'" in outfits list: ').concat(this._allOutfits.toString())):(a=null,1===i.length?a=i[0]:(r=r||i[0].name||"",(a=i.filter(function(t){return t.name===r})[0])||(a=i[0],l.logDebug('There is no color folder matching "'.concat(r,'" for the current item in ').concat(t,"/").concat(e,'. Using fallback instead: "').concat(a.name,'".')))),!a||-1<this._appliedOutfits.indexOf(a)||(-1!==(i=this.getOverlappedAppliedOutfitIndex(a))&&this.clearOutfit(i),l.logDebug("LOADING OUTFIT:",a),o="".concat(l.AvatarEditorConstants.ASSETS_BASE_PATH).concat(a.path,"."),a.children.forEach(function(t){s.loadPart("".concat(o).concat(t.name))}),this._appliedOutfits.push(a))))},o.prototype.clearOutfit=function(t){var e=this,r=this._appliedOutfits[t];r&&(l.logDebug("CLEARING OUTFIT:",r),r.children.forEach(function(t){e.clearPart(t.placeholder)}),this._appliedOutfits.splice(t,1))},o.prototype.getOverlappedAppliedOutfitIndex=function(t){for(var e=0;e<this._appliedOutfits.length;e++){var r=this._appliedOutfits[e];if(0<DBLArrayUtilities.commonItems(this.getOutfitPlaceholders(r),this.getOutfitPlaceholders(t)).length)return e}return-1},o.prototype.getOutfitPlaceholders=function(t){return t.children.map(function(t){return t.placeholder})},o.prototype.resetAvatar=function(t){var e=this;this._placeholders.forEach(function(t){e.clearPart(t)}),this.loadSkin(),this._appliedOutfits=[],t||this.onAvatarInitComplete()},o.prototype.generateConfiguration=function(n){var a=this,i=[];return Object.keys(this._avatarLayersData).forEach(function(t){var e,r;n&&!a._avatarLayersData[t].ct.visible||(r=(e=a._avatarLayersData[t]).src)&&(r=r.replace(/^.*\/Assets\//,""),i.push({placeholder:t,src:r,x:e.ct.x,y:e.ct.y,regX:e.ct.regX,regY:e.ct.regY}))}),0<i.length?{width:o.frameSize.width,height:o.frameSize.height,format:l.AvatarEditorConstants.ASSET_EXTENSION,layers:i}:(l.logWarning("No configuration to save! ".concat(i.toString()," ").concat(this._avatarLayersData.toString())),null)},o.prototype.saveConfiguration=function(t){var e=this.generateConfiguration();e?(l.saveAvatarConfig(e,t),l.logDebug("SAVED CONFIGURATION:",e)):null!=t&&t()},o.prototype.loadConfiguration=function(){var e=this,t=l.getAvatarConfig();if(t){l.logDebug("LOADING CONFIGURATION:",t);for(var r="",n=0,a=t.layers;n<a.length;n++){var i=a[n],i=this.extractSkinNameFromSrc(i.src);if(i){r=i;break}}r&&(this._currentSkinIndex=this._skins.indexOf(r)),this.resetAvatar(!0),t.layers.forEach(function(t){e.loadPart("".concat(l.AvatarEditorConstants.ASSETS_FOLDER_PATH).concat(t.src))})}},o.hasConfiguration=function(){return!!DBLStateManager.getProperty(DBLDataConstants.PROPERTY2_CUSTOM_AVATAR_CONFIG)},o.prototype.extractSkinNameFromSrc=function(t){t=t.match(/\Skin\/([^\/]+)\//);return t?t[1]:void 0},o.prototype.createAvatarBitmap=function(){var t,e=this._avatarLayersContainer.getBounds();return e?(this._avatarLayersContainer.cache(e.x,e.y,e.width,e.height,standardScale),(e=this._avatarLayersContainer.cacheCanvas)?t=new createjs.Bitmap(e):l.logError("Cannot create PNG: cacheCanvas is not available."),this._avatarLayersContainer.uncache()):l.logError("Cannot create PNG: Transformed bounds are not available."),t},o.frameSize={width:246,height:308},l.AvatarEditor=o})(library_intermediateshared_avatareditor=library_intermediateshared_avatareditor||{});