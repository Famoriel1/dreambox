function setupHTMLEvents(){window.onfocus=onFocus,window.onblur=onBlur,window.onunload=onUnload}function onBlur(){__tabHasFocus=!1,doBlur(),window.DfhgSgh&&__shellAuto&&DfhgSgh.sajag()}function onUnload(){iOS||immediateExit()}function onFocus(){__tabHasFocus=!0,doBlur(),__waitingToLoadEventAudio&&(__waitingToLoadEventAudio=!1,DBLLog.log("Tab regained focus - proceeding with audio loads",DBLLog.INFO),loadEventAudio()),window.DfhgSgh&&__shellAuto&&DfhgSgh.sbkdj()}function invalidate(e){if(!__inUpdate&&null!=e.stage&&engagementStage&&lessonStage&&(!frozen||e.stage!=lessonStage)){for(;null!=e&&null==e.name;)e=e.parent;e&&e.parent&&-1==__invalidObjects.indexOf(e)&&-1==__frozenComponents.indexOf(e)&&(accumulateBoundingRect(e,10),__invalidObjects.push(e))}}function tick(e){if(engagementStage&&lessonStage){var t,n,a,o,s,i=0,l=createjs.Ticker.getEventTime(),r=l-__timeLastTick24,r=(1e3/24<=r&&(r=r/(1e3/24),a=Math.floor(r),__timeLastTick24=l-1e3/24*(r-(i=a))),replayMode&&(i=1),l-__timeLastMuteCheck);for(t in 1e3<=r&&(__timeLastMuteCheck=l,checkTabletMute(),r<2e3)&&shell&&__shellSetup&&checkIpadAudio(),components){var c=components[t];if(c&&("function"==typeof c.tick&&c.tick.call(c),i)&&"function"==typeof c.tick24&&c.tick24.call(c,i),!engagementStage||!lessonStage)return}if(shell&&shell.tick(),screencur&&"function"==typeof screencur.tick&&!frozen&&screencur.tick(),i){if("object"==typeof DBLPopin&&DBLPopin.tick24(i),__progressMeter&&!__progressMeter.paused)for(var _=i;0<_--;)DBLAsset.advanceMovieClip(__progressMeter),__progressController.tick();__spinner&&__spinner.tick24(i),__login&&__login.tick24(i),shell&&shell.tick24(i),screencur&&"function"==typeof screencur.tick24&&!frozen&&screencur.tick24(i)}if((__lessonOrScreenStarted||__exiting)&&runEventLoop(),engagementStage&&lessonStage){if(0<__invalidObjects.length)for(var d=0;d<__invalidObjects.length;d++){var p=__invalidObjects[d];p.parent&&accumulateBoundingRect(p)}__invalidObjects=[],__flash&&(a=!1,5<__aDebugEngagementRect.length&&(n=__aDebugEngagementRect.shift())&&(engagementStage.drawRect=n,updateEngagementStage(e,!1),a=!0,engagementStage.drawRect=null),5<__aDebugLessonRect.length&&(n=__aDebugLessonRect.shift())&&(lessonStage.drawRect=n,updateLessonStage(e,!1),a=!0,lessonStage.drawRect=null),"undefined"!=typeof a11y)&&a&&a11y.updateAccessibility(),intern||(framesSinceRedraw++,n=r=l=!1,null!=__invalidEngagementRect&&(IE||(engagementStage.drawRect=__invalidEngagementRect),updateEngagementStage(e,!1),n=!0,engagementStage.drawRect=null,__flash&&((o=engagementStage.canvas.getContext("2d")).fillStyle="rgba(0, 0, 255, 0.5)",o.fillRect(__invalidEngagementRect.x,__invalidEngagementRect.y,__invalidEngagementRect.width,__invalidEngagementRect.height),__aDebugEngagementRect.push(__invalidEngagementRect.clone()),l=!0),__invalidEngagementRect=null,framesSinceRedraw=0),frozen||(useWebGL&&spriteStage&&spriteStage.update(e),null!=__invalidLessonRect&&(IE||(lessonStage.drawRect=__invalidLessonRect),updateLessonStage(e,!1),n=!(lessonStage.drawRect=null),__flash&&((o=lessonStage.canvas.getContext("2d")).fillStyle="rgba(0, 255, 0, 0.5)",o.fillRect(__invalidLessonRect.x,__invalidLessonRect.y,__invalidLessonRect.width,__invalidLessonRect.height),__aDebugLessonRect.push(__invalidLessonRect.clone()),r=!0),__invalidLessonRect=null,framesSinceRedraw=0),backgroundStage!=lessonStage&&null!=__invalidBackgroundRect&&(backgroundStage.drawRect=__invalidBackgroundRect,__inUpdate=!0,backgroundStage.update(e),__inUpdate=!1,backgroundStage.drawRect=null,__invalidBackgroundRect=null,framesSinceRedraw=0)),__flash&&(l||__aDebugEngagementRect.push(null),r||__aDebugLessonRect.push(null)),"undefined"!=typeof a11y&&n&&a11y.updateAccessibility(),a=Date.now(),o=__tLastTick?a-__tLastTick:0,__tLastTick=a,o>=1e3*(__passwordResume?15:60)*1&&shell&&__shellSetup?(DBLLog.log("CPU thread appears to have been suspended for "+(o/6e4).toFixed(1)+" minutes - server may have abandoned us, pinging...",DBLLog.INFO),DBLActivityMonitor.immediatePingServer(function(){__passwordResume&&showPasswordResumeDialog()})):6e4<=o&&serverURL&&__login&&(DBLLog.log("checking for new static version...",DBLLog.INFO),(s=new XMLHttpRequest).open("POST",document.location.protocol+"//"+document.location.host+"/schools/tablet/v1.0/environment",!0),s.setRequestHeader("pragma","no-cache"),s.setRequestHeader("Cache-Control","no-cache"),s.setRequestHeader("Accept","application/json"),s.applicationId=rootParams.application||1,s.setRequestHeader("DBL-ClientInfo",JSON.stringify({appVersion:rootParams.appversion||"browser",device:rootParams.device||"browser",applicationId:rootParams.application||1})),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){var e;try{e=JSON.parse(s.response)}catch(e){}e&&e.vars&&e.vars.static_content_server&&stripEndingSlash(e.vars.static_content_server)!=stripEndingSlash(rootURL)&&location.reload()}},s.send(JSON.stringify({version:"1.0",app_version:rootParams.appversion||"browser"}))))}}}function stripEndingSlash(e){return"/"===e.substr(-1)?e.substr(0,e.length-1):e}function accumulateBoundingRect(e,t){if(void 0===t&&(t=0),e){var n,a,o,s,i=e.getTransformedBounds();if(i||!e.children||0!=e.children.length){for(;!i&&e.parent;)i=(e=e.parent).getTransformedBounds();i&&e.parent?(pointTemp1=pointTemp1||new createjs.Point,pointTemp2=pointTemp2||new createjs.Point,pointTemp3=pointTemp3||new createjs.Point,pointTemp4=pointTemp4||new createjs.Point,e.parent.localToGlobal(i.x,i.y,pointTemp1),e.parent.localToGlobal(i.x+i.width,i.y,pointTemp2),e.parent.localToGlobal(i.x,i.y+i.height,pointTemp3),e.parent.localToGlobal(i.x+i.width,i.y+i.height,pointTemp4),n=Math.floor(Math.min(Math.min(pointTemp1.x,pointTemp2.x),Math.min(pointTemp3.x,pointTemp4.x))),a=Math.ceil(Math.max(Math.max(pointTemp1.x,pointTemp2.x),Math.max(pointTemp3.x,pointTemp4.x))),o=Math.floor(Math.min(Math.min(pointTemp1.y,pointTemp2.y),Math.min(pointTemp3.y,pointTemp4.y))),s=Math.ceil(Math.max(Math.max(pointTemp1.y,pointTemp2.y),Math.max(pointTemp3.y,pointTemp4.y))),i.x=n,i.y=o,i.width=a-n,i.height=s-o,t&&i.pad(t,t,t,t)):i=new createjs.Rectangle(0,0,lessonStage.canvas.width/dblDevicePixelRatio,lessonStage.canvas.height/dblDevicePixelRatio),e.stage==engagementStage?__invalidEngagementRect=null==__invalidEngagementRect?i.clone():__invalidEngagementRect.union(i):e.stage==lessonStage?__invalidLessonRect=null==__invalidLessonRect?i.clone():__invalidLessonRect.union(i):backgroundStage!=lessonStage&&e.stage==backgroundStage&&(__invalidBackgroundRect=null==__invalidBackgroundRect?i.clone():__invalidBackgroundRect.union(i))}}}function checkTabletMute(){if(webview&&"8.0.0"!=appVersion&&"8.0.1"!=appVersion&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.observe)try{window.webkit.messageHandlers.observe.postMessage("checkMute")}catch(e){}}function checkIpadAudio(){if(iOS&&!__appInBackground){var e=!1;try{var t=createjs.Sound.activePlugin;"suspended"!=t.context.state&&"interrupted"!=t.context.state||(t.context.resume(),e=!0)}catch(e){}e&&DBLLog.log("iPad audio suspended audio context resumed",DBLLog.INFO)}}function checkMuteComplete(e){deviceMuted=e,shell&&__lessonOrScreenStarted&&(e&&void 0===__seenMuteCheck?(__seenMuteCheck=!0,shell.setMuteDisplay()):e||(__seenMuteCheck=void 0))}function freezeContent(){if(!frozen&&(DBLLog.log("freezeContent()",DBLLog.INFO),replayMode||doBlur(),screencur&&"function"==typeof screencur.freeze&&(screencur.freeze(),tick()),frozen=!0,lessonStage.mouseChildren=__interactive&&!frozen,DBLActivityMonitor.lessonFrozen(),"html"==presentation||"mixed"==presentation)){assert(0==__frozenHTMLComponents.length),__frozenHTMLComponents=[];for(var e in components)(t=>{var e;isHTMLComponent(lesson.lessonData.components.find(function(e){return e.id==t}))&&(e=components[t])&&!0===e.interactive&&(e.interactive=!1,__frozenHTMLComponents.push(t))})(e)}}function updateLessonStage(e,t){__inUpdate=!0,lessonStage.update(e),"undefined"!=typeof a11y&&t&&a11y.updateAccessibility(),__inUpdate=!1}function updateEngagementStage(e,t){__inUpdate=!0,engagementStage.update(e),"undefined"!=typeof a11y&&t&&a11y.updateAccessibility(),__inUpdate=!1}function thawContent(){if(frozen&&(DBLLog.log("thawContent()",DBLLog.INFO),screencur&&"function"==typeof screencur.thaw&&screencur.thaw(),lesson&&lesson.__onThaw instanceof Function&&lesson.__onThaw(),lessonStage.drawRect=null,updateLessonStage(engagementStage.drawRect=null,!1),updateEngagementStage(null,!0),frozen=!1,lessonStage.mouseChildren=__interactive&&!frozen,DBLActivityMonitor.lessonThawed(),__delayedUserRunLesson?(fastForwarding=!1,userRunLesson(__delayedUserRunLesson),__delayedUserRunLesson=void 0):__delayedUserRunScreen&&(fastForwarding=!1,userRunScreen(__delayedUserRunScreen,__runScreenParams),__delayedUserRunScreen=void 0),"html"==presentation||"mixed"==presentation)){document.getElementById("lrt4LessonDiv").firstChild.style.visibility="visible";for(var e=0,t=__frozenHTMLComponents;e<t.length;e++){var n=t[e],n=components[n];n&&!1===n.interactive&&(n.interactive=!0)}__frozenHTMLComponents=[]}}function suspendAutoInvalidate(e){-1==__frozenComponents.indexOf(e)&&__frozenComponents.push(e)}function resumeAutoInvalidate(e){e=__frozenComponents.indexOf(e);-1!=e&&__frozenComponents.splice(e,1)}function manualInvalidate(e,t){e.parent&&accumulateBoundingRect(e,t)}function onWindowResizeDebug(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,n=(webview&&rootParams.device&&(e=Math.max(window.screen.width,window.screen.height),t=Math.min(window.screen.width,window.screen.height)),e/1024),t=t/(768+(webview?0:20)),a=n<t?n:t,t=(Math.max(t,n),a=Math.max(a,.25),Math.ceil(1024*a)),n=Math.ceil(768*a),e=Math.floor((e-t)/2),o=document.getElementById("lrt4BackgroundCanvas"),s=document.getElementById("lrt4LessonCanvas"),i=document.getElementById("lrt4EngagementCanvas"),l=document.getElementById("lrt4SpriteCanvas"),r=document.getElementById("htmlcontent"),o=(o&&(o.width=t*dblDevicePixelRatio,o.height=n*dblDevicePixelRatio,o.style.width=t+"px",o.style.height=n+"px",o.style.left=e+"px",o.style.top="0px",l.width=t*dblDevicePixelRatio,l.height=n*dblDevicePixelRatio,l.style.width=t+"px",l.style.height=n+"px",l.style.left=e+"px",l.style.top="0px"),s.width=t*dblDevicePixelRatio,s.height=n*dblDevicePixelRatio,s.style.width=t+"px",s.style.height=n+"px",s.style.left=e+"px",s.style.top="0px",i.width=t*dblDevicePixelRatio,i.height=n*dblDevicePixelRatio,i.style.width=t+"px",i.style.height=n+"px",i.style.left=e+"px",i.style.top="0px",r.style.width=t+"px",r.style.height=n+"px",r.style.left=e+"px",r.style.top="0px",document.getElementById("lrt4LessonDiv")),l=(o&&(o.style.scale=a.toString(),o.style.left=e+"px",o.style.top="0px"),document.getElementById("copyright")),i=(l&&(l.style.top=n+"px",l.style.width=t+"px",l.style.left=e+"px"),document.getElementById("jscontent"));i&&(i.style.width=s.style.width,i.style.height=s.style.height),resize(a)}function rescaleProgressMeter(e){engagementStage.contains(__progressMeter)?__progressMeter.scaleX=__progressMeter.scaleY=e:(__progressMeter.scaleX=__progressMeter.scaleY=1.094*e,__progressMeter.y=shell.getHeaderHeight()*e)}function updateCopyrightDebugString(){var e,t=document.getElementById("copyright");t&&(e="<span style='font:"+Math.min(16,Math.round(16*lessonContent.scaleX))+"px Arial; color:#345372' tabindex='-1'>",debug,e+="<span style='float:left' tabindex='-1'>&copy; "+(new Date).getFullYear()+" Discovery Education, Inc. All Rights Reserved. ",__application==APPID_MATH?e+="<a href='https://www.dreambox.com/legal' target='_blank' tabindex='-1'><font color='#0000FF'><u>Copyright</u></font></a> | <a href='https://www.dreambox.com/child-friendly-terms-of-use' target='_blank' tabindex='-1'><font color='#0000FF'><u>Terms of Use</u></font></a> | <a href='https://www.dreambox.com/child-friendly-privacy-policy' target='_blank' tabindex='-1'><font color='#0000FF'><u>Privacy Policy</u></font></a>":e+="<a href='http://www.dreambox.com/legal' target='_blank' tabindex='-1'><font color='#0000FF'><u>legal</u></font></a> | <a href='http://www.dreambox.com/privacy' target='_blank' tabindex='-1'><font color='#0000FF'><u>privacy policy</u></font></a>",__suppressIESFX&&(e+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Limited sound on this browser."),e+="</span>",rootParams.parentlink&&"squiggly"!=engagement&&"bookworm"!=engagement&&(e+="<a href='javascript:void(0)' onclick='immediateExit(1)' style='float:right' tabindex='-1'><font color='#0000FF'><u>Set up parent access</u></font></a>"),t.innerHTML=e+="</span>")}function resize(e){if(window.scale=e,updateA11yDiv(),lessonStage&&window.DBLActivityMonitor){if(backgroundStage.setBounds(0,0,backgroundStage.canvas.width/dblDevicePixelRatio,backgroundStage.canvas.height/dblDevicePixelRatio),lessonStage.setBounds(0,0,lessonStage.canvas.width/dblDevicePixelRatio,lessonStage.canvas.height/dblDevicePixelRatio),engagementStage.setBounds(0,0,engagementStage.canvas.width/dblDevicePixelRatio,engagementStage.canvas.height/dblDevicePixelRatio),__backgroundBitmap&&rescaleBackground(e),__progressMeter&&rescaleProgressMeter(e),DBLPopin.rescalePopin(),lessonContent.scaleX=e,lessonContent.scaleY=e,lessonContent.x=Math.floor(lessonStage.canvas.width/dblDevicePixelRatio/2-1024*e/2),lessonContent.y=(shell?shell.getHeaderHeight():0)*e,engagementContent.scaleX=e,engagementContent.scaleY=e,engagementContent.x=lessonContent.x,engagementContent.y=lessonContent.y,a11yContent&&(a11yContent.scaleX=e,a11yContent.scaleY=e,a11yContent.x=engagementContent.x,a11yContent.y=engagementContent.y),__lessonOrScreenStarted){if(components)for(var t in components){t=components[t];"function"==typeof t.resize&&t.resize.call(t)}screencur&&"function"==typeof screencur.resize&&screencur.resize.call(screencur)}backgroundStage!=lessonStage&&(__invalidBackgroundRect=new createjs.Rectangle(0,0,backgroundStage.canvas.width/dblDevicePixelRatio,lessonStage.canvas.height/dblDevicePixelRatio),__inUpdate=!0,backgroundStage.update(),__inUpdate=!1),__invalidLessonRect=new createjs.Rectangle(0,0,lessonStage.canvas.width/dblDevicePixelRatio,lessonStage.canvas.height/dblDevicePixelRatio),updateLessonStage(null,!1),__spinner&&__spinner.resize(),shell&&shell.resize(),__keyPad&&__keyPad.resize(),__interactiveShield&&setInteractiveShield(!0),__invalidEngagementRect=new createjs.Rectangle(0,0,engagementStage.canvas.width/dblDevicePixelRatio,engagementStage.canvas.height/dblDevicePixelRatio),updateEngagementStage(null,!0),updateCopyrightDebugString()}else __initialScale=e}function callJS(e,t,n,a){var o;if("runtime"==e&&"resize"==n)return o=document.getElementById("lrt4LessonCanvas"),void resize(parseInt(o.style.width)/1024);"object"==typeof console&&DBLLog.log("unknown API "+n+" on "+e,DBLLog.WARN)}function rescaleBackground(e){__backgroundBitmap.scaleX=__backgroundBitmap.scaleY=.5*e,__backgroundBitmap.y=(shell?shell.getHeaderHeight():0)*e}function onComponentEvent(e){var t,n=e instanceof CustomEvent?(a=e.detail.source,e.detail.event):(a=getToolNameFromObject(e.currentTarget),e.getSubtype()),a=(DBLLog.log("Event "+n+" received from "+a,DBLLog.INFO),{name:n,source:a,data:null});e.hasOwnProperty("data")&&e.data&&(a.data=e.data),"function"==typeof e.currentTarget.playText&&"pressed"==n?fastForwarding?DBLPlay.playTextToolAudioDuringFastForward():(__eventCur=a,fastForward(),fastForwarding=!1,__ff=fastForwardPlay,(t=e.currentTarget).onPlayStarted(),DBLPlay.playTextToolAudio(function(){__ff=null,t.onPlayStopped(),__unblock()}),window.DfhgSgh&&DfhgSgh.scfwm()):__state.isEventAsync(a)?__eventCur||0!=__eventQueue.length?__eventQueue.push(a):(__eventCur=a,n=__state.processEvent.call(__state,__eventCur),window.DfhgSgh&&DfhgSgh.nbit(),n||(__eventCur=null)):(__state.processEvent.call(__state,a),window.DfhgSgh&&DfhgSgh.nbit())}function goto(e){var t;e?(t="string"==typeof e?e:e.name,(e="string"==typeof e?__states[e]:e)instanceof DBLState||DBLLog.log("goto() unknown state"+t,DBLLog.ERROR),e=replacementState(e),DBLLog.log("goto("+e.name+")",DBLLog.INFO),__nextState=e):DBLLog.log("goto() called without passing state or state name",DBLLog.ERROR)}function dispatch(e){__eventQueue.push("object"==typeof e?e:{name:e})}var __stuckTest2=0;function runEventLoop(){if(("undefined"==typeof a11y||!a11y.waitForA11y())&&!__exited&&(!frozen||__initialFreeze||replayMode||isVisualCheckSave())){var e=!1;if(__state)for(window.DfhgSgh&&DfhgSgh.nbit();;){if(!e&&!__eventCur&&0<__eventQueue.length){if(__stuckTest2=0,__eventCur=__eventQueue.pop(),e=__state.processEvent.call(__state,__eventCur)){"stall"!=__eventCur.name&&DBLActivityMonitor.blockingNonStallEvent();break}}else{if(e||__eventCur||0!=__eventQueue.length||!__nextState){!runningUnattended||!intern&&rootParams.powerthrough||replayMode||isVisualCheckSave()||1800<++__stuckTest2&&(DBLLog.log("Test likely stuck",DBLLog.FATAL),finalExit());break}if(__state=__nextState,__nextState=null,__stuckTest2=0,e=__state.runEnter.call(__state)){DBLActivityMonitor.blockingNonStallEvent();break}}if(__eventCur=null,__exited)return}e&&__initialFreeze&&!__extendedLoad&&!replayMode&&(__initialFreeze=!1,thawContent()),e||(__exiting?(__exited=!0,actuallyExit()):__eventCur||0!=__eventQueue.length||(lesson?(skippable=!1,runningUnattended||replayMode||(fastForwarding=!1),DBLActivityMonitor.controlReturnsToUser(),window.DfhgSgh&&DfhgSgh.mapjk(),shell&&(shell.enableHelp=__helpEnabled),replayMode?onPlaybackReady():isVisualCheckSave()&&!rootParams.powerthrough||doAnyPlaybacks()):screencur&&doAnyPlaybacks()))}}function fastForward(e){for(var t in DBLLog.log("fastForward("+(e||"")+")",DBLLog.INFO),e=e||"unspecified",assert("unspecified"==e||"popup"==e||"skip"==e||"nav"==e),"popup"==e&&(__pendingPause=!0),__ff&&(__fastForwardHint=e,fastForwarding=!0,__ff.call(__ffObj)),__ffList)(0,__ffList[t])()}function skipPoint(){runningUnattended||(fastForwarding&&"skip"==__fastForwardHint&&(logDelayed(),shell)&&(shell.showSkipButton=__skippable,shell.enableSkip=__skippable),replayMode)||(fastForwarding=!1)}function interruptPoint(e){!runningUnattended&&fastForwarding&&"popup"==__fastForwardHint?(fastForwarding=!1,__resumeFunction=e):(__resumeFunction=void 0,e())}function abandonAnyInterruptPoint(){__resumeFunction=void 0}function __doFF(){var e=__ff,t=__ffObj;__ff=null,__ffObj=null,e.call(t)}function __csPush(e){__cs.push(e)}function __csPop(){0!=__cs.length&&__cs.pop()()}function __run_function(e,t){__cs.push({type:"function",callback:e}),__cs.push({type:"sequence",block:t,index:0}),__run()}function __run_blocking(e,t,n){__ffObj=e||window,__ff=__ffObj["fastForward"+t.substr(0,1).toUpperCase()+t.substr(1)];var e=__ffObj[t].apply(__ffObj,Array.prototype.slice.call(arguments,2).concat(__continue));if(e instanceof Promise&&e.then(__continue).catch(__continue),fastForwarding&&__ff&&(t=__ff,e=__ffObj,__ff=null,__ffObj=null,t.call(e)),fastForwarding)for(var a in __ffList)(0,__ffList[a])()}function __continue(){__ff=null,__ffObj=null;var e=__cs[__cs.length-1];assert("sequence"==e.type),e.index++,__run()}function __run_for(e,t,n,a){__cs.push({type:"for",init:e,test:t,block:a,iterate:n}),__run()}function __run_if(){for(var e=[],t=[],n=0;n<arguments.length;n+=2)e.push(arguments[n]),t.push(arguments[n+1]);__cs.push({type:"if",tests:e,branches:t}),__run()}function __run(){for(var e=__cs.length-1,t=__cs[e--],n=t;"function"!=n.type;)n=__cs[e--];if("sequence"==t.type)t.index>=t.block.length?(__cs.pop(),__run()):t.block[t.index]();else if("for"==t.type)t.init?(t.init(),t.init=null):t.iterate(),(t.test()?(__cs.push({type:"sequence",block:t.block,index:0}),__run):(__cs.pop(),__continue))();else if("if"==t.type){__cs.pop();var a=__cs[__cs.length-1];assert("sequence"==a.type),a.index++;for(e=0;e<t.branches.length;e++){var o=t.tests[e];if(!o||o()){__cs.push({type:"sequence",block:t.branches[e],index:0});break}}__run()}else"function"==t.type&&(__cs.pop(),t.callback())}function DBLRegisterFastForward(e){var t=__nextFFHandle;return __nextFFHandle++,__ffList[t]=e,t}function DBLUnregisterFastForward(e){delete __ffList[e]}function getToolNameFromObject(e){for(var t in components)if(components[t]==e)return t}function pause(e,t){__calledFromPlay?DBLPlay.playProxyPause(e):(assert(!__pauseId,"reentrant pause"),__pauseCallback=t,__pauseId=setTimeout(function(){__pauseId=null;var e=__pauseCallback;__pauseCallback=void 0,e()},e))}function fastForwardPause(){var e;__pauseId&&(clearTimeout(__pauseId),__pauseId=null,e=__pauseCallback,__pauseCallback=void 0,interruptPoint(e))}function setInteractiveShield(e){e?(__interactiveShield||((__interactiveShield=new createjs.Shape).graphics.beginFill("rgba(255,0,0,0.2)"),__interactiveShield.graphics.drawRect(0,0,1,1),__interactiveShield.setBounds(0,0,1,1),engagementStage.addChildAt(__interactiveShield,0)),__interactiveShield.scaleX=lessonStage.getBounds().width,__interactiveShield.scaleY=lessonStage.getBounds().height,manualInvalidate(__interactiveShield)):__interactiveShield&&(manualInvalidate(__interactiveShield),engagementStage.removeChild(__interactiveShield),__interactiveShield=null)}function playSound(e,t){__suppressIESFX&&!__loadedAudio[e]||("boolean"==typeof t&&(t={interrupt:createjs.Sound.INTERRUPT_EARLY,delay:0,offset:0}),fastForwarding)||__suppressPlaySound||(t=createjs.Sound.play(e,t),__keepBundleAudioInstances&&screenerMode&&(__audioInstances[e]=t))}function showPasswordResumeDialog(){var e;shell&&(e=null,e=rootParams.pictureid?"pictureid":rootParams.ssopassword?"sso":"password",shell.showResumePasswordDialog(e))}function setupReplayMessageHandler(){__haltA11y=!0,window.addEventListener("message",function(e){var t=e.data;switch(t.type){case"stop":cleanupReplay();break;case"slideRecord":messageParent("replay-data",DBLReplay.getSlideRecords(t.content.sitting));break;case"load":messageParent("replay-data",{version:"ordered",replayData:DBLReplay.getSlideRecords(t.content.sitting)}),__replayTranscript=t.content.sitting,__startingAS=t.content.asData,runMultipleTranscripts=t.content.runMultipleTranscripts,processAssessmentType(t),reloadFromTranscript();break;default:console.error("Wrong or missing data type: ",t.type)}})}function cleanupReplay(){cleanupLesson(),cleanupLinkedAssets(),cleanupEngagement(),cleanupRest()}function reloadFromTranscript(){var e=__replayTranscript.setupData,t=e.engagementData,n=document.location.pathname+"?replay=true&engagement="+e.engagement+"&lesson="+e.lesson,n=(n=(n=(n+="&username="+encodeURIComponent(t.userName||"student"))+("&seeds=["+e.seed1+","+e.seed2+"]"))+("&avatar="+t.avatar))+("&data="+t.data);"primary"==e.engagement?n=(n+="&theme="+t.theme)+"&story="+t.story:(n=(n+="&lessonname="+t.lessonName)+"&lessontype="+t.lessonType,t.lessonIcon&&(n+="&lessonicon="+t.lessonIcon),t.avatarType&&(n+="&avatartype="+t.avatarType),t.avatarCount&&(n+="&avatarcount="+t.avatarCount),t.avatarProgress&&(n+="&avatarprogress="+t.avatarProgress),t.avatarLevels&&(n+="&avatarlevels="+t.avatarLevels)),n=(n+="&lcid="+(e.lcid||""))+"&staticmap="+(e.staticMap||""),shell=null,__contentAreas=null,run(n)}function replayNext(){__currentSlide<__slideRecords.length-1&&(__currentSlide++,updateSlide(!0))}function replayPrev(){0<__currentSlide&&(__currentSlide--,updateSlide(!1))}function replayGotoSlide(e){__currentSlide=e,updateSlide(!1)}function replayGotoProblemFirstSlide(e,t){for(var n=0;n<__slideRecords.length;n++)if(__slideRecords[n].problem==t&&__slideRecords[n].sitting==e)return replayGotoSlide(n)}function updateSlide(e){var t=__slideRecords[__currentSlide].snapshot;t?(__slideTween&&(__slideTween.progress(1),__slideTween=null),e?1==__activeSlideImage?(document.getElementById("snapshot2").src=t,document.getElementById("snapshot2").style.opacity="0",document.getElementById("snapshot2").style.display="block",document.getElementById("snapshot2").style.zIndex="1000",document.getElementById("snapshot1").style.zIndex="auto",__slideTween=gsap.TweenLite.to(document.getElementById("snapshot2").style,.5,{opacity:1,ease:gsap.Linear.easeNone,onComplete:function(){document.getElementById("snapshot1").src="",document.getElementById("snapshot1").style.display="none",__slideTween=null}}),__activeSlideImage=2):2==__activeSlideImage&&(document.getElementById("snapshot1").src=t,document.getElementById("snapshot1").style.opacity="0",document.getElementById("snapshot1").style.display="block",document.getElementById("snapshot1").style.zIndex="1000",document.getElementById("snapshot2").style.zIndex="auto",__slideTween=gsap.TweenLite.to(document.getElementById("snapshot1").style,.5,{opacity:1,ease:gsap.Linear.easeNone,onComplete:function(){document.getElementById("snapshot2").src="",document.getElementById("snapshot2").style.display="none",__slideTween=null}}),__activeSlideImage=1):(document.getElementById("snapshot1").src=t,document.getElementById("snapshot1").style.display="block",document.getElementById("snapshot1").style.opacity="1",document.getElementById("snapshot2").src="",document.getElementById("snapshot2").style.display="none",__activeSlideImage=1)):DBLLog.log("Asked to go to a slide with no snapshot!",DBLLog.FATAL)}function messageParent(e,t){window.top.postMessage(JSON.stringify({type:e,content:t}),"*")}function setupForReplay(){shell.closedCaptionBarEnabled=!0,shell.resetClosedCaptioning(),engagementStage.enableDOMEvents(!1),lessonStage.enableDOMEvents(!1),createjs.Sound.muted=!0,updateCopyrightDebugString(),assert(1==fastForwarding),freezeContent(),__slideRecords=runMultipleTranscripts&&__slideRecords?__slideRecords.concat(DBLReplay.getSlideRecords(__replayTranscript)):DBLReplay.getSlideRecords(__replayTranscript),isVisualCheckEnabled()&&DBLVisualTestUtils.setSlidesSnapshotData(__replayTranscript,__slideRecords),__currentSlide=0,__replayLine=-1,__replayInput=0,__replayImage=0,__activeSlideImage=1,__snapshotPending=!1,__inPlaybackReady=!1,__replayStuck=!1,__replayPlaybackDelay=100,__replayActionFlag=!1}function onPlaybackReady(){if(!(__replayStuck>STUCK_RETRIES||__inPlaybackReady)){__inPlaybackReady=!0;var e=getReplayRecord(__replayLine+1);if(e=!e&&getReplayRecord(__replayLine)&&"exit"!=getReplayRecord(__replayLine).type?{type:"exit"}:e){if(isReplayUserAction(e.type)){if(takePendingSnapshot(),DBLAutomation.runParsed(e))__replayStuck=0;else if(tick(),++__replayStuck>STUCK_RETRIES)return DBLLog.log("Replay likely stuck at line: "+JSON.stringify(e),DBLLog.WARN),void(__inPlaybackReady=!1);return setTimeout(tick,__replayPlaybackDelay),void(__inPlaybackReady=!1)}if("exit"==e.type)return takePendingSnapshot(),__replayLine++,takeSnapshot(),messageParent("asdata-available",{asData:DfhgSgh.olgki(3,SnwRaDh.seeafels())}),checkForSlidesWithoutSnapshots(),void setTimeout(function(){cleanupReplay()},0);if(++__replayStuck>STUCK_RETRIES)return DBLLog.log("Replay likely stuck at line: "+JSON.stringify(e),DBLLog.WARN),void(__inPlaybackReady=!1)}__inPlaybackReady=!1}}function replayLogAutomation(e){var t,n;__replayTranscript&&(t=DBLAutomation.getTranscriptEntry(e))&&(takePendingSnapshot(),__replayLine++,__replayStuck=0,n=getReplayRecord(__replayLine))&&(checkRecordsMatch(t,n),takeSnapshot(),"playPopup("==e.substr(0,10))&&DBLPopup.takeSecondPopupSnapshot()}function isReplayUserAction(e){return"click"==e||"drag-"==e.substr(0,5)||"edit"==e||"help"==e||"mouse"==e||"answer"==e||"restart"==e||"pass"==e||"fail"==e||"comment"==e}function checkRecordsMatch(e,t){e.timestamp=t.timestamp;var e=JSON.stringify(e),n=t?JSON.stringify(t):null;e!=n&&"exit"!=t.type&&DBLLog.log("Replay lines mismatch found! Current record: "+e+" Replay record: "+n,DBLLog.INFO)}function getReplayRecord(e){return __replayTranscript.records[e]}function takePendingSnapshot(){takeSnapshot(!0)}function takeSnapshot(e){if(void 0===e&&(e=!1),__slideRecords){for(var t=[],n=0;n<__slideRecords.length;n++){var a=__slideRecords[n];a.transcriptIndex!=__replayLine||a.snapshot||!a.pending!=!e||t.push(n)}if(0!=t.length){for(var o=!1,s=0;s<t.length;s++){var a=__slideRecords[t[s]],i=0==t[0];switch(!i&&("primary"!=engagement||"progress-complete"!=a.type&&"progress-payoff"!=a.type)||DBLAutomation.updateCanvasData(),a.type){case"play-popin":replayUpdateCC(DBLPopin.getPopinScript());break;case"play-text-plus-auto":case"play-text-plus":case"play-text":DBLPlay.fastForwardText(),replayUpdateCC(translate(a.play));break;default:replayUpdateCC(translate(a.play))}a.play&&0<a.afterCommand&&(DBLPlay.partialFastForward(a.afterCommand),o=!0),thawContent();var l=DBLAutomation.snapshot();freezeContent(),a.snapshot=l,i&&updateSlide(!1),messageParent("image-loaded",{index:t[s],image:l}),isVisualCheckEnabled()&&DBLVisualTestUtils.saveSnapshotData(null,__slideRecords,t[s],l)}o&&DBLPlay.finalFastForward()}}}function checkForSlidesWithoutSnapshots(){for(var e=0;e<__slideRecords.length;e++)__slideRecords[e].snapshot||DBLLog.log("Slide without a snapshot: "+JSON.stringify(__slideRecords[e]),DBLLog.WARN)}function replayUpdateCC(e){e?__replayCC!=e&&(shell.resetClosedCaptioning(),shell.showClosedCaptionString(e),__replayCC=e):__replayCC&&(shell.resetClosedCaptioning(),__replayCC=null)}function snapshot(){logAutomation("snapshot")}Object.defineProperty(window,"interactive",{get:function(){return __interactive},set:function(e){__interactive=e,lessonStage&&(lessonStage.mouseChildren=__interactive&&!frozen);var t=document.getElementById("lrt4LessonDiv");t&&t.firstChild&&(t.firstChild.style.pointerEvents=e?"auto":"none"),__interactive||doBlur(),__interactive&&DBLTextInputFocusManager.setDeferredFocus(),shell&&shell.onInteractiveChanged(),debug&&lessonStage&&!replayMode&&setInteractiveShield(!__interactive),a11y&&a11y.updateLessonInteractive(__interactive),!__interactive&&window.DfhgSgh&&DfhgSgh.ifadf()}}),Object.defineProperty(window,"skippable",{get:function(){return __skippable},set:function(e){__skippable!=e&&(__skippable=e,shell)&&(shell.showSkipButton=e,shell.enableSkip=e)}}),Object.defineProperty(window,"helpEnabled",{get:function(){return __helpEnabled},set:function(e){__helpEnabled=e,shell&&(shell.enableHelp=e)}}),Object.defineProperty(window,"extendedLoad",{get:function(){return __extendedLoad},set:function(e){__extendedLoad=e}});