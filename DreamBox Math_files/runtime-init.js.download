var __audioLoadLogged,DBLRuntime,__mousedownHandler,__mousemoveHandler,__mouseupHandler,__importedLessons,__clientStartRetries=0;function isA11ySupported(){return"undefined"!=typeof Proxy}function run(e,n){__originalUrl=e,__timeDisplacement=0,dreamboxStartTime=n?(new Date).getTime():dreamboxStartTime||(new Date).getTime()-Math.round(performance.now()),__initialFreeze=!0,rootURL=-1!=e.indexOf("runtime")?e.substr(0,e.indexOf("runtime")):-1!=e.indexOf("test")?e.substr(0,e.indexOf("test")):e;var o,t=getQueryParams(e=-1!=e.indexOf("?")?e.substr(e.indexOf("?")+1):e);for(o in"true"==t.intern&&"true"==t.fromca&&(rootURL="/../dbl-content/V4"+rootURL),rootParams={},t){var a=t[o];"true"==a?rootParams[o]=!0:"false"==a?rootParams[o]=!1:isParamNumber(a)&&"username"!=o&&"password"!=o&&"ssopassword"!=o&&"districtid"!=o&&"schoolid"!=o&&"playurlpath"!=o&&"playurlquery"!=o&&"playurlfragment"!=o&&"qoskeystitration"!=o&&"staticmap"!=o?rootParams[o]=parseFloat(a):rootParams[o]=a}if(t.clientinstance&&(clientInstance=t.clientinstance),t.authsession&&(authSession=t.authsession),t.studentid&&(__studentId=t.studentid),t.appversion&&(appVersion=t.appversion),t.debug&&"false"==t.debug&&(window.debug=!1),!debug)for(var s=["log","debug","warn","info"],r=0;r<s.length;r++)console[s[r]]=function(){};presentation="canvas",t.screenerMode&&(screenerMode="true"==t.screenerMode),t.screenerHelpMe&&(screenerHelpMe="true"==t.screenerHelpMe),engagement=t.engagement||"none",__application=parseInt(t.application||"1"),"squiggly"!=engagement&&"bookworm"!=engagement||(__application=APPID_EARLY_LITERACY),lcid=t.lcid&&__application==APPID_MATH?parseInt(t.lcid):Lcid.USEnglish,country=t.country||"",region=t.region||"",language=Lcid.getSystemLanguage(),dialect=Lcid.getSystemDialect(),logLevel=t.loglevel?logLevelFromString(t.loglevel):debug?DBLLog.INFO:DBLLog.OFF,alertLevel=t.alertlevel?logLevelFromString(t.alertlevel):debug?DBLLog.WARN:DBLLog.OFF,__skipTTS=!!t.skipTTS&&"true"==t.skipTTS,__debugA11y=!!t.debugA11y&&"true"==t.debugA11y,__debugNeon=!!t.debugNeon&&"true"==t.debugNeon,!(__haltA11y=!isA11ySupported())&&t.haltA11y&&(__haltA11y="true"==t.haltA11y),t.screenReaderEnabled&&(__screenReaderEnabled="true"==t.screenReaderEnabled),__runLogin="true"==t.login,season=t.season||null,audienceType=t.audiencetype||0,achievements=!t.achievements||"true"===t.achievements,stats=!t.stats||"true"===t.stats,personalization=!t.personalization||(i=parseInt(t.personalization),isNaN(i)?"true"===t.personalization:i),collections=!t.collections||(i=parseInt(t.collections),isNaN(i)?"true"===t.collections:i),__staticVersion=t.staticversion?parseInt(t.staticversion):!t.intern&&(new Date).getTime()%1e3,t.lessonhash&&(__lessonhash=t.lessonhash),t.lessonid&&(__lessonid=parseInt(t.lessonid)),t.lessonaid&&(__lessonaid="null"==t.lessonaid||"0"==t.lessonaid?null:t.lessonaid),t.assignmenttype&&(__assignmentType=t.assignmenttype),t.lessonpid&&(__lessonpid=t.lessonpid),t.lessonuuid&&(__lessonuuid=t.lessonuuid),t.lessonrid&&(__lessonrid=t.lessonrid),t.failload&&(__failLoad=parseInt(t.failload),__loadIndex=1),__retryStaticLoads="true"==t.retrystaticrequests,__retryServerRequests="true"==t.retryserverrequests,t.webfonts&&"false"==t.webfonts&&(__webFonts=!1),IE?(__useAudio=1,__suppressIESFX=isIntermediate()):__useAudio=2,-1!=navigator.userAgent.indexOf("Chrome/67")&&(__useAudio=1),t.audio&&("none"==t.audio?__useAudio=0:"html"==t.audio?__useAudio=1:"web"==t.audio?__useAudio=2:DBLLog.log("Invalid parameter "+t.audio,DBLLog.ERROR)),"stopped"==t.time&&(__noTime=!0,dreamboxStartTime=0),"true"==t.flash&&(__flash=!0),"false"==t.shellauto&&(__shellAuto=!1),minspec=!1;var i,n=t.device,e=(n&&0==n.indexOf("iPad")&&(minspec=!0),"true"==t.minspec?minspec=!0:"false"==t.minspec&&(minspec=!1),minspec&&(dblDevicePixelRatio=1,standardScale=dblDevicePixelRatio*(webview?1:2)),__clearingReloads=!0===rootParams.clearingreloads||appVersion&&"browser"!=appVersion,minspec&&isIntermediate()&&!__clearingReloads&&(__suppressIESFX=!0),"true"==t.retina?(dblDevicePixelRatio=2,standardScale=dblDevicePixelRatio*(webview?1:2)):"false"==t.retina&&(dblDevicePixelRatio=1,standardScale=dblDevicePixelRatio*(webview?1:2)),__asDataVersion=3.06,t.asdata&&(__asDataVersion=parseFloat(t.asdata)),__logDataVersion=1.2,t.logdata&&(__logDataVersion=parseFloat(t.logdata)),__earlyFly=!0,"false"==t.earlyfly&&(__earlyFly=!1),t.resume&&(__resumeFile=t.resume),t.run&&(__runFile=t.run),t.bookmark&&(__bookmark=decodeURIComponent(t.bookmark)),t.replay&&(replayMode="false"!==t.replay,"true"!==t.replay&&"false"!==t.replay&&("json"==(i=(e=t.replay.split(".")).pop())?__transcriptFile=e.join("."):__runFile="run"==i?e.join("."):t.replay),replayMode)&&(__sessionProperties=__replayTranscript?JSON.parse(JSON.stringify(__replayTranscript.setupData.sessionProperties||{})):{},__noTime=!0),t.suite&&(__suiteFile=t.suite),t.screener&&(__screenFile=t.screener),t.state&&(__stateFile=t.state),t.api&&(api=parseFloat(t.api)),assert(2<=api,"api"),t.autosave&&(__autoSave="true"==t.autosave),"false"==t.cc&&(__ccEnabled=!1),__lessonFeedbackRandom="true"===t.lessonfeedbackrandom,__lessonFeedbackOptIn="true"===t.lessonfeedbackoptin,__gatesPreviewEnabled="paperfrenzy"===engagement&&"true"===t.gatespreview,__gatesBannersEnabled="paperfrenzy"===engagement&&"true"===t.gatesbanners,__gatesSurvey="paperfrenzy"===engagement&&t.gatessurvey||"",t.avatar&&(__user._avatar_="default"==t.avatar||"undefined"==t.avatar?void 0:t.avatar),"squiggly"==engagement&&(__user._avatar_=""),t.username&&(__user._name_=t.username),t.data&&(__user._data_=parseInt(t.data)),t.theme&&(theme=t.theme),t.story&&(story=parseInt(t.story)),t.area&&(area=parseInt(t.area)),t.goal&&(goal=parseInt(t.goal)),t.seeds&&(__startingSeeds=JSON.parse(t.seeds)),__messaging=!t.messaging||"true"==t.messaging,__application==APPID_EARLY_LITERACY&&(__messaging=!1),__sendMessages=!t.sendmessages||"true"==t.sendmessages,__sendFeedback=!t.sendfeedback||"true"==t.sendfeedback,__clientEvents=!!t.clientevents&&"true"==t.clientevents,__qosEvents=!!t.qosevents&&"true"===t.qosevents,__qosKeysTitration=t.qoskeystitration?JSON.parse(t.qoskeystitration):null,t.exp&&(__exp=t.exp.toString().split(" ")),processAssessmentType(t),t.multipleLanguages&&(__runningMultipleLanguages="true"==t.multipleLanguages)&&(t.lcid=Lcid.USEnglish,lcid=Lcid.USEnglish,language=Lcid.getSystemLanguage()),t.ignorePlayMismatches&&(__ignorePlayMismatches="true"==t.ignorePlayMismatches),webview=iOS&&-1==navigator.userAgent.indexOf("Safari"),"true"==t.webview?webview=!0:"false"==t.webview&&(webview=!1),webview&&((n=document.getElementById("jscontent"))&&(n.style.height="768px"),i=document.getElementById("copyright"))&&n&&(debug?i.style.visibility="hidden":n.removeChild(i)),__passwordResume=webview,"true"==t.passwordresume?__passwordResume=!0:"false"==t.passwordresume&&(__passwordResume=!1),__requestLessonRating=0,t.rating&&(__requestLessonRating=parseInt(t.rating)),__requestEnjoymentRating=0,t.altrating&&(__requestEnjoymentRating=parseInt(t.altrating)),!1),l=(!(standalone="run.html"==document.location.pathname.substr(-8)||"replay.html"==document.location.pathname.substr(-11)||"debug.html"==document.location.pathname.substr(-10)||"true"==t.intern)&&webview?(logLevel=debug?DBLLog.INFO:DBLLog.OFF,alertLevel=DBLLog.FATAL,serverURL=document.location.protocol+"//"+document.location.host+"/",authSession&&(serverURL=document.location.protocol+"//"+(rootParams.playservice||document.location.host)+"/"),debug||(window.onerror=globalErrorHandler),(e=1024<Math.max(window.screen.width,window.screen.height))&&onWindowResizeDebug()):standalone||webview?replayMode?(isIntermediate()&&setSessionProperty("Session.currentLessonInfo",{assignmentType:null,iconURL:null,name:null}),debug||(window.onerror=globalErrorHandler)):standalone&&(__lessonsCompletedThisWeek=0,__prevWeeksInStreak=0,__initialWeeklyTime=0,(t.lesson||t.screen||t.run||t.replay)&&(setupEngagementTestDefaults(),isIntermediate())&&setSessionProperty("Session.currentLessonInfo",{assignmentType:null,iconURL:null,name:null}),__stateFile=__stateFile||"runtime.DefaultState",debug&&!t.intern||(window.onerror=globalErrorHandler)):(logLevel=debug?DBLLog.INFO:DBLLog.OFF,alertLevel=DBLLog.FATAL,serverURL=document.location.protocol+"//"+document.location.host+"/",authSession&&(serverURL=document.location.protocol+"//"+(rootParams.playservice||document.location.host)+"/"),debug||(window.onerror=globalErrorHandler),1==audienceType&&(theme=theme||("squiggly"==engagement?"park":"pirates"),story=story||1),onWindowResizedJS(),l=document.getElementById("lrt4LessonCanvas"),resize(parseInt(l.style.width)/1024)),serverReportLevel=DBLLog.ERROR,useWebGL=__application==APPID_MATH,"false"==t.webgl&&(useWebGL=!1),"object"==typeof window.DBLDebugPanel&&window.DBLDebugPanel.init(),"true"==t.resizeable?(window.onresize=onWindowResizeDebug)():(webview&&!e||standalone)&&2==dblDevicePixelRatio&&(l=document.getElementById("lrt4LessonCanvas"),n=document.getElementById("lrt4EngagementCanvas"),i=document.getElementById("lrt4SpriteCanvas")||l,e=document.getElementById("lrt4BackgroundCanvas")||l,2048!=l.width)&&(l.width=2048,l.height=1536,i.width=2048,i.height=1536,n.width=2048,n.height=1536,e.width=2048,e.height=1536),__noLessonStalls=isPrimary()||isIntermediate(),"audible"==t.stall?__noLessonStalls=!1:"none"==t.stall?__noLessonStalls=!0:"fast"==t.stall&&(__noLessonStalls=!1,__fastStalls=!0),t.iOS&&(iOS=t.iOS),__nanogamedoor=t.nanogamedoor,__nanogameselection=t.nanogameselection,__donefn=null,!t.engagement&&!__runLogin);localStorageAvailable()&&__studentId&&!__exitBroadcast&&(window.addEventListener("storage",function(e){"message"==e.key&&e.newValue&&"exit"==(e=e.newValue.split(":"))[0]&&e[1]!=dreamboxStartTime.toString()&&sessionSuperseded(e[2]==__studentId)}),localStorage.setItem("message","exit:"+dreamboxStartTime+":"+__studentId),localStorage.removeItem("message"),__exitBroadcast=!0),(t.clearingscreen||t.clearinglessonid||t.clearinglessonfqn)&&(__runClientStart=!0),!serverURL||__runClientStart||l?("true"==t.usetestcsvdata&&(__useTestCsvData=!0),"true"==t.domTestHooks&&(__domTestHooks=!0,(i=document.createElement("div")).setAttribute("id",DOM_TEST_DIV),document.getElementById("htmlcontent").appendChild(i),(n=document.createElement("div")).setAttribute("id",PERM_TEST_DIV),document.getElementById(DOM_TEST_DIV).appendChild(n),(e=document.createElement("div")).setAttribute("id",TEMP_TEST_DIV),document.getElementById(DOM_TEST_DIV).appendChild(e)),__bookmark?runLessonFromRun():t.clearingscreen?(reifySessionState(),clearingRunScreen(t.clearingscreen,t.clearingscreenparams)):t.clearinglessonid?(reifySessionState(),clearingRunLesson({lessonId:parseInt(t.clearinglessonid),assignmentType:t.clearingassignmenttype,assignmentId:parseInt(t.clearingassignmentid),fqln:t.clearinglessonfqn,recommendationUuid:t.clearinglessonrid})):(t.clearinglessonfqn,t.lesson?(isVisualCheckSave()&&(fastForwarding=!0,runningUnattended=!0),runLesson(t.lesson)):t.screen?runScreen(t.screen,t.screenparams):t.run||__runFile||__transcriptFile?runLessonFromRun():t.suite?runSuite():t.screener?runScreener():t.background?runBackground(t.background):t.progressmeter?runProgressMeter(t.progressmeter):t.popin?runPopIn(t.popin):t.video?runVideo(t.video):t.icon?runIcon(t.icon):("true"==t.intern?runIntern:(l&&(__runLogin=!0),runLoginOrEngagement))())):doClientStart()}function doClientStart(){var o=new XMLHttpRequest,e=(o.open("POST",serverURL+"public/v1/users/"+__studentId+"/clientStart",!0),o.setRequestHeader("Content-type","application/json"),o.setRequestHeader("DBL-AuthSessionUuid",authSession),clientInstance&&o.setRequestHeader("DBL-ClientInstanceUuid",clientInstance),o.setRequestHeader("DBL-ClientRequestUuid",uuidv4()),{provideAdditionalStudentMetrics:isIntermediate()});o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status){var e;try{e=JSON.parse(o.response)}catch(e){throw dblRecordError(e),e}var n=function(e){return null!=e};__lessonsCompletedThisWeek=e.lessonsCompletedThisWeek,__prevWeeksInStreak=n(e.currentWeekStreak)?e.currentWeekStreak:-1,__initialWeeklyTime=n(e.currentWeekSessionTimeMillis)?e.currentWeekSessionTimeMillis:-1,__avatarPricing=e.avatarPricing,__wallpaperPricing=e.wallpaperPricing,__musicPricing=e.musicPricing,__ttsCacheBase=e.ttsCacheBase,processAssessmentType(e),__screenReaderEnabled=!!e.muteDblAudio,screenerHelpMe=!!screenerMode&&!(!e.clientEnvironment||!e.clientEnvironment.showLaunchpadHelpMe),n(e.lessonsCompletedThisSchoolYear)&&(__lessonsCompletedThisYear=e.lessonsCompletedThisSchoolYear),n(e.bestWeekStreakThisSchoolYear)&&(__longestStreakThisYear=e.bestWeekStreakThisSchoolYear),n(e.sessionTimeMillisThisSchoolYear)&&(__initialYearlyTime=e.sessionTimeMillisThisSchoolYear),__runClientStart=!0,run(__originalUrl)}else(429==o.status||500<=o.status?retryClientStart:exitOnClientStartFailure)(o)},o.onerror=function(){(429==o.status||500<=o.status?retryClientStart:exitOnClientStartFailure)(o)},o.send(JSON.stringify(e))}function retryClientStart(e){var n;3<=__clientStartRetries?exitOnClientStartFailure(e):(n=500*++__clientStartRetries,setTimeout(function(){DBLLog.log("public/v1/users/USERID/clientStart was unreachable: "+e.status+". Retrying in "+n+"ms",DBLLog.WARN),doClientStart()},n))}function exitOnClientStartFailure(e){__fatalErrorReached=30001,DBLLog.log("public/v1/users/USERID/clientStart was unreachable: "+e.status,DBLLog.FATAL,__fatalErrorReached),closeWindowFatalError(__fatalErrorReached,0)}function runningScreenDirectly(){return rootParams.screen||rootParams.video||rootParams.icon}function runningLessonDirectly(){return rootParams.lesson||rootParams.run||rootParams.suite||rootParams.replay||rootParams.background||rootParams.progressmeter||rootParams.popin}function runningViaClearingReload(){return rootParams.clearingscreen||rootParams.clearinglessonid||rootParams.clearinglessonfqn}function getQueryParams(e){e=(e||"").split("+").join(" ");for(var n,o={},t=/[?&]?([^=]+)=([^&]*)/g;n=t.exec(e);)o[decodeURIComponent(n[1])]=decodeURIComponent(n[2]);return o}function logLevelFromString(e){switch(e){case"off":return DBLLog.OFF;case"fatal":return DBLLog.FATAL;case"error":return DBLLog.ERROR;case"warn":return DBLLog.WARN;case"info":return DBLLog.INFO;case"debug":return DBLLog.DEBUG;default:return DBLLog.log("Invalid parameter "+e,DBLLog.ERROR),DBLLog.OFF}}function isParamNumber(e){for(var n=0,o=0;o<e.length;o++){var t=e.charCodeAt(o)>="0".charCodeAt(0)&&e.charCodeAt(o)<="9".charCodeAt(0),a="."==e.substr(o,1);if(!t&&!a)return!1;if(a&&0<n)return!1;a&&n++}return!0}function runSuite(){lessonfqn=null,loadCreateJS()}function runScreener(){lessonfqn=null,loadCreateJS()}function runLessonFromRun(){lessonfqn=null,loadCreateJS()}function runIntern(){lessonfqn=null}function runScreen(e,n){screenfqn=e,__runScreenParams=n=void 0===n?null:n,loadCreateJS()}function clearingRunScreen(e,n){screenfqn=e,__runScreenParams=n,loadCreateJS()}function runLoginOrEngagement(){lessonfqn=null,screenfqn=null,loadCreateJS()}function runLesson(e){lessonfqn=e,loadCreateJS()}function adjustLessonFqn(n){return n&&null!=__unifiedLessons&&__unifiedLessons.some(function(e){return n.startsWith(e)})?"".concat(n,".json"):n}function clearingRunLesson(e){__clearingLessonInfo=e,loadCreateJS()}function loadCreateJS(){var e,n;"object"==typeof createjs?loadContentAreas():(DBLLog.log("Loading createjs",DBLLog.INFO),e=rootURL+(debug?CREATEJS_URL:CREATEJS_MIN_URL)+getLoadSuffix(),n=document.createElement("script"),document.body.appendChild(n),n.onload=onCreateJSLoaded,n.onerror=function(){DBLLog.log("Failed to load createjs - aborting.",DBLLog.FATAL,30001)},n.src=e)}function onCreateJSLoaded(){resetLaunchLoader(),createjs.Sound.registerPlugins([2==__useAudio?createjs.WebAudioPlugin:createjs.HTMLAudioPlugin]),createjs.MotionGuidePlugin.install(createjs.Tween),loadContentAreas()}function loadContentAreas(){var e,n;__contentAreas?onContentAreasLoaded():(e=rootURL+"runtime/ContentAreas.json"+getLoadSuffix(),n=rootURL+"runtime/UnifiedLessons.json"+getLoadSuffix(),DBLLog.log("Loading "+e,DBLLog.INFO),__launchLoader.loadFile({src:e,id:"runtime.ContentAreas",loadTimeout:DEFAULT_LOAD_TIMEOUT},!1),__launchLoader.loadFile({src:n,id:"runtime.UnifiedLessons",loadTimeout:DEFAULT_LOAD_TIMEOUT},!1),setupLoader(__launchLoader,onContentAreasLoaded),__launchLoader.load())}function onContentAreasLoaded(){__contentAreas||(__contentAreas=__launchLoader.getResult("runtime.ContentAreas"),__rootHash=rootHashFromStaticMap(rootParams.staticmap)),__unifiedLessons=__unifiedLessons||__launchLoader.getResult("runtime.UnifiedLessons"),resetLaunchLoader();var e="runtime.accessibility.accessibility",n=debug?".js":".min.js";DBLLog.log("Loading ".concat(fileFromFQN(e,n)),DBLLog.INFO),__launchLoader.loadFile({src:fileFromFQN(e,n),id:"runtime.accessibility",loadTimeout:DEFAULT_LOAD_TIMEOUT},!1),setupLoader(__launchLoader,onAccessibilityLoaded),__launchLoader.load()}function onAccessibilityLoaded(){resetLaunchLoader(),createStages();var n=["HTML","BODY","MAIN"];window.addEventListener("keydown",function(e){"Space"===e.code&&-1!==n.indexOf(e.target.tagName.toUpperCase())&&e.preventDefault()})}function appEnteringBackground(){__appInBackground=!0,shell&&__shellSetup&&shell.showPausePopupDueToLossOfFocus(),localStorageAvailable()&&localStorage.setItem("__appInBackground","true")}function appEnteringForeground(){__appInBackground=!1,localStorageAvailable()&&localStorage.setItem("__appInBackground","false")}function createLoader(e){var n=new createjs.LoadQueue(!debug);return n.setMaxConnections(PARALLEL_THREADS_COUNT),e&&n.installPlugin(createjs.Sound),n}function cleanupLoader(e){e&&(e.removeAllEventListeners(),e.close())}function setupLoader(t,o){var a=[],s=0;function r(){for(var e=0;e<a.length;e++){var n=a[e],o={src:n.src,id:n.id,loadTimeout:DEFAULT_LOAD_TIMEOUT,type:n.type};t.reloadFile(n,o,!1),DBLLog.log("Failed to load an essential static asset "+n.src+" - retry "+s,DBLLog.INFO)}a=[],t.load()}t.on("error",function(e){a.push(e.data)}),t.on("complete",function(e){if(a.length)if(++s<=(__retryStaticLoads?3:0))setTimeout(r,1e3*s*s);else{try{t.close()}catch(e){console.error(e)}var n=a.map(function(e){return e.src});DBLLog.log("Failed to load essential static asset ("+n+") - aborting.",DBLLog.FATAL,30001)}else o(e)})}function resetLaunchLoader(){cleanupLoader(__launchLoader),(__launchLoader=createLoader(!1)).addEventListener("fileload",onPotentialAnimateFileLoad)}function onStaticLoadFailed(e,n){++__retryStaticLoadCount<=(__retryStaticLoads?3:0)?setTimeout(function(){DBLLog.log("Failed to load an essential static asset "+e.data.src+" - retry "+__retryStaticLoadCount,DBLLog.INFO),e.target.reloadFile(e.data,{src:e.data.src,id:e.data.id,loadTimeout:DEFAULT_LOAD_TIMEOUT,type:e.data.type},!1),e.target.load()},1e3*__retryStaticLoadCount*__retryStaticLoadCount):DBLLog.log("Failed to load an essential static asset "+e.data.src+" - aborting.",null!=n?n:DBLLog.FATAL,30001)}function resetStaticLoadCount(){__retryStaticLoadCount=0}function mouseInside(e,n){if(n){e=n.globalToLocal(e.stageX/dblDevicePixelRatio,e.stageY/dblDevicePixelRatio),n=n.getBounds();if(n&&n.contains(e.x,e.y))return!0}return!1}function shouldBlur(e){return!(__keyPadController&&!__keyPadController.shouldBlur(e)||(IE&&document.focus(),mouseInside(e,window.DBLTextInputFocusManager?DBLTextInputFocusManager.getTextInputWithFocus():null))||shell&&shell.hitTestRestoreKeyboardButton(e.stageX,e.stageY))}function createStages(){var n,e,o,t;"object"!=typeof lessonStage&&(DBLLog.log("Creating stages",DBLLog.INFO),lessonStage=new createjs.Stage("lrt4LessonCanvas"),e=null!=document.getElementById("lrt4BackgroundCanvas"),(backgroundStage=e?new createjs.Stage("lrt4BackgroundCanvas"):lessonStage)!=lessonStage&&(lessonStage.nextStage=backgroundStage),(engagementStage=new createjs.Stage("lrt4EngagementCanvas")).nextStage=lessonStage,e=document.getElementById("lrt4SpriteCanvas"),useWebGL?(e&&(e.style.display="block"),DBLLog.log("Creating sprite stage",DBLLog.INFO),spriteStage=new createjs.StageGL("lrt4SpriteCanvas",{antialias:!0,transparent:!0,depth:!0,preserveBuffer:!0}),lessonStage.nextStage=spriteStage,backgroundStage!=lessonStage&&(spriteStage.nextStage=backgroundStage),spriteStage.setClearColor("#00000000"),spriteStage.updateViewport(1024,768)):e&&(e.style.display="none"),!runningViaClearingReload()&&createjs.Touch.isSupported()&&(n=engagementStage.addEventListener("stagemousedown",function(e){e.isTouch&&window.DBLQOSEventManager&&(engagementStage.removeEventListener("stagemousedown",n),DBLQOSEventManager.recordEvent(DBLQOSEventManager.Key.SessionTouchUsed,1))})),2==dblDevicePixelRatio&&(backgroundStage.scaleX=2,backgroundStage.scaleY=2,lessonStage.scaleX=2,lessonStage.scaleY=2,engagementStage.scaleX=2,engagementStage.scaleY=2),backgroundStage.tickOnUpdate=!1,lessonStage.tickOnUpdate=!1,engagementStage.tickOnUpdate=!1,e=backgroundStage.canvas,o=lessonStage.canvas,t=engagementStage.canvas,backgroundStage.setBounds(0,0,e.width/dblDevicePixelRatio,e.height/dblDevicePixelRatio),lessonStage.setBounds(0,0,o.width/dblDevicePixelRatio,o.height/dblDevicePixelRatio),engagementStage.setBounds(0,0,t.width/dblDevicePixelRatio,t.height/dblDevicePixelRatio),iOS||android||1==rootParams.mobile||1==rootParams.webview||(engagementStage.enableMouseOver(10),lessonStage.enableMouseOver(10),spriteStage&&spriteStage.enableMouseOver(10)),engagementStage.addEventListener("stagemousedown",function(e){window.DBLActivityMonitor&&DBLActivityMonitor.userActive(),__mouseDown=!0,shouldBlur(e)&&doBlur(e)}),engagementStage.addEventListener("stagemousemove",function(e){window.DBLActivityMonitor&&__mouseDown&&DBLActivityMonitor.userActive()}),engagementStage.addEventListener("stagemouseup",function(e){window.DBLActivityMonitor&&DBLActivityMonitor.userActive(),__mouseDown=!1}),document.getElementById("htmlcontent").addEventListener("keypress",function(e){window.DBLActivityMonitor&&DBLActivityMonitor.userActive()}),createjs.Ticker.addEventListener("tick",tick),createjs.Ticker.timingMode=createjs.Ticker.RAF,createjs.Ticker.framerate=60,createjs.Touch.isSupported()&&(createjs.Touch.enable(lessonStage,!0),createjs.Touch.enable(engagementStage,!0),spriteStage)&&createjs.Touch.enable(spriteStage,!0),(lessonContent=new createjs.Container).name="lessonContent",lessonContent.setBounds(0,0,1024,768),lessonStage.addChild(lessonContent),lessonContent.scaleX=__initialScale,lessonContent.scaleY=__initialScale,lessonContent.x=Math.floor(lessonStage.canvas.width/dblDevicePixelRatio/2-1024*lessonContent.scaleX/2),(engagementContent=new createjs.Container).name="engagementContent",engagementContent.setBounds(0,0,1024,768),engagementStage.addChild(engagementContent),engagementContent.scaleX=__initialScale,engagementContent.scaleY=__initialScale,(a11yContent=new createjs.Container).name="a11yContent",a11yContent.setBounds(0,0,1024,768),engagementStage.addChild(a11yContent),a11yContent.scaleX=__initialScale,a11yContent.scaleY=__initialScale,spriteStage&&(spriteContent=new createjs.Container,spriteStage.addChild(spriteContent),spriteContent.y=(shell?shell.getHeaderHeight():0)*lessonContent.scaleX),setupHTMLEvents(),setupAccessibility()),useWebGL&&DBLLog.log("WebGL enabled with webgl=true",DBLLog.INFO),spriteStage&&DBLLog.log("WebGL is"+(spriteStage.isWebGL?" ":" NOT ")+"supported",DBLLog.INFO),(__runLogin?doneAnyTestLoading:doAnyTestLoading)()}function doneAnyTestLoading(){loadCorePieces()}function getOrCreateA11yDiv(){var e,n=document.getElementById("a11ycontent");return n||((n=(e=document.getElementById("htmlcontent")).cloneNode(!1)).setAttribute("id","a11ycontent"),n.style.opacity="0",document.getElementById("jscontent").insertBefore(n,e)),n}function createA11yAlert(){var e,n=document.getElementById("a11yAlert");n||((n=(e=document.getElementById("a11ycontent")).cloneNode(!1)).setAttribute("id","a11yAlert"),n.setAttribute("tabindex","-1"),n.setAttribute("aria-hidden","false"),n.setAttribute("aria-disabled","false"),n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic","true"),n.setAttribute("role","alert"),n.style.opacity="0",document.getElementById("jscontent").insertBefore(n,e))}function updateA11yDiv(){var e=getOrCreateA11yDiv(),n=(createA11yAlert(),document.getElementById("htmlcontent"));return e&&n&&(e.style.width=n.style.width,e.style.height=n.style.height,e.style.left=n.style.left,e.style.top=n.style.top),e}function setupAccessibility(){var e;AccessibilityModule&&(e=updateA11yDiv(),AccessibilityModule.setupStage(lessonStage,e,function(){}))}function loadCorePieces(){var e;window.DBLActivityMonitor?onCorePiecesLoaded(null,!0):(e=rootURL+"runtime/greensock/TweenMax.min.js"+getLoadSuffix(),__launchLoader.loadFile({src:e,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1),DBLLog.log("Loading "+e,DBLLog.INFO),e=rootURL+"runtime/core/core.js"+getLoadSuffix(),__launchLoader.loadFile({src:e,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1),DBLLog.log("Loading "+e,DBLLog.INFO),e=rootURL+"runtime/ExtraLoadDependencies.csv"+getLoadSuffix(),DBLLog.log("Loading "+e,DBLLog.INFO),__launchLoader.loadFile({src:e,id:"runtime.ExtraLoadDependencies",loadTimeout:DEFAULT_LOAD_TIMEOUT},!1),e=rootURL+"library/manipulativecore/manipulativecore.js"+getLoadSuffix(),DBLLog.log("Loading "+e,DBLLog.INFO),__launchLoader.loadFile({src:e,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1),__domTestHooks&&(e=rootURL+"library/testutil/testutil.js"+getLoadSuffix(),DBLLog.log("Loading "+e,DBLLog.INFO),__launchLoader.loadFile({src:e,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1)),replayMode||(e=rootURL+"runtime/LoadingSpinner.js"+getLoadSuffix(),DBLLog.log("Loading "+e,DBLLog.INFO),__launchLoader.loadFile({src:e,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1)),setupLoader(__launchLoader,onCorePiecesLoaded),__launchLoader.load())}function completeCSVLoad(e){__launchLoader.getResult(e)&&(window[e.split(".").join("_")]=DBLCSVUtils.createIndexedCSVStructure(__launchLoader.getResult(e),e))}function onCorePiecesLoaded(e,n){void 0===n&&(n=!1),completeCSVLoad("runtime.ExtraLoadDependencies"),resetLaunchLoader(),__extraLoadDependencies={},Object.assign(__extraLoadDependencies,window.runtime_ExtraLoadDependencies),__lessonLoadDependencies={},shell||intern||standalone||rootParams.resizeable||webview||(__spinner||(__spinner=new DBLLoadingSpinner,engagementStage.addChild(__spinner)),__spinner.show()),DBLError.init(),__initialStateManagerSequenceCache&&DBLStateManager.setSequenceCache(__initialStateManagerSequenceCache),__initialStateManagerSequenceNumber=null,__initialStateManagerSequenceCache=null,__initialLessonManagerSequenceNumber=null,__initialClientEventManagerEvents&&DBLClientEventManager.setUnsentEvents(__initialClientEventManagerEvents),__initialClientEventManagerEvents=null,__initialQosEventKeysDisabled&&DBLQOSEventManager.setDisabledKeys(__initialQosEventKeysDisabled),__initialQosEventKeysDisabled=null,n||runningViaClearingReload()||(DBLQOSEventManager.recordEvent(DBLQOSEventManager.Key.SessionStaticVersion,DBLError.getStaticVersion(),"startup"),DBLQOSEventManager.recordEvent(DBLQOSEventManager.Key.SessionTouchEnabled,createjs.Touch.isSupported(),"startup")),startLoadingModulesWithRequires()}function startLoadingModulesWithRequires(){(__launchLoaderAudio=createLoader(!0)).addEventListener("error",function(e){"PRELOAD_MANIFEST_EMPTY"!=e.title&&logAudioErrorOnce()}),__waitingToLoadEventAudio=!1,__audioToLoad=[],__fontsToLoad=[],mappings=[],(__runLogin?loadLogin:loadShell)()}function logAudioErrorOnce(){__audioLoadLogged||(DBLLog.log("At least one audio load failed this session - handling gracefully",DBLLog.ERROR),__audioLoadLogged=!0)}function loadShellOrLoginMappings(e,n){__mappingfqns=e.getMappings();for(var o=0;o<__mappingfqns.length;o++)loadMappingItem(__mappingfqns[o]);setupLoader(__launchLoader,n),__launchLoader.load()}function populateMappingsFromMappingFQNS(){for(var e=0;e<__mappingfqns.length;e++){var n=objectFromFQN(__mappingfqns[e],".csv");n&&(n.mappingfqn=__mappingfqns[e],mappings.push(n))}}function loadLogin(){__haltA11y||a11y.setupAccessibility(),setupLoader(__launchLoader,onLoginLoaded);var e="engagement.login.Login",n=fileFromFQN(e);DBLLog.log("Loading "+n,DBLLog.INFO),logAutomation('new screen "'+e+'", 0, 0'),__launchLoader.loadFile({src:n,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1),__launchLoader.load(),window.recordRecoveryInfo&&window.recordRecoveryInfo("studentid=&screen=engagement.login.Login")}function onLoginLoaded(){(__fatalErrorReached?immediateExit:(resetLaunchLoader(),__loadingFontsForLogin=!0,loadFonts))()}function createLogin(){DBLLog.log("Creating login",DBLLog.INFO),loadShellOrLoginMappings(__login=new window.engagement_login.Login,onLoginMappingsLoaded)}function onLoginMappingsLoaded(){completeMappingLoad(),populateMappingsFromMappingFQNS(),__login&&__login.load(onLoginReady)}function onLoginReady(){DBLLog.log("login ready()",DBLLog.INFO),DBLTextInputFocusManager.init(),DBLAutomation.init(),screenfqn="engagement.login.Login",screencur=__login,lessonContent.addChild(__login),__login.ready(),updateCopyrightDebugString(),DBLLog.log("Running login...",DBLLog.INFO),__login.run(loginComplete),manualInvalidate(__login),thawContent(),tick();var e=document.getElementById("loading");if(e&&e.remove(),webview&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.observe)try{window.webkit.messageHandlers.observe.postMessage("dropLoading")}catch(e){}DBLQOSEventManager.recordEvent(DBLQOSEventManager.Key.SessionLoginReadyLoadDuration,getTime()-dreamboxStartTime)}function loginComplete(e){DBLLog.log("Login complete",DBLLog.INFO),window.setAbnormalToken&&setAbnormalToken(!0),__login.showScrim(),tick(),freezeContent(),lessonContent.removeChild(__login),__login.cleanup(),__login=null,(__spinner=new DBLLoadingSpinner).show(),engagementStage.addChild(__spinner),run(e,!(__contentAreas=null))}function loadShell(){var e,n;shell?(mappings=__shellMappings.concat(),onShellReady()):(e=isPrimary()?"engagement.primary.shell.Shell":isIntermediate()?"engagement.intermediate.shell.Shell":isSquiggly()?"engagement.squiggly.shell.Shell":null)||"none"==engagement?e&&!objectFromFQN(e)?(addExtraLoadDependenciesRec(e),n=fileFromFQN(e),DBLLog.log("Loading "+n,DBLLog.INFO),__launchLoader.loadFile({src:n,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1),setupLoader(__launchLoader,onShellLoaded),__launchLoader.load()):onShellLoaded():(DBLLog.log("Invalid engagement "+engagement,DBLLog.ERROR),e=null)}function onShellLoaded(){(__fatalErrorReached?immediateExit:(resetLaunchLoader(),__loadingFontsForShell=!0,loadFonts))()}function createShell(){isPrimary()?(DBLLog.log("Creating "+engagement+" engagement",DBLLog.INFO),loadShellOrLoginMappings(shell=new window.engagement_primary_shell.Shell,onShellMappingsLoaded)):isSquiggly()?(DBLLog.log("Creating "+engagement+" engagement",DBLLog.INFO),loadShellOrLoginMappings(shell=new window.engagement_squiggly_shell.Shell,onShellMappingsLoaded)):isIntermediate()?(DBLLog.log("Creating "+engagement+" engagement",DBLLog.INFO),loadShellOrLoginMappings(shell=new window.engagement_intermediate_shell.Shell,onShellMappingsLoaded)):onShellReady()}function onShellMappingsLoaded(){completeMappingLoad(),resetLaunchLoader(),populateMappingsFromMappingFQNS(),__shellMappings=mappings.concat(),shell.load(onShellReady)}function onShellReady(){shell&&(lessonContent.y=shell.getHeaderHeight()*lessonContent.scaleX,a11yContent.y=engagementContent.y=lessonContent.y,shell&&(a11yContent.getAccessibilityDataHeader=shell.getAccessibilityDataHeader.bind(shell),a11yContent.getAccessibilityDataFooter=shell.getAccessibilityDataFooter.bind(shell)),engagementStage.addChild(a11yContent)),runningScreenDirectly()||runningLessonDirectly()||runningViaClearingReload()||!shell||intern||lessonfqn||(screenfqn=shell.getInitialScreen()),loadLessonOrScreen()}function loadLessonOrScreen(){lessonfqn||__clearingLessonInfo?(isScreenerLessonClearingReload()&&(shell&&(setupShell(),tick(),shell.showSpinner(!0)),dropClearingReload()),loadLessonSupport(lessonfqn||__clearingLessonInfo.fqln)):screenfqn&&loadScreen()}function loadScreen(){var e;DBLLog.log("Running "+screenfqn,DBLLog.INFO),__actualLog=[],__invalidInputsLog=[],resetVisualCheckParams(),logAutomation('new screen "'+screenfqn+(__runScreenParams?" "+__runScreenParams:"")+'", '+__startingSeeds[0]+", "+__startingSeeds[1]),window.recordRecoveryInfo&&window.recordRecoveryInfo("studentid="+__studentId+"&screen="+screenfqn),__launchLoaderAudio.removeAll(),__launchLoaderAudio.reset(),isModuleFQN(screenfqn)?setLessonPresentation("html"):setLessonPresentation("canvas"),objectFromFQN(screenfqn)?onScreenLoaded():(addExtraLoadDependenciesRec(screenfqn),e=fileFromFQN(screenfqn),DBLLog.log("Loading "+e,DBLLog.INFO),setupLoader(__launchLoader,onScreenLoaded),__launchLoader.loadFile({src:e,loadTimeout:DEFAULT_LOAD_TIMEOUT},!0))}function onScreenLoaded(){var e,n,o;__fatalErrorReached||(resetLaunchLoader(),e=classFromModuleFQN(screenfqn),__cHTMLScreensOutstanding=0,isModuleFQN(screenfqn)?(o=document.getElementById("lrt4LessonDiv"),(n=document.createElement("div")).id=e,n.style.visibility="hidden",n.style.position="absolute",n.style.top=shell.getHeaderHeight()+"px",o.appendChild(n),__cHTMLScreensOutstanding=1,createHTMLComponentFromRef(screenfqn,n.id)):(o=objectFromFQN(screenfqn)[e],(__screenNew=new o(__runScreenParams)).name=e.toLowerCase(),createScreenContinued()))}function DBLRegisterReactScreen(e,n){__screenNew=n,__cHTMLComponentsOutstanding=0,createScreenContinued()}function createScreenContinued(){__screenNew?loadMappings():DBLLog.log("Screen "+screenfqn+" corrupt.",DBLLog.FATAL,DBLError.LESSON_CORRUPT)}function loadLessonSupport(e){var n;window.DfhgSgh||(n=rootURL+"runtime/lesson/lesson.js"+getLoadSuffix(),DBLLog.log("Loading "+n,DBLLog.INFO),__launchLoader.loadFile({src:n,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1),replayMode)||(n=rootURL+"runtime/Lexicon.csv"+getLoadSuffix(),DBLLog.log("Loading "+n,DBLLog.INFO),__launchLoader.loadFile({src:n,id:"runtime.Lexicon",loadTimeout:DEFAULT_LOAD_TIMEOUT},!1)),screenerMode&&!isLoadedHintReference()&&(n=rootURL+"runtime/HintReference.csv"+getLoadSuffix(),DBLLog.log("Loading "+n,DBLLog.INFO),__launchLoader.loadFile({src:n,id:"runtime.HintReference",loadTimeout:DEFAULT_LOAD_TIMEOUT},!1)),screenerMode&&!isLoadedFixedFormSeeds()&&(n=rootURL+"runtime/FixedFormSeeds.csv"+getLoadSuffix(),DBLLog.log("Loading "+n,DBLLog.INFO),__launchLoader.loadFile({src:n,id:"runtime.FixedFormSeeds",loadTimeout:DEFAULT_LOAD_TIMEOUT},!1)),mayNeedTypeless(e)&&!window.lessons&&addExtraLoadDependenciesRec("lesson.support"),0<__launchLoader.getItems().length?(setupLoader(__launchLoader,onLessonSupportLoaded),__launchLoader.load()):onLessonSupportLoaded()}function isLoadedHintReference(){return!!window.runtime_HintReference}function isLoadedFixedFormSeeds(){return!!window.runtime_FixedFormSeeds}function mayNeedTypeless(e){e=repoFromFQN(e);return"dbl-content-early-literacy"!=e&&"dbl-content-math-1"!=e&&"dbl-content-math-2"!=e}function onLessonSupportLoaded(){var e;completeCSVLoad("runtime.Lexicon"),__lexicon={},Object.assign(__lexicon,window.runtime_Lexicon),screenerMode&&(completeCSVLoad("runtime.HintReference"),completeCSVLoad("runtime.FixedFormSeeds")),__clearingLessonInfo?(e=__clearingLessonInfo,__clearingLessonInfo=null,DBLLessonManager.startLesson(e,onLessonReady)):loadLesson()}function loadLesson(){var e;resetLaunchLoader(),__startingAS&&(__startingAS.v<3?6<=(e=__startingAS.ld).length&&(__startingSeeds=[parseInt(e[4]),parseInt(e[5])]):__startingSeeds=[__startingAS.ls[0].s1,__startingAS.ls[0].s2]),fixedForm&&((e=window.runtime_FixedFormSeeds)&&e[lessonfqn]?(__startingSeeds[0]=e[lessonfqn].seed1,__startingSeeds[1]=e[lessonfqn].seed2):(__startingSeeds[0]=11111,__startingSeeds[1]=11111)),__seedOverride&&(__startingSeeds=__seedOverride,__seedOverride=null),0==__startingSeeds.length&&(__startingSeeds[0]=Date.now()%1e5,__startingSeeds[1]=__startingSeeds[0]+100),DBLRandom.setSeedForGenerators(__startingSeeds[0]),DBLRandom.setSeedGeneralPurpose(__startingSeeds[1]),__timeDisplacement=0,lessonStartTime=__timeLastAutoSave=getTime(),DBLLog.log("Running "+lessonfqn+" with seeds "+__startingSeeds[0]+", "+__startingSeeds[1]+(__startingAS?" coming from Suspend/Resume AS data":""),DBLLog.INFO),window.recordRecoveryInfo&&window.recordRecoveryInfo("studentid="+__studentId+"&lesson="+lessonfqn),__actualLog=[],__invalidInputsLog=[],resetVisualCheckParams(),loadContentAreaExtraLoadDependencies()}function loadContentAreaExtraLoadDependencies(){assert(lessonfqn);var e,n,o,t=repoFromFQN(lessonfqn);null!=t&&(e=0,n=t+"_ExtraLoadDependencies",window[n]?Object.assign(__extraLoadDependencies,window[n]):(o=rootFromFQN(lessonfqn)+"ExtraLoadDependencies.csv"+getLoadSuffix(),DBLLog.log("Loading "+o,DBLLog.INFO),__launchLoader.loadFile({src:o,id:n,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1),e++),n=t+"_LessonLoadDependencies",mayNeedTypeless(lessonfqn)&&(window[n]?Object.assign(__lessonLoadDependencies,window[n]):(o=rootFromFQN(lessonfqn)+"LessonLoadDependencies.csv"+getLoadSuffix(),DBLLog.log("Loading "+o,DBLLog.INFO),__launchLoader.loadFile({src:o,id:n,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1),e++)),n=t+"_TestLessonLoadDependencies","dbl-content-early-literacy"==t&&(n=t+"_Lexicon",window[n]?Object.assign(__lexicon,window[n]):(o=rootFromFQN(lessonfqn)+"Lexicon.csv",DBLLog.log("Loading "+o,DBLLog.INFO),__launchLoader.loadFile({src:o,id:n,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1),e++)),0<e)?(setupLoader(__launchLoader,onAreaExtraLoadDependenciesLoaded),__launchLoader.load()):loadLessonProper()}function onAreaExtraLoadDependenciesLoaded(){var e=repoFromFQN(lessonfqn),n=e+"_ExtraLoadDependencies";__launchLoader.getResult(n)&&(window[n]=DBLCSVUtils.createIndexedCSVStructure(__launchLoader.getResult(n),n),Object.assign(__extraLoadDependencies,window[n])),n=e+"_LessonLoadDependencies",__launchLoader.getResult(n)&&(window[n]=DBLCSVUtils.createIndexedCSVStructure(__launchLoader.getResult(n),n),Object.assign(__lessonLoadDependencies,window[n])),n=e+"_Lexicon",__launchLoader.getResult(n)&&(window[n]=DBLCSVUtils.createIndexedCSVStructure(__launchLoader.getResult(n),n),Object.assign(__lexicon,window[n])),resetLaunchLoader(),loadLessonProper()}function setLessonPresentation(e){presentation=e;var n=document.getElementById("lrt4LessonCanvas"),o=document.getElementById("lrt4EngagementCanvas"),t=document.getElementById("lrt4LessonDiv");t||((t=document.createElement("div")).id="lrt4LessonDiv",t.style.position="absolute",t.style.transformOrigin="top left",t.style.top="0",t.style.left="0",t.style.width="1024px",t.style.height="768px",o.parentElement.insertBefore(t,o)),"html"!=e&&"mixed"!=e||(o.style.pointerEvents="none",__mousedownHandler=t.addEventListener("mousedown",chainingMouseDownHandler),__mousemoveHandler=t.addEventListener("mousemove",chainingMouseMoveHandler),__mouseupHandler=t.addEventListener("mouseup",chainingMouseUpHandler)),"html"==e&&(n.style.visibility="hidden"),"canvas"==e&&(o.style.pointerEvents="auto",n.style.visibility="visible",t.removeEventListener("mousedown",__mousedownHandler),t.removeEventListener("mouseover",__mousemoveHandler),t.removeEventListener("mouseup",__mouseupHandler),__mouseupHandler=__mousemoveHandler=__mousedownHandler=null)}function chainingMouseDownHandler(e){engagementStage._handlePointerDown(-1,e,e.pageX,e.pageY,null)}function chainingMouseMoveHandler(e){engagementStage._handlePointerMove(-1,e,e.pageX,e.pageY,null)}function chainingMouseUpHandler(e){engagementStage._handlePointerUp(-1,e,!1)}function loadLessonProper(){var e=adjustLessonFqn(lessonfqn);isAssetViewerLesson()||objectFromFQN(e)?onLessonLoaded():".json"==e.substr(-5)?loadJSONLesson(e):(setLessonPresentation("canvas"),mayNeedTypeless(e)&&addLessonLoadDependenciesRec(e),e=fileFromFQN(e),DBLLog.log("Loading "+e,DBLLog.INFO),setupLoader(__launchLoader,onLessonLoaded),__launchLoader.loadFile({src:e,loadTimeout:DEFAULT_LOAD_TIMEOUT},!0))}function getLessonProto(e){var n,e=e.split("."),o=e.join("_"),o=window[o];return o||(n=e.pop(),e=e.join("_"),window[e]&&window[e].hasOwnProperty(n)&&(o=window[e][n])),o}function loadJSONLesson(e){__importedLessons=[],lesson=void 0,runtime_lesson_data.loadLesson(e,function(e){setLessonPresentation((lesson=e).lessonData.presentation||"canvas"),loadMappings()})}function onLessonLoaded(){resetLaunchLoader();var e=getLessonProto(lessonfqn);e?(DBLSkippable.cleanup(),__pendingPause=!1,"function"==typeof(lesson=new e).__ready&&lesson.__ready(),loadBaseLessons()):DBLLog.log("Lesson "+lessonfqn+" could not be loaded - did it compile? Does it have the right fully-qualified lesson name?",DBLLog.FATAL,DBLError.LESSON_CORRUPT)}function loadBaseLessons(){__baseLessons=[];var e,n=lesson.__data.base;n?objectFromFQN(n)?onBaseLessonLoaded(n):(setupLoader(__launchLoader,function(){onBaseLessonLoaded(n)}),e=fileFromFQN(n),DBLLog.log("Loading "+e,DBLLog.INFO),__launchLoader.loadFile({src:e,loadTimeout:DEFAULT_LOAD_TIMEOUT})):onLessonChainLoaded()}function onBaseLessonLoaded(e){resetLaunchLoader();var n=new(getLessonProto(e));"function"==typeof n.__ready&&n.__ready(),0==__baseLessons.length?lesson.base=n:__baseLessons[__baseLessons.length-1].base=n,__baseLessons.push(n),(e=n.__data.base)?objectFromFQN(e)?onBaseLessonLoaded(e):(setupLoader(__launchLoader,function(){onBaseLessonLoaded(e)}),n=rootFromFQN(e)+e.split(".").join("/")+".js"+getLoadSuffix(),DBLLog.log("Loading "+n,DBLLog.INFO),__launchLoader.loadFile({src:n,loadTimeout:DEFAULT_LOAD_TIMEOUT},!0)):onLessonChainLoaded()}function onLessonChainLoaded(){resetLaunchLoader(),loadImportedLessons()}function loadImportedLessons(){__importedLessons=[];for(var e=lesson;e;e=e.base)if(e.__data.imports)for(var n=0;n<e.__data.imports.length;n++){var o,t=e.__data.imports[n];objectFromFQN(t)||(o=rootFromFQN(t)+t.split(".").join("/")+".js"+getLoadSuffix(),DBLLog.log("Loading "+o,DBLLog.INFO),__launchLoader.loadFile({src:o,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1),__importedLessons.push({lesson:e,fqn:t}))}0<__importedLessons.length?(setupLoader(__launchLoader,onImportedLessonsLoaded),__launchLoader.load()):onImportedLessonsLoaded()}function onImportedLessonsLoaded(){resetLaunchLoader(),loadMappings()}function loadMappings(){if(__mappingfqns=[],screenerMode&&__mappingfqns.push("assets.audio.lessons.math.shared.Screener"),__haltA11y||isSquiggly()||(__mappingfqns.push("assets.translations.lessons.math.screenreader.Translate"),__mappingfqns.push("assets.audio.lessons.math.shared.ScreenReader")),"primary"===engagement&&"intermediate"===getPreferredEngagement()&&__mappingfqns.push("assets.media.lessons.math.popups.Popups"),lesson)for(var e=lesson;e;e=e.base){var n=e.__data.mappings;if(n)for(var o=0;o<n.length;o++)__mappingfqns.push(n[o])}else __screenNew&&(__mappingfqns=__mappingfqns.concat(__screenNew.getMappings()));for(o=0;o<__mappingfqns.length;o++)loadMappingItem(__mappingfqns[o]);setupLoader(__launchLoader,onMappingsLoaded),__launchLoader.load()}function onMappingsLoaded(){completeMappingLoad(),resetLaunchLoader();for(var e=0;e<__mappingfqns.length;e++){var n=objectFromFQN(__mappingfqns[e],".csv");n&&(n.mappingfqn=__mappingfqns[e],mappings.push(n))}lesson?lesson.__data.video?(setupShell(),runVideoLesson(lesson.__data.video)):loadLessonDependencies():onLessonDependenciesLoaded()}function runVideoLesson(e){e=DBLProxy.getActualFromSignature(e),e=DBLProxy.getFQNFromActual(e);shell.runVideoLesson(e)}function getFqnId(e){return isModuleFQN(e)?moduleFromModuleFQN(e):e}function loadItem(e,n,o,t){var a=getFqnId(e);t=t||__launchLoader,objectFromFQN(e)||t.getItem(a)||(e=fileFromFQN(e,n),DBLLog.log("Loading "+e,DBLLog.INFO),n={src:e,id:a,loadTimeout:DEFAULT_LOAD_TIMEOUT},o&&(n.type=o),t.loadFile(n,!1))}function loadMappingItem(e){var n;objectFromFQN(e,".csv")||__launchLoader.getItem(e)||(n=fileFromFQN(e,".csv"),DBLLog.log("Loading "+n,DBLLog.INFO),__launchLoader.loadFile({src:n,id:e,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1))}function completeMappingLoad(){for(var e=0;e<__mappingfqns.length;e++){var n=__mappingfqns[e];objectFromFQN(n,".csv")||completeCSVLoad(n)}}function addLessonDependenciesRec(e){for(var n,o,t,a=e.__data.libraries||[],s=0;s<a.length;s++)DBLRuntime.requireLibrary(a[s]);var r=e.__data.components;for(s=0;s<r.length;s++)addExtraLoadDependenciesRec(t=r[s][1]),loadItem(t);var i,l=e.__data.bundles;if(l)for(s=0;s<l.length;s++)loadItem(t=l[s][1]);__chosenBackgroundURL||(isPrimary()?i=e.__data.primary_background:isSquiggly()?i=e.__data.squiggly_background:isIntermediate()&&(i=e.__data.intermediate_background),i&&((o=DBLProxy.getActualFromSignature(i))?(t=DBLProxy.getFQNFromActual(o),n=fileFromFQN(t,".png"),__chosenBackgroundURL=n,DBLLog.log("Loading "+n,DBLLog.INFO),__launchLoader.loadFile({src:n,crossOrigin:!0,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1)):DBLLog.log('Failed to find mapping for background "'+i+'"',DBLLog.ERROR))),__chosenProgress||!isPrimary()||screenerMode||(i=e.__data.progress_meter||e.__data.primary_progress_meter||e.__data.squiggly_progress_meter)&&((o=DBLProxy.getActualFromSignature(i))?(__chosenProgress=DBLProxy.getFQNFromActual(o),objectFromFQN(__chosenProgress)||(n=fileFromFQN(__chosenProgress),DBLLog.log("Loading "+n,DBLLog.INFO),__launchLoader.loadFile({src:n,id:__chosenProgress,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1))):DBLLog.log('Failed to find mapping for progress "'+i+'"',DBLLog.ERROR)),e.base&&addLessonDependenciesRec(e.base)}function addExtraLoadDependenciesRec(e){__extraLoadDependencies?loadDependenciesRec(e,__extraLoadDependencies):DBLLog.log("Missing load dependencies.",DBLLog.FATAL,DBLError.LESSON_CORRUPT)}function addLessonLoadDependenciesRec(e){__lessonLoadDependencies?loadDependenciesRec(e,__lessonLoadDependencies):DBLLog.log("Missing lesson load dependencies.",DBLLog.FATAL,DBLError.LESSON_CORRUPT)}function loadDependenciesRec(e,n){var o=n[e=isModuleFQN(e)?moduleFromModuleFQN(e):e];if(o)for(var t=0;t<o.length;t++){var a=o[t],s=a;isModuleFQN(a)&&(s=a,a+=".*"),loadDependenciesRec(a,n),objectFromFQN(a)||__launchLoader.getItem(s)||(a=fileFromFQN(a),DBLLog.log("Loading "+a,DBLLog.INFO),__launchLoader.loadFile({src:a,id:s,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1))}}(e=>{function t(e,n,o,t){void 0===t&&(t=void 0);var a=(o=void 0===o?void 0:o)||e,s=e.split(".");if("library"!=s[0]&&"assets"!=s[0]&&"test"!=s[0]&&"components"!=s[0]&&"engagement"!=s[0]&&"runtime"!=s[0])throw new Error("DBLRuntime.requireXXX() argument should begin with library, assets, test, components, engagement, or runtime.");"library"==n&&s.push(s[s.length-1]);var r=rootFromFQN(e)+s.join("/");if("audio"==n?r+=".mp3":"bundle"==n?r+=".js":"component"==n||"library"==n?(r+=".js",s.shift(),s.pop()):"external"==n&&(r+=".min.js"),"audio"==n){var i=__loadedAudio[o||e];if(i)urlsEqualIgnoringSuffix(i,r)||DBLLog.log("The same id has been used to requireAudio two different files!",DBLLog.ERROR);else for(var l=0;l<__audioToLoad.length;l++)if(__audioToLoad[l].id==(o||e)){i=!0;break}i||__suppressIESFX||(r+=getLoadSuffix(),__audioToLoad.push({id:o||e,src:r,data:t}))}else objectFromFQN(e)||__launchLoader.getItem(e)||(r+=getLoadSuffix(),DBLLog.log("Loading "+r,DBLLog.INFO),addExtraLoadDependenciesRec(e),__launchLoader.loadFile({src:r,id:e,loadTimeout:DEFAULT_LOAD_TIMEOUT},!0));return a}e.requireLibrary=function(e){return t(e,"library")},e.requireComponent=function(e){return t(e,"component")},e.requireExternal=function(e){return t(e,"external")},e.requireBundle=function(e,n){return t(e=(n=void 0===n?{}:n).localizeBundle?Loc.localizeBundle(e):e,"bundle")},e.requireArt=function(e){return t(e,"bundle")},e.requireAudio=function(e,n,o){return __useAudio?t(e,"audio",n,o):""},e.requireFont=function(e,n){if(e=e.split("."),__webFonts&&!IE){for(var o=rootURL+e.join("/"),t=[o+=".css",n||400],a=!1,s=0;s<__loadedFonts.length;s++)if(__loadedFonts[s][0]==t[0]&&__loadedFonts[s][1]==t[1]){a=!0;break}if(!a)for(s=0;s<__fontsToLoad.length;s++)if(__fontsToLoad[s][0]==t[0]&&__fontsToLoad[s][1]==t[1]){a=!0;break}a||__fontsToLoad.push(t)}return e[e.length-1]},e.loadLinkedAssets=function(e,n,a){var o="string"==typeof e?objectFromFQN(e):e;if(o){for(var s,t=o.properties.manifest,r=[],i=n?n.split(","):[],l=o.fqn.split("."),d=l.slice(0,l.length-1).join("/"),_=0;_<t.length;_++){var g,c=t[_].id,u=!1;if("*"==n)u=!0;else for(var L=0;L<i.length;L++)if(0<=c.toLowerCase().indexOf(i[L].trim().toLowerCase())){u=!0;break}u&&(g=rootFromFQN("string"==typeof e?e:e.fqn),t[_].src.substr(0,g.length)!=g&&(t[_].src=g+d+"/"+t[_].src+getLoadSuffix()),DBLLog.log("Loading linked asset "+t[_].src,DBLLog.INFO),r.push({src:t[_].src,id:t[_].id,crossOrigin:!0,loadTimeout:DEFAULT_LOAD_TIMEOUT}))}0==r.length?a():((l=__linkedAssetLoaders[o.fqn])?cleanupLoader(l):l=__linkedAssetLoaders[o.fqn]=createLoader(!0),s=window.AdobeAn.getComposition(o.properties.id),l.addEventListener("fileload",function(e){e&&"image"==e.item.type&&(s.getImages()[e.item.id]=e.result)}),setupLoader(l,function(e){if(s){var n=s.getSpriteSheet(),o=s.getLibrary().ssMetadata;if(n&&o){var t=e.target;for(_=0;_<o.length;_++)n[o[_].name]=new createjs.SpriteSheet({images:[t.getResult(o[_].name)],frames:o[_].frames})}}a()}),l.loadManifest(r))}else a()},e.fastForwardLoadLinkedAssets=function(){}})(DBLRuntime=DBLRuntime||{});var __bundlesToProcess,__componentsToFinalLoad,getLocation=function(e){var n=document.createElement("a");return n.href=e,n};function loadLessonDependencies(){var e=shell?shell.getLessonSupportModule():null;e&&!objectFromFQN(e)&&(e=fileFromFQN(e),DBLLog.log("Loading "+e,DBLLog.INFO),__launchLoader.loadFile({src:e,loadTimeout:DEFAULT_LOAD_TIMEOUT},!1)),__chosenBackgroundURL=__chosenBackgroundImg=void 0,__chosenProgress=void 0,addLessonDependenciesRec(lesson),__ttsInLesson=!0;for(var n=lesson;n;n=n.base)if("false"==n.__data.use_tts){__ttsInLesson=!1;break}__allowUnmappedInLesson=!1;for(n=lesson;n;n=n.base)if("true"==n.__data.allow_unmapped){__allowUnmappedInLesson=!0;break}__replayEnabledForLesson=!1;for(n=lesson;n;n=n.base)if("true"==n.__data.replay_enabled){__replayEnabledForLesson=!0;break}"primary"===engagement&&"intermediate"===getPreferredEngagement()&&loadItem("components.shared.academicpopup.AcademicPopup"),setupLoader(__launchLoader,onLessonDependenciesLoaded),__launchLoader.load()}function onLessonDependenciesLoaded(){__chosenBackgroundURL&&(__chosenBackgroundImg=__launchLoader.getResult(__chosenBackgroundURL)),resetLaunchLoader(),processBundlesWithLinkedAssets()}function onPotentialAnimateFileLoad(e){if("assets."==e.item.id.substr(0,7)&&window.AdobeAn&&window.AdobeAn.compositions){var n,o=0,t="";for(n in window.AdobeAn.compositions){var a,s=window.AdobeAn.compositions[n].getLibrary();s.properties.dblMarked||(a=e.item.id.split(".").join("_"),0==o&&((window[a]=s).fqn=e.item.id,s.properties.dblMarked=!0),o++,t+=" "+s.properties.id)}1<o&&DBLLog.log("Missing a call to onPotentialAnimateFileLoad() on fileload event: "+t,DBLLog.ERROR)}}function processBundlesWithLinkedAssets(){__bundlesToProcess=[];for(var e=lesson;e;){var n=e.__data.bundles;if(n)for(var o=0;o<n.length;o++){var t=n[o][1],a=n[o][2];if(a){for(var s=!1,r=0;r<__bundlesToProcess.length;r++)__bundlesToProcess[r][0]==t&&(s=!0);s||__bundlesToProcess.push([t,a])}}e=e.base}processAnotherBundle()}function processAnotherBundle(){var e;0==__bundlesToProcess.length?loadFonts():(e=__bundlesToProcess.shift(),DBLRuntime.loadLinkedAssets(e[0],e[1],processAnotherBundle))}function loadFonts(){var e;0<__fontsToLoad.length&&(!runningUnattended||replayMode||__bookmark)?(setupLoader(__launchLoader,onWebFontLoaderLoaded),e=rootURL+"runtime/webfontloader/webfontloader.min.js"+getLoadSuffix(),DBLLog.log("Loading "+e,DBLLog.INFO),__launchLoader.loadFile({src:e,loadTimeout:DEFAULT_LOAD_TIMEOUT},!0)):onFontsLoaded()}function onWebFontLoaderLoaded(){resetLaunchLoader();for(var e=[],n=[],o=0;o<__fontsToLoad.length;o++){var t=__fontsToLoad[o][0].split("/"),t=t[t.length-1].split(".")[0];e.push(t),DBLLog.log("Loading "+__fontsToLoad[o][0],DBLLog.INFO),n.push(__fontsToLoad[o][0])}window.WebFont.load({active:rawFontsLoaded,fontinactive:fontLoadFailed,inactive:rawFontsLoaded,custom:{families:e,urls:n}})}function fontLoadFailed(e,n){DBLLog.log("Failed to load font family "+e+" "+n,DBLLog.WARN)}function rawFontsLoaded(){__fontTesters=[],__fontWidths=[];for(var e=0;e<__fontsToLoad.length;e++){var n=__fontsToLoad[e][0].split("/"),n=n[n.length-1].split(".")[0],o=document.createElement("span"),t=document.createTextNode("QW@HhsXJ");o.appendChild(t),__fontTesters.push(o),o.style.position="absolute",o.style.top="-9999px",o.style.left="-9999px",o.style.visibility="hidden",o.style.fontFamily=__defaultFont,o.style.fontSize="250px",document.body.appendChild(o),__fontWidths.push(o.offsetWidth),o.style.fontFamily=n+","+__defaultFont,o.style.fontWeight=__fontsToLoad[e][1]}__fontsReady=0,__fontTimeout=1e3,__fontDelay=50,retry()}function retry(){setTimeout(checkFont,__fontDelay),__fontTimeout-=__fontDelay}function checkFont(){for(var e=0;e<__fontsToLoad.length;e++){var n=__fontTesters[e].offsetWidth;__fontWidths[e]!=n&&(__fontWidths[e]=n,__fontsReady++)}__fontsReady==__fontsToLoad.length||__fontTimeout<0?setTimeout(onFontsLoaded,1):retry()}function onFontsLoaded(){__loadedFonts=__loadedFonts.concat(__fontsToLoad),__fontsToLoad=[],(__loadingFontsForShell?(__loadingFontsForShell=!1,createShell):__loadingFontsForLogin?(__loadingFontsForLogin=!1,registerEventAudio(),createLogin):(registerEventAudio(),almostEverythingLoaded))()}function loadEventAudio(){if(0==__audioToLoad.length||runningUnattended)almostEverythingLoaded();else if(__tabHasFocus){for(__launchLoaderAudio.addEventListener("complete",eventAudioLoaded);0<__audioToLoad.length;){var e=__audioToLoad.shift();DBLLog.log("Loading "+e.src,DBLLog.INFO),e.loadTimeout=DEFAULT_LOAD_TIMEOUT,__launchLoaderAudio.loadFile(e,!1),__loadedAudio[e.id]=e.src}__launchLoaderAudio.load()}else DBLLog.log("Waiting for tab to regain focus before proceeding with audio load.",DBLLog.INFO),__waitingToLoadEventAudio=!0}function eventAudioLoaded(){__launchLoaderAudio.removeAllEventListeners("complete"),(0<__audioToLoad.length?loadEventAudio:almostEverythingLoaded)()}function registerEventAudio(){for(var e=0;e<__audioToLoad.length;e++){var n=__audioToLoad[e];createjs.Sound.registerSound(n.src,n.id,n.data),__loadedAudio[n.id]=n.src}__audioToLoad=[]}function almostEverythingLoaded(){if(webview&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.observe)try{window.webkit.messageHandlers.observe.postMessage("dropLoading")}catch(e){}__screenNew?__screenNew.load(delayLoadForModal):(lesson?initialSetupLesson:delayLoadForModal)()}function doFinalLoad(){for(var e in __componentsToFinalLoad=[],components)lesson[e].load&&__componentsToFinalLoad.push(lesson[e]);loadAnotherComponent()}function loadAnotherComponent(){for(;0<__componentsToFinalLoad.length;)return __componentsToFinalLoad.shift().load(loadAnotherComponent);delayLoadForModal()}function delayLoadForModal(){paused?__extendedLoadDueToModal=!0:everythingLoaded()}var __waitingForRunLessonRelease,__waitingForRunScreenRelease,__initialPageThawed=!1;function everythingLoaded(){screenerMode&&shell&&shell.waitForSpinnerToFinish?(shell.finishedLoading(),setTimeout(function(){shell&&everythingLoaded()},100)):__fatalErrorReached?immediateExit():(setupShell(),shell&&shell.hideLoadingScreen(),"none"!=engagement&&setupKeyPad(),(lesson?setupLesson:setupScreen)(),__spinner&&(engagementStage.removeChild(__spinner),__spinner=null),shell&&shell.hideContentScrim(),shell&&shell.hideSpinner(),thawContent(),__initialPageThawed||(__initialPageThawed=!0,runningViaClearingReload())||DBLQOSEventManager.recordEvent(DBLQOSEventManager.Key.SessionPlayInitialLoadDuration,getTime()-dreamboxStartTime),__qosPageLoadStartTime&&(DBLQOSEventManager.recordEvent(DBLQOSEventManager.Key.PageLoadDuration,getTime()-__qosPageLoadStartTime),__qosPageLoadStartTime=void 0),isScreenerLessonClearingReload()||dropClearingReload(100),lesson&&(runningUnattended||replayMode||(fastForwarding=!1),rootParams.lessonname&&shell.setLessonName(rootParams.lessonname),rootParams.lessontype&&shell.setLessonType(rootParams.lessontype),shell?shell.lessonIntro(startLesson):startLesson()))}function isScreenerLessonClearingReload(){return screenerMode&&__clearingLessonInfo}function setupShell(){var e;shell&&!__shellSetup&&(shell.ready(),DBLLog.log("shell ready()",DBLLog.INFO),e=engagementStage.canvas,__invalidEngagementRect=new createjs.Rectangle(0,0,e.width/dblDevicePixelRatio,e.height/dblDevicePixelRatio),__shellSetup=!0),__haltA11y||a11y.setupAccessibility()}function isHTMLComponent(e){return e&&"modules"==e.ref.split(".")[0]&&"generator"!=e.role&&"assessment"!=e.role}function initialSetupLesson(){DBLLog.log("Creating lesson components",DBLLog.INFO),replayMode&&(fastForwarding=!0);for(var e=__cHTMLComponentsOutstanding=0,n=(null==(o=lesson.lessonData)?void 0:o.components)||[];e<n.length;e++)isHTMLComponent(d=n[e])&&__cHTMLComponentsOutstanding++;if(0<__cHTMLComponentsOutstanding){var o=document.getElementById("lrt4LessonDiv"),t=lesson.lessonData.layouts,a=t[0];if(a.ref){var s=document.createElement("div");if(s.id=a.id,s.style.visibility="hidden",o.appendChild(s),1!=t.length)throw new Error("HTML Lesson should have exactly one layout component.");createHTMLComponentFromRef(a.ref,a.id)}else if(a.components){for(var r=document.createElement("div"),i=(r.style.position="relative",r.style.width="1024px",r.style.width="768px",r.style.visibility="hidden",r.style.position="absolute",r.style.top=(shell?shell.getHeaderHeight():0)+"px",o.appendChild(r),0),l=lesson.lessonData.components;i<l.length;i++)(n=>{var e,o;isHTMLComponent(n)&&((e=document.createElement("div")).id=n.id,r.appendChild(e),e.style.position="absolute",o=a.components.find(function(e){return e.id==n.id}))&&(e.style.left=o.x+"px",e.style.top=o.y+"px")})(d=l[i]);for(var d,_=0,g=lesson.lessonData.components;_<g.length;_++)isHTMLComponent(d=g[_])&&createHTMLComponentFromRef(d.ref,d.id)}}else initialSetupLessonCont()}function createHTMLComponentFromRef(e,n){var o,t;return isModuleFQN(e)?(o=factoryFromModuleFQN(e),t=classFromModuleFQN(e),"function"==typeof o?o(t,n):void DBLLog.log("Could not find module factory for ".concat(e," #").concat(n),DBLLog.ERROR)):null}function DBLRegisterReactLayout(e,n){window.layout=n,__layout=n}function DBLRegisterReactComponent(n,e){window.lesson[n]=e;var o=lesson.lessonData.layouts[0].components.find(function(e){return e.id==n});o&&!1!==o.visible||(e.visible=!1),0==--__cHTMLComponentsOutstanding&&initialSetupLessonCont()}function DBLDispatchComponentEvent(e,n){document.getElementById("lrt4LessonDiv").dispatchEvent(new CustomEvent("component_event",{detail:{source:e,event:n},bubbles:!0}))}function initialSetupLessonCont(){for(var e=[],n=lesson;n;)e.push(n),n=n.base;for(;0<e.length;)(n=e.pop()).init.call(n);for(var o,t=0;t<__importedLessons.length;t++){var a,s=__importedLessons[t].lesson,r=__importedLessons[t].fqn.split(".").join("_"),i=new window[r];for(a in i.init.call(i),i)"__data"!=a&&"__init"!=a&&(s[a]=i[a]);s.__data.mappings=s.__data.mappings.concat(i.__data.mappings),s.__data.components=s.__data.components.concat(i.__data.components),s.__data.bundles=s.__data.bundles.concat(i.__data.bundles),s.__data.states=s.__data.states.concat(i.__data.states),s.__data.problem_types=s.__data.problem_types.concat(i.__data.problem_types),s.__data.question_types=s.__data.question_types.concat(i.__data.question_types),s.__data.mistake_types=s.__data.mistake_types.concat(i.__data.mistake_types)}for(n=lesson.base;n;){for(var l in n)n.hasOwnProperty(l)&&!lesson.hasOwnProperty(l)&&(lesson[l]=n[l]);n=n.base}for(components={},__overriddenComponents=[],n=lesson;n;){for(var d=n.__data.components,t=0;t<d.length;t++){var _=d[t][0];components[_]?__overriddenComponents.push(n[_]):components[_]=n[_]}n=n.base}for(o in components)lesson[o]=components[o];doFinalLoad()}function setupLesson(){if(__chosenBackgroundImg&&((n=new createjs.Bitmap(__chosenBackgroundImg)).name="background",n.visible=!0,backgroundStage.addChildAt(n,0),__backgroundBitmap=n,rescaleBackground(lessonContent.scaleX)),shell){var e,n,o,t,a=lesson;if(isSquiggly())e="";else for(;a&&!e;)e=a.__data.progress_meter||a.__data.primary_progress_meter,a=a.base;__progressController=isSquiggly()?(n=DBLAsset.createArtFromBundle("DBLAProgressBarLarge","assets.bundles.engagement.squiggly.SquigglyShared"),t=DBLAsset.createArtFromBundle("DBLAProgressBarSmall","assets.bundles.engagement.squiggly.SquigglyShared"),o=objectFromFQN("assets.bundles.engagement.squiggly.SquigglyShared"),n.name=t.name="progress",__progressMeter=t,t=engagementStage.getChildIndex(shell.bottomBar),engagementStage.addChildAt(__progressMeter,t?t+1:engagementStage.numChildren),__progressMeter.scaleX=__progressMeter.scaleY=lessonContent.scaleX,new window.engagement_squiggly_shell.ProgressController(e,__chosenProgress,o,__progressMeter,n)):__chosenProgress&&isEarlyLearning()&&!screenerMode?(n=DBLAsset.createArt(__chosenProgress),o=objectFromFQN(__chosenProgress),n.setBounds(0,0,o.properties.width,o.properties.height),n.name="progress",__progressMeter=n,"bottombar"==e?(t=engagementStage.getChildIndex(shell.bottomBar),engagementStage.addChildAt(__progressMeter,t?t+1:engagementStage.numChildren),__progressMeter.scaleX=__progressMeter.scaleY=lessonContent.scaleX):(backgroundStage.addChildAt(__progressMeter,__chosenBackgroundImg?1:0),__progressMeter.y=shell.getHeaderHeight()*lessonContent.scaleX,__progressMeter.scaleX=__progressMeter.scaleY=1.094*lessonContent.scaleX),isPrimary(),new window.engagement_primary_shell.ProgressController(e,__chosenProgress,o,__progressMeter)):void 0}}function dropClearingReload(e){void 0===e&&(e=0),webview&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.observe&&runningViaClearingReload()&&(e?setTimeout(postMessageForClearingReload,e):postMessageForClearingReload())}function postMessageForClearingReload(){try{window.webkit.messageHandlers.observe.postMessage("dropClearingReload")}catch(e){}}function setupScreen(){isModuleFQN(screenfqn)||((useWebGL&&__screenNew.supportsWebGL?spriteContent:lessonContent).addChild(__screenNew),__screenNew.setBounds(0,0,1024,768)),components={},__eventCur=null,__eventQueue=[],__exiting=!1,__exited=!1,__exitCode=void 0,__cs=[],__ff=null,__ffObj=null,DBLVoiceChoice.init(),DBLPlay.initPlay(),DBLPopin.initPopin(),DBLTextInputFocusManager.init(),DBLAutomation.init(),interactive=!0,__skippable=!1,__lessonOrScreenStarted=!0,runningUnattended||(fastForwarding=!1),__resumeFunction=void 0,DBLActivityMonitor.init(),screencur=__screenNew,__screenNew=null,shell&&shell.screenReady(screencur),screencur.ready(),DBLLog.log("screen ready()",DBLLog.INFO),updateCopyrightDebugString(),isModuleFQN(screenfqn)?document.getElementById("lrt4LessonDiv").firstChild.style.visibility="visible":manualInvalidate(screencur),__openingPing||(__openingPing=!0,DBLActivityMonitor.openingPingServer(function(){})),__runScreenParams=null}function startLesson(){for(var e in __initialFreeze=!0,__frozenHTMLComponents=[],components)"function"==typeof(t=components[e]).dispatchEvent&&t.addEventListener(DBLComponentEvent.COMPONENT_EVENT,onComponentEvent);var n;if(document.getElementById("lrt4LessonDiv")&&document.getElementById("lrt4LessonDiv").addEventListener("component_event",onComponentEvent),__eventCur=null,__eventQueue=[],__exiting=!1,__exited=!1,__exitCode=void 0,__cs=[],__ff=null,__ffObj=null,__startingAS?__usingPreviousAS?logAutomation('new lesson "'+lessonfqn+'", resume'):logAutomation('new lesson "'+lessonfqn+'", '+JSON.stringify(__startingAS)):logAutomation('new lesson "'+lessonfqn+'", '+__startingSeeds[0]+", "+__startingSeeds[1]),initStates(),initLayouts(),SnwRaDh.guagd(),SnwRaDh.goecz(),DfhgSgh.gladg(),DfhgSgh.mmset(),DfhgSgh.vbacg(),DfhgSgh.gaeith(),DfhgSgh.glgaj(),DfhgSgh.mgathg(),SnwRaDh.angae(),DBLVoiceChoice.init(),DBLPlay.initPlay(),DBLPopin.initPopin(),DBLAutomation.init(),DBLActivityMonitor.init(),DBLTextInputFocusManager.init(),__startingAS&&(DfhgSgh.amgpt(__startingAS),n=Math.min(Math.max(Math.round(DfhgSgh.mfeh()),0),100),__progressController&&(__suppressPlaySound=!0,__progressController.resetProgress(n),__suppressPlaySound=!1),1==__logDataVersion)&&logAutomation("progress "+n),__interactive=!0,__skippable=!1,__helpEnabled=!0,"canvas"==presentation||"mixed"==presentation){for(var o in __layout=void 0,__layouts){__layout=__layouts[o];break}__layout&&(updateLayout(!0,!1,!1),updateLayout(!1,!0,!1))}var t;for(e in components)"function"==typeof(t=components[e]).ready&&t.ready.call(t),muted&&"function"==typeof t.mute&&t.mute();a11y.lessonReady(),replayMode&&(setupForReplay(),messageParent("replay-data",{version:"ordered",replayData:DBLReplay.getSlideRecords(__replayTranscript)})),isVisualCheckSaveOrReplay()&&(fastForwarding=!0);function a(){var e=!1;__states.start?e=(__state=__states.start).runEnter.call(__states.start):DBLLog.log("Lesson has no 'start' state.",DBLLog.WARN),shell&&shell.lessonReady(),DBLLog.log("lesson ready()",DBLLog.INFO),__lessonOrScreenStarted=!0,__seenMuteCheck=void 0,updateCopyrightDebugString(),e||runEventLoop()}rootParams.pauseonstart&&"function"==typeof shell.showPausePopupOnStart?shell.showPausePopupOnStart(a):a()}function applyLayoutPropertiesCanvas(e,n){e.x=n.x,e.y=n.y,e.scaleX=n.scaleX||n.scale,e.scaleY=n.scaleY||n.scale,e.visible=n.visible}function applyLayoutPropertiesHTML(e,n){var o=document.getElementById(n.name);o&&(o.style.left=n.x+"px",o.style.top=n.y+"px"),e.visible=n.visible}function updateLayout(e,n,o){for(var t=0;t<__layout.items.length;t++){var a=__layout.items[t],s=a.name,r=!1,i=(".json"==lessonfqn.substr(-5)&&(r=isHTMLComponent(lesson.lessonData.components.find(function(e){return e.id==s}))),lesson[s]);screenerMode&&-1!=["hint","hintbutton"].indexOf(s.toLowerCase())||(i?(e&&((r?applyLayoutPropertiesHTML:applyLayoutPropertiesCanvas)(i,a),i.name=s),n&&!r&&(useWebGL&&i.supportsWebGL?spriteContent:lessonContent).addChild(i),o&&"function"==typeof i.resize&&i.resize.call(i)):DBLLog.log("Could not layout component "+s,DBLLog.ERROR))}if("html"==presentation||"mixed"==presentation)for(var l=0,d=lesson.lessonData.components;l<d.length;l++)(n=>{!isHTMLComponent(n)||__layout.items.find(function(e){return e.name==n.id})||(lesson[n.id].visible=!1)})(d[l])}function setLayout(e){e!=__layout&&(__layout=e,DBLLog.log("setLayout("+__layout.name+")",DBLLog.INFO),lessonContent.removeAllChildren(),updateLayout(!0,!0,!0))}function setupKeyPad(){__keyPad&&__keyPadController||(__keyPad=new window.engagement_shared.KeyPadView,__keyPadController=new window.engagement_shared.KeyPadController(__keyPad))}function userRunScreen(e,n){DBLLog.log("userRunScreen("+e+")",DBLLog.INFO),__qosPageLoadStartTime=getTime(),__userRunLessonDrainTimer&&(clearTimeout(__userRunLessonDrainTimer),__userRunLessonDrainTimer=null),__runScreenParams=n,fastForwarding&&"popup"==__fastForwardHint?(__delayedUserRunScreen=e,DBLLog.log(" - delayed till thaw (just before popup)",DBLLog.INFO),fastForwarding=!1):fastForwarding&&"nav"==__fastForwardHint?(DBLLog.log(" - ignoring as next runScreen will preempt",DBLLog.INFO),fastForwarding=!1):(__delayedUserRunScreen=void 0,screenerMode&&shell.showSpinner(),setTimeout(function(){userRunScreenActual(e,n)},1))}function userRunScreenActual(o,e){freezeContent(),lesson&&cleanupLesson(),screencur&&cleanupScreen(),cleanupLinkedAssets(),shell.showContentScrim(),shell.showSpinner(),screenfqn=o,DBLStateManager.cancelAllSyncs(function(){if(__clearingReloads){var e="engagement.primary.games.",n="engagement.intermediate.minigames.";if(o.substr(0,e.length)==e||o.substr(0,n.length)==n)return void setTimeout(function(){doClearingReload(screenfqn,__runScreenParams,null)},100)}rootParams.holdlowtide?__waitingForRunScreenRelease=!0:loadLessonOrScreen()})}function userRunLesson(e){screenerMode&&shell.showSpinner(!0),__qosPageLoadStartTime=getTime(),__userRunLessonDrainTimer=setTimeout(function(){__userRunLessonDrainTimer=null,userRunLessonActual(e)},1)}function userRunLessonActual(e){e.lessonId?DBLLog.log("userRunLesson("+e.lessonId+")",DBLLog.INFO):e.lessonFQN?DBLLog.log("userRunLesson("+e.lessonFQN+")",DBLLog.INFO):assert(!1),fastForwarding&&"popup"==__fastForwardHint?(__delayedUserRunLesson=e,DBLLog.log(" - delayed till thaw",DBLLog.INFO),fastForwarding=!1):fastForwarding&&"nav"==__fastForwardHint?(DBLLog.log(" - ignoring as next runScreen will preempt",DBLLog.INFO),fastForwarding=!1):(freezeContent(),screencur&&cleanupScreen(),shell.showContentScrim(),shell.showSpinner(!0),DBLStateManager.cancelAllSyncs(function(){__clearingReloads?setTimeout(function(){doClearingReload(null,null,e)},100):rootParams.holdlowtide?__waitingForRunLessonRelease=e:DBLLessonManager.startLesson(e,onLessonReady)}))}function restartFromLowMemoryMark(){}function onLessonReady(e,n,o,t,a,s,r,i,l,d,_,g){"V3."==d.substr(0,3)?DBLLog.log("V4 runtime can't run a V3 lesson",DBLLog.FATAL,DBLError.UNSUPPORTED_LRT):(__lessonhash=e,__lessonid=n,__lessonpid=o,__lessonuuid=t,__lessontype=a,__lessonaid=r,__assignmentType=i,__startingAS=l,__lessonrid=_,__seedOverride=g,runLesson(d))}function autosave(e){var n=(getTime()-__timeLastAutoSave)/1e3;__autoSave&&DfhgSgh.hperg()&&DBLLessonManager.getLessonActive()&&60<n?(__timeLastAutoSave=getTime(),DBLLessonManager.autoSaveLesson(__lessonid,DfhgSgh.olgki(SnwRaDh.EXIT_CODE_AUTO_SAVE),__transcript,e)):e()}function fastForwardAutosave(){}function userStop(){__eventQueue=[],__nextState=null,__pendingPause=!1,commonExit(5)}function inactiveExit(){shell&&shell.closeAnyPausePopup(),lesson?commonExit(4):finalExit()}function userExit(){!lesson||screenerMode&&shell.waitForSpinnerToFinish||__delayedUserRunScreen?finalExit():(frozen&&userResume(),commonExit(3))}function commonExit(e){assert(lesson,"lesson"),DBLActivityMonitor.cleanup(),DBLSkippable.cleanup(),DBLAutomation.recordUserExit(),a11y.cleanup(),__exited=!1,exit(e),runEventLoop()}function exit(e){__exitCode=e,replayMode||(__exiting=!0)}function actuallyExit(){DBLLog.log("exit("+(null!=__exitCode?__exitCode:"")+")",DBLLog.INFO),assert(lesson,"lesson"),DBLAutomation.recordConfiguration(),logAutomation("exit lesson"+(null!=__exitCode?" "+__exitCode:"")),DfhgSgh.hgaek();var e,n,o=DfhgSgh.olgki(__exitCode,SnwRaDh.seeafels()),t=(3==__exitCode||4==__exitCode||5==__exitCode?e=[]:o&&o.mo&&(e=o.mo,screenerMode||incrementLessonsCompleted()),shell&&(shell.setLastLessonCompleted(0==__exitCode||1==__exitCode||2==__exitCode),shell.setLastLessonSuccessful(1==__exitCode)),0);for(n in DfhgSgh.mgpa)t++;0<t&&(logAutomation("score "+JSON.stringify(e)),logAutomation("as "+JSON.stringify(o))),__runningMultipleLanguages&&lcid==Lcid.USEnglish?__previousASDeferred=o:__previousAS=__runningMultipleLanguages&&lcid===Lcid.USSpanish?__previousASDeferred:o;var a={exit:__exitCode,lessonId:__lessonid,transcript:__transcript};!intern&&!runningLessonDirectly()&&DBLLessonManager.getLessonActive()?(__ff=fastForwardEndLesson,DBLLessonManager.endLesson(e,o,a,onEndLessonComplete)):finalExit()}function incrementLessonsCompleted(){__lessonsCompletedThisWeek++,__lessonsCompletedThisYear++}function fastForwardEndLesson(){}function onEndLessonComplete(e){__ff=null,__transcript=null,__keyPad&&__keyPad.hideImmediate(),shell&&shell.lessonOutro(__exitCode,e,onLessonOutroComplete)}function onLessonOutroComplete(){__keyPad&&__keyPad.isInTheProcessOfHiding()?setTimeout(onLessonOutroComplete,10):onKeyPadDown()}function onKeyPadDown(){3==__exitCode||4==__exitCode||0!=audienceType?finalExit():(shell.pressedBack=__exitCode==SnwRaDh.EXIT_CODE_BACK_CLICKED,userRunScreen(shell.getLessonExitScreen()))}function finalExit(){setTimeout(function(){finalExitActual()},1)}function finalExitActual(){lesson&&cleanupLesson(),screencur&&cleanupScreen(),cleanupLinkedAssets(),cleanupEngagement(),cleanupRest(),(__donefn||(__screenFile?runNextScreenerLesson:!__suiteFile||__runningMultipleLanguages||__ignorePlayMismatches?__suiteFile&&__runningMultipleLanguages?loadSuiteTestInADifferentLanguage:__runningMultipleLanguages?loadTestInADifferentLanguage:__suiteFile&&__ignorePlayMismatches?loadSuiteTestAndIgnorePlayMismatches:__ignorePlayMismatches?loadTestAndIgnorePlayMismatches:immediateExit:runAnotherTest))()}function cleanupScreen(){screencur.cleanup(),lessonContent.removeChild(screencur),screencur=null,screenfqn=null,__lessonOrScreenStarted=!1,DBLActivityMonitor.cleanup(),DBLTextInputFocusManager.cleanup(),DBLPlay.initPlay(),DBLPopin.initPopin(),DBLAutomation.init(),__cursorOwner=null,__frozenComponents=[],checkDOMCleanup(),checkStageEventCleanup(),checkTickerCleanup(),checkTweenCleanup()}function cleanupLinkedAssets(){if(window.AdobeAn&&window.AdobeAn.compositions)for(var e in window.AdobeAn.compositions){var n=window.AdobeAn.compositions[e].getImages();for(o in n)delete n[o];var o,t=window.AdobeAn.compositions[e].getSpriteSheet();for(o in t)delete t[o]}for(var a in __linkedAssetLoaders)cleanupLoader(__linkedAssetLoaders[a]);__linkedAssetLoaders={}}function checkStageEventCleanup(){lessonStage.removeAllEventListeners()}function checkTweenCleanup(){gsap.TweenMax.killAll()}function checkTickerCleanup(){createjs.Ticker.removeEventListener("tick",tick),createjs.Ticker.removeEventListener("tick",createjs.Tween),createjs.Ticker.removeAllEventListeners("tick"),createjs.Ticker.addEventListener("tick",createjs.Tween),createjs.Ticker.addEventListener("tick",tick)}function cleanupTestHooks(){var e=document.getElementById("htmlcontent"),n=document.getElementById(DOM_TEST_DIV),o=document.getElementById(TEMP_TEST_DIV);e.innerHTML="",null==n||null==o?DBLLog.log("Unable to find test hooks in DOM",DBLLog.WARN):(o.innerHTML="",e.append(n))}function checkDOMCleanup(){var e=document.getElementById("htmlcontent");e&&!__domTestHooks?(0<e.childElementCount&&DBLLog.log("DOM elements not cleaned up!!!",DBLLog.INFO),e.innerHTML=""):e&&__domTestHooks&&cleanupTestHooks()}function callCleanup(e){"function"==typeof e.cleanup?e.cleanup():DBLLog.log(e.constructor.name+" doesn't have a cleanup function - possible memory-leak.",DBLLog.INFO)}function cleanupLesson(){try{for(var e in DBLSkippable.cleanup(),components)callCleanup(components[e]);if(__overriddenComponents)for(var n=0;n<__overriddenComponents.length;n++)callCleanup(__overriddenComponents[n]);a11y.cleanupLesson()}catch(e){globalErrorHandler("Exception in cleanup - recovered, but memory-leak possible",null,null,null,e)}lessonContent.removeAllChildren();var o=document.getElementById("lrt4LessonDiv");o&&(o.textContent="",o.style.opacity="1"),lessonContent.alpha=1,components={},__overriddenComponents=[],__lessonOrScreenStarted=!1,lesson=null,__baseLessons=[],initStates(),initLayouts(),SnwRaDh.guagd(),SnwRaDh.goecz(),DfhgSgh.gladg(),DfhgSgh.mmset(),DfhgSgh.vbacg(),DfhgSgh.gaeith(),DfhgSgh.glgaj(),DfhgSgh.mgathg(),SnwRaDh.angae(),DBLPlay.initPlay(),DBLPopin.initPopin(),DBLAutomation.init(),DBLActivityMonitor.init(),DBLTextInputFocusManager.init(),DBLTextInputFocusManager.resetDeferredFocus(),__progressMeter&&(lessonStage.contains(__progressMeter)?lessonStage.removeChild(__progressMeter):engagementStage.contains(__progressMeter)?engagementStage.removeChild(__progressMeter):backgroundStage.contains(__progressMeter)&&backgroundStage.removeChild(__progressMeter),__progressMeter=void 0,__progressController.cleanup(),__progressController=void 0),__backgroundBitmap&&(backgroundStage.removeChild(__backgroundBitmap),__backgroundBitmap=void 0),lessonfqn=null,__lessonid=0,__lessonuuid=null,__startingSeeds=[],__cursorOwner=null,__frozenComponents=[],checkDOMCleanup(),checkStageEventCleanup(),checkTickerCleanup(),checkTweenCleanup()}function cleanupEngagement(){shell&&(engagementStage&&engagementStage.removeChild(shell),shell.cleanup(),shell=null,__shellSetup=!1)}function cleanupRest(){DBLMessageManager.cleanup(),DBLPopin.cleanupPopin(),createjs.Ticker.removeAllEventListeners(),__keyPad&&__keyPad.cleanup(),__keyPad=null,__keyPadController&&__keyPadController.cleanup(),__keyPadController=null,lessonStage&&(lessonStage.removeAllEventListeners(),lessonStage.removeAllChildren(),lessonStage.clear(),lessonStage=void 0),engagementStage&&(engagementStage.removeAllEventListeners(),engagementStage.removeAllChildren(),engagementStage.nextStage=void 0,engagementStage.clear(),engagementStage=void 0);var e=document.getElementById("htmlcontent"),e=(e&&!__domTestHooks?e.innerHTML="":e&&__domTestHooks&&cleanupTestHooks(),document.getElementById("copyright"));e&&(e.innerHTML=""),a11y.cleanup()}function immediateExit(e,n){if(!__studentExitCalled)if(__exited=!0,standalone){if(__transcript)a=(a="<xmp>")+JSON.stringify(__transcript,null,2)+"</xmp>",(t=document.getElementById("jscontent")).outerHTML=a,document.body.style.backgroundColor="#3cede5";else if(__actualLog){var o,t,a="<xmp>",s=!1;if(__suiteOutput)a=__suiteOutput,s=!0,a+=__actualLog[__actualLog.length-1];else{for(var r=0,i=0;r<__actualLog.length;r++,i++){if(!s&&__testLog&&r<Math.min(__actualLog.length,__testLog.length)){if(!isVisualCheckQuickOrFull()&&0<__linesSkippedTest)for(;i<__testLog.length&&isSnapshotRecordLine(__testLog[i]);)i++;__actualLog[r]!=__testLog[i]&&(s=!0)}a+=getActualLogLine(r)}__testLog&&__actualLog.length!=__testLog.length-__linesSkippedTest&&(s=!0)}(rootParams.multipleLanguages||rootParams.ignorePlayMismatches)&&(o=(a+=__languageMismatch).split("<xmp>"),a="<xmp>"+__languageOutput+o[1]),(t=document.getElementById("jscontent"))&&(t.outerHTML=a+="</xmp>"),__runningMultipleLanguages?document.body.style.backgroundColor="#538eed":__ignorePlayMismatches&&0<__languageMismatch.length?document.body.style.backgroundColor=__fatalErrorReached?"#ff8080":"#3cede5":document.body.style.backgroundColor=s?"#ff8080":"#80ff80",__invalidObjects=[]}}else 2==e?closeWindowRedirect(n):(__immediateExitCode=e,__studentExitCalled=!0,__studentId&&finalExitSequence())}function finalExitSequence(){setTimeout(onStudentExitComplete,2e3),DBLStateManager?DBLStateManager.syncProperties(finalExitSequence2):finalExitSequence2()}function finalExitSequence2(){DBLClientEventManager?DBLClientEventManager.sendNow(finalExitSequence3):finalExitSequence3()}function finalExitSequence3(){var e=new XMLHttpRequest;e.open("POST",serverURL+"public/v1/users/"+__studentId+"/clientExit",!0),e.setRequestHeader("Content-type","application/json"),e.setRequestHeader("DBL-AuthSessionUuid",authSession),clientInstance&&e.setRequestHeader("DBL-ClientInstanceUuid",clientInstance),e.setRequestHeader("DBL-ClientRequestUuid",uuidv4()),e.onreadystatechange=function(){4==e.readyState&&onStudentExitComplete()},e.onerror=onStudentExitComplete,e.send("")}function onStudentExitComplete(){DBLStateManager.cleanup(),DBLClientEventManager.cleanup(),__fatalErrorReached?(!window.DBLError||DBLError.isLoadError(__fatalErrorReached)?closeWindowIOError:closeWindowFatalError)(__fatalErrorReached,0):__sessionSuperseded?closeWindowRedirect("../play/newclientstarted"):(1==__immediateExitCode?closeWindowSetupParent:closeWindow)()}function doClearingReload(e,n,o){for(var t=(t=__originalUrl.split("?"))[1]?t[1].split("&"):[],a=document.location.protocol+"//"+document.location.host+document.location.pathname,s=!0,r=0;r<t.length;r++)0==t[r].indexOf("clearing")&&0!=t[r].indexOf("clearingreloads")||(a+=(s?"?":"&")+t[r],s=!1);if(e?(a+="&clearingscreen="+e,n&&(a+="&clearingscreenparams="+n)):o&&(o.lessonId?(a=(a=(a+="&clearinglessonid="+o.lessonId)+"&clearingassignmenttype="+o.assignmentType)+"&clearingassignmentid="+o.assignmentId+"&clearinglessonfqn="+o.fqln,o.recommendationUuid&&(a+="&clearinglessonrid="+o.recommendationUuid)):o.lessonFQN?a+="&clearinglessonfqn="+o.lessonFQN:assert(!1)),DBLLog.log("Performing a clearing reload",DBLLog.INFO),persistSessionState(),window.setAbnormalToken&&setAbnormalToken(!1),window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.observe)try{window.webkit.messageHandlers.observe.postMessage("clearingReload "+a)}catch(e){}else window.location.href=a}function localStorageAvailable(){try{var e=window.localStorage,n="__storage_test__";return e.setItem(n,n),e.removeItem(n),!0}catch(e){}return!1}function persistSessionState(){var e;shell&&"function"==typeof shell.persistSessionState&&shell.persistSessionState(),localStorageAvailable()&&(e={avatar:__user._avatar_,data:__user._data_,theme:theme,story:story,goal:goal,muted:muted,area:area,questId:questId},window.localStorage.setItem("sessionState",JSON.stringify(e)),window.localStorage.setItem("sessionProperties",JSON.stringify(__sessionProperties)),window.localStorage.setItem("sessionSequenceCache",JSON.stringify(DBLStateManager.getSequenceCache())),window.localStorage.setItem("apiSequence",__apiSequence.toString()),window.localStorage.setItem("lessonsCompletedThisWeek",__lessonsCompletedThisWeek),window.localStorage.setItem("prevWeeksInStreak",__prevWeeksInStreak),window.localStorage.setItem("initialWeeklyTime",__initialWeeklyTime),window.localStorage.setItem("avatarPricing",JSON.stringify(__avatarPricing||null)),window.localStorage.setItem("wallpaperPricing",JSON.stringify(__wallpaperPricing||null)),window.localStorage.setItem("musicPricing",JSON.stringify(__musicPricing||null)),window.localStorage.setItem("ttsCacheBase",JSON.stringify(__ttsCacheBase||null)),window.localStorage.setItem("sessionUnsentClientEvents",JSON.stringify(DBLClientEventManager.getUnsentEvents())),window.localStorage.setItem("sessionQosEventKeysDisabled",JSON.stringify(DBLClientEventManager.getUnsentEvents())),__qosPageLoadStartTime&&window.localStorage.setItem("qosPageLoadStartTime",__qosPageLoadStartTime),void 0!==__lessonsCompletedThisYear&&window.localStorage.setItem("lessonsCompletedThisYear",__lessonsCompletedThisYear),void 0!==__longestStreakThisYear&&window.localStorage.setItem("longestStreakThisYear",__longestStreakThisYear),void 0!==__initialYearlyTime&&window.localStorage.setItem("initialYearlyTime",__initialYearlyTime),window.localStorage.setItem("sessionAssessmentType",__assessmentType),window.localStorage.setItem("sessionScreenerMode",JSON.stringify(screenerMode||null)),window.localStorage.setItem("sessionScreenerHelpMe",JSON.stringify(screenerHelpMe||null)),window.localStorage.setItem("sessionFixedForm",JSON.stringify(fixedForm||null)))}function reifySessionState(){var e;localStorageAvailable()&&(e=JSON.parse(window.localStorage.getItem("sessionState")),__user._avatar_=e.avatar,__user._data_=e.data,theme=e.theme,story=e.story,goal=e.goal,muted=e.muted,area=e.area,questId=e.questId,__sessionProperties=JSON.parse(window.localStorage.getItem("sessionProperties")),__initialStateManagerSequenceNumber=parseInt(window.localStorage.getItem("sessionSequenceNumber")),__initialStateManagerSequenceCache=JSON.parse(window.localStorage.getItem("sessionSequenceCache")),__initialLessonManagerSequenceNumber=parseInt(window.localStorage.getItem("sessionSequenceNumber2")),__apiSequence=parseInt(window.localStorage.getItem("apiSequence")),__lessonsCompletedThisWeek=parseInt(window.localStorage.getItem("lessonsCompletedThisWeek")),__prevWeeksInStreak=parseInt(window.localStorage.getItem("prevWeeksInStreak")),__initialWeeklyTime=parseInt(window.localStorage.getItem("initialWeeklyTime")),__avatarPricing=JSON.parse(window.localStorage.getItem("avatarPricing")),__wallpaperPricing=JSON.parse(window.localStorage.getItem("wallpaperPricing")),__musicPricing=JSON.parse(window.localStorage.getItem("musicPricing")),__ttsCacheBase=JSON.parse(window.localStorage.getItem("ttsCacheBase")),__initialClientEventManagerEvents=JSON.parse(window.localStorage.getItem("sessionUnsentClientEvents")),__initialQosEventKeysDisabled=JSON.parse(window.localStorage.getItem("sessionQosEventKeysDisabled")),__qosPageLoadStartTime=parseInt(window.localStorage.getItem("qosPageLoadStartTime")),__lessonsCompletedThisYear=parseInt(window.localStorage.getItem("lessonsCompletedThisYear"))||0,__longestStreakThisYear=parseInt(window.localStorage.getItem("longestStreakThisYear"))||0,__initialYearlyTime=parseInt(window.localStorage.getItem("initialYearlyTime"))||0,__assessmentType=window.localStorage.getItem("sessionAssessmentType"),screenerMode=JSON.parse(window.localStorage.getItem("sessionScreenerMode")||"false"),screenerHelpMe=JSON.parse(window.localStorage.getItem("sessionScreenerHelpMe")||"false"),fixedForm=JSON.parse(window.localStorage.getItem("sessionFixedForm")||"false"))}function sessionSuperseded(e){__sessionSuperseded||(__sessionSuperseded=!0,e?DBLLog.log("Session superseded by login same student on a different tab or window",DBLLog.FATAL,32011):DBLLog.log("Session superseded by login different student on a different tab or window",DBLLog.FATAL,32012))}function getActualLogLine(e){var n="";return n=isPowerThroughClean()&&__invalidInputsLog[e]?n:__actualLog[e]+"\n"}function resetVisualCheckParams(){isVisualCheckEnabled()&&DBLVisualTestUtils.resetVisualCheckParams()}function processAssessmentType(e){e.assessmentType&&(__assessmentType=e.assessmentType,fixedForm=__assessmentType.toLowerCase()==ASSESSMENT_TYPE_STRING_FIXED_FORM.toLowerCase(),screenerMode=__assessmentType.toLowerCase()==ASSESSMENT_TYPE_STRING_SCREENER.toLowerCase()||fixedForm),e.screenerMode&&(screenerMode="true"==e.screenerMode,__assessmentType=screenerMode?ASSESSMENT_TYPE_STRING_SCREENER:""),e.fixedForm&&(fixedForm="true"==e.fixedForm,screenerMode=fixedForm,__assessmentType=fixedForm?ASSESSMENT_TYPE_STRING_FIXED_FORM:""),screenerHelpMe=!!screenerMode&&"true"==e.screenerHelpMe}